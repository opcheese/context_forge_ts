import{S as C,b as I,c as k,g as v,r as l,j as e,k as S}from"./index-lxgQ_mJ1.js";import{a as g}from"./api-CRlO8hFs.js";import{B as a}from"./button-NEfGHqYM.js";import{u as P}from"./SessionContext-BuMPhUm7.js";function _(t){const r=Math.floor((Date.now()-t)/1e3);return r<60?"just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:`${Math.floor(r/86400)}d ago`}function A({project:t,isOpen:r,onClose:d}){const[s,c]=l.useState(t.name),[p,h]=l.useState(t.description??""),[u,f]=l.useState(!1),x=v(g.projects.update),j=async o=>{o.preventDefault(),f(!0);try{await x({id:t._id,name:s.trim(),description:p.trim()||void 0}),d()}finally{f(!1)}};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Edit Project"}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-name",className:"block text-sm font-medium mb-1",children:"Name"}),e.jsx("input",{id:"edit-name",type:"text",value:s,onChange:o=>c(o.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-description",className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{id:"edit-description",value:p,onChange:o=>h(o.target.value),rows:3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),e.jsx(a,{type:"submit",disabled:!s.trim()||u,children:u?"Saving...":"Save Changes"})]})]})]})}):null}function D({projectId:t,isOpen:r,onClose:d,onCreated:s}){const[c,p]=l.useState(""),[h,u]=l.useState(""),[f,x]=l.useState(!1),j=k(g.templates.list),o=v(g.projects.createSession),b=async i=>{i.preventDefault(),x(!0);try{const N=await o({projectId:t,name:c.trim()||void 0,templateId:h||void 0});p(""),u(""),d(),s(N)}finally{x(!1)}};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Create Session in Project"}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"session-name",className:"block text-sm font-medium mb-1",children:"Session Name (optional)"}),e.jsx("input",{id:"session-name",type:"text",value:c,onChange:i=>p(i.target.value),placeholder:"Step 1: Initial Brainstorm",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"template-select",className:"block text-sm font-medium mb-1",children:"Start from Template (optional)"}),e.jsxs("select",{id:"template-select",value:h,onChange:i=>u(i.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Start empty"}),j?.map(i=>e.jsxs("option",{value:i._id,children:[i.name," (",i.blocks.length," blocks)"]},i._id))]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),e.jsx(a,{type:"submit",disabled:f,children:f?"Creating...":"Create Session"})]})]})]})}):null}function z({session:t,onOpen:r,onRemove:d}){const[s,c]=l.useState(!1);return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.stepNumber!==void 0&&e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",children:["Step ",t.stepNumber]}),e.jsx("h3",{className:"font-medium truncate",children:t.name??`Session ${t._id.slice(-6)}`})]}),t.systemPrompt&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:["System: ",t.systemPrompt.slice(0,50),"..."]})]}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-nowrap",children:t.updatedAt??t.createdAt?_(t.updatedAt??t.createdAt):""})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(a,{variant:"outline",size:"sm",onClick:r,children:"Open"}),s?e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"destructive",size:"sm",onClick:d,children:"Confirm"}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>c(!1),children:"Cancel"})]}):e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>c(!0),className:"text-muted-foreground",children:"Remove from Project"})]})]})}function O(){const{projectId:t}=C.useParams(),r=I(),{switchSession:d}=P(),s=k(g.projects.get,{id:t}),c=v(g.projects.removeSession),p=v(g.workflows.advanceStep),[h,u]=l.useState(!1),[f,x]=l.useState(!1),[j,o]=l.useState(!1),b=n=>{d(n),r({to:"/app"})},i=async n=>{await c({sessionId:n})},N=async()=>{if(!s||!s.workflow)return;const n=s.sessions.find(m=>m.stepNumber===s.currentStep);if(n){o(!0);try{const m=await p({projectId:s._id,previousSessionId:n._id});b(m.sessionId)}finally{o(!1)}}};return s===void 0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Loading project..."}):s===null?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-lg font-medium mb-2",children:"Project not found"}),e.jsx(S,{to:"/app/projects",children:e.jsx(a,{variant:"outline",children:"Back to Projects"})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(S,{to:"/app/projects",className:"hover:text-foreground",children:"Projects"}),e.jsx("span",{children:"/"})]}),e.jsx("h1",{className:"text-2xl font-bold",children:s.name}),s.description&&e.jsx("p",{className:"text-muted-foreground mt-1",children:s.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a,{variant:"outline",onClick:()=>u(!0),children:"Edit"}),e.jsx(a,{onClick:()=>x(!0),children:"+ Add Session"})]})]}),s.workflow&&e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"WORKFLOW"}),e.jsx(S,{to:"/app/workflows/$workflowId",params:{workflowId:s.workflow._id},className:"text-sm font-medium hover:underline",children:s.workflow.name})]}),s.currentStep!==void 0&&s.currentStep<s.workflow.steps.length-1&&e.jsx(a,{size:"sm",onClick:N,disabled:j,children:j?"Advancing...":"Next Step →"})]}),e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto pb-2",children:s.workflow.steps.map((n,m)=>{const w=(s.currentStep??0)>m,y=s.currentStep===m;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-medium whitespace-nowrap ${w?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":y?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"}`,children:[e.jsx("span",{className:"w-5 h-5 rounded-full flex items-center justify-center bg-white/20",children:w?"✓":m+1}),n.name]}),m<s.workflow.steps.length-1&&e.jsx("div",{className:`w-4 h-0.5 mx-1 ${w?"bg-green-500":"bg-border"}`})]},m)})}),s.currentStep===s.workflow.steps.length-1&&e.jsx("div",{className:"mt-2 text-xs text-green-600 dark:text-green-400",children:"✓ Workflow complete"})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold mb-3",children:["Sessions (",s.sessions.length,")"]}),s.sessions.length===0?e.jsxs("div",{className:"text-center py-8 border border-dashed border-border rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No sessions in this project yet."}),e.jsx(a,{onClick:()=>x(!0),children:"Create First Session"})]}):e.jsx("div",{className:"grid gap-3",children:s.sessions.map(n=>e.jsx(z,{session:n,onOpen:()=>b(n._id),onRemove:()=>i(n._id)},n._id))})]}),h&&e.jsx(A,{project:s,isOpen:h,onClose:()=>u(!1)}),e.jsx(D,{projectId:s._id,isOpen:f,onClose:()=>x(!1),onCreated:b})]})}export{O as component};
