import{r as n,b as C,d as y,G as B,j as e,A as L,m as S,e as p,g}from"./index-C_UHGseK.js";import{a as u}from"./api-B6BZvDqw.js";import{B as E}from"./button-nz7UIBa1.js";function R({isOpen:x,onClose:k,type:F,sourceId:w,sourceName:c,sourceDescription:f,publishedMarketplaceId:r,onSuccess:U}){const[a,h]=n.useState(c),[o,j]=n.useState(f??""),[i,m]=n.useState(""),[l,v]=n.useState(r?"update":"new"),[N,P]=n.useState(!1),s=C(u.marketplace.listCategories),$=y(u.marketplace.publishTemplate),D=y(u.marketplace.publishWorkflow),T=y(u.marketplace.update),d=C(u.marketplace.get,r?{id:r}:"skip"),{toast:b}=B();n.useEffect(()=>{x&&(l==="update"&&d?(h(d.name??c),j(d.description??""),m(d.category??s?.[0]?.slug??"")):(h(c),j(f??""),s?.length&&m(s[0].slug)))},[x,l,d,c,f,s]),n.useEffect(()=>{s&&s.length>0&&!i&&m(s[0].slug)},[s,i]);const z=async t=>{if(t.preventDefault(),!(!a.trim()||!o.trim()||!i)){P(!0);try{l==="update"&&r?(await T({id:r,name:a.trim(),description:o.trim(),category:i}),b.success("Updated","Publication updated successfully")):F==="template"?(await $({templateId:w,name:a.trim(),description:o.trim(),category:i}),b.success("Published",`"${a.trim()}" is now in the marketplace`)):(await D({workflowId:w,name:a.trim(),description:o.trim(),category:i}),b.success("Published",`"${a.trim()}" is now in the marketplace`)),U?.(),k()}catch(A){b.error("Error",String(A))}finally{P(!1)}}};return e.jsx(L,{children:x&&e.jsx(S.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",initial:p.initial,animate:p.animate,exit:p.exit,transition:p.transition,children:e.jsxs(S.div,{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-md p-6",initial:g.initial,animate:g.animate,exit:g.exit,transition:g.transition,onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:r?"Update Publication":"Publish to Marketplace"}),r&&e.jsxs("div",{className:"mb-4 flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>v("update"),className:`text-xs px-3 py-1.5 rounded-full border transition-colors ${l==="update"?"bg-foreground text-background border-foreground":"bg-background text-muted-foreground border-border"}`,children:"Update existing"}),e.jsx("button",{type:"button",onClick:()=>v("new"),className:`text-xs px-3 py-1.5 rounded-full border transition-colors ${l==="new"?"bg-foreground text-background border-foreground":"bg-background text-muted-foreground border-border"}`,children:"Publish as new"})]}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pub-name",className:"block text-sm font-medium mb-1",children:"Name"}),e.jsx("input",{id:"pub-name",type:"text",value:a,onChange:t=>h(t.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pub-description",className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{id:"pub-description",value:o,onChange:t=>j(t.target.value),rows:3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none",placeholder:"Describe what this template/workflow does..."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pub-category",className:"block text-sm font-medium mb-1",children:"Category"}),e.jsx("select",{id:"pub-category",value:i,onChange:t=>m(t.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:s?.map(t=>e.jsx("option",{value:t.slug,children:t.label},t._id))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(E,{type:"button",variant:"outline",onClick:k,children:"Cancel"}),e.jsx(E,{type:"submit",disabled:!a.trim()||!o.trim()||!i||N,children:N?"Publishing...":l==="update"?"Update":"Publish"})]})]})]})})})}export{R as P};
