import{e as An,j as c,r as k,g as _e,v as li,R as ct,w as ci,x as rl,y as pe,z as zt,A as Nn,m as Fe,h as be,i as ye,c as Se,s as ol,X as jn,B as nt,C as il,D as sl,E as al,F as kr,b as ll,k as ui}from"./index-lxgQ_mJ1.js";import{a as ae}from"./api-CRlO8hFs.js";import{c as _r,u as Ae,B as de}from"./button-NEfGHqYM.js";import{u as cl,a as ul,b as dl,S as fl,v as pl,C as di,c as hl}from"./confirm-dialog-BwJeYPZ2.js";import{u as Cr}from"./SessionContext-BuMPhUm7.js";import{D as ft}from"./debounced-button-DXneJHO6.js";import{M as fi,a as pi,r as hi,b as mi,P as Sr,U as gi,L as xi,F as vi,g as bi,c as ml,C as gl,B as oo,d as sr}from"./blockTypes-BgHgU0D8.js";import{s as yi,a as wi,g as xl,c as vl,b as bl,d as yl,o as io,e as so,f as ao}from"./openrouter-CvI0C0jo.js";import{A as lo,P as wl}from"./AnimatedNumber-vI6v5iIP.js";import{D as ki}from"./download-CS5_iaJU.js";import{I as kl}from"./input-C2oNxr8r.js";const _l=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],Cl=An("folder-tree",_l);const Sl=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],El=An("grip-vertical",Sl);const Al=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Rn=An("minimize-2",Al);const Nl=[["path",{d:"M15 7h2a5 5 0 0 1 0 10h-2m-6 0H7A5 5 0 0 1 7 7h2",key:"1re2ne"}]],jl=An("unlink-2",Nl);function Rl({id:e,zone:n,position:t,children:r}){const{attributes:o,listeners:i,setNodeRef:s,transform:a,transition:l,isDragging:d}=cl({id:e,data:{type:"block",blockId:e,zone:n,position:t}}),h={transform:ul.Transform.toString(a),transition:l,opacity:d?.5:1};return c.jsx("div",{ref:s,style:h,"data-block-id":e,"data-zone":n,"data-dragging":d,children:c.jsxs("div",{className:"flex",children:[c.jsx("button",{type:"button",...o,...i,className:"flex items-center px-0.5 cursor-grab active:cursor-grabbing text-muted-foreground/50 hover:text-muted-foreground touch-none","aria-label":"Drag to reorder",children:c.jsx(El,{className:"w-3 h-3"})}),c.jsx("div",{className:"flex-1 min-w-0",children:r})]})})}function Ol({zone:e,itemIds:n,children:t}){const{setNodeRef:r,isOver:o}=dl({id:`zone-${e}`,data:{type:"zone",zone:e}});return c.jsx("div",{ref:r,"data-droppable-zone":e,"data-drop-active":o,className:`
        flex-1 min-h-0 flex flex-col transition-colors duration-200
        ${o?"bg-primary/5 ring-2 ring-primary/20 ring-inset":""}
      `,children:c.jsx(fl,{items:n,strategy:pl,children:t})})}const Er=["PERMANENT","STABLE","WORKING"],Tl={PERMANENT:"SYSTEM",STABLE:"NOTE",WORKING:"NOTE"};function Il(e){const n=e.name.toLowerCase();return n==="skill.md"||n.endsWith(".zip")}function Pl(e){const n=e.name.toLowerCase();return n.endsWith(".txt")||n.endsWith(".md")||n.endsWith(".zip")}function Ml({sessionId:e,zone:n,onSkillFile:t,onSuccess:r,onError:o}){const[i,s]=k.useState(!1),a=_e(ae.blocks.create),l=k.useCallback(p=>{p.dataTransfer.types.includes("Files")&&(p.preventDefault(),p.stopPropagation(),s(!0))},[]),d=k.useCallback(p=>{p.dataTransfer.types.includes("Files")&&(p.preventDefault(),p.stopPropagation(),s(!1))},[]),h=k.useCallback(async p=>{if(!p.dataTransfer.types.includes("Files"))return;p.preventDefault(),p.stopPropagation(),s(!1);const u=Array.from(p.dataTransfer.files).filter(Pl);if(u.length!==0)for(const b of u)try{if(Il(b))t?.(b,n);else{const f=await b.text(),m=Tl[n];await a({sessionId:e,content:f,type:m,zone:n}),r?.(b.name)}}catch{o?.(`Failed to add file: ${b.name}`)}},[e,n,a,t,r,o]);return{isDragOver:i,dropProps:{onDragOver:l,onDragLeave:d,onDrop:h}}}function Ut(e){const n=Dl(e),t=k.forwardRef((r,o)=>{const{children:i,...s}=r,a=k.Children.toArray(i),l=a.find(Ll);if(l){const d=l.props.children,h=a.map(p=>p===l?k.Children.count(d)>1?k.Children.only(null):k.isValidElement(d)?d.props.children:null:p);return c.jsx(n,{...s,ref:o,children:k.isValidElement(d)?k.cloneElement(d,void 0,h):null})}return c.jsx(n,{...s,ref:o,children:i})});return t.displayName=`${e}.Slot`,t}function Dl(e){const n=k.forwardRef((t,r)=>{const{children:o,...i}=t;if(k.isValidElement(o)){const s=zl(o),a=Bl(i,o.props);return o.type!==k.Fragment&&(a.ref=r?_r(r,s):s),k.cloneElement(o,a)}return k.Children.count(o)>1?k.Children.only(null):null});return n.displayName=`${e}.SlotClone`,n}var Fl=Symbol("radix.slottable");function Ll(e){return k.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Fl}function Bl(e,n){const t={...n};for(const r in n){const o=e[r],i=n[r];/^on[A-Z]/.test(r)?o&&i?t[r]=(...a)=>{const l=i(...a);return o(...a),l}:o&&(t[r]=o):r==="style"?t[r]={...o,...i}:r==="className"&&(t[r]=[o,i].filter(Boolean).join(" "))}return{...e,...t}}function zl(e){let n=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,t=n&&"isReactWarning"in n&&n.isReactWarning;return t?e.ref:(n=Object.getOwnPropertyDescriptor(e,"ref")?.get,t=n&&"isReactWarning"in n&&n.isReactWarning,t?e.props.ref:e.props.ref||e.ref)}var Ul=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ee=Ul.reduce((e,n)=>{const t=Ut(`Primitive.${n}`),r=k.forwardRef((o,i)=>{const{asChild:s,...a}=o,l=s?t:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),c.jsx(l,{...a,ref:i})});return r.displayName=`Primitive.${n}`,{...e,[n]:r}},{});function _i(e,n){e&&li.flushSync(()=>e.dispatchEvent(n))}function Rt(e,n=[]){let t=[];function r(i,s){const a=k.createContext(s),l=t.length;t=[...t,s];const d=p=>{const{scope:x,children:u,...b}=p,f=x?.[e]?.[l]||a,m=k.useMemo(()=>b,Object.values(b));return c.jsx(f.Provider,{value:m,children:u})};d.displayName=i+"Provider";function h(p,x){const u=x?.[e]?.[l]||a,b=k.useContext(u);if(b)return b;if(s!==void 0)return s;throw new Error(`\`${p}\` must be used within \`${i}\``)}return[d,h]}const o=()=>{const i=t.map(s=>k.createContext(s));return function(a){const l=a?.[e]||i;return k.useMemo(()=>({[`__scope${e}`]:{...a,[e]:l}}),[a,l])}};return o.scopeName=e,[r,$l(o,...n)]}function $l(...e){const n=e[0];if(e.length===1)return n;const t=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(i){const s=r.reduce((a,{useScope:l,scopeName:d})=>{const p=l(i)[`__scope${d}`];return{...a,...p}},{});return k.useMemo(()=>({[`__scope${n.scopeName}`]:s}),[s])}};return t.scopeName=n.scopeName,t}function Ci(e){const n=e+"CollectionProvider",[t,r]=Rt(n),[o,i]=t(n,{collectionRef:{current:null},itemMap:new Map}),s=f=>{const{scope:m,children:g}=f,w=ct.useRef(null),_=ct.useRef(new Map).current;return c.jsx(o,{scope:m,itemMap:_,collectionRef:w,children:g})};s.displayName=n;const a=e+"CollectionSlot",l=Ut(a),d=ct.forwardRef((f,m)=>{const{scope:g,children:w}=f,_=i(a,g),E=Ae(m,_.collectionRef);return c.jsx(l,{ref:E,children:w})});d.displayName=a;const h=e+"CollectionItemSlot",p="data-radix-collection-item",x=Ut(h),u=ct.forwardRef((f,m)=>{const{scope:g,children:w,..._}=f,E=ct.useRef(null),S=Ae(m,E),R=i(h,g);return ct.useEffect(()=>(R.itemMap.set(E,{ref:E,..._}),()=>{R.itemMap.delete(E)})),c.jsx(x,{[p]:"",ref:S,children:w})});u.displayName=h;function b(f){const m=i(e+"CollectionConsumer",f);return ct.useCallback(()=>{const w=m.collectionRef.current;if(!w)return[];const _=Array.from(w.querySelectorAll(`[${p}]`));return Array.from(m.itemMap.values()).sort((R,j)=>_.indexOf(R.ref.current)-_.indexOf(j.ref.current))},[m.collectionRef,m.itemMap])}return[{Provider:s,Slot:d,ItemSlot:u},b,r]}function le(e,n,{checkForDefaultPrevented:t=!0}={}){return function(o){if(e?.(o),t===!1||!o.defaultPrevented)return n?.(o)}}var ot=globalThis?.document?k.useLayoutEffect:()=>{},Wl=ci[" useInsertionEffect ".trim().toString()]||ot;function Ar({prop:e,defaultProp:n,onChange:t=()=>{},caller:r}){const[o,i,s]=Hl({defaultProp:n,onChange:t}),a=e!==void 0,l=a?e:o;{const h=k.useRef(e!==void 0);k.useEffect(()=>{const p=h.current;p!==a&&console.warn(`${r} is changing from ${p?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=a},[a,r])}const d=k.useCallback(h=>{if(a){const p=Kl(h)?h(e):h;p!==e&&s.current?.(p)}else i(h)},[a,e,i,s]);return[l,d]}function Hl({defaultProp:e,onChange:n}){const[t,r]=k.useState(e),o=k.useRef(t),i=k.useRef(n);return Wl(()=>{i.current=n},[n]),k.useEffect(()=>{o.current!==t&&(i.current?.(t),o.current=t)},[t,o]),[t,r,i]}function Kl(e){return typeof e=="function"}function Zl(e,n){return k.useReducer((t,r)=>n[t][r]??t,e)}var ht=e=>{const{present:n,children:t}=e,r=Gl(n),o=typeof t=="function"?t({present:r.isPresent}):k.Children.only(t),i=Ae(r.ref,Yl(o));return typeof t=="function"||r.isPresent?k.cloneElement(o,{ref:i}):null};ht.displayName="Presence";function Gl(e){const[n,t]=k.useState(),r=k.useRef(null),o=k.useRef(e),i=k.useRef("none"),s=e?"mounted":"unmounted",[a,l]=Zl(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return k.useEffect(()=>{const d=nn(r.current);i.current=a==="mounted"?d:"none"},[a]),ot(()=>{const d=r.current,h=o.current;if(h!==e){const x=i.current,u=nn(d);e?l("MOUNT"):u==="none"||d?.display==="none"?l("UNMOUNT"):l(h&&x!==u?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,l]),ot(()=>{if(n){let d;const h=n.ownerDocument.defaultView??window,p=u=>{const f=nn(r.current).includes(CSS.escape(u.animationName));if(u.target===n&&f&&(l("ANIMATION_END"),!o.current)){const m=n.style.animationFillMode;n.style.animationFillMode="forwards",d=h.setTimeout(()=>{n.style.animationFillMode==="forwards"&&(n.style.animationFillMode=m)})}},x=u=>{u.target===n&&(i.current=nn(r.current))};return n.addEventListener("animationstart",x),n.addEventListener("animationcancel",p),n.addEventListener("animationend",p),()=>{h.clearTimeout(d),n.removeEventListener("animationstart",x),n.removeEventListener("animationcancel",p),n.removeEventListener("animationend",p)}}else l("ANIMATION_END")},[n,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:k.useCallback(d=>{r.current=d?getComputedStyle(d):null,t(d)},[])}}function nn(e){return e?.animationName||"none"}function Yl(e){let n=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,t=n&&"isReactWarning"in n&&n.isReactWarning;return t?e.ref:(n=Object.getOwnPropertyDescriptor(e,"ref")?.get,t=n&&"isReactWarning"in n&&n.isReactWarning,t?e.props.ref:e.props.ref||e.ref)}var Vl=ci[" useId ".trim().toString()]||(()=>{}),ql=0;function hn(e){const[n,t]=k.useState(Vl());return ot(()=>{t(r=>r??String(ql++))},[e]),e||(n?`radix-${n}`:"")}var Xl=k.createContext(void 0);function Si(e){const n=k.useContext(Xl);return e||n||"ltr"}function qe(e){const n=k.useRef(e);return k.useEffect(()=>{n.current=e}),k.useMemo(()=>(...t)=>n.current?.(...t),[])}function Ql(e,n=globalThis?.document){const t=qe(e);k.useEffect(()=>{const r=o=>{o.key==="Escape"&&t(o)};return n.addEventListener("keydown",r,{capture:!0}),()=>n.removeEventListener("keydown",r,{capture:!0})},[t,n])}var Jl="DismissableLayer",ar="dismissableLayer.update",ec="dismissableLayer.pointerDownOutside",tc="dismissableLayer.focusOutside",co,Ei=k.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Nr=k.forwardRef((e,n)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:i,onInteractOutside:s,onDismiss:a,...l}=e,d=k.useContext(Ei),[h,p]=k.useState(null),x=h?.ownerDocument??globalThis?.document,[,u]=k.useState({}),b=Ae(n,j=>p(j)),f=Array.from(d.layers),[m]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),g=f.indexOf(m),w=h?f.indexOf(h):-1,_=d.layersWithOutsidePointerEventsDisabled.size>0,E=w>=g,S=oc(j=>{const M=j.target,I=[...d.branches].some(L=>L.contains(M));!E||I||(o?.(j),s?.(j),j.defaultPrevented||a?.())},x),R=ic(j=>{const M=j.target;[...d.branches].some(L=>L.contains(M))||(i?.(j),s?.(j),j.defaultPrevented||a?.())},x);return Ql(j=>{w===d.layers.size-1&&(r?.(j),!j.defaultPrevented&&a&&(j.preventDefault(),a()))},x),k.useEffect(()=>{if(h)return t&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(co=x.body.style.pointerEvents,x.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(h)),d.layers.add(h),uo(),()=>{t&&d.layersWithOutsidePointerEventsDisabled.size===1&&(x.body.style.pointerEvents=co)}},[h,x,t,d]),k.useEffect(()=>()=>{h&&(d.layers.delete(h),d.layersWithOutsidePointerEventsDisabled.delete(h),uo())},[h,d]),k.useEffect(()=>{const j=()=>u({});return document.addEventListener(ar,j),()=>document.removeEventListener(ar,j)},[]),c.jsx(Ee.div,{...l,ref:b,style:{pointerEvents:_?E?"auto":"none":void 0,...e.style},onFocusCapture:le(e.onFocusCapture,R.onFocusCapture),onBlurCapture:le(e.onBlurCapture,R.onBlurCapture),onPointerDownCapture:le(e.onPointerDownCapture,S.onPointerDownCapture)})});Nr.displayName=Jl;var nc="DismissableLayerBranch",rc=k.forwardRef((e,n)=>{const t=k.useContext(Ei),r=k.useRef(null),o=Ae(n,r);return k.useEffect(()=>{const i=r.current;if(i)return t.branches.add(i),()=>{t.branches.delete(i)}},[t.branches]),c.jsx(Ee.div,{...e,ref:o})});rc.displayName=nc;function oc(e,n=globalThis?.document){const t=qe(e),r=k.useRef(!1),o=k.useRef(()=>{});return k.useEffect(()=>{const i=a=>{if(a.target&&!r.current){let l=function(){Ai(ec,t,d,{discrete:!0})};const d={originalEvent:a};a.pointerType==="touch"?(n.removeEventListener("click",o.current),o.current=l,n.addEventListener("click",o.current,{once:!0})):l()}else n.removeEventListener("click",o.current);r.current=!1},s=window.setTimeout(()=>{n.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(s),n.removeEventListener("pointerdown",i),n.removeEventListener("click",o.current)}},[n,t]),{onPointerDownCapture:()=>r.current=!0}}function ic(e,n=globalThis?.document){const t=qe(e),r=k.useRef(!1);return k.useEffect(()=>{const o=i=>{i.target&&!r.current&&Ai(tc,t,{originalEvent:i},{discrete:!1})};return n.addEventListener("focusin",o),()=>n.removeEventListener("focusin",o)},[n,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function uo(){const e=new CustomEvent(ar);document.dispatchEvent(e)}function Ai(e,n,t,{discrete:r}){const o=t.originalEvent.target,i=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:t});n&&o.addEventListener(e,n,{once:!0}),r?_i(o,i):o.dispatchEvent(i)}var Hn="focusScope.autoFocusOnMount",Kn="focusScope.autoFocusOnUnmount",fo={bubbles:!1,cancelable:!0},sc="FocusScope",jr=k.forwardRef((e,n)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:i,...s}=e,[a,l]=k.useState(null),d=qe(o),h=qe(i),p=k.useRef(null),x=Ae(n,f=>l(f)),u=k.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;k.useEffect(()=>{if(r){let f=function(_){if(u.paused||!a)return;const E=_.target;a.contains(E)?p.current=E:et(p.current,{select:!0})},m=function(_){if(u.paused||!a)return;const E=_.relatedTarget;E!==null&&(a.contains(E)||et(p.current,{select:!0}))},g=function(_){if(document.activeElement===document.body)for(const S of _)S.removedNodes.length>0&&et(a)};document.addEventListener("focusin",f),document.addEventListener("focusout",m);const w=new MutationObserver(g);return a&&w.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",f),document.removeEventListener("focusout",m),w.disconnect()}}},[r,a,u.paused]),k.useEffect(()=>{if(a){ho.add(u);const f=document.activeElement;if(!a.contains(f)){const g=new CustomEvent(Hn,fo);a.addEventListener(Hn,d),a.dispatchEvent(g),g.defaultPrevented||(ac(fc(Ni(a)),{select:!0}),document.activeElement===f&&et(a))}return()=>{a.removeEventListener(Hn,d),setTimeout(()=>{const g=new CustomEvent(Kn,fo);a.addEventListener(Kn,h),a.dispatchEvent(g),g.defaultPrevented||et(f??document.body,{select:!0}),a.removeEventListener(Kn,h),ho.remove(u)},0)}}},[a,d,h,u]);const b=k.useCallback(f=>{if(!t&&!r||u.paused)return;const m=f.key==="Tab"&&!f.altKey&&!f.ctrlKey&&!f.metaKey,g=document.activeElement;if(m&&g){const w=f.currentTarget,[_,E]=lc(w);_&&E?!f.shiftKey&&g===E?(f.preventDefault(),t&&et(_,{select:!0})):f.shiftKey&&g===_&&(f.preventDefault(),t&&et(E,{select:!0})):g===w&&f.preventDefault()}},[t,r,u.paused]);return c.jsx(Ee.div,{tabIndex:-1,...s,ref:x,onKeyDown:b})});jr.displayName=sc;function ac(e,{select:n=!1}={}){const t=document.activeElement;for(const r of e)if(et(r,{select:n}),document.activeElement!==t)return}function lc(e){const n=Ni(e),t=po(n,e),r=po(n.reverse(),e);return[t,r]}function Ni(e){const n=[],t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)n.push(t.currentNode);return n}function po(e,n){for(const t of e)if(!cc(t,{upTo:n}))return t}function cc(e,{upTo:n}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n!==void 0&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function uc(e){return e instanceof HTMLInputElement&&"select"in e}function et(e,{select:n=!1}={}){if(e&&e.focus){const t=document.activeElement;e.focus({preventScroll:!0}),e!==t&&uc(e)&&n&&e.select()}}var ho=dc();function dc(){let e=[];return{add(n){const t=e[0];n!==t&&t?.pause(),e=mo(e,n),e.unshift(n)},remove(n){e=mo(e,n),e[0]?.resume()}}}function mo(e,n){const t=[...e],r=t.indexOf(n);return r!==-1&&t.splice(r,1),t}function fc(e){return e.filter(n=>n.tagName!=="A")}var pc="Portal",Rr=k.forwardRef((e,n)=>{const{container:t,...r}=e,[o,i]=k.useState(!1);ot(()=>i(!0),[]);const s=t||o&&globalThis?.document?.body;return s?rl.createPortal(c.jsx(Ee.div,{...r,ref:n}),s):null});Rr.displayName=pc;var Zn=0;function ji(){k.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??go()),document.body.insertAdjacentElement("beforeend",e[1]??go()),Zn++,()=>{Zn===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(n=>n.remove()),Zn--}},[])}function go(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var Ue=function(){return Ue=Object.assign||function(n){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Ue.apply(this,arguments)};function Ri(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(t[r[o]]=e[r[o]]);return t}function hc(e,n,t){if(t||arguments.length===2)for(var r=0,o=n.length,i;r<o;r++)(i||!(r in n))&&(i||(i=Array.prototype.slice.call(n,0,r)),i[r]=n[r]);return e.concat(i||Array.prototype.slice.call(n))}var un="right-scroll-bar-position",dn="width-before-scroll-bar",mc="with-scroll-bars-hidden",gc="--removed-body-scroll-bar-size";function Gn(e,n){return typeof e=="function"?e(n):e&&(e.current=n),e}function xc(e,n){var t=k.useState(function(){return{value:e,callback:n,facade:{get current(){return t.value},set current(r){var o=t.value;o!==r&&(t.value=r,t.callback(r,o))}}}})[0];return t.callback=n,t.facade}var vc=typeof window<"u"?k.useLayoutEffect:k.useEffect,xo=new WeakMap;function bc(e,n){var t=xc(null,function(r){return e.forEach(function(o){return Gn(o,r)})});return vc(function(){var r=xo.get(t);if(r){var o=new Set(r),i=new Set(e),s=t.current;o.forEach(function(a){i.has(a)||Gn(a,null)}),i.forEach(function(a){o.has(a)||Gn(a,s)})}xo.set(t,e)},[e]),t}function yc(e){return e}function wc(e,n){n===void 0&&(n=yc);var t=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:e},useMedium:function(i){var s=n(i,r);return t.push(s),function(){t=t.filter(function(a){return a!==s})}},assignSyncMedium:function(i){for(r=!0;t.length;){var s=t;t=[],s.forEach(i)}t={push:function(a){return i(a)},filter:function(){return t}}},assignMedium:function(i){r=!0;var s=[];if(t.length){var a=t;t=[],a.forEach(i),s=t}var l=function(){var h=s;s=[],h.forEach(i)},d=function(){return Promise.resolve().then(l)};d(),t={push:function(h){s.push(h),d()},filter:function(h){return s=s.filter(h),t}}}};return o}function kc(e){e===void 0&&(e={});var n=wc(null);return n.options=Ue({async:!0,ssr:!1},e),n}var Oi=function(e){var n=e.sideCar,t=Ri(e,["sideCar"]);if(!n)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=n.read();if(!r)throw new Error("Sidecar medium not found");return k.createElement(r,Ue({},t))};Oi.isSideCarExport=!0;function _c(e,n){return e.useMedium(n),Oi}var Ti=kc(),Yn=function(){},On=k.forwardRef(function(e,n){var t=k.useRef(null),r=k.useState({onScrollCapture:Yn,onWheelCapture:Yn,onTouchMoveCapture:Yn}),o=r[0],i=r[1],s=e.forwardProps,a=e.children,l=e.className,d=e.removeScrollBar,h=e.enabled,p=e.shards,x=e.sideCar,u=e.noRelative,b=e.noIsolation,f=e.inert,m=e.allowPinchZoom,g=e.as,w=g===void 0?"div":g,_=e.gapMode,E=Ri(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),S=x,R=bc([t,n]),j=Ue(Ue({},E),o);return k.createElement(k.Fragment,null,h&&k.createElement(S,{sideCar:Ti,removeScrollBar:d,shards:p,noRelative:u,noIsolation:b,inert:f,setCallbacks:i,allowPinchZoom:!!m,lockRef:t,gapMode:_}),s?k.cloneElement(k.Children.only(a),Ue(Ue({},j),{ref:R})):k.createElement(w,Ue({},j,{className:l,ref:R}),a))});On.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};On.classNames={fullWidth:dn,zeroRight:un};var Cc=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Sc(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var n=Cc();return n&&e.setAttribute("nonce",n),e}function Ec(e,n){e.styleSheet?e.styleSheet.cssText=n:e.appendChild(document.createTextNode(n))}function Ac(e){var n=document.head||document.getElementsByTagName("head")[0];n.appendChild(e)}var Nc=function(){var e=0,n=null;return{add:function(t){e==0&&(n=Sc())&&(Ec(n,t),Ac(n)),e++},remove:function(){e--,!e&&n&&(n.parentNode&&n.parentNode.removeChild(n),n=null)}}},jc=function(){var e=Nc();return function(n,t){k.useEffect(function(){return e.add(n),function(){e.remove()}},[n&&t])}},Ii=function(){var e=jc(),n=function(t){var r=t.styles,o=t.dynamic;return e(r,o),null};return n},Rc={left:0,top:0,right:0,gap:0},Vn=function(e){return parseInt(e||"",10)||0},Oc=function(e){var n=window.getComputedStyle(document.body),t=n[e==="padding"?"paddingLeft":"marginLeft"],r=n[e==="padding"?"paddingTop":"marginTop"],o=n[e==="padding"?"paddingRight":"marginRight"];return[Vn(t),Vn(r),Vn(o)]},Tc=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Rc;var n=Oc(e),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:n[0],top:n[1],right:n[2],gap:Math.max(0,r-t+n[2]-n[0])}},Ic=Ii(),St="data-scroll-locked",Pc=function(e,n,t,r){var o=e.left,i=e.top,s=e.right,a=e.gap;return t===void 0&&(t="margin"),`
  .`.concat(mc,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(St,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([n&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(un,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(dn,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(un," .").concat(un,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(dn," .").concat(dn,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(St,`] {
    `).concat(gc,": ").concat(a,`px;
  }
`)},vo=function(){var e=parseInt(document.body.getAttribute(St)||"0",10);return isFinite(e)?e:0},Mc=function(){k.useEffect(function(){return document.body.setAttribute(St,(vo()+1).toString()),function(){var e=vo()-1;e<=0?document.body.removeAttribute(St):document.body.setAttribute(St,e.toString())}},[])},Dc=function(e){var n=e.noRelative,t=e.noImportant,r=e.gapMode,o=r===void 0?"margin":r;Mc();var i=k.useMemo(function(){return Tc(o)},[o]);return k.createElement(Ic,{styles:Pc(i,!n,o,t?"":"!important")})},lr=!1;if(typeof window<"u")try{var rn=Object.defineProperty({},"passive",{get:function(){return lr=!0,!0}});window.addEventListener("test",rn,rn),window.removeEventListener("test",rn,rn)}catch{lr=!1}var xt=lr?{passive:!1}:!1,Fc=function(e){return e.tagName==="TEXTAREA"},Pi=function(e,n){if(!(e instanceof Element))return!1;var t=window.getComputedStyle(e);return t[n]!=="hidden"&&!(t.overflowY===t.overflowX&&!Fc(e)&&t[n]==="visible")},Lc=function(e){return Pi(e,"overflowY")},Bc=function(e){return Pi(e,"overflowX")},bo=function(e,n){var t=n.ownerDocument,r=n;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=Mi(e,r);if(o){var i=Di(e,r),s=i[1],a=i[2];if(s>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},zc=function(e){var n=e.scrollTop,t=e.scrollHeight,r=e.clientHeight;return[n,t,r]},Uc=function(e){var n=e.scrollLeft,t=e.scrollWidth,r=e.clientWidth;return[n,t,r]},Mi=function(e,n){return e==="v"?Lc(n):Bc(n)},Di=function(e,n){return e==="v"?zc(n):Uc(n)},$c=function(e,n){return e==="h"&&n==="rtl"?-1:1},Wc=function(e,n,t,r,o){var i=$c(e,window.getComputedStyle(n).direction),s=i*r,a=t.target,l=n.contains(a),d=!1,h=s>0,p=0,x=0;do{if(!a)break;var u=Di(e,a),b=u[0],f=u[1],m=u[2],g=f-m-i*b;(b||g)&&Mi(e,a)&&(p+=g,x+=b);var w=a.parentNode;a=w&&w.nodeType===Node.DOCUMENT_FRAGMENT_NODE?w.host:w}while(!l&&a!==document.body||l&&(n.contains(a)||n===a));return(h&&Math.abs(p)<1||!h&&Math.abs(x)<1)&&(d=!0),d},on=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},yo=function(e){return[e.deltaX,e.deltaY]},wo=function(e){return e&&"current"in e?e.current:e},Hc=function(e,n){return e[0]===n[0]&&e[1]===n[1]},Kc=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Zc=0,vt=[];function Gc(e){var n=k.useRef([]),t=k.useRef([0,0]),r=k.useRef(),o=k.useState(Zc++)[0],i=k.useState(Ii)[0],s=k.useRef(e);k.useEffect(function(){s.current=e},[e]),k.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var f=hc([e.lockRef.current],(e.shards||[]).map(wo),!0).filter(Boolean);return f.forEach(function(m){return m.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),f.forEach(function(m){return m.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var a=k.useCallback(function(f,m){if("touches"in f&&f.touches.length===2||f.type==="wheel"&&f.ctrlKey)return!s.current.allowPinchZoom;var g=on(f),w=t.current,_="deltaX"in f?f.deltaX:w[0]-g[0],E="deltaY"in f?f.deltaY:w[1]-g[1],S,R=f.target,j=Math.abs(_)>Math.abs(E)?"h":"v";if("touches"in f&&j==="h"&&R.type==="range")return!1;var M=window.getSelection(),I=M&&M.anchorNode,L=I?I===R||I.contains(R):!1;if(L)return!1;var K=bo(j,R);if(!K)return!0;if(K?S=j:(S=j==="v"?"h":"v",K=bo(j,R)),!K)return!1;if(!r.current&&"changedTouches"in f&&(_||E)&&(r.current=S),!S)return!0;var C=r.current||S;return Wc(C,m,f,C==="h"?_:E)},[]),l=k.useCallback(function(f){var m=f;if(!(!vt.length||vt[vt.length-1]!==i)){var g="deltaY"in m?yo(m):on(m),w=n.current.filter(function(S){return S.name===m.type&&(S.target===m.target||m.target===S.shadowParent)&&Hc(S.delta,g)})[0];if(w&&w.should){m.cancelable&&m.preventDefault();return}if(!w){var _=(s.current.shards||[]).map(wo).filter(Boolean).filter(function(S){return S.contains(m.target)}),E=_.length>0?a(m,_[0]):!s.current.noIsolation;E&&m.cancelable&&m.preventDefault()}}},[]),d=k.useCallback(function(f,m,g,w){var _={name:f,delta:m,target:g,should:w,shadowParent:Yc(g)};n.current.push(_),setTimeout(function(){n.current=n.current.filter(function(E){return E!==_})},1)},[]),h=k.useCallback(function(f){t.current=on(f),r.current=void 0},[]),p=k.useCallback(function(f){d(f.type,yo(f),f.target,a(f,e.lockRef.current))},[]),x=k.useCallback(function(f){d(f.type,on(f),f.target,a(f,e.lockRef.current))},[]);k.useEffect(function(){return vt.push(i),e.setCallbacks({onScrollCapture:p,onWheelCapture:p,onTouchMoveCapture:x}),document.addEventListener("wheel",l,xt),document.addEventListener("touchmove",l,xt),document.addEventListener("touchstart",h,xt),function(){vt=vt.filter(function(f){return f!==i}),document.removeEventListener("wheel",l,xt),document.removeEventListener("touchmove",l,xt),document.removeEventListener("touchstart",h,xt)}},[]);var u=e.removeScrollBar,b=e.inert;return k.createElement(k.Fragment,null,b?k.createElement(i,{styles:Kc(o)}):null,u?k.createElement(Dc,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function Yc(e){for(var n=null;e!==null;)e instanceof ShadowRoot&&(n=e.host,e=e.host),e=e.parentNode;return n}const Vc=_c(Ti,Gc);var Or=k.forwardRef(function(e,n){return k.createElement(On,Ue({},e,{ref:n,sideCar:Vc}))});Or.classNames=On.classNames;var qc=function(e){if(typeof document>"u")return null;var n=Array.isArray(e)?e[0]:e;return n.ownerDocument.body},bt=new WeakMap,sn=new WeakMap,an={},qn=0,Fi=function(e){return e&&(e.host||Fi(e.parentNode))},Xc=function(e,n){return n.map(function(t){if(e.contains(t))return t;var r=Fi(t);return r&&e.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)}).filter(function(t){return!!t})},Qc=function(e,n,t,r){var o=Xc(n,Array.isArray(e)?e:[e]);an[t]||(an[t]=new WeakMap);var i=an[t],s=[],a=new Set,l=new Set(o),d=function(p){!p||a.has(p)||(a.add(p),d(p.parentNode))};o.forEach(d);var h=function(p){!p||l.has(p)||Array.prototype.forEach.call(p.children,function(x){if(a.has(x))h(x);else try{var u=x.getAttribute(r),b=u!==null&&u!=="false",f=(bt.get(x)||0)+1,m=(i.get(x)||0)+1;bt.set(x,f),i.set(x,m),s.push(x),f===1&&b&&sn.set(x,!0),m===1&&x.setAttribute(t,"true"),b||x.setAttribute(r,"true")}catch(g){console.error("aria-hidden: cannot operate on ",x,g)}})};return h(n),a.clear(),qn++,function(){s.forEach(function(p){var x=bt.get(p)-1,u=i.get(p)-1;bt.set(p,x),i.set(p,u),x||(sn.has(p)||p.removeAttribute(r),sn.delete(p)),u||p.removeAttribute(t)}),qn--,qn||(bt=new WeakMap,bt=new WeakMap,sn=new WeakMap,an={})}},Li=function(e,n,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),o=qc(e);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live], script"))),Qc(r,o,t,"aria-hidden")):function(){return null}};function Jc(e){const[n,t]=k.useState(void 0);return ot(()=>{if(e){t({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const i=o[0];let s,a;if("borderBoxSize"in i){const l=i.borderBoxSize,d=Array.isArray(l)?l[0]:l;s=d.inlineSize,a=d.blockSize}else s=e.offsetWidth,a=e.offsetHeight;t({width:s,height:a})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else t(void 0)},[e]),n}const eu=["top","right","bottom","left"],it=Math.min,Ie=Math.max,mn=Math.round,ln=Math.floor,He=e=>({x:e,y:e}),tu={left:"right",right:"left",bottom:"top",top:"bottom"},nu={start:"end",end:"start"};function cr(e,n,t){return Ie(e,it(n,t))}function Xe(e,n){return typeof e=="function"?e(n):e}function Qe(e){return e.split("-")[0]}function Ot(e){return e.split("-")[1]}function Tr(e){return e==="x"?"y":"x"}function Ir(e){return e==="y"?"height":"width"}const ru=new Set(["top","bottom"]);function We(e){return ru.has(Qe(e))?"y":"x"}function Pr(e){return Tr(We(e))}function ou(e,n,t){t===void 0&&(t=!1);const r=Ot(e),o=Pr(e),i=Ir(o);let s=o==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return n.reference[i]>n.floating[i]&&(s=gn(s)),[s,gn(s)]}function iu(e){const n=gn(e);return[ur(e),n,ur(n)]}function ur(e){return e.replace(/start|end/g,n=>nu[n])}const ko=["left","right"],_o=["right","left"],su=["top","bottom"],au=["bottom","top"];function lu(e,n,t){switch(e){case"top":case"bottom":return t?n?_o:ko:n?ko:_o;case"left":case"right":return n?su:au;default:return[]}}function cu(e,n,t,r){const o=Ot(e);let i=lu(Qe(e),t==="start",r);return o&&(i=i.map(s=>s+"-"+o),n&&(i=i.concat(i.map(ur)))),i}function gn(e){return e.replace(/left|right|bottom|top/g,n=>tu[n])}function uu(e){return{top:0,right:0,bottom:0,left:0,...e}}function Bi(e){return typeof e!="number"?uu(e):{top:e,right:e,bottom:e,left:e}}function xn(e){const{x:n,y:t,width:r,height:o}=e;return{width:r,height:o,top:t,left:n,right:n+r,bottom:t+o,x:n,y:t}}function Co(e,n,t){let{reference:r,floating:o}=e;const i=We(n),s=Pr(n),a=Ir(s),l=Qe(n),d=i==="y",h=r.x+r.width/2-o.width/2,p=r.y+r.height/2-o.height/2,x=r[a]/2-o[a]/2;let u;switch(l){case"top":u={x:h,y:r.y-o.height};break;case"bottom":u={x:h,y:r.y+r.height};break;case"right":u={x:r.x+r.width,y:p};break;case"left":u={x:r.x-o.width,y:p};break;default:u={x:r.x,y:r.y}}switch(Ot(n)){case"start":u[s]-=x*(t&&d?-1:1);break;case"end":u[s]+=x*(t&&d?-1:1);break}return u}async function du(e,n){var t;n===void 0&&(n={});const{x:r,y:o,platform:i,rects:s,elements:a,strategy:l}=e,{boundary:d="clippingAncestors",rootBoundary:h="viewport",elementContext:p="floating",altBoundary:x=!1,padding:u=0}=Xe(n,e),b=Bi(u),m=a[x?p==="floating"?"reference":"floating":p],g=xn(await i.getClippingRect({element:(t=await(i.isElement==null?void 0:i.isElement(m)))==null||t?m:m.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:d,rootBoundary:h,strategy:l})),w=p==="floating"?{x:r,y:o,width:s.floating.width,height:s.floating.height}:s.reference,_=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),E=await(i.isElement==null?void 0:i.isElement(_))?await(i.getScale==null?void 0:i.getScale(_))||{x:1,y:1}:{x:1,y:1},S=xn(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:w,offsetParent:_,strategy:l}):w);return{top:(g.top-S.top+b.top)/E.y,bottom:(S.bottom-g.bottom+b.bottom)/E.y,left:(g.left-S.left+b.left)/E.x,right:(S.right-g.right+b.right)/E.x}}const fu=async(e,n,t)=>{const{placement:r="bottom",strategy:o="absolute",middleware:i=[],platform:s}=t,a=i.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(n));let d=await s.getElementRects({reference:e,floating:n,strategy:o}),{x:h,y:p}=Co(d,r,l),x=r,u={},b=0;for(let m=0;m<a.length;m++){var f;const{name:g,fn:w}=a[m],{x:_,y:E,data:S,reset:R}=await w({x:h,y:p,initialPlacement:r,placement:x,strategy:o,middlewareData:u,rects:d,platform:{...s,detectOverflow:(f=s.detectOverflow)!=null?f:du},elements:{reference:e,floating:n}});h=_??h,p=E??p,u={...u,[g]:{...u[g],...S}},R&&b<=50&&(b++,typeof R=="object"&&(R.placement&&(x=R.placement),R.rects&&(d=R.rects===!0?await s.getElementRects({reference:e,floating:n,strategy:o}):R.rects),{x:h,y:p}=Co(d,x,l)),m=-1)}return{x:h,y:p,placement:x,strategy:o,middlewareData:u}},pu=e=>({name:"arrow",options:e,async fn(n){const{x:t,y:r,placement:o,rects:i,platform:s,elements:a,middlewareData:l}=n,{element:d,padding:h=0}=Xe(e,n)||{};if(d==null)return{};const p=Bi(h),x={x:t,y:r},u=Pr(o),b=Ir(u),f=await s.getDimensions(d),m=u==="y",g=m?"top":"left",w=m?"bottom":"right",_=m?"clientHeight":"clientWidth",E=i.reference[b]+i.reference[u]-x[u]-i.floating[b],S=x[u]-i.reference[u],R=await(s.getOffsetParent==null?void 0:s.getOffsetParent(d));let j=R?R[_]:0;(!j||!await(s.isElement==null?void 0:s.isElement(R)))&&(j=a.floating[_]||i.floating[b]);const M=E/2-S/2,I=j/2-f[b]/2-1,L=it(p[g],I),K=it(p[w],I),C=L,D=j-f[b]-K,y=j/2-f[b]/2+M,U=cr(C,y,D),V=!l.arrow&&Ot(o)!=null&&y!==U&&i.reference[b]/2-(y<C?L:K)-f[b]/2<0,H=V?y<C?y-C:y-D:0;return{[u]:x[u]+H,data:{[u]:U,centerOffset:y-U-H,...V&&{alignmentOffset:H}},reset:V}}}),hu=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(n){var t,r;const{placement:o,middlewareData:i,rects:s,initialPlacement:a,platform:l,elements:d}=n,{mainAxis:h=!0,crossAxis:p=!0,fallbackPlacements:x,fallbackStrategy:u="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:f=!0,...m}=Xe(e,n);if((t=i.arrow)!=null&&t.alignmentOffset)return{};const g=Qe(o),w=We(a),_=Qe(a)===a,E=await(l.isRTL==null?void 0:l.isRTL(d.floating)),S=x||(_||!f?[gn(a)]:iu(a)),R=b!=="none";!x&&R&&S.push(...cu(a,f,b,E));const j=[a,...S],M=await l.detectOverflow(n,m),I=[];let L=((r=i.flip)==null?void 0:r.overflows)||[];if(h&&I.push(M[g]),p){const y=ou(o,s,E);I.push(M[y[0]],M[y[1]])}if(L=[...L,{placement:o,overflows:I}],!I.every(y=>y<=0)){var K,C;const y=(((K=i.flip)==null?void 0:K.index)||0)+1,U=j[y];if(U&&(!(p==="alignment"?w!==We(U):!1)||L.every(X=>We(X.placement)===w?X.overflows[0]>0:!0)))return{data:{index:y,overflows:L},reset:{placement:U}};let V=(C=L.filter(H=>H.overflows[0]<=0).sort((H,X)=>H.overflows[1]-X.overflows[1])[0])==null?void 0:C.placement;if(!V)switch(u){case"bestFit":{var D;const H=(D=L.filter(X=>{if(R){const B=We(X.placement);return B===w||B==="y"}return!0}).map(X=>[X.placement,X.overflows.filter(B=>B>0).reduce((B,Z)=>B+Z,0)]).sort((X,B)=>X[1]-B[1])[0])==null?void 0:D[0];H&&(V=H);break}case"initialPlacement":V=a;break}if(o!==V)return{reset:{placement:V}}}return{}}}};function So(e,n){return{top:e.top-n.height,right:e.right-n.width,bottom:e.bottom-n.height,left:e.left-n.width}}function Eo(e){return eu.some(n=>e[n]>=0)}const mu=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(n){const{rects:t,platform:r}=n,{strategy:o="referenceHidden",...i}=Xe(e,n);switch(o){case"referenceHidden":{const s=await r.detectOverflow(n,{...i,elementContext:"reference"}),a=So(s,t.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:Eo(a)}}}case"escaped":{const s=await r.detectOverflow(n,{...i,altBoundary:!0}),a=So(s,t.floating);return{data:{escapedOffsets:a,escaped:Eo(a)}}}default:return{}}}}},zi=new Set(["left","top"]);async function gu(e,n){const{placement:t,platform:r,elements:o}=e,i=await(r.isRTL==null?void 0:r.isRTL(o.floating)),s=Qe(t),a=Ot(t),l=We(t)==="y",d=zi.has(s)?-1:1,h=i&&l?-1:1,p=Xe(n,e);let{mainAxis:x,crossAxis:u,alignmentAxis:b}=typeof p=="number"?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:p.mainAxis||0,crossAxis:p.crossAxis||0,alignmentAxis:p.alignmentAxis};return a&&typeof b=="number"&&(u=a==="end"?b*-1:b),l?{x:u*h,y:x*d}:{x:x*d,y:u*h}}const xu=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(n){var t,r;const{x:o,y:i,placement:s,middlewareData:a}=n,l=await gu(n,e);return s===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+l.x,y:i+l.y,data:{...l,placement:s}}}}},vu=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(n){const{x:t,y:r,placement:o,platform:i}=n,{mainAxis:s=!0,crossAxis:a=!1,limiter:l={fn:g=>{let{x:w,y:_}=g;return{x:w,y:_}}},...d}=Xe(e,n),h={x:t,y:r},p=await i.detectOverflow(n,d),x=We(Qe(o)),u=Tr(x);let b=h[u],f=h[x];if(s){const g=u==="y"?"top":"left",w=u==="y"?"bottom":"right",_=b+p[g],E=b-p[w];b=cr(_,b,E)}if(a){const g=x==="y"?"top":"left",w=x==="y"?"bottom":"right",_=f+p[g],E=f-p[w];f=cr(_,f,E)}const m=l.fn({...n,[u]:b,[x]:f});return{...m,data:{x:m.x-t,y:m.y-r,enabled:{[u]:s,[x]:a}}}}}},bu=function(e){return e===void 0&&(e={}),{options:e,fn(n){const{x:t,y:r,placement:o,rects:i,middlewareData:s}=n,{offset:a=0,mainAxis:l=!0,crossAxis:d=!0}=Xe(e,n),h={x:t,y:r},p=We(o),x=Tr(p);let u=h[x],b=h[p];const f=Xe(a,n),m=typeof f=="number"?{mainAxis:f,crossAxis:0}:{mainAxis:0,crossAxis:0,...f};if(l){const _=x==="y"?"height":"width",E=i.reference[x]-i.floating[_]+m.mainAxis,S=i.reference[x]+i.reference[_]-m.mainAxis;u<E?u=E:u>S&&(u=S)}if(d){var g,w;const _=x==="y"?"width":"height",E=zi.has(Qe(o)),S=i.reference[p]-i.floating[_]+(E&&((g=s.offset)==null?void 0:g[p])||0)+(E?0:m.crossAxis),R=i.reference[p]+i.reference[_]+(E?0:((w=s.offset)==null?void 0:w[p])||0)-(E?m.crossAxis:0);b<S?b=S:b>R&&(b=R)}return{[x]:u,[p]:b}}}},yu=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(n){var t,r;const{placement:o,rects:i,platform:s,elements:a}=n,{apply:l=()=>{},...d}=Xe(e,n),h=await s.detectOverflow(n,d),p=Qe(o),x=Ot(o),u=We(o)==="y",{width:b,height:f}=i.floating;let m,g;p==="top"||p==="bottom"?(m=p,g=x===(await(s.isRTL==null?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(g=p,m=x==="end"?"top":"bottom");const w=f-h.top-h.bottom,_=b-h.left-h.right,E=it(f-h[m],w),S=it(b-h[g],_),R=!n.middlewareData.shift;let j=E,M=S;if((t=n.middlewareData.shift)!=null&&t.enabled.x&&(M=_),(r=n.middlewareData.shift)!=null&&r.enabled.y&&(j=w),R&&!x){const L=Ie(h.left,0),K=Ie(h.right,0),C=Ie(h.top,0),D=Ie(h.bottom,0);u?M=b-2*(L!==0||K!==0?L+K:Ie(h.left,h.right)):j=f-2*(C!==0||D!==0?C+D:Ie(h.top,h.bottom))}await l({...n,availableWidth:M,availableHeight:j});const I=await s.getDimensions(a.floating);return b!==I.width||f!==I.height?{reset:{rects:!0}}:{}}}};function Tn(){return typeof window<"u"}function Tt(e){return Ui(e)?(e.nodeName||"").toLowerCase():"#document"}function Pe(e){var n;return(e==null||(n=e.ownerDocument)==null?void 0:n.defaultView)||window}function Ge(e){var n;return(n=(Ui(e)?e.ownerDocument:e.document)||window.document)==null?void 0:n.documentElement}function Ui(e){return Tn()?e instanceof Node||e instanceof Pe(e).Node:!1}function Le(e){return Tn()?e instanceof Element||e instanceof Pe(e).Element:!1}function Ze(e){return Tn()?e instanceof HTMLElement||e instanceof Pe(e).HTMLElement:!1}function Ao(e){return!Tn()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Pe(e).ShadowRoot}const wu=new Set(["inline","contents"]);function Vt(e){const{overflow:n,overflowX:t,overflowY:r,display:o}=Be(e);return/auto|scroll|overlay|hidden|clip/.test(n+r+t)&&!wu.has(o)}const ku=new Set(["table","td","th"]);function _u(e){return ku.has(Tt(e))}const Cu=[":popover-open",":modal"];function In(e){return Cu.some(n=>{try{return e.matches(n)}catch{return!1}})}const Su=["transform","translate","scale","rotate","perspective"],Eu=["transform","translate","scale","rotate","perspective","filter"],Au=["paint","layout","strict","content"];function Mr(e){const n=Dr(),t=Le(e)?Be(e):e;return Su.some(r=>t[r]?t[r]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!n&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!n&&(t.filter?t.filter!=="none":!1)||Eu.some(r=>(t.willChange||"").includes(r))||Au.some(r=>(t.contain||"").includes(r))}function Nu(e){let n=st(e);for(;Ze(n)&&!At(n);){if(Mr(n))return n;if(In(n))return null;n=st(n)}return null}function Dr(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const ju=new Set(["html","body","#document"]);function At(e){return ju.has(Tt(e))}function Be(e){return Pe(e).getComputedStyle(e)}function Pn(e){return Le(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function st(e){if(Tt(e)==="html")return e;const n=e.assignedSlot||e.parentNode||Ao(e)&&e.host||Ge(e);return Ao(n)?n.host:n}function $i(e){const n=st(e);return At(n)?e.ownerDocument?e.ownerDocument.body:e.body:Ze(n)&&Vt(n)?n:$i(n)}function $t(e,n,t){var r;n===void 0&&(n=[]),t===void 0&&(t=!0);const o=$i(e),i=o===((r=e.ownerDocument)==null?void 0:r.body),s=Pe(o);if(i){const a=dr(s);return n.concat(s,s.visualViewport||[],Vt(o)?o:[],a&&t?$t(a):[])}return n.concat(o,$t(o,[],t))}function dr(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Wi(e){const n=Be(e);let t=parseFloat(n.width)||0,r=parseFloat(n.height)||0;const o=Ze(e),i=o?e.offsetWidth:t,s=o?e.offsetHeight:r,a=mn(t)!==i||mn(r)!==s;return a&&(t=i,r=s),{width:t,height:r,$:a}}function Fr(e){return Le(e)?e:e.contextElement}function Et(e){const n=Fr(e);if(!Ze(n))return He(1);const t=n.getBoundingClientRect(),{width:r,height:o,$:i}=Wi(n);let s=(i?mn(t.width):t.width)/r,a=(i?mn(t.height):t.height)/o;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const Ru=He(0);function Hi(e){const n=Pe(e);return!Dr()||!n.visualViewport?Ru:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function Ou(e,n,t){return n===void 0&&(n=!1),!t||n&&t!==Pe(e)?!1:n}function pt(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=!1);const o=e.getBoundingClientRect(),i=Fr(e);let s=He(1);n&&(r?Le(r)&&(s=Et(r)):s=Et(e));const a=Ou(i,t,r)?Hi(i):He(0);let l=(o.left+a.x)/s.x,d=(o.top+a.y)/s.y,h=o.width/s.x,p=o.height/s.y;if(i){const x=Pe(i),u=r&&Le(r)?Pe(r):r;let b=x,f=dr(b);for(;f&&r&&u!==b;){const m=Et(f),g=f.getBoundingClientRect(),w=Be(f),_=g.left+(f.clientLeft+parseFloat(w.paddingLeft))*m.x,E=g.top+(f.clientTop+parseFloat(w.paddingTop))*m.y;l*=m.x,d*=m.y,h*=m.x,p*=m.y,l+=_,d+=E,b=Pe(f),f=dr(b)}}return xn({width:h,height:p,x:l,y:d})}function Mn(e,n){const t=Pn(e).scrollLeft;return n?n.left+t:pt(Ge(e)).left+t}function Ki(e,n){const t=e.getBoundingClientRect(),r=t.left+n.scrollLeft-Mn(e,t),o=t.top+n.scrollTop;return{x:r,y:o}}function Tu(e){let{elements:n,rect:t,offsetParent:r,strategy:o}=e;const i=o==="fixed",s=Ge(r),a=n?In(n.floating):!1;if(r===s||a&&i)return t;let l={scrollLeft:0,scrollTop:0},d=He(1);const h=He(0),p=Ze(r);if((p||!p&&!i)&&((Tt(r)!=="body"||Vt(s))&&(l=Pn(r)),Ze(r))){const u=pt(r);d=Et(r),h.x=u.x+r.clientLeft,h.y=u.y+r.clientTop}const x=s&&!p&&!i?Ki(s,l):He(0);return{width:t.width*d.x,height:t.height*d.y,x:t.x*d.x-l.scrollLeft*d.x+h.x+x.x,y:t.y*d.y-l.scrollTop*d.y+h.y+x.y}}function Iu(e){return Array.from(e.getClientRects())}function Pu(e){const n=Ge(e),t=Pn(e),r=e.ownerDocument.body,o=Ie(n.scrollWidth,n.clientWidth,r.scrollWidth,r.clientWidth),i=Ie(n.scrollHeight,n.clientHeight,r.scrollHeight,r.clientHeight);let s=-t.scrollLeft+Mn(e);const a=-t.scrollTop;return Be(r).direction==="rtl"&&(s+=Ie(n.clientWidth,r.clientWidth)-o),{width:o,height:i,x:s,y:a}}const No=25;function Mu(e,n){const t=Pe(e),r=Ge(e),o=t.visualViewport;let i=r.clientWidth,s=r.clientHeight,a=0,l=0;if(o){i=o.width,s=o.height;const h=Dr();(!h||h&&n==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}const d=Mn(r);if(d<=0){const h=r.ownerDocument,p=h.body,x=getComputedStyle(p),u=h.compatMode==="CSS1Compat"&&parseFloat(x.marginLeft)+parseFloat(x.marginRight)||0,b=Math.abs(r.clientWidth-p.clientWidth-u);b<=No&&(i-=b)}else d<=No&&(i+=d);return{width:i,height:s,x:a,y:l}}const Du=new Set(["absolute","fixed"]);function Fu(e,n){const t=pt(e,!0,n==="fixed"),r=t.top+e.clientTop,o=t.left+e.clientLeft,i=Ze(e)?Et(e):He(1),s=e.clientWidth*i.x,a=e.clientHeight*i.y,l=o*i.x,d=r*i.y;return{width:s,height:a,x:l,y:d}}function jo(e,n,t){let r;if(n==="viewport")r=Mu(e,t);else if(n==="document")r=Pu(Ge(e));else if(Le(n))r=Fu(n,t);else{const o=Hi(e);r={x:n.x-o.x,y:n.y-o.y,width:n.width,height:n.height}}return xn(r)}function Zi(e,n){const t=st(e);return t===n||!Le(t)||At(t)?!1:Be(t).position==="fixed"||Zi(t,n)}function Lu(e,n){const t=n.get(e);if(t)return t;let r=$t(e,[],!1).filter(a=>Le(a)&&Tt(a)!=="body"),o=null;const i=Be(e).position==="fixed";let s=i?st(e):e;for(;Le(s)&&!At(s);){const a=Be(s),l=Mr(s);!l&&a.position==="fixed"&&(o=null),(i?!l&&!o:!l&&a.position==="static"&&!!o&&Du.has(o.position)||Vt(s)&&!l&&Zi(e,s))?r=r.filter(h=>h!==s):o=a,s=st(s)}return n.set(e,r),r}function Bu(e){let{element:n,boundary:t,rootBoundary:r,strategy:o}=e;const s=[...t==="clippingAncestors"?In(n)?[]:Lu(n,this._c):[].concat(t),r],a=s[0],l=s.reduce((d,h)=>{const p=jo(n,h,o);return d.top=Ie(p.top,d.top),d.right=it(p.right,d.right),d.bottom=it(p.bottom,d.bottom),d.left=Ie(p.left,d.left),d},jo(n,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function zu(e){const{width:n,height:t}=Wi(e);return{width:n,height:t}}function Uu(e,n,t){const r=Ze(n),o=Ge(n),i=t==="fixed",s=pt(e,!0,i,n);let a={scrollLeft:0,scrollTop:0};const l=He(0);function d(){l.x=Mn(o)}if(r||!r&&!i)if((Tt(n)!=="body"||Vt(o))&&(a=Pn(n)),r){const u=pt(n,!0,i,n);l.x=u.x+n.clientLeft,l.y=u.y+n.clientTop}else o&&d();i&&!r&&o&&d();const h=o&&!r&&!i?Ki(o,a):He(0),p=s.left+a.scrollLeft-l.x-h.x,x=s.top+a.scrollTop-l.y-h.y;return{x:p,y:x,width:s.width,height:s.height}}function Xn(e){return Be(e).position==="static"}function Ro(e,n){if(!Ze(e)||Be(e).position==="fixed")return null;if(n)return n(e);let t=e.offsetParent;return Ge(e)===t&&(t=t.ownerDocument.body),t}function Gi(e,n){const t=Pe(e);if(In(e))return t;if(!Ze(e)){let o=st(e);for(;o&&!At(o);){if(Le(o)&&!Xn(o))return o;o=st(o)}return t}let r=Ro(e,n);for(;r&&_u(r)&&Xn(r);)r=Ro(r,n);return r&&At(r)&&Xn(r)&&!Mr(r)?t:r||Nu(e)||t}const $u=async function(e){const n=this.getOffsetParent||Gi,t=this.getDimensions,r=await t(e.floating);return{reference:Uu(e.reference,await n(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Wu(e){return Be(e).direction==="rtl"}const Hu={convertOffsetParentRelativeRectToViewportRelativeRect:Tu,getDocumentElement:Ge,getClippingRect:Bu,getOffsetParent:Gi,getElementRects:$u,getClientRects:Iu,getDimensions:zu,getScale:Et,isElement:Le,isRTL:Wu};function Yi(e,n){return e.x===n.x&&e.y===n.y&&e.width===n.width&&e.height===n.height}function Ku(e,n){let t=null,r;const o=Ge(e);function i(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),i();const d=e.getBoundingClientRect(),{left:h,top:p,width:x,height:u}=d;if(a||n(),!x||!u)return;const b=ln(p),f=ln(o.clientWidth-(h+x)),m=ln(o.clientHeight-(p+u)),g=ln(h),_={rootMargin:-b+"px "+-f+"px "+-m+"px "+-g+"px",threshold:Ie(0,it(1,l))||1};let E=!0;function S(R){const j=R[0].intersectionRatio;if(j!==l){if(!E)return s();j?s(!1,j):r=setTimeout(()=>{s(!1,1e-7)},1e3)}j===1&&!Yi(d,e.getBoundingClientRect())&&s(),E=!1}try{t=new IntersectionObserver(S,{..._,root:o.ownerDocument})}catch{t=new IntersectionObserver(S,_)}t.observe(e)}return s(!0),i}function Zu(e,n,t,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,d=Fr(e),h=o||i?[...d?$t(d):[],...$t(n)]:[];h.forEach(g=>{o&&g.addEventListener("scroll",t,{passive:!0}),i&&g.addEventListener("resize",t)});const p=d&&a?Ku(d,t):null;let x=-1,u=null;s&&(u=new ResizeObserver(g=>{let[w]=g;w&&w.target===d&&u&&(u.unobserve(n),cancelAnimationFrame(x),x=requestAnimationFrame(()=>{var _;(_=u)==null||_.observe(n)})),t()}),d&&!l&&u.observe(d),u.observe(n));let b,f=l?pt(e):null;l&&m();function m(){const g=pt(e);f&&!Yi(f,g)&&t(),f=g,b=requestAnimationFrame(m)}return t(),()=>{var g;h.forEach(w=>{o&&w.removeEventListener("scroll",t),i&&w.removeEventListener("resize",t)}),p?.(),(g=u)==null||g.disconnect(),u=null,l&&cancelAnimationFrame(b)}}const Gu=xu,Yu=vu,Vu=hu,qu=yu,Xu=mu,Oo=pu,Qu=bu,Ju=(e,n,t)=>{const r=new Map,o={platform:Hu,...t},i={...o.platform,_c:r};return fu(e,n,{...o,platform:i})};var ed=typeof document<"u",td=function(){},fn=ed?k.useLayoutEffect:td;function vn(e,n){if(e===n)return!0;if(typeof e!=typeof n)return!1;if(typeof e=="function"&&e.toString()===n.toString())return!0;let t,r,o;if(e&&n&&typeof e=="object"){if(Array.isArray(e)){if(t=e.length,t!==n.length)return!1;for(r=t;r--!==0;)if(!vn(e[r],n[r]))return!1;return!0}if(o=Object.keys(e),t=o.length,t!==Object.keys(n).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(n,o[r]))return!1;for(r=t;r--!==0;){const i=o[r];if(!(i==="_owner"&&e.$$typeof)&&!vn(e[i],n[i]))return!1}return!0}return e!==e&&n!==n}function Vi(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function To(e,n){const t=Vi(e);return Math.round(n*t)/t}function Qn(e){const n=k.useRef(e);return fn(()=>{n.current=e}),n}function nd(e){e===void 0&&(e={});const{placement:n="bottom",strategy:t="absolute",middleware:r=[],platform:o,elements:{reference:i,floating:s}={},transform:a=!0,whileElementsMounted:l,open:d}=e,[h,p]=k.useState({x:0,y:0,strategy:t,placement:n,middlewareData:{},isPositioned:!1}),[x,u]=k.useState(r);vn(x,r)||u(r);const[b,f]=k.useState(null),[m,g]=k.useState(null),w=k.useCallback(X=>{X!==R.current&&(R.current=X,f(X))},[]),_=k.useCallback(X=>{X!==j.current&&(j.current=X,g(X))},[]),E=i||b,S=s||m,R=k.useRef(null),j=k.useRef(null),M=k.useRef(h),I=l!=null,L=Qn(l),K=Qn(o),C=Qn(d),D=k.useCallback(()=>{if(!R.current||!j.current)return;const X={placement:n,strategy:t,middleware:x};K.current&&(X.platform=K.current),Ju(R.current,j.current,X).then(B=>{const Z={...B,isPositioned:C.current!==!1};y.current&&!vn(M.current,Z)&&(M.current=Z,li.flushSync(()=>{p(Z)}))})},[x,n,t,K,C]);fn(()=>{d===!1&&M.current.isPositioned&&(M.current.isPositioned=!1,p(X=>({...X,isPositioned:!1})))},[d]);const y=k.useRef(!1);fn(()=>(y.current=!0,()=>{y.current=!1}),[]),fn(()=>{if(E&&(R.current=E),S&&(j.current=S),E&&S){if(L.current)return L.current(E,S,D);D()}},[E,S,D,L,I]);const U=k.useMemo(()=>({reference:R,floating:j,setReference:w,setFloating:_}),[w,_]),V=k.useMemo(()=>({reference:E,floating:S}),[E,S]),H=k.useMemo(()=>{const X={position:t,left:0,top:0};if(!V.floating)return X;const B=To(V.floating,h.x),Z=To(V.floating,h.y);return a?{...X,transform:"translate("+B+"px, "+Z+"px)",...Vi(V.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:B,top:Z}},[t,a,V.floating,h.x,h.y]);return k.useMemo(()=>({...h,update:D,refs:U,elements:V,floatingStyles:H}),[h,D,U,V,H])}const rd=e=>{function n(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:e,fn(t){const{element:r,padding:o}=typeof e=="function"?e(t):e;return r&&n(r)?r.current!=null?Oo({element:r.current,padding:o}).fn(t):{}:r?Oo({element:r,padding:o}).fn(t):{}}}},od=(e,n)=>({...Gu(e),options:[e,n]}),id=(e,n)=>({...Yu(e),options:[e,n]}),sd=(e,n)=>({...Qu(e),options:[e,n]}),ad=(e,n)=>({...Vu(e),options:[e,n]}),ld=(e,n)=>({...qu(e),options:[e,n]}),cd=(e,n)=>({...Xu(e),options:[e,n]}),ud=(e,n)=>({...rd(e),options:[e,n]});var dd="Arrow",qi=k.forwardRef((e,n)=>{const{children:t,width:r=10,height:o=5,...i}=e;return c.jsx(Ee.svg,{...i,ref:n,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?t:c.jsx("polygon",{points:"0,0 30,0 15,10"})})});qi.displayName=dd;var fd=qi,Lr="Popper",[Xi,Dn]=Rt(Lr),[pd,Qi]=Xi(Lr),Ji=e=>{const{__scopePopper:n,children:t}=e,[r,o]=k.useState(null);return c.jsx(pd,{scope:n,anchor:r,onAnchorChange:o,children:t})};Ji.displayName=Lr;var es="PopperAnchor",ts=k.forwardRef((e,n)=>{const{__scopePopper:t,virtualRef:r,...o}=e,i=Qi(es,t),s=k.useRef(null),a=Ae(n,s),l=k.useRef(null);return k.useEffect(()=>{const d=l.current;l.current=r?.current||s.current,d!==l.current&&i.onAnchorChange(l.current)}),r?null:c.jsx(Ee.div,{...o,ref:a})});ts.displayName=es;var Br="PopperContent",[hd,md]=Xi(Br),ns=k.forwardRef((e,n)=>{const{__scopePopper:t,side:r="bottom",sideOffset:o=0,align:i="center",alignOffset:s=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:d=[],collisionPadding:h=0,sticky:p="partial",hideWhenDetached:x=!1,updatePositionStrategy:u="optimized",onPlaced:b,...f}=e,m=Qi(Br,t),[g,w]=k.useState(null),_=Ae(n,q=>w(q)),[E,S]=k.useState(null),R=Jc(E),j=R?.width??0,M=R?.height??0,I=r+(i!=="center"?"-"+i:""),L=typeof h=="number"?h:{top:0,right:0,bottom:0,left:0,...h},K=Array.isArray(d)?d:[d],C=K.length>0,D={padding:L,boundary:K.filter(xd),altBoundary:C},{refs:y,floatingStyles:U,placement:V,isPositioned:H,middlewareData:X}=nd({strategy:"fixed",placement:I,whileElementsMounted:(...q)=>Zu(...q,{animationFrame:u==="always"}),elements:{reference:m.anchor},middleware:[od({mainAxis:o+M,alignmentAxis:s}),l&&id({mainAxis:!0,crossAxis:!1,limiter:p==="partial"?sd():void 0,...D}),l&&ad({...D}),ld({...D,apply:({elements:q,rects:re,availableWidth:se,availableHeight:me})=>{const{width:he,height:Oe}=re.reference,ke=q.floating.style;ke.setProperty("--radix-popper-available-width",`${se}px`),ke.setProperty("--radix-popper-available-height",`${me}px`),ke.setProperty("--radix-popper-anchor-width",`${he}px`),ke.setProperty("--radix-popper-anchor-height",`${Oe}px`)}}),E&&ud({element:E,padding:a}),vd({arrowWidth:j,arrowHeight:M}),x&&cd({strategy:"referenceHidden",...D})]}),[B,Z]=is(V),P=qe(b);ot(()=>{H&&P?.()},[H,P]);const T=X.arrow?.x,te=X.arrow?.y,ee=X.arrow?.centerOffset!==0,[J,ce]=k.useState();return ot(()=>{g&&ce(window.getComputedStyle(g).zIndex)},[g]),c.jsx("div",{ref:y.setFloating,"data-radix-popper-content-wrapper":"",style:{...U,transform:H?U.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:J,"--radix-popper-transform-origin":[X.transformOrigin?.x,X.transformOrigin?.y].join(" "),...X.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:c.jsx(hd,{scope:t,placedSide:B,onArrowChange:S,arrowX:T,arrowY:te,shouldHideArrow:ee,children:c.jsx(Ee.div,{"data-side":B,"data-align":Z,...f,ref:_,style:{...f.style,animation:H?void 0:"none"}})})})});ns.displayName=Br;var rs="PopperArrow",gd={top:"bottom",right:"left",bottom:"top",left:"right"},os=k.forwardRef(function(n,t){const{__scopePopper:r,...o}=n,i=md(rs,r),s=gd[i.placedSide];return c.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:c.jsx(fd,{...o,ref:t,style:{...o.style,display:"block"}})})});os.displayName=rs;function xd(e){return e!==null}var vd=e=>({name:"transformOrigin",options:e,fn(n){const{placement:t,rects:r,middlewareData:o}=n,s=o.arrow?.centerOffset!==0,a=s?0:e.arrowWidth,l=s?0:e.arrowHeight,[d,h]=is(t),p={start:"0%",center:"50%",end:"100%"}[h],x=(o.arrow?.x??0)+a/2,u=(o.arrow?.y??0)+l/2;let b="",f="";return d==="bottom"?(b=s?p:`${x}px`,f=`${-l}px`):d==="top"?(b=s?p:`${x}px`,f=`${r.floating.height+l}px`):d==="right"?(b=`${-l}px`,f=s?p:`${u}px`):d==="left"&&(b=`${r.floating.width+l}px`,f=s?p:`${u}px`),{data:{x:b,y:f}}}});function is(e){const[n,t="center"]=e.split("-");return[n,t]}var ss=Ji,zr=ts,as=ns,ls=os,Jn="rovingFocusGroup.onEntryFocus",bd={bubbles:!1,cancelable:!0},qt="RovingFocusGroup",[fr,cs,yd]=Ci(qt),[wd,us]=Rt(qt,[yd]),[kd,_d]=wd(qt),ds=k.forwardRef((e,n)=>c.jsx(fr.Provider,{scope:e.__scopeRovingFocusGroup,children:c.jsx(fr.Slot,{scope:e.__scopeRovingFocusGroup,children:c.jsx(Cd,{...e,ref:n})})}));ds.displayName=qt;var Cd=k.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:o=!1,dir:i,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:d,preventScrollOnEntryFocus:h=!1,...p}=e,x=k.useRef(null),u=Ae(n,x),b=Si(i),[f,m]=Ar({prop:s,defaultProp:a??null,onChange:l,caller:qt}),[g,w]=k.useState(!1),_=qe(d),E=cs(t),S=k.useRef(!1),[R,j]=k.useState(0);return k.useEffect(()=>{const M=x.current;if(M)return M.addEventListener(Jn,_),()=>M.removeEventListener(Jn,_)},[_]),c.jsx(kd,{scope:t,orientation:r,dir:b,loop:o,currentTabStopId:f,onItemFocus:k.useCallback(M=>m(M),[m]),onItemShiftTab:k.useCallback(()=>w(!0),[]),onFocusableItemAdd:k.useCallback(()=>j(M=>M+1),[]),onFocusableItemRemove:k.useCallback(()=>j(M=>M-1),[]),children:c.jsx(Ee.div,{tabIndex:g||R===0?-1:0,"data-orientation":r,...p,ref:u,style:{outline:"none",...e.style},onMouseDown:le(e.onMouseDown,()=>{S.current=!0}),onFocus:le(e.onFocus,M=>{const I=!S.current;if(M.target===M.currentTarget&&I&&!g){const L=new CustomEvent(Jn,bd);if(M.currentTarget.dispatchEvent(L),!L.defaultPrevented){const K=E().filter(V=>V.focusable),C=K.find(V=>V.active),D=K.find(V=>V.id===f),U=[C,D,...K].filter(Boolean).map(V=>V.ref.current);hs(U,h)}}S.current=!1}),onBlur:le(e.onBlur,()=>w(!1))})})}),fs="RovingFocusGroupItem",ps=k.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:o=!1,tabStopId:i,children:s,...a}=e,l=hn(),d=i||l,h=_d(fs,t),p=h.currentTabStopId===d,x=cs(t),{onFocusableItemAdd:u,onFocusableItemRemove:b,currentTabStopId:f}=h;return k.useEffect(()=>{if(r)return u(),()=>b()},[r,u,b]),c.jsx(fr.ItemSlot,{scope:t,id:d,focusable:r,active:o,children:c.jsx(Ee.span,{tabIndex:p?0:-1,"data-orientation":h.orientation,...a,ref:n,onMouseDown:le(e.onMouseDown,m=>{r?h.onItemFocus(d):m.preventDefault()}),onFocus:le(e.onFocus,()=>h.onItemFocus(d)),onKeyDown:le(e.onKeyDown,m=>{if(m.key==="Tab"&&m.shiftKey){h.onItemShiftTab();return}if(m.target!==m.currentTarget)return;const g=Ad(m,h.orientation,h.dir);if(g!==void 0){if(m.metaKey||m.ctrlKey||m.altKey||m.shiftKey)return;m.preventDefault();let _=x().filter(E=>E.focusable).map(E=>E.ref.current);if(g==="last")_.reverse();else if(g==="prev"||g==="next"){g==="prev"&&_.reverse();const E=_.indexOf(m.currentTarget);_=h.loop?Nd(_,E+1):_.slice(E+1)}setTimeout(()=>hs(_))}}),children:typeof s=="function"?s({isCurrentTabStop:p,hasTabStop:f!=null}):s})})});ps.displayName=fs;var Sd={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ed(e,n){return n!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Ad(e,n,t){const r=Ed(e.key,t);if(!(n==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(n==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return Sd[r]}function hs(e,n=!1){const t=document.activeElement;for(const r of e)if(r===t||(r.focus({preventScroll:n}),document.activeElement!==t))return}function Nd(e,n){return e.map((t,r)=>e[(n+r)%e.length])}var jd=ds,Rd=ps,pr=["Enter"," "],Od=["ArrowDown","PageUp","Home"],ms=["ArrowUp","PageDown","End"],Td=[...Od,...ms],Id={ltr:[...pr,"ArrowRight"],rtl:[...pr,"ArrowLeft"]},Pd={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Xt="Menu",[Wt,Md,Dd]=Ci(Xt),[mt,gs]=Rt(Xt,[Dd,Dn,us]),Fn=Dn(),xs=us(),[Fd,gt]=mt(Xt),[Ld,Qt]=mt(Xt),vs=e=>{const{__scopeMenu:n,open:t=!1,children:r,dir:o,onOpenChange:i,modal:s=!0}=e,a=Fn(n),[l,d]=k.useState(null),h=k.useRef(!1),p=qe(i),x=Si(o);return k.useEffect(()=>{const u=()=>{h.current=!0,document.addEventListener("pointerdown",b,{capture:!0,once:!0}),document.addEventListener("pointermove",b,{capture:!0,once:!0})},b=()=>h.current=!1;return document.addEventListener("keydown",u,{capture:!0}),()=>{document.removeEventListener("keydown",u,{capture:!0}),document.removeEventListener("pointerdown",b,{capture:!0}),document.removeEventListener("pointermove",b,{capture:!0})}},[]),c.jsx(ss,{...a,children:c.jsx(Fd,{scope:n,open:t,onOpenChange:p,content:l,onContentChange:d,children:c.jsx(Ld,{scope:n,onClose:k.useCallback(()=>p(!1),[p]),isUsingKeyboardRef:h,dir:x,modal:s,children:r})})})};vs.displayName=Xt;var Bd="MenuAnchor",Ur=k.forwardRef((e,n)=>{const{__scopeMenu:t,...r}=e,o=Fn(t);return c.jsx(zr,{...o,...r,ref:n})});Ur.displayName=Bd;var $r="MenuPortal",[zd,bs]=mt($r,{forceMount:void 0}),ys=e=>{const{__scopeMenu:n,forceMount:t,children:r,container:o}=e,i=gt($r,n);return c.jsx(zd,{scope:n,forceMount:t,children:c.jsx(ht,{present:t||i.open,children:c.jsx(Rr,{asChild:!0,container:o,children:r})})})};ys.displayName=$r;var De="MenuContent",[Ud,Wr]=mt(De),ws=k.forwardRef((e,n)=>{const t=bs(De,e.__scopeMenu),{forceMount:r=t.forceMount,...o}=e,i=gt(De,e.__scopeMenu),s=Qt(De,e.__scopeMenu);return c.jsx(Wt.Provider,{scope:e.__scopeMenu,children:c.jsx(ht,{present:r||i.open,children:c.jsx(Wt.Slot,{scope:e.__scopeMenu,children:s.modal?c.jsx($d,{...o,ref:n}):c.jsx(Wd,{...o,ref:n})})})})}),$d=k.forwardRef((e,n)=>{const t=gt(De,e.__scopeMenu),r=k.useRef(null),o=Ae(n,r);return k.useEffect(()=>{const i=r.current;if(i)return Li(i)},[]),c.jsx(Hr,{...e,ref:o,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:le(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),Wd=k.forwardRef((e,n)=>{const t=gt(De,e.__scopeMenu);return c.jsx(Hr,{...e,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),Hd=Ut("MenuContent.ScrollLock"),Hr=k.forwardRef((e,n)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:o,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:p,onInteractOutside:x,onDismiss:u,disableOutsideScroll:b,...f}=e,m=gt(De,t),g=Qt(De,t),w=Fn(t),_=xs(t),E=Md(t),[S,R]=k.useState(null),j=k.useRef(null),M=Ae(n,j,m.onContentChange),I=k.useRef(0),L=k.useRef(""),K=k.useRef(0),C=k.useRef(null),D=k.useRef("right"),y=k.useRef(0),U=b?Or:k.Fragment,V=b?{as:Hd,allowPinchZoom:!0}:void 0,H=B=>{const Z=L.current+B,P=E().filter(q=>!q.disabled),T=document.activeElement,te=P.find(q=>q.ref.current===T)?.textValue,ee=P.map(q=>q.textValue),J=nf(ee,Z,te),ce=P.find(q=>q.textValue===J)?.ref.current;(function q(re){L.current=re,window.clearTimeout(I.current),re!==""&&(I.current=window.setTimeout(()=>q(""),1e3))})(Z),ce&&setTimeout(()=>ce.focus())};k.useEffect(()=>()=>window.clearTimeout(I.current),[]),ji();const X=k.useCallback(B=>D.current===C.current?.side&&of(B,C.current?.area),[]);return c.jsx(Ud,{scope:t,searchRef:L,onItemEnter:k.useCallback(B=>{X(B)&&B.preventDefault()},[X]),onItemLeave:k.useCallback(B=>{X(B)||(j.current?.focus(),R(null))},[X]),onTriggerLeave:k.useCallback(B=>{X(B)&&B.preventDefault()},[X]),pointerGraceTimerRef:K,onPointerGraceIntentChange:k.useCallback(B=>{C.current=B},[]),children:c.jsx(U,{...V,children:c.jsx(jr,{asChild:!0,trapped:o,onMountAutoFocus:le(i,B=>{B.preventDefault(),j.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:s,children:c.jsx(Nr,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:p,onInteractOutside:x,onDismiss:u,children:c.jsx(jd,{asChild:!0,..._,dir:g.dir,orientation:"vertical",loop:r,currentTabStopId:S,onCurrentTabStopIdChange:R,onEntryFocus:le(l,B=>{g.isUsingKeyboardRef.current||B.preventDefault()}),preventScrollOnEntryFocus:!0,children:c.jsx(as,{role:"menu","aria-orientation":"vertical","data-state":Fs(m.open),"data-radix-menu-content":"",dir:g.dir,...w,...f,ref:M,style:{outline:"none",...f.style},onKeyDown:le(f.onKeyDown,B=>{const P=B.target.closest("[data-radix-menu-content]")===B.currentTarget,T=B.ctrlKey||B.altKey||B.metaKey,te=B.key.length===1;P&&(B.key==="Tab"&&B.preventDefault(),!T&&te&&H(B.key));const ee=j.current;if(B.target!==ee||!Td.includes(B.key))return;B.preventDefault();const ce=E().filter(q=>!q.disabled).map(q=>q.ref.current);ms.includes(B.key)&&ce.reverse(),ef(ce)}),onBlur:le(e.onBlur,B=>{B.currentTarget.contains(B.target)||(window.clearTimeout(I.current),L.current="")}),onPointerMove:le(e.onPointerMove,Ht(B=>{const Z=B.target,P=y.current!==B.clientX;if(B.currentTarget.contains(Z)&&P){const T=B.clientX>y.current?"right":"left";D.current=T,y.current=B.clientX}}))})})})})})})});ws.displayName=De;var Kd="MenuGroup",Kr=k.forwardRef((e,n)=>{const{__scopeMenu:t,...r}=e;return c.jsx(Ee.div,{role:"group",...r,ref:n})});Kr.displayName=Kd;var Zd="MenuLabel",ks=k.forwardRef((e,n)=>{const{__scopeMenu:t,...r}=e;return c.jsx(Ee.div,{...r,ref:n})});ks.displayName=Zd;var bn="MenuItem",Io="menu.itemSelect",Ln=k.forwardRef((e,n)=>{const{disabled:t=!1,onSelect:r,...o}=e,i=k.useRef(null),s=Qt(bn,e.__scopeMenu),a=Wr(bn,e.__scopeMenu),l=Ae(n,i),d=k.useRef(!1),h=()=>{const p=i.current;if(!t&&p){const x=new CustomEvent(Io,{bubbles:!0,cancelable:!0});p.addEventListener(Io,u=>r?.(u),{once:!0}),_i(p,x),x.defaultPrevented?d.current=!1:s.onClose()}};return c.jsx(_s,{...o,ref:l,disabled:t,onClick:le(e.onClick,h),onPointerDown:p=>{e.onPointerDown?.(p),d.current=!0},onPointerUp:le(e.onPointerUp,p=>{d.current||p.currentTarget?.click()}),onKeyDown:le(e.onKeyDown,p=>{const x=a.searchRef.current!=="";t||x&&p.key===" "||pr.includes(p.key)&&(p.currentTarget.click(),p.preventDefault())})})});Ln.displayName=bn;var _s=k.forwardRef((e,n)=>{const{__scopeMenu:t,disabled:r=!1,textValue:o,...i}=e,s=Wr(bn,t),a=xs(t),l=k.useRef(null),d=Ae(n,l),[h,p]=k.useState(!1),[x,u]=k.useState("");return k.useEffect(()=>{const b=l.current;b&&u((b.textContent??"").trim())},[i.children]),c.jsx(Wt.ItemSlot,{scope:t,disabled:r,textValue:o??x,children:c.jsx(Rd,{asChild:!0,...a,focusable:!r,children:c.jsx(Ee.div,{role:"menuitem","data-highlighted":h?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...i,ref:d,onPointerMove:le(e.onPointerMove,Ht(b=>{r?s.onItemLeave(b):(s.onItemEnter(b),b.defaultPrevented||b.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:le(e.onPointerLeave,Ht(b=>s.onItemLeave(b))),onFocus:le(e.onFocus,()=>p(!0)),onBlur:le(e.onBlur,()=>p(!1))})})})}),Gd="MenuCheckboxItem",Cs=k.forwardRef((e,n)=>{const{checked:t=!1,onCheckedChange:r,...o}=e;return c.jsx(js,{scope:e.__scopeMenu,checked:t,children:c.jsx(Ln,{role:"menuitemcheckbox","aria-checked":yn(t)?"mixed":t,...o,ref:n,"data-state":Gr(t),onSelect:le(o.onSelect,()=>r?.(yn(t)?!0:!t),{checkForDefaultPrevented:!1})})})});Cs.displayName=Gd;var Ss="MenuRadioGroup",[Yd,Vd]=mt(Ss,{value:void 0,onValueChange:()=>{}}),Es=k.forwardRef((e,n)=>{const{value:t,onValueChange:r,...o}=e,i=qe(r);return c.jsx(Yd,{scope:e.__scopeMenu,value:t,onValueChange:i,children:c.jsx(Kr,{...o,ref:n})})});Es.displayName=Ss;var As="MenuRadioItem",Ns=k.forwardRef((e,n)=>{const{value:t,...r}=e,o=Vd(As,e.__scopeMenu),i=t===o.value;return c.jsx(js,{scope:e.__scopeMenu,checked:i,children:c.jsx(Ln,{role:"menuitemradio","aria-checked":i,...r,ref:n,"data-state":Gr(i),onSelect:le(r.onSelect,()=>o.onValueChange?.(t),{checkForDefaultPrevented:!1})})})});Ns.displayName=As;var Zr="MenuItemIndicator",[js,qd]=mt(Zr,{checked:!1}),Rs=k.forwardRef((e,n)=>{const{__scopeMenu:t,forceMount:r,...o}=e,i=qd(Zr,t);return c.jsx(ht,{present:r||yn(i.checked)||i.checked===!0,children:c.jsx(Ee.span,{...o,ref:n,"data-state":Gr(i.checked)})})});Rs.displayName=Zr;var Xd="MenuSeparator",Os=k.forwardRef((e,n)=>{const{__scopeMenu:t,...r}=e;return c.jsx(Ee.div,{role:"separator","aria-orientation":"horizontal",...r,ref:n})});Os.displayName=Xd;var Qd="MenuArrow",Ts=k.forwardRef((e,n)=>{const{__scopeMenu:t,...r}=e,o=Fn(t);return c.jsx(ls,{...o,...r,ref:n})});Ts.displayName=Qd;var Jd="MenuSub",[Hg,Is]=mt(Jd),Ft="MenuSubTrigger",Ps=k.forwardRef((e,n)=>{const t=gt(Ft,e.__scopeMenu),r=Qt(Ft,e.__scopeMenu),o=Is(Ft,e.__scopeMenu),i=Wr(Ft,e.__scopeMenu),s=k.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=i,d={__scopeMenu:e.__scopeMenu},h=k.useCallback(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return k.useEffect(()=>h,[h]),k.useEffect(()=>{const p=a.current;return()=>{window.clearTimeout(p),l(null)}},[a,l]),c.jsx(Ur,{asChild:!0,...d,children:c.jsx(_s,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":o.contentId,"data-state":Fs(t.open),...e,ref:_r(n,o.onTriggerChange),onClick:p=>{e.onClick?.(p),!(e.disabled||p.defaultPrevented)&&(p.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:le(e.onPointerMove,Ht(p=>{i.onItemEnter(p),!p.defaultPrevented&&!e.disabled&&!t.open&&!s.current&&(i.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{t.onOpenChange(!0),h()},100))})),onPointerLeave:le(e.onPointerLeave,Ht(p=>{h();const x=t.content?.getBoundingClientRect();if(x){const u=t.content?.dataset.side,b=u==="right",f=b?-5:5,m=x[b?"left":"right"],g=x[b?"right":"left"];i.onPointerGraceIntentChange({area:[{x:p.clientX+f,y:p.clientY},{x:m,y:x.top},{x:g,y:x.top},{x:g,y:x.bottom},{x:m,y:x.bottom}],side:u}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(p),p.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:le(e.onKeyDown,p=>{const x=i.searchRef.current!=="";e.disabled||x&&p.key===" "||Id[r.dir].includes(p.key)&&(t.onOpenChange(!0),t.content?.focus(),p.preventDefault())})})})});Ps.displayName=Ft;var Ms="MenuSubContent",Ds=k.forwardRef((e,n)=>{const t=bs(De,e.__scopeMenu),{forceMount:r=t.forceMount,...o}=e,i=gt(De,e.__scopeMenu),s=Qt(De,e.__scopeMenu),a=Is(Ms,e.__scopeMenu),l=k.useRef(null),d=Ae(n,l);return c.jsx(Wt.Provider,{scope:e.__scopeMenu,children:c.jsx(ht,{present:r||i.open,children:c.jsx(Wt.Slot,{scope:e.__scopeMenu,children:c.jsx(Hr,{id:a.contentId,"aria-labelledby":a.triggerId,...o,ref:d,align:"start",side:s.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:h=>{s.isUsingKeyboardRef.current&&l.current?.focus(),h.preventDefault()},onCloseAutoFocus:h=>h.preventDefault(),onFocusOutside:le(e.onFocusOutside,h=>{h.target!==a.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:le(e.onEscapeKeyDown,h=>{s.onClose(),h.preventDefault()}),onKeyDown:le(e.onKeyDown,h=>{const p=h.currentTarget.contains(h.target),x=Pd[s.dir].includes(h.key);p&&x&&(i.onOpenChange(!1),a.trigger?.focus(),h.preventDefault())})})})})})});Ds.displayName=Ms;function Fs(e){return e?"open":"closed"}function yn(e){return e==="indeterminate"}function Gr(e){return yn(e)?"indeterminate":e?"checked":"unchecked"}function ef(e){const n=document.activeElement;for(const t of e)if(t===n||(t.focus(),document.activeElement!==n))return}function tf(e,n){return e.map((t,r)=>e[(n+r)%e.length])}function nf(e,n,t){const o=n.length>1&&Array.from(n).every(d=>d===n[0])?n[0]:n,i=t?e.indexOf(t):-1;let s=tf(e,Math.max(i,0));o.length===1&&(s=s.filter(d=>d!==t));const l=s.find(d=>d.toLowerCase().startsWith(o.toLowerCase()));return l!==t?l:void 0}function rf(e,n){const{x:t,y:r}=e;let o=!1;for(let i=0,s=n.length-1;i<n.length;s=i++){const a=n[i],l=n[s],d=a.x,h=a.y,p=l.x,x=l.y;h>r!=x>r&&t<(p-d)*(r-h)/(x-h)+d&&(o=!o)}return o}function of(e,n){if(!n)return!1;const t={x:e.clientX,y:e.clientY};return rf(t,n)}function Ht(e){return n=>n.pointerType==="mouse"?e(n):void 0}var sf=vs,af=Ur,lf=ys,cf=ws,uf=Kr,df=ks,ff=Ln,pf=Cs,hf=Es,mf=Ns,gf=Rs,xf=Os,vf=Ts,bf=Ps,yf=Ds,Bn="DropdownMenu",[wf]=Rt(Bn,[gs]),Re=gs(),[kf,Ls]=wf(Bn),Bs=e=>{const{__scopeDropdownMenu:n,children:t,dir:r,open:o,defaultOpen:i,onOpenChange:s,modal:a=!0}=e,l=Re(n),d=k.useRef(null),[h,p]=Ar({prop:o,defaultProp:i??!1,onChange:s,caller:Bn});return c.jsx(kf,{scope:n,triggerId:hn(),triggerRef:d,contentId:hn(),open:h,onOpenChange:p,onOpenToggle:k.useCallback(()=>p(x=>!x),[p]),modal:a,children:c.jsx(sf,{...l,open:h,onOpenChange:p,dir:r,modal:a,children:t})})};Bs.displayName=Bn;var zs="DropdownMenuTrigger",Us=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...o}=e,i=Ls(zs,t),s=Re(t);return c.jsx(af,{asChild:!0,...s,children:c.jsx(Ee.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...o,ref:_r(n,i.triggerRef),onPointerDown:le(e.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(i.onOpenToggle(),i.open||a.preventDefault())}),onKeyDown:le(e.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&i.onOpenToggle(),a.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});Us.displayName=zs;var _f="DropdownMenuPortal",$s=e=>{const{__scopeDropdownMenu:n,...t}=e,r=Re(n);return c.jsx(lf,{...r,...t})};$s.displayName=_f;var Ws="DropdownMenuContent",Hs=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Ls(Ws,t),i=Re(t),s=k.useRef(!1);return c.jsx(cf,{id:o.contentId,"aria-labelledby":o.triggerId,...i,...r,ref:n,onCloseAutoFocus:le(e.onCloseAutoFocus,a=>{s.current||o.triggerRef.current?.focus(),s.current=!1,a.preventDefault()}),onInteractOutside:le(e.onInteractOutside,a=>{const l=a.detail.originalEvent,d=l.button===0&&l.ctrlKey===!0,h=l.button===2||d;(!o.modal||h)&&(s.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Hs.displayName=Ws;var Cf="DropdownMenuGroup",Sf=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(uf,{...o,...r,ref:n})});Sf.displayName=Cf;var Ef="DropdownMenuLabel",Ks=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(df,{...o,...r,ref:n})});Ks.displayName=Ef;var Af="DropdownMenuItem",Zs=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(ff,{...o,...r,ref:n})});Zs.displayName=Af;var Nf="DropdownMenuCheckboxItem",jf=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(pf,{...o,...r,ref:n})});jf.displayName=Nf;var Rf="DropdownMenuRadioGroup",Of=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(hf,{...o,...r,ref:n})});Of.displayName=Rf;var Tf="DropdownMenuRadioItem",If=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(mf,{...o,...r,ref:n})});If.displayName=Tf;var Pf="DropdownMenuItemIndicator",Mf=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(gf,{...o,...r,ref:n})});Mf.displayName=Pf;var Df="DropdownMenuSeparator",Gs=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(xf,{...o,...r,ref:n})});Gs.displayName=Df;var Ff="DropdownMenuArrow",Lf=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(vf,{...o,...r,ref:n})});Lf.displayName=Ff;var Bf="DropdownMenuSubTrigger",zf=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(bf,{...o,...r,ref:n})});zf.displayName=Bf;var Uf="DropdownMenuSubContent",$f=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(yf,{...o,...r,ref:n,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});$f.displayName=Uf;var Wf=Bs,Hf=Us,Kf=$s,Zf=Hs,Gf=Ks,Yf=Zs,Vf=Gs,zn="Popover",[Ys]=Rt(zn,[Dn]),Jt=Dn(),[qf,lt]=Ys(zn),Vs=e=>{const{__scopePopover:n,children:t,open:r,defaultOpen:o,onOpenChange:i,modal:s=!1}=e,a=Jt(n),l=k.useRef(null),[d,h]=k.useState(!1),[p,x]=Ar({prop:r,defaultProp:o??!1,onChange:i,caller:zn});return c.jsx(ss,{...a,children:c.jsx(qf,{scope:n,contentId:hn(),triggerRef:l,open:p,onOpenChange:x,onOpenToggle:k.useCallback(()=>x(u=>!u),[x]),hasCustomAnchor:d,onCustomAnchorAdd:k.useCallback(()=>h(!0),[]),onCustomAnchorRemove:k.useCallback(()=>h(!1),[]),modal:s,children:t})})};Vs.displayName=zn;var qs="PopoverAnchor",Xf=k.forwardRef((e,n)=>{const{__scopePopover:t,...r}=e,o=lt(qs,t),i=Jt(t),{onCustomAnchorAdd:s,onCustomAnchorRemove:a}=o;return k.useEffect(()=>(s(),()=>a()),[s,a]),c.jsx(zr,{...i,...r,ref:n})});Xf.displayName=qs;var Xs="PopoverTrigger",Qs=k.forwardRef((e,n)=>{const{__scopePopover:t,...r}=e,o=lt(Xs,t),i=Jt(t),s=Ae(n,o.triggerRef),a=c.jsx(Ee.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":ra(o.open),...r,ref:s,onClick:le(e.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:c.jsx(zr,{asChild:!0,...i,children:a})});Qs.displayName=Xs;var Yr="PopoverPortal",[Qf,Jf]=Ys(Yr,{forceMount:void 0}),Js=e=>{const{__scopePopover:n,forceMount:t,children:r,container:o}=e,i=lt(Yr,n);return c.jsx(Qf,{scope:n,forceMount:t,children:c.jsx(ht,{present:t||i.open,children:c.jsx(Rr,{asChild:!0,container:o,children:r})})})};Js.displayName=Yr;var Nt="PopoverContent",ea=k.forwardRef((e,n)=>{const t=Jf(Nt,e.__scopePopover),{forceMount:r=t.forceMount,...o}=e,i=lt(Nt,e.__scopePopover);return c.jsx(ht,{present:r||i.open,children:i.modal?c.jsx(tp,{...o,ref:n}):c.jsx(np,{...o,ref:n})})});ea.displayName=Nt;var ep=Ut("PopoverContent.RemoveScroll"),tp=k.forwardRef((e,n)=>{const t=lt(Nt,e.__scopePopover),r=k.useRef(null),o=Ae(n,r),i=k.useRef(!1);return k.useEffect(()=>{const s=r.current;if(s)return Li(s)},[]),c.jsx(Or,{as:ep,allowPinchZoom:!0,children:c.jsx(ta,{...e,ref:o,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:le(e.onCloseAutoFocus,s=>{s.preventDefault(),i.current||t.triggerRef.current?.focus()}),onPointerDownOutside:le(e.onPointerDownOutside,s=>{const a=s.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,d=a.button===2||l;i.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:le(e.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1})})})}),np=k.forwardRef((e,n)=>{const t=lt(Nt,e.__scopePopover),r=k.useRef(!1),o=k.useRef(!1);return c.jsx(ta,{...e,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{e.onCloseAutoFocus?.(i),i.defaultPrevented||(r.current||t.triggerRef.current?.focus(),i.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:i=>{e.onInteractOutside?.(i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const s=i.target;t.triggerRef.current?.contains(s)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&o.current&&i.preventDefault()}})}),ta=k.forwardRef((e,n)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:d,onInteractOutside:h,...p}=e,x=lt(Nt,t),u=Jt(t);return ji(),c.jsx(jr,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:i,children:c.jsx(Nr,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:h,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:d,onDismiss:()=>x.onOpenChange(!1),children:c.jsx(as,{"data-state":ra(x.open),role:"dialog",id:x.contentId,...u,...p,ref:n,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),na="PopoverClose",rp=k.forwardRef((e,n)=>{const{__scopePopover:t,...r}=e,o=lt(na,t);return c.jsx(Ee.button,{type:"button",...r,ref:n,onClick:le(e.onClick,()=>o.onOpenChange(!1))})});rp.displayName=na;var op="PopoverArrow",ip=k.forwardRef((e,n)=>{const{__scopePopover:t,...r}=e,o=Jt(t);return c.jsx(ls,{...o,...r,ref:n})});ip.displayName=op;function ra(e){return e?"open":"closed"}var sp=Vs,ap=Qs,lp=Js,cp=ea;function up({...e}){return c.jsx(Wf,{"data-slot":"dropdown-menu",...e})}function dp({...e}){return c.jsx(Hf,{"data-slot":"dropdown-menu-trigger",...e})}function fp({className:e,sideOffset:n=4,...t}){return c.jsx(Kf,{children:c.jsx(Zf,{"data-slot":"dropdown-menu-content",sideOffset:n,className:pe("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",e),...t})})}function er({className:e,inset:n,variant:t="default",...r}){return c.jsx(Yf,{"data-slot":"dropdown-menu-item","data-inset":n,"data-variant":t,className:pe("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r})}function pp({className:e,inset:n,...t}){return c.jsx(Gf,{"data-slot":"dropdown-menu-label","data-inset":n,className:pe("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",e),...t})}function hp({className:e,...n}){return c.jsx(Vf,{"data-slot":"dropdown-menu-separator",className:pe("bg-border -mx-1 my-1 h-px",e),...n})}const hr="brainstorming",mp="Brainstorming Methodology",gp=`# Brainstorming Ideas Into Designs

## Overview

Help turn ideas into fully formed designs through natural collaborative dialogue.

The user's context blocks are already loaded into this conversation. Use them to understand the project, domain, and constraints. Ask questions one at a time to refine the idea. Once you understand what's being designed, present the design and get user approval.

## Anti-Pattern: "This Is Too Simple To Need A Design"

Every idea goes through this process. "Simple" ideas are where unexamined assumptions cause the most wasted work. The design can be short (a few sentences for truly simple ideas), but you MUST present it and get approval.

## Process Flow

1. **Review the context blocks**  understand the project/domain from what's already loaded
2. **Ask clarifying questions**  one at a time, understand purpose/constraints/success criteria
3. **Propose 2-3 approaches**  with trade-offs and your recommendation
4. **Present design**  in sections scaled to their complexity, get user approval after each section

## The Process

**Understanding the idea:**
- Review the context blocks to understand the project and domain
- Ask questions one at a time to refine the idea
- Prefer multiple choice questions when possible, but open-ended is fine too
- Only one question per message - if a topic needs more exploration, break it into multiple questions
- Focus on understanding: purpose, constraints, success criteria

**Exploring approaches:**
- Propose 2-3 different approaches with trade-offs
- Present options conversationally with your recommendation and reasoning
- Lead with your recommended option and explain why

**Presenting the design:**
- Once you believe you understand what's being designed, present it
- Scale each section to its complexity: a few sentences if straightforward, up to 200-300 words if nuanced
- Ask after each section whether it looks right so far
- Cover whatever aspects are relevant to the domain (structure, flow, trade-offs, edge cases)
- Be ready to go back and clarify if something doesn't make sense

## Key Principles

- **One question at a time** - Don't overwhelm with multiple questions
- **Multiple choice preferred** - Easier to answer than open-ended when possible
- **YAGNI ruthlessly** - Remove unnecessary complexity from all designs
- **Explore alternatives** - Always propose 2-3 approaches before settling
- **Incremental validation** - Present design in sections, get approval before moving on
- **Be flexible** - Go back and clarify when something doesn't make sense`,ut={[hr]:{id:hr,label:mp,content:gp}},xp={[hr]:!0};function Po(e){const n=[];for(const[t,r]of Object.entries(e))r&&ut[t]&&n.push(`[Active Skill: ${ut[t].label}]
${ut[t].content}`);return n.join(`

`)}const vp=6e4;function Mo(e){if(!e)return"";const n=new Date(e).getTime()-Date.now();if(n<=0)return"now";const t=Math.floor(n/6e4),r=Math.floor(t/60),o=t%60;return r>0?`${r}h ${o}m`:`${o}m`}function bp(e){const n=zt(ae.claudeNode.getSubscriptionUsage),[t,r]=k.useState(null),[o,i]=k.useState(!0),[s,a]=k.useState(null),l=k.useRef(null),d=k.useCallback(async()=>{try{const x=await n();"error"in x?a(x.error):(r(x),a(null))}catch(x){a(x instanceof Error?x.message:String(x))}finally{i(!1)}},[n]);k.useEffect(()=>{if(!e){i(!1);return}return d(),l.current=setInterval(d,vp),()=>{l.current&&clearInterval(l.current)}},[e,d]);const[,h]=k.useState(0);k.useEffect(()=>{if(!e||!t)return;const x=setInterval(()=>h(u=>u+1),3e4);return()=>clearInterval(x)},[e,t]);const p={utilization:0,resetsAt:"",resetsIn:""};return t?{fiveHour:{utilization:t.fiveHour.utilization,resetsAt:t.fiveHour.resetsAt,resetsIn:Mo(t.fiveHour.resetsAt)},sevenDay:{utilization:t.sevenDay.utilization,resetsAt:t.sevenDay.resetsAt,resetsIn:Mo(t.sevenDay.resetsAt)},loading:o,error:s}:{fiveHour:p,sevenDay:p,loading:o,error:s}}function yp({enabled:e}){const{fiveHour:n,sevenDay:t,loading:r,error:o}=bp(e);if(!e)return null;if(r)return c.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-muted text-muted-foreground animate-pulse",children:"5h: "});if(o)return c.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-muted text-muted-foreground",title:`Usage unavailable: ${o}`,children:"5h: --"});const i=n.utilization,s=i>=70&&i<90,a=i>=90,l=[`5-hour: ${i.toFixed(1)}%${n.resetsAt?` (resets ${n.resetsIn})`:""}`,`7-day: ${t.utilization.toFixed(1)}%${t.resetsAt?` (resets ${t.resetsIn})`:""}`].join(`
`);return a?c.jsxs("span",{className:pe("text-xs px-2 py-1 rounded-full font-medium","bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300","ring-1 ring-red-300 dark:ring-red-700"),title:l,children:["5h: ",Math.round(i),"%  ",n.resetsIn," | 7d: ",Math.round(t.utilization),"%"]}):s?c.jsxs("span",{className:"text-xs px-2 py-1 rounded-full font-medium bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300",title:l,children:["5h: ",Math.round(i),"%  ",n.resetsIn]}):c.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300",title:l,children:["5h: ",Math.round(i),"%"]})}function wp(e){return e<.01?`$${e.toFixed(4)}`:e<1?`$${e.toFixed(3)}`:`$${e.toFixed(2)}`}function kp({sessionCost:e}){return e<=0?null:c.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",title:`OpenRouter session cost: $${e.toFixed(6)}`,children:wp(e)})}function _p({message:e,onCopy:n,onSave:t,onRetry:r,onEdit:o,isStreaming:i}){const[s,a]=k.useState(!1),[l,d]=k.useState(!1),[h,p]=k.useState(e.content),x=()=>{if(navigator.clipboard)navigator.clipboard.writeText(e.content);else{const m=document.createElement("textarea");m.value=e.content,m.style.position="fixed",m.style.left="-999999px",m.style.top="-999999px",document.body.appendChild(m),m.focus(),m.select();try{document.execCommand("copy")}finally{document.body.removeChild(m)}}a(!0),setTimeout(()=>a(!1),1500),n()},u=()=>{h.trim()&&h!==e.content&&o(h.trim()),d(!1)},b=m=>{m.key==="Enter"&&(m.ctrlKey||m.metaKey)?(m.preventDefault(),u()):m.key==="Escape"&&(p(e.content),d(!1))},f=e.role==="user";return c.jsxs("div",{className:pe("flex flex-col gap-1",f?"items-end":"items-start"),children:[c.jsxs("div",{className:pe("max-w-[80%] rounded-lg px-4 py-2",f?"bg-primary text-primary-foreground":"bg-muted"),children:[c.jsx("div",{className:"text-xs font-medium mb-1 opacity-70",children:f?"You":"Assistant"}),l?c.jsxs("div",{className:"space-y-2",children:[c.jsx("textarea",{value:h,onChange:m=>p(m.target.value),onKeyDown:b,className:"w-full min-w-[300px] rounded border border-input bg-background px-2 py-1 text-sm text-foreground resize-none",rows:3,autoFocus:!0}),c.jsxs("div",{className:"flex gap-1 justify-end",children:[c.jsx(de,{variant:"ghost",size:"sm",onClick:()=>{p(e.content),d(!1)},className:"h-6 px-2 text-xs",children:"Cancel"}),c.jsx(de,{size:"sm",onClick:u,disabled:!h.trim()||h===e.content,className:"h-6 px-2 text-xs",children:"Send"})]})]}):f?c.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.content}):c.jsx("div",{className:"text-sm prose prose-sm dark:prose-invert max-w-none",children:c.jsx(fi,{remarkPlugins:[hi,mi],components:pi,children:e.content||"No answer"})})]}),!l&&c.jsxs("div",{className:"flex gap-1 relative",children:[c.jsx(de,{variant:"ghost",size:"sm",onClick:x,className:"h-6 px-2 text-xs",children:s?"Copied!":"Copy"}),f&&c.jsx(de,{variant:"ghost",size:"sm",onClick:()=>d(!0),disabled:i,className:"h-6 px-2 text-xs",children:"Edit"}),c.jsxs(up,{children:[c.jsx(dp,{asChild:!0,children:c.jsx(de,{variant:"ghost",size:"sm",className:pe("h-6 px-2 text-xs",e.savedAsBlockId&&"text-green-600"),children:e.savedAsBlockId?"Saved":"Save"})}),c.jsxs(fp,{align:"end",collisionPadding:8,children:[c.jsx(pp,{className:"text-xs",children:"Save to zone:"}),c.jsx(hp,{}),c.jsx(er,{onSelect:()=>t("WORKING"),children:"Working"}),c.jsx(er,{onSelect:()=>t("STABLE"),children:"Stable"}),c.jsx(er,{onSelect:()=>t("PERMANENT"),children:"Permanent"})]})]}),c.jsx(de,{variant:"ghost",size:"sm",onClick:r,disabled:i,className:"h-6 px-2 text-xs",title:f?"Resend this message":"Regenerate response",children:"Retry"})]})]})}function Cp({text:e}){return c.jsx("div",{className:"flex flex-col gap-1 items-start",children:c.jsxs("div",{className:"max-w-[80%] rounded-lg px-4 py-2 bg-muted",children:[c.jsxs("div",{className:"text-xs font-medium mb-1 opacity-70 flex items-center gap-2",children:["Assistant",c.jsx("span",{className:"inline-flex items-center",children:c.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary animate-pulse"})})]}),e?c.jsx("div",{className:"text-sm prose prose-sm dark:prose-invert max-w-none",children:c.jsx(fi,{remarkPlugins:[hi,mi],components:pi,children:e||"No answer."})}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Thinking..."})]})})}function Do({isOpen:e,onClose:n,messages:t,hasUnsavedContent:r=!1,isStreaming:o,streamingText:i,provider:s,onProviderChange:a,onSendMessage:l,onClearConversation:d,onSaveMessage:h,onRetryMessage:p,onEditMessage:x,error:u,providerHealth:b,systemPrompt:f,disableAgentBehavior:m=!0,onDisableAgentBehaviorChange:g,preventSelfTalk:w=!0,onPreventSelfTalkChange:_,onStopStreaming:E,model:S,onModelChange:R,activeSkills:j,onToggleSkill:M,openrouterSessionCost:I}){const[L,K]=k.useState(""),[C,D]=k.useState(!1),[y,U]=k.useState(null),V=k.useRef(null),H=k.useRef(null),X=k.useRef(null),[B,Z]=k.useState(!0),P=k.useCallback(()=>{const q=H.current;if(!q)return;const{scrollTop:re,scrollHeight:se,clientHeight:me}=q,he=se-re-me<100;Z(he)},[]);k.useEffect(()=>{B&&V.current?.scrollIntoView({behavior:"smooth"})},[t,i,B]),k.useEffect(()=>{e&&setTimeout(()=>X.current?.focus(),100)},[e]),k.useEffect(()=>{const q=re=>{if(r&&e)return re.preventDefault(),re.returnValue="",""};return window.addEventListener("beforeunload",q),()=>window.removeEventListener("beforeunload",q)},[r,e]);const T=k.useCallback(()=>{r?D(!0):n()},[r,n]);k.useEffect(()=>{const q=re=>{re.key==="Escape"&&e&&(re.preventDefault(),T())};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)},[e,T]);const te=k.useCallback(async()=>{if(!L.trim()||o)return;const q=L.trim();K(""),await l(q)},[L,o,l]),ee=q=>{q.key==="Enter"&&(q.ctrlKey||q.metaKey)&&(q.preventDefault(),te())};k.useEffect(()=>{const q=X.current;if(!q)return;q.style.height="auto";const re=200;q.style.height=`${Math.min(q.scrollHeight,re)}px`},[L]),k.useEffect(()=>{if(!b)return;const q=b[s];q!=null&&(!q.ok||"disabled"in q&&q.disabled)&&(b.ollama?.ok?a("ollama"):b.openrouter?.ok&&a("openrouter"))},[b,s,a]);const J=s==="ollama"?b?.ollama?.ok??!0:s==="openrouter"?b?.openrouter?.ok??!0:b?.claude===null||b?.claude===void 0?!0:b.claude.ok&&!b.claude.disabled,ce=t.length===0;return c.jsx(Nn,{children:e&&c.jsxs(Fe.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",initial:be.initial,animate:be.animate,exit:be.exit,transition:be.transition,children:[c.jsxs(Fe.div,{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-5xl h-[80vh] flex flex-col",initial:ye.initial,animate:ye.animate,exit:ye.exit,transition:ye.transition,onClick:q=>q.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("h2",{className:"text-lg font-semibold",children:"Brainstorm"}),c.jsxs("select",{value:s,onChange:q=>a(q.target.value),disabled:!ce||o,className:"text-sm border border-input rounded-md px-2 py-1 bg-background disabled:opacity-50",children:[!b?.claude?.disabled&&c.jsxs("option",{value:"claude",disabled:!b?.claude?.ok,children:["Claude ",b?.claude?.ok?"":"(offline)"]}),c.jsxs("option",{value:"ollama",disabled:!b?.ollama?.ok,children:["Ollama ",b?.ollama?.ok?"":"(offline)"]}),c.jsxs("option",{value:"openrouter",disabled:!b?.openrouter?.ok,children:["OpenRouter ",b?.openrouter?.ok?"":"(offline)"]})]}),s==="claude"&&R&&!b?.claude?.disabled&&c.jsxs("select",{value:S??"",onChange:q=>R(q.target.value||null),disabled:!ce||o,className:"text-sm border border-input rounded-md px-2 py-1 bg-background disabled:opacity-50 max-w-[200px]",children:[c.jsx("option",{value:"",children:"Default (Opus)"}),c.jsx("option",{value:"claude-sonnet-4-5-20250929",children:"Sonnet 4.5"}),c.jsx("option",{value:"claude-opus-4-6",children:"Opus 4.6"}),c.jsx("option",{value:"claude-haiku-4-5-20251001",children:"Haiku 4.5"})]}),s==="claude"&&!b?.claude?.disabled&&c.jsx(yp,{enabled:s==="claude"}),s==="openrouter"&&I!=null&&c.jsx(kp,{sessionCost:I}),s==="claude"&&g&&!b?.claude?.disabled&&c.jsxs("label",{className:"inline-flex items-center gap-1.5 text-xs cursor-pointer",title:"When enabled, appends instructions to prevent Claude from pretending to have tool access",children:[c.jsx("input",{type:"checkbox",checked:m,onChange:q=>g(q.target.checked),disabled:!ce||o,className:"rounded border-input"}),c.jsx("span",{className:"text-muted-foreground",children:"No tools"})]}),s==="claude"&&_&&!b?.claude?.disabled&&c.jsxs("label",{className:"inline-flex items-center gap-1.5 text-xs cursor-pointer",title:"When enabled, prevents the model from simulating user messages and continuing the conversation with itself",children:[c.jsx("input",{type:"checkbox",checked:w,onChange:q=>_(q.target.checked),disabled:!ce||o,className:"rounded border-input"}),c.jsx("span",{className:"text-muted-foreground",children:"No self-talk"})]}),f&&c.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300",title:f,children:"System Prompt Active"}),j&&M&&Object.entries(j).map(([q,re])=>{const se=ut[q];return se?c.jsxs("span",{className:pe("inline-flex items-center gap-1.5 text-xs px-2 py-1 rounded-full cursor-pointer transition-colors",re?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"bg-muted text-muted-foreground line-through"),children:[c.jsx("input",{type:"checkbox",checked:re,onChange:()=>M(q),className:"rounded border-input h-3 w-3"}),c.jsx("span",{onClick:()=>U(y===q?null:q),title:"Click to preview skill content",children:se.label})]},q):null})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(de,{variant:"ghost",size:"sm",onClick:d,disabled:t.length===0&&!i,children:"Clear"}),c.jsx(de,{variant:"ghost",size:"sm",onClick:()=>{o&&E(),T()},children:"Close"})]})]}),y&&ut[y]&&c.jsxs("div",{className:"mx-4 mt-2 p-3 rounded-md bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 max-h-[200px] overflow-y-auto",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-medium text-blue-700 dark:text-blue-300",children:ut[y].label}),c.jsx(de,{variant:"ghost",size:"sm",className:"h-5 px-1 text-xs",onClick:()=>U(null),children:"Close"})]}),c.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-wrap font-mono",children:ut[y].content})]}),c.jsxs("div",{ref:H,onScroll:P,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.length===0&&!o&&c.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[c.jsx("p",{className:"text-lg mb-2",children:"Start a conversation"}),c.jsxs("p",{className:"text-sm",children:["Your context blocks are included automatically.",c.jsx("br",{}),"Messages you save will become blocks."]}),c.jsx("p",{className:"text-xs text-muted-foreground/60 mt-2",children:"AI responses may be inaccurate. Verify before relying on them."})]}),t.map(q=>c.jsx(_p,{message:q,onCopy:()=>{},onSave:re=>h(q.id,re),onRetry:()=>p(q.id),onEdit:re=>x(q.id,re),isStreaming:o},q.id)),o&&c.jsx(Cp,{text:i}),c.jsx("div",{ref:V})]}),u&&c.jsx("div",{className:"mx-4 mb-2 p-3 rounded-md bg-destructive/10 border border-destructive text-destructive text-sm",children:u}),c.jsxs("div",{className:"p-4 border-t border-border",children:[c.jsxs("div",{className:"flex gap-2 items-end",children:[c.jsx("textarea",{ref:X,value:L,onChange:q=>K(q.target.value),onKeyDown:ee,placeholder:"Type your message... (Ctrl+Enter to send)",rows:3,disabled:o||!J,className:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm resize-none disabled:opacity-50 min-h-[80px] max-h-[200px] overflow-y-auto"}),o?c.jsx(de,{variant:"destructive",onClick:E,className:"self-end",children:"Stop"}):c.jsx(ft,{onClick:te,disabled:!L.trim()||!J,className:"self-end",debounceMs:300,children:"Send"})]}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ctrl+Enter to send, Esc to close  AI responses may be inaccurate"})]})]}),c.jsx(di,{open:C,onOpenChange:D,title:"Discard conversation?",description:"You have unsaved messages. Are you sure you want to close? Your conversation will be lost.",confirmLabel:"Discard",cancelLabel:"Keep open",destructive:!0,onConfirm:()=>{D(!1),d(),n()}})]})})}const Sp=`

IMPORTANT: In this conversation you do NOT have access to tools, files, or code execution. Do NOT say "let me read that file" or "I'll search for that" - work only with information provided in this conversation.`;function Fo(e){return e.filter(t=>t.type==="system_prompt"&&t.zone==="PERMANENT"&&!t.isDraft).sort((t,r)=>t.position-r.position)[0]?.content}function Lo(e,n,t,r){const o=[],i={PERMANENT:[],STABLE:[],WORKING:[]};for(const d of e){if(d.type==="system_prompt"||d.isDraft)continue;const h=d.zone;i[h]&&i[h].push(d)}for(const d of Object.keys(i))i[d].sort((h,p)=>h.position-p.position);const s=i.PERMANENT.map(d=>d.content).join(`

`);s&&o.push({role:"system",content:s});const a=i.STABLE.map(d=>d.content).join(`

`);a&&o.push({role:"user",content:`Reference Material:

${a}`});const l=i.WORKING.map(d=>d.content).join(`

`);l&&o.push({role:"user",content:`Current Context:

${l}`}),r&&o.push({role:"user",content:`Active Skills:

${r}`});for(const d of n)o.push({role:d.role,content:d.content});return o.push({role:"user",content:t}),o}function Dt(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Ep(e){const{sessionId:n,onError:t,defaultDisableAgentBehavior:r=!0}=e,[o,i]=k.useState(!1),[s,a]=k.useState("claude"),[l,d]=k.useState(r),[h,p]=k.useState(!0),[x,u]=k.useState(null),[b,f]=k.useState([]),[m,g]=k.useState(!1),[w,_]=k.useState(()=>({...xp})),[E,S]=k.useState(null),[R,j]=k.useState(!1),[M,I]=k.useState(""),L=k.useRef(""),[K,C]=k.useState(null),[D,y]=k.useState(0),U=k.useRef("");k.useEffect(()=>{L.current=M},[M]);const V=k.useRef(null),H=Se(ae.blocks.list,{sessionId:n});k.useEffect(()=>{f([]),I(""),C(null),S(null),j(!1),U.current="",V.current?.abort()},[n]);const X=_e(ae.generations.startBrainstormGeneration),B=_e(ae.generations.saveBrainstormMessage),Z=_e(ae.generations.cancel);k.useEffect(()=>{const v=()=>{E&&Z({generationId:E}).catch(()=>{}),V.current?.abort()};return window.addEventListener("beforeunload",v),()=>window.removeEventListener("beforeunload",v)},[E,Z]);const P=Se(ae.generations.get,E?{generationId:E}:"skip");k.useEffect(()=>{if(!P||s!=="claude")return;const v=P.text;if(v!==U.current&&(U.current=v,I(v)),P.status==="complete"&&R){if(j(!1),P.text.trim()){const $={id:Dt(),role:"assistant",content:P.text,timestamp:Date.now()};f(z=>[...z,$])}I(""),S(null)}if(P.status==="error"&&R){j(!1);const $=P.error||"Unknown error";console.error("[Claude Brainstorm] Generation error:",$),P.text?.trim()&&console.error("[Claude Brainstorm] Partial text before error:",P.text),C($),t?.($),I(""),S(null)}P.status==="cancelled"&&R&&(j(!1),I(""),S(null))},[P,R,t,s]);const T=k.useCallback(v=>{v&&a(v),i(!0)},[]),te=k.useCallback(()=>{i(!1),V.current?.abort(),E&&Z({generationId:E}).catch(console.error),j(!1),I(""),S(null),U.current=""},[E,Z]),ee=k.useCallback(()=>{const v=L.current;if(v.trim()){const $={id:Dt(),role:"assistant",content:v+`

*(generation stopped)*`,timestamp:Date.now()};f(z=>[...z,$])}V.current?.abort(),E&&Z({generationId:E}).catch(console.error),j(!1),I(""),S(null),U.current=""},[E,Z]),J=k.useCallback(v=>{_($=>({...$,[v]:!$[v]}))},[]),ce=k.useCallback(()=>{f([]),g(!1),I(""),C(null),S(null),j(!1),y(0),U.current="",V.current?.abort()},[]),q=k.useCallback(async(v,$)=>{if(!H)throw new Error("Blocks not loaded yet");const z=Po(w),N=Lo(H,$,v,z||void 0),A=Fo(H),O=[];A&&O.push({role:"system",content:A});for(const F of N)O.push({role:F.role,content:F.content});let W="";const G=new AbortController;V.current=G;try{const F=yi(O,{signal:G.signal});for await(const Y of F)W+=Y,I(W);if(W.trim()){const Y={id:Dt(),role:"assistant",content:W,timestamp:Date.now()};f(ne=>[...ne,Y])}}finally{I("")}},[H,w]),re=k.useCallback(async(v,$)=>{if(!H)throw new Error("Blocks not loaded yet");const z=Po(w),N=Lo(H,$,v,z||void 0),A=Fo(H),O=[];A&&O.push({role:"system",content:A+Sp});for(const F of N)O.push({role:F.role,content:F.content});let W="";const G=new AbortController;V.current=G;try{const F=wi(O,{signal:G.signal});let Y;do Y=await F.next(),!Y.done&&Y.value&&(W+=Y.value,I(W));while(!Y.done);const ne=Y.value;if(ne?.promptTokens&&ne?.completionTokens&&ne?.model){const Q=await xl(ne.model);if(Q){const oe=vl(ne.promptTokens,ne.completionTokens,Q);y(fe=>fe+oe)}}if(W.trim()){const Q={id:Dt(),role:"assistant",content:W,timestamp:Date.now()};f(oe=>[...oe,Q])}}finally{I("")}},[H,w]),se=k.useCallback(async v=>{const $=b.map(A=>({role:A.role,content:A.content})),z=Object.entries(w).filter(([,A])=>A).map(([A])=>A),N=await X({sessionId:n,conversationHistory:$,newMessage:v,disableAgentBehavior:l,preventSelfTalk:h,activeSkillIds:z,model:x??void 0});S(N.generationId)},[n,b,X,l,h,w,x]),me=k.useCallback(async v=>{if(!v.trim()||R)return;C(null);const $=b.map(N=>({role:N.role,content:N.content})),z={id:Dt(),role:"user",content:v.trim(),timestamp:Date.now()};f(N=>[...N,z]),g(!0),j(!0),I(""),U.current="";try{s==="ollama"?await q(v.trim(),$):s==="openrouter"?await re(v.trim(),$):await se(v.trim())}catch(N){if(N instanceof DOMException&&N.name==="AbortError")return;const A=N instanceof Error?N.message:"Unknown error";console.error(`[Brainstorm] ${s} error:`,N),C(A),t?.(A)}finally{(s==="ollama"||s==="openrouter")&&j(!1)}},[s,R,b,q,re,se,t]),he=k.useCallback(async(v,$)=>{const z=b.find(A=>A.id===v);if(!z)throw new Error("Message not found");const N=await B({sessionId:n,content:z.content,role:z.role,zone:$});return f(A=>A.map(O=>O.id===v?{...O,savedAsBlockId:N}:O)),N},[n,b,B]),Oe=k.useCallback(async v=>{if(R)return;const $=b.findIndex(W=>W.id===v);if($===-1)return;const z=b[$];let N,A=0;if(z.role==="assistant"){for(let W=$-1;W>=0;W--)if(b[W].role==="user"){N=b[W],A=W+1;break}}else N=z,A=$+1;if(!N)return;const O=b.slice(0,A-1).map(W=>({role:W.role,content:W.content}));f(W=>W.slice(0,A)),C(null),j(!0),I(""),U.current="";try{s==="ollama"?await q(N.content,O):s==="openrouter"?await re(N.content,O):await se(N.content)}catch(W){if(W instanceof DOMException&&W.name==="AbortError")return;const G=W instanceof Error?W.message:"Unknown error";C(G),t?.(G)}finally{(s==="ollama"||s==="openrouter")&&j(!1)}},[b,R,s,q,re,se,t]),ke=k.useCallback(async(v,$)=>{if(R||!$.trim())return;const z=b.findIndex(O=>O.id===v);if(z===-1)return;const N=b[z];if(N.role!=="user")return;const A=b.slice(0,z).map(O=>({role:O.role,content:O.content}));f(O=>{const W=O.slice(0,z);return W.push({...N,content:$.trim(),timestamp:Date.now()}),W}),C(null),j(!0),I(""),U.current="";try{s==="ollama"?await q($.trim(),A):s==="openrouter"?await re($.trim(),A):await se($.trim())}catch(O){if(O instanceof DOMException&&O.name==="AbortError")return;const W=O instanceof Error?O.message:"Unknown error";C(W),t?.(W)}finally{(s==="ollama"||s==="openrouter")&&j(!1)}},[b,R,s,q,re,se,t]);return{messages:b,isOpen:o,provider:s,hasUnsavedContent:m,open:T,close:te,sendMessage:me,clearConversation:ce,setProvider:a,retryMessage:Oe,editMessage:ke,isStreaming:R,streamingText:M,stopStreaming:ee,saveMessage:he,disableAgentBehavior:l,setDisableAgentBehavior:d,preventSelfTalk:h,setPreventSelfTalk:p,model:x,setModel:u,activeSkills:w,toggleSkill:J,openrouterSessionCost:D,error:K}}function Ap(){const[e,n]=k.useState({ollama:null,claude:null,openrouter:null}),t=Se(ae.features.getFlags);return k.useEffect(()=>{const r=async()=>{const o=await bl(),i=await yl();let s=null;if(t?.claudeCodeEnabled)try{const a="http://127.0.0.1:3210",l=a?a.replace(":3210",":3211"):"http://127.0.0.1:3211",d=await fetch(`${l}/api/health/claude`);d.ok?s=await d.json():s={ok:!1,error:"Claude Code not available"}}catch{s={ok:!1,error:"Failed to check Claude Code"}}else s={ok:!1,disabled:!0,error:"Disabled"};n({ollama:o,claude:s,openrouter:i})};if(t!==void 0){r();const o=setInterval(r,3e4);return()=>clearInterval(o)}},[t]),e}function Np({sessionId:e,compact:n=!1}){const t=Ap(),[r,o]=k.useState(!1),[i,s]=k.useState(""),[a,l]=k.useState(!1),d=_e(ae.blocks.create),h=Se(ae.blocks.listByZone,{sessionId:e,zone:"PERMANENT"}),p=k.useMemo(()=>h?h.filter(w=>w.type==="system_prompt").sort((w,_)=>w.position-_.position)[0]??null:null,[h]),x=p?.content??"",u=Ep({sessionId:e,onError:g=>console.error("Brainstorm error:",g)}),b=async(g,w)=>{try{await u.saveMessage(g,w)}catch(_){console.error("Failed to save message:",_)}},f=async()=>{if(i.trim()){l(!0);try{await d({sessionId:e,content:i.trim(),type:"system_prompt",zone:"PERMANENT"}),s("")}finally{l(!1)}}},m=(g,w)=>w===null?c.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-muted-foreground animate-pulse"}),g,"..."]}):w.ok?c.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-green-600",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),g]}):c.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-destructive",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-destructive"}),g]});if(n){const w=t.claude===null&&t.ollama===null&&t.openrouter===null||t.claude?.ok||t.ollama?.ok||t.openrouter?.ok;return c.jsxs(c.Fragment,{children:[c.jsx(de,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>u.open(),disabled:!w,children:u.messages.length>0?`Brainstorm (${u.messages.length})`:"Brainstorm"}),c.jsx(Do,{isOpen:u.isOpen,onClose:u.close,messages:u.messages,hasUnsavedContent:u.hasUnsavedContent,isStreaming:u.isStreaming,streamingText:u.streamingText,provider:u.provider,onProviderChange:u.setProvider,onSendMessage:_=>u.sendMessage(_),onClearConversation:u.clearConversation,onSaveMessage:b,onRetryMessage:_=>u.retryMessage(_),onEditMessage:(_,E)=>u.editMessage(_,E),error:u.error,providerHealth:t,systemPrompt:x,disableAgentBehavior:u.disableAgentBehavior,onDisableAgentBehaviorChange:u.setDisableAgentBehavior,preventSelfTalk:u.preventSelfTalk,onPreventSelfTalkChange:u.setPreventSelfTalk,onStopStreaming:u.stopStreaming,model:u.model,onModelChange:u.setModel,activeSkills:u.activeSkills,onToggleSkill:u.toggleSkill,openrouterSessionCost:u.openrouterSessionCost})]})}return c.jsxs("div",{className:"rounded-lg border border-border bg-card p-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("h2",{className:"text-xl font-semibold",children:"Brainstorm"}),c.jsxs("div",{className:"flex items-center gap-2",children:[m("Ollama",t.ollama),!t.claude?.disabled&&m("Claude",t.claude),m("OpenRouter",t.openrouter)]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs(de,{variant:"ghost",size:"sm",onClick:()=>o(!r),children:[r?"Hide":"Show"," System Prompt"]}),c.jsx(de,{onClick:()=>u.open(),disabled:!(t.claude===null&&t.ollama===null&&t.openrouter===null)&&!t.claude?.ok&&!t.ollama?.ok&&!t.openrouter?.ok,children:u.messages.length>0?`Continue (${u.messages.length} msgs)`:"Start Brainstorming"})]})]}),c.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Have a multi-turn conversation with your context. Save valuable messages as blocks."}),r&&c.jsxs("div",{className:"mt-4 p-4 rounded-md bg-muted/50 border border-border",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("label",{htmlFor:"system-prompt",className:"text-sm font-medium",children:"System Prompt (LLM Role)"}),p&&c.jsx("span",{className:"inline-flex items-center gap-1 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300 px-2 py-0.5 rounded",children:"Active Block"})]}),p?c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"p-3 rounded-md bg-background border border-input text-sm font-mono whitespace-pre-wrap",children:p.content}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Edit this block in the PERMANENT zone above."})]}):c.jsxs("div",{className:"space-y-2",children:[c.jsx("textarea",{id:"system-prompt",value:i,onChange:g=>s(g.target.value),placeholder:"Define the LLM's role and behavior. E.g., 'You are a game design expert specializing in narrative systems...'",rows:3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none font-mono"}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-xs text-muted-foreground",children:"This prompt will be sent with every brainstorm message."}),c.jsx(de,{size:"sm",onClick:f,disabled:a||!i.trim(),children:a?"Creating...":"Create System Prompt Block"})]})]})]}),u.messages.length>0&&c.jsxs("div",{className:"mt-4 p-3 rounded-md bg-muted/50 border border-border",children:[c.jsxs("div",{className:"text-xs text-muted-foreground mb-2",children:["Recent messages (",u.messages.length," total)"]}),c.jsx("div",{className:"space-y-1",children:u.messages.slice(-3).map(g=>c.jsxs("div",{className:"text-sm truncate",children:[c.jsx("span",{className:"font-medium",children:g.role==="user"?"You: ":"AI: "}),c.jsxs("span",{className:"text-muted-foreground",children:[g.content.slice(0,100),g.content.length>100?"...":""]})]},g.id))})]}),c.jsx(Do,{isOpen:u.isOpen,onClose:u.close,messages:u.messages,isStreaming:u.isStreaming,streamingText:u.streamingText,provider:u.provider,onProviderChange:u.setProvider,onSendMessage:g=>u.sendMessage(g),onClearConversation:u.clearConversation,onSaveMessage:b,onRetryMessage:g=>u.retryMessage(g),onEditMessage:(g,w)=>u.editMessage(g,w),error:u.error,providerHealth:t,systemPrompt:x,disableAgentBehavior:u.disableAgentBehavior,onDisableAgentBehaviorChange:u.setDisableAgentBehavior,onStopStreaming:u.stopStreaming,model:u.model,onModelChange:u.setModel,activeSkills:u.activeSkills,onToggleSkill:u.toggleSkill,openrouterSessionCost:u.openrouterSessionCost})]})}const Bo=e=>e>=1e3?`${(e/1e3).toFixed(1)}K`:Math.round(e).toLocaleString();function mr({zone:e,blockCount:n,tokens:t,budget:r,onCompress:o,isCompressing:i}){const s=Math.round(t/r*100),a=s>80&&s<=95,l=s>95;return c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h3",{className:"font-semibold text-foreground",children:e}),c.jsxs("span",{className:"text-xs text-muted-foreground",children:[n," ",n===1?"block":"blocks"]}),o&&n>1&&c.jsxs("button",{onClick:o,disabled:i,className:"px-1.5 py-0.5 text-[10px] rounded border border-input hover:bg-muted disabled:opacity-50 flex items-center gap-1",title:"Compress all blocks in this zone",children:[c.jsx(Rn,{className:"w-2.5 h-2.5"}),i?"...":"Compress"]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:pe("text-xs font-mono",l&&"text-destructive",a&&"text-yellow-600 dark:text-yellow-500"),children:[c.jsx(lo,{value:t,format:Bo})," / ",Bo(r)]}),c.jsx("div",{className:"w-16 h-2 bg-muted rounded-full overflow-hidden",children:c.jsx(Fe.div,{className:pe("h-full",l?"bg-destructive":a?"bg-yellow-500":"bg-primary"),animate:{width:`${Math.min(s,100)}%`},transition:ol.gentle})}),c.jsx("span",{className:pe("text-xs font-mono w-10 text-right",l&&"text-destructive",a&&"text-yellow-600 dark:text-yellow-500"),children:c.jsx(lo,{value:s,format:d=>`${Math.round(d)}%`})})]})]})}function ge({className:e,...n}){return c.jsx("div",{"data-slot":"skeleton",className:pe("bg-accent animate-pulse rounded-md",e),...n})}function wn(){return c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ge,{className:"h-4 w-16"}),c.jsx(ge,{className:"h-3 w-14"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ge,{className:"h-3 w-20 font-mono"}),c.jsx(ge,{className:"h-2 w-16 rounded-full"}),c.jsx(ge,{className:"h-3 w-10"})]})]})}const jp={PERMANENT:"Permanent",STABLE:"Stable",WORKING:"Working"};function oa({sessionId:e,collapsed:n=!1,className:t=""}){const r=Se(ae.metrics.getZoneMetrics,{sessionId:e});if(!r)return n?c.jsxs("div",{className:pe("inline-flex items-center gap-2 text-sm",t),children:[c.jsx(ge,{className:"h-4 w-20"}),c.jsx(ge,{className:"h-1.5 w-12 rounded-full"}),c.jsx(ge,{className:"h-3 w-8"})]}):c.jsxs("div",{className:pe("rounded-lg border border-border bg-card p-4",t),children:[c.jsx(ge,{className:"h-5 w-28 mb-3"}),c.jsxs("div",{className:"space-y-3",children:[[0,1,2].map(l=>c.jsx(wn,{},l)),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx(wn,{})})]})]});const o=Math.round(r.total.tokens/r.total.budget*100),i=o>95,s=o>80&&o<=95,a=l=>l>=1e3?`${(l/1e3).toFixed(1)}K`:l.toLocaleString();return n?c.jsxs("div",{className:pe("inline-flex items-center gap-2 text-sm",i&&"text-destructive",s&&"text-yellow-600 dark:text-yellow-500",t),children:[c.jsxs("span",{className:"font-mono",children:[a(r.total.tokens)," / ",a(r.total.budget)]}),c.jsx("div",{className:"w-12 h-1.5 bg-muted rounded-full overflow-hidden",children:c.jsx("div",{className:pe("h-full transition-all",i?"bg-destructive":s?"bg-yellow-500":"bg-primary"),style:{width:`${Math.min(o,100)}%`}})}),c.jsxs("span",{className:"font-mono text-xs",children:[o,"%"]})]}):c.jsxs("div",{className:pe("rounded-lg border border-border bg-card p-4",t),children:[c.jsx("h3",{className:"font-semibold mb-3 text-foreground",children:"Context Budget"}),c.jsxs("div",{className:"space-y-3",children:[Object.keys(r.zones).map(l=>c.jsx(mr,{zone:jp[l]||l,blockCount:r.zones[l].blocks,tokens:r.zones[l].tokens,budget:r.zones[l].budget},l)),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx(mr,{zone:"Total",blockCount:r.total.blocks,tokens:r.total.tokens,budget:r.total.budget})})]})]})}function Rp({sessionId:e,className:n}){const[t,r]=k.useState("plain"),[o,i]=k.useState(!1),[s,a]=k.useState(!1),l=Se(ae.context.getAssembled,{sessionId:e,format:t,includePromptPlaceholder:!0}),d=async()=>{if(l?.text)try{await navigator.clipboard.writeText(l.text),i(!0),setTimeout(()=>i(!1),2e3)}catch(p){console.error("Failed to copy:",p)}},h=p=>p>=1e3?`${(p/1e3).toFixed(1)}K`:p.toLocaleString();return c.jsxs("div",{className:pe("rounded-lg border border-border bg-card p-4",n),children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-semibold text-foreground",children:"Export Context"}),l&&c.jsxs("span",{className:"text-xs text-muted-foreground font-mono",children:[h(l.tokens)," tokens"]})]}),c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsx("label",{htmlFor:"export-format",className:"text-sm text-muted-foreground",children:"Format:"}),c.jsxs("select",{id:"export-format",value:t,onChange:p=>r(p.target.value),className:"rounded-md border border-input bg-background px-2 py-1 text-sm",children:[c.jsx("option",{value:"plain",children:"Plain Text"}),c.jsx("option",{value:"markdown",children:"Markdown"}),c.jsx("option",{value:"xml",children:"XML (Claude-style)"})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(de,{onClick:d,disabled:!l?.text,className:"flex-1",children:o?"Copied!":"Copy to Clipboard"}),c.jsx(de,{variant:"outline",onClick:()=>a(!s),disabled:!l?.text,children:s?"Hide":"Preview"})]}),s&&l?.text&&c.jsx("div",{className:"mt-3 p-3 rounded-md bg-muted/50 border border-border max-h-[300px] overflow-auto",children:c.jsx("pre",{className:"text-xs whitespace-pre-wrap font-mono text-foreground",children:l.text})})]})}const Op=`You are a compression specialist. Compress the following {contentType} content from {originalTokens} tokens to approximately {originalTokens}/{targetRatio} tokens while preserving all critical information.

CRITICAL RULES:
- Keep ALL specific names, numbers, dates, and decisions
- Maintain chronological order
- Preserve technical terms and key concepts
- Remove redundant explanations and examples
- Keep conclusions and results
- Output ONLY the compressed content (no meta-commentary)
- If the same phrase is repeated, keep only the first occurrence

CONTENT TO COMPRESS:
{content}

COMPRESSED VERSION:`;async function Tp(e,n){const t=n.targetRatio,r=n.contentType||"text",o=Mp({content:e,originalTokens:wt(e),targetRatio:t,contentType:r});switch(n.provider){case"ollama":return Ip(o,n);case"openrouter":return Pp(o,n);case"claude-code":throw new Error("Claude Code compression must be called via Convex action");default:throw new Error(`Unknown provider: ${n.provider}`)}}async function Ip(e,n){const t=[{role:"user",content:e}];let r="";const o=yi(t,{model:n.ollamaModel,temperature:.2,topP:.95});for await(const i of o)r+=i;return r.trim()}async function Pp(e,n){const t=[{role:"user",content:e}];let r="";const o=wi(t,{model:n.openrouterModel,temperature:.2,topP:.95});for await(const i of o)r+=i;return r.trim()}function Mp(e){return Op.replace(/\{(\w+)\}/g,(n,t)=>String(e[t]||""))}function wt(e){return Math.ceil(e.length/4)}function Dp(e){const n=[],t=e.match(/\b\d+(?:\.\d+)?\b/g)||[];n.push(...t);const r=e.match(/\b[A-Z][a-z]+\b/g)||[];n.push(...r.slice(0,10));const o=e.match(/\b[A-Z]{2,}\b/g)||[];return n.push(...o.slice(0,5)),n}function Fp(e,n){const t=Dp(e);if(t.length===0)return .8;const r=n.toLowerCase(),o=t.filter(i=>r.includes(i.toLowerCase())).length;return Math.min(1,o/t.length)}const zo=100,Uo=1.2;class $o{provider;providerConfig;constructor(n,t){this.provider=n||this.detectProvider(),this.providerConfig={provider:this.provider,ollamaUrl:t?.ollamaUrl||so.getUrl(),ollamaModel:t?.ollamaModel||so.getModel(),openrouterModel:t?.openrouterModel||io.getModel()}}detectProvider(){return io.isConfigured()?"openrouter":"ollama"}async compressBlock(n,t="semantic"){const r=Date.now(),o=this.validateBlock(n);if(!o.valid)return{success:!1,error:o.reason||"Block validation failed",originalTokens:n.tokens||0,compressedTokens:0,compressionRatio:1,tokensSaved:0,strategy:t};try{const i=await this.compressContent(n.content,t,n.type),s=n.tokens||wt(n.content),a=wt(i),l=s/a;if(l<Uo)return{success:!1,error:`Compression ratio ${l.toFixed(2)}x is below minimum ${Uo}x`,originalTokens:s,compressedTokens:a,compressionRatio:l,tokensSaved:0,strategy:t};const d=Fp(n.content,i);return d<.6?{success:!1,error:`Compression quality ${(d*100).toFixed(0)}% is too low`,originalTokens:s,compressedTokens:a,compressionRatio:l,tokensSaved:0,strategy:t}:{success:!0,blockId:n._id,originalTokens:s,compressedTokens:a,compressionRatio:l,tokensSaved:s-a,compressedContent:i,strategy:t,provider:this.provider,durationMs:Date.now()-r}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error",originalTokens:n.tokens||0,compressedTokens:0,compressionRatio:1,tokensSaved:0,strategy:t}}}async compressText(n,t="semantic",r="text"){const o=await this.compressContent(n,t,r),i=wt(n),s=wt(o),a=i/s;return{compressedContent:o,originalTokens:i,compressedTokens:s,compressionRatio:a}}async compressContent(n,t,r){switch(t){case"semantic":return Tp(n,{provider:this.provider,targetRatio:2,contentType:r,ollamaModel:this.providerConfig.ollamaModel,ollamaUrl:this.providerConfig.ollamaUrl,openrouterModel:this.providerConfig.openrouterModel});case"structural":throw new Error("Structural compression not yet implemented");case"statistical":throw new Error("Statistical compression not yet implemented");default:throw new Error(`Unknown strategy: ${t}`)}}validateBlock(n){const t=n.tokens||wt(n.content);return t<zo?{valid:!1,reason:`Block has only ${t} tokens (minimum: ${zo})`}:!n.content||n.content.trim().length===0?{valid:!1,reason:"Block has no content"}:{valid:!0}}getProvider(){return this.provider}getProviderConfig(){return this.providerConfig}}function Vr(e){const{sessionId:n,onSuccess:t,onError:r}=e,[o,i]=k.useState(!1),[s,a]=k.useState(null),[l,d]=k.useState(null),h=_e(ae.blocks.compress),p=_e(ae.blocks.compressAndMerge),x=zt(ae.compression.compressWithClaudeCode),u=zt(ae.compression.compressAndMergeWithClaudeCode),b=k.useCallback(async(g,w="semantic")=>{i(!0),a(null),d(null);const _=ao.getProvider();console.log("[Compression Client] Starting single block compression"),console.log(`[Compression Client] Block ID: ${g._id}, Strategy: ${w}`),console.log(`[Compression Client] Compression provider: ${_}`);try{let E;if(_==="claude-code"){console.log("[Compression Client] Using SERVER-SIDE Claude Code action");const S=await x({blockId:g._id,strategy:w});E={success:S.success,blockId:S.blockId,originalTokens:S.originalTokens,compressedTokens:S.compressedTokens,compressionRatio:S.compressionRatio,tokensSaved:S.tokensSaved,strategy:w,provider:"claude-code"}}else{if(console.log(`[Compression Client] Using CLIENT-SIDE compression service (${_})`),E=await new $o(_).compressBlock(g,w),!E.success)throw new Error(E.error||"Compression failed");await h({blockId:g._id,compressedContent:E.compressedContent,originalTokens:E.originalTokens,compressedTokens:E.compressedTokens,compressionRatio:E.compressionRatio,strategy:w})}console.log("[Compression Client] Single block compression completed successfully"),console.log(`[Compression Client] Ratio: ${E.compressionRatio.toFixed(2)}x, Saved: ${E.tokensSaved} tokens`),d(E),t?.(E)}catch(E){const S=E instanceof Error?E.message:"Unknown error";console.error("[Compression Client] Single block compression failed:",S),a(S),r?.(S)}finally{i(!1)}},[h,x,t,r]),f=k.useCallback(async(g,w)=>{if(g.length===0){const E="No blocks to merge";a(E),r?.(E);return}i(!0),a(null),d(null);const _=ao.getProvider();console.log("[Compression Client Merge] Starting multi-block compression"),console.log(`[Compression Client Merge] Block count: ${g.length}, Strategy: ${w.strategy||"semantic"}`),console.log(`[Compression Client Merge] Compression provider: ${_}`);try{const E=w.strategy||"semantic";let S,R,j,M;if(_==="claude-code"){console.log("[Compression Client Merge] Using SERVER-SIDE Claude Code action");const K=await u({blockIds:g.map(C=>C._id),strategy:E});if(!K.success)throw new Error("Compression action failed");S=K.compressedContent,R=K.originalTokens,j=K.compressedTokens,M=K.compressionRatio}else{console.log(`[Compression Client Merge] Using CLIENT-SIDE compression service (${_})`);const K=g.map((y,U)=>`${`## Block ${U+1} (${y.type})`}

${y.content}`).join(`

---

`),D=await new $o(_).compressText(K,E,"merged_blocks");S=D.compressedContent,R=D.originalTokens,j=D.compressedTokens,M=D.compressionRatio}if(M<1.2)throw new Error(`Compression ratio ${M.toFixed(2)}x is below minimum 1.2x`);const L={success:!0,newBlockId:(await p({blockIds:g.map(K=>K._id),compressedContent:S,originalTokens:R,compressedTokens:j,compressionRatio:M,strategy:E,targetZone:w.targetZone,targetType:w.targetType,targetPosition:0})).newBlockId,originalTokens:R,compressedTokens:j,compressionRatio:M,tokensSaved:R-j,strategy:E,provider:_};console.log("[Compression Client Merge] Multi-block compression completed successfully"),console.log(`[Compression Client Merge] Ratio: ${M.toFixed(2)}x, Saved: ${R-j} tokens`),d(L),t?.(L)}catch(E){const S=E instanceof Error?E.message:"Unknown error";console.error("[Compression Client Merge] Multi-block compression failed:",S),a(S),r?.(S)}finally{i(!1)}},[u,p,t,r]),m=k.useCallback(async g=>{const w="compressZone is deprecated. Use compressAndMerge with zone blocks directly.";a(w),r?.(w)},[r]);return{compressSingle:b,compressAndMerge:f,compressZone:m,isCompressing:o,error:s,result:l}}function Lp({onDelete:e,getTitle:n=()=>"Delete item?",getDescription:t=()=>"This action cannot be undone."}){const[r,o]=k.useState(null),[i,s]=k.useState(!1),a=k.useCallback(h=>{o(h)},[]),l=k.useCallback(()=>{i||o(null)},[i]),d=k.useCallback(async()=>{if(r){s(!0);try{await e(r),o(null)}catch(h){console.error("Delete failed:",h)}finally{s(!1)}}},[r,e]);return{itemToDelete:r,isDeleting:i,isOpen:r!==null,title:r?n(r):"",description:r?t(r):"",requestDelete:a,cancelDelete:l,confirmDelete:d}}const Bp={PERMANENT:{label:"Permanent",description:"Always included"},STABLE:{label:"Stable",description:"Reference material"},WORKING:{label:"Working",description:"Draft content"}};function ia({isOpen:e,onClose:n,blocks:t,onCompress:r,isCompressing:o,result:i,error:s}){const[a,l]=k.useState("WORKING"),[d,h]=k.useState("note"),p=t.reduce((f,m)=>f+(m.tokens||0),0),x=async()=>{await r(a,d)},u=()=>{o||n()},b=f=>{f.key==="Escape"&&!o&&n()};return c.jsx(Nn,{children:e&&c.jsx(Fe.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:u,onKeyDown:b,initial:be.initial,animate:be.animate,exit:be.exit,transition:be.transition,children:c.jsxs(Fe.div,{className:"bg-card border border-border rounded-lg shadow-lg max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:f=>f.stopPropagation(),initial:ye.initial,animate:ye.animate,exit:ye.exit,transition:ye.transition,children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Rn,{className:"w-5 h-5"}),c.jsx("h2",{className:"text-lg font-semibold",children:"Compress & Merge Blocks"})]}),c.jsx("button",{onClick:u,disabled:o,className:"text-muted-foreground hover:text-foreground disabled:opacity-50",children:c.jsx(jn,{className:"w-5 h-5"})})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[c.jsxs("div",{className:"rounded-lg border border-border p-3 bg-muted/50",children:[c.jsx("div",{className:"text-sm font-medium mb-2",children:"Merge Summary"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Blocks:"})," ",c.jsx("span",{className:"font-medium",children:t.length})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Total tokens:"})," ",c.jsx("span",{className:"font-medium",children:p})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Expected ratio:"})," ",c.jsx("span",{className:"font-medium",children:"~2.0x"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Target tokens:"})," ",c.jsxs("span",{className:"font-medium",children:["~",Math.ceil(p/2)]})]})]})]}),c.jsxs("div",{children:[c.jsx("div",{className:"text-sm font-medium mb-2",children:"Blocks to merge:"}),c.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:t.map((f,m)=>c.jsxs("div",{className:"rounded border border-border p-2 bg-card",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Block ",m+1]}),c.jsx("span",{className:"text-xs text-muted-foreground",children:f.type}),f.tokens&&c.jsxs("span",{className:"text-xs text-muted-foreground font-mono",children:[f.tokens,"t"]}),f.isCompressed&&c.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-blue-500/10 text-blue-600",children:"Compressed"})]}),c.jsx("p",{className:"text-xs text-foreground line-clamp-2",children:f.content})]},f._id))})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium block mb-1.5",children:"Target Zone"}),c.jsx("select",{value:a,onChange:f=>l(f.target.value),disabled:o,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm disabled:opacity-50",children:Object.entries(Bp).map(([f,m])=>c.jsxs("option",{value:f,children:[m.label," - ",m.description]},f))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium block mb-1.5",children:"Block Type"}),c.jsxs("select",{value:d,onChange:f=>h(f.target.value),disabled:o,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm disabled:opacity-50",children:[c.jsx("option",{value:"note",children:"Note"}),c.jsx("option",{value:"summary",children:"Summary"}),c.jsx("option",{value:"context",children:"Context"})]})]})]}),i&&i.success&&c.jsxs("div",{className:"rounded-lg border border-green-500/50 bg-green-500/10 p-3",children:[c.jsx("div",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2",children:" Compression successful!"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Ratio:"})," ",c.jsxs("span",{className:"font-medium",children:[i.compressionRatio.toFixed(1),"x"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Saved:"})," ",c.jsxs("span",{className:"font-medium",children:[i.tokensSaved," tokens"]})]})]})]}),s&&c.jsx("div",{className:"rounded-lg border border-destructive/50 bg-destructive/10 p-3 text-destructive text-sm",children:s})]}),c.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-border",children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"This will merge all blocks into one compressed block."}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(de,{variant:"ghost",onClick:u,disabled:o,children:i?.success?"Close":"Cancel"}),!i?.success&&c.jsx(de,{onClick:x,disabled:o||t.length===0,children:o?"Compressing...":"Compress & Merge"})]})]})]})})})}class Bt extends Error{constructor(n){super(n),this.name="SkillParseError"}}function sa(e,n){const t=e.trim();if(!t.startsWith("---"))throw new Bt("Not a valid SKILL.md: missing frontmatter (expected --- at start)");const r=t.indexOf("---",3);if(r===-1)throw new Bt("Not a valid SKILL.md: missing closing --- delimiter");const o=t.slice(3,r).trim(),i=t.slice(r+3).trim(),s={};for(const d of o.split(`
`)){const h=d.indexOf(":");if(h===-1)continue;const p=d.slice(0,h).trim().toLowerCase();let x=d.slice(h+1).trim();(x.startsWith('"')&&x.endsWith('"')||x.startsWith("'")&&x.endsWith("'"))&&(x=x.slice(1,-1)),s[p]=x}const a=s.name;if(!a)throw new Bt("Not a valid SKILL.md: missing required 'name' field in frontmatter");const l=s.description||n||"";return{content:i,metadata:{skillName:a,skillDescription:l}}}function aa(e){return typeof e>"u"||e===null}function zp(e){return typeof e=="object"&&e!==null}function Up(e){return Array.isArray(e)?e:aa(e)?[]:[e]}function $p(e,n){var t,r,o,i;if(n)for(i=Object.keys(n),t=0,r=i.length;t<r;t+=1)o=i[t],e[o]=n[o];return e}function Wp(e,n){var t="",r;for(r=0;r<n;r+=1)t+=e;return t}function Hp(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Kp=aa,Zp=zp,Gp=Up,Yp=Wp,Vp=Hp,qp=$p,we={isNothing:Kp,isObject:Zp,toArray:Gp,repeat:Yp,isNegativeZero:Vp,extend:qp};function la(e,n){var t="",r=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(t+='in "'+e.mark.name+'" '),t+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!n&&e.mark.snippet&&(t+=`

`+e.mark.snippet),r+" "+t):r}function Kt(e,n){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=n,this.message=la(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Kt.prototype=Object.create(Error.prototype);Kt.prototype.constructor=Kt;Kt.prototype.toString=function(n){return this.name+": "+la(this,n)};var je=Kt;function tr(e,n,t,r,o){var i="",s="",a=Math.floor(o/2)-1;return r-n>a&&(i=" ... ",n=r-a+i.length),t-r>a&&(s=" ...",t=r+a-s.length),{str:i+e.slice(n,t).replace(/\t/g,"")+s,pos:r-n+i.length}}function nr(e,n){return we.repeat(" ",n-e.length)+e}function Xp(e,n){if(n=Object.create(n||null),!e.buffer)return null;n.maxLength||(n.maxLength=79),typeof n.indent!="number"&&(n.indent=1),typeof n.linesBefore!="number"&&(n.linesBefore=3),typeof n.linesAfter!="number"&&(n.linesAfter=2);for(var t=/\r?\n|\r|\0/g,r=[0],o=[],i,s=-1;i=t.exec(e.buffer);)o.push(i.index),r.push(i.index+i[0].length),e.position<=i.index&&s<0&&(s=r.length-2);s<0&&(s=r.length-1);var a="",l,d,h=Math.min(e.line+n.linesAfter,o.length).toString().length,p=n.maxLength-(n.indent+h+3);for(l=1;l<=n.linesBefore&&!(s-l<0);l++)d=tr(e.buffer,r[s-l],o[s-l],e.position-(r[s]-r[s-l]),p),a=we.repeat(" ",n.indent)+nr((e.line-l+1).toString(),h)+" | "+d.str+`
`+a;for(d=tr(e.buffer,r[s],o[s],e.position,p),a+=we.repeat(" ",n.indent)+nr((e.line+1).toString(),h)+" | "+d.str+`
`,a+=we.repeat("-",n.indent+h+3+d.pos)+`^
`,l=1;l<=n.linesAfter&&!(s+l>=o.length);l++)d=tr(e.buffer,r[s+l],o[s+l],e.position-(r[s]-r[s+l]),p),a+=we.repeat(" ",n.indent)+nr((e.line+l+1).toString(),h)+" | "+d.str+`
`;return a.replace(/\n$/,"")}var Qp=Xp,Jp=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],eh=["scalar","sequence","mapping"];function th(e){var n={};return e!==null&&Object.keys(e).forEach(function(t){e[t].forEach(function(r){n[String(r)]=t})}),n}function nh(e,n){if(n=n||{},Object.keys(n).forEach(function(t){if(Jp.indexOf(t)===-1)throw new je('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')}),this.options=n,this.tag=e,this.kind=n.kind||null,this.resolve=n.resolve||function(){return!0},this.construct=n.construct||function(t){return t},this.instanceOf=n.instanceOf||null,this.predicate=n.predicate||null,this.represent=n.represent||null,this.representName=n.representName||null,this.defaultStyle=n.defaultStyle||null,this.multi=n.multi||!1,this.styleAliases=th(n.styleAliases||null),eh.indexOf(this.kind)===-1)throw new je('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var Ce=nh;function Wo(e,n){var t=[];return e[n].forEach(function(r){var o=t.length;t.forEach(function(i,s){i.tag===r.tag&&i.kind===r.kind&&i.multi===r.multi&&(o=s)}),t[o]=r}),t}function rh(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},n,t;function r(o){o.multi?(e.multi[o.kind].push(o),e.multi.fallback.push(o)):e[o.kind][o.tag]=e.fallback[o.tag]=o}for(n=0,t=arguments.length;n<t;n+=1)arguments[n].forEach(r);return e}function gr(e){return this.extend(e)}gr.prototype.extend=function(n){var t=[],r=[];if(n instanceof Ce)r.push(n);else if(Array.isArray(n))r=r.concat(n);else if(n&&(Array.isArray(n.implicit)||Array.isArray(n.explicit)))n.implicit&&(t=t.concat(n.implicit)),n.explicit&&(r=r.concat(n.explicit));else throw new je("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(i){if(!(i instanceof Ce))throw new je("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(i.loadKind&&i.loadKind!=="scalar")throw new je("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(i.multi)throw new je("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(i){if(!(i instanceof Ce))throw new je("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var o=Object.create(gr.prototype);return o.implicit=(this.implicit||[]).concat(t),o.explicit=(this.explicit||[]).concat(r),o.compiledImplicit=Wo(o,"implicit"),o.compiledExplicit=Wo(o,"explicit"),o.compiledTypeMap=rh(o.compiledImplicit,o.compiledExplicit),o};var ca=gr,ua=new Ce("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),da=new Ce("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),fa=new Ce("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),pa=new ca({explicit:[ua,da,fa]});function oh(e){if(e===null)return!0;var n=e.length;return n===1&&e==="~"||n===4&&(e==="null"||e==="Null"||e==="NULL")}function ih(){return null}function sh(e){return e===null}var ha=new Ce("tag:yaml.org,2002:null",{kind:"scalar",resolve:oh,construct:ih,predicate:sh,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function ah(e){if(e===null)return!1;var n=e.length;return n===4&&(e==="true"||e==="True"||e==="TRUE")||n===5&&(e==="false"||e==="False"||e==="FALSE")}function lh(e){return e==="true"||e==="True"||e==="TRUE"}function ch(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var ma=new Ce("tag:yaml.org,2002:bool",{kind:"scalar",resolve:ah,construct:lh,predicate:ch,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function uh(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function dh(e){return 48<=e&&e<=55}function fh(e){return 48<=e&&e<=57}function ph(e){if(e===null)return!1;var n=e.length,t=0,r=!1,o;if(!n)return!1;if(o=e[t],(o==="-"||o==="+")&&(o=e[++t]),o==="0"){if(t+1===n)return!0;if(o=e[++t],o==="b"){for(t++;t<n;t++)if(o=e[t],o!=="_"){if(o!=="0"&&o!=="1")return!1;r=!0}return r&&o!=="_"}if(o==="x"){for(t++;t<n;t++)if(o=e[t],o!=="_"){if(!uh(e.charCodeAt(t)))return!1;r=!0}return r&&o!=="_"}if(o==="o"){for(t++;t<n;t++)if(o=e[t],o!=="_"){if(!dh(e.charCodeAt(t)))return!1;r=!0}return r&&o!=="_"}}if(o==="_")return!1;for(;t<n;t++)if(o=e[t],o!=="_"){if(!fh(e.charCodeAt(t)))return!1;r=!0}return!(!r||o==="_")}function hh(e){var n=e,t=1,r;if(n.indexOf("_")!==-1&&(n=n.replace(/_/g,"")),r=n[0],(r==="-"||r==="+")&&(r==="-"&&(t=-1),n=n.slice(1),r=n[0]),n==="0")return 0;if(r==="0"){if(n[1]==="b")return t*parseInt(n.slice(2),2);if(n[1]==="x")return t*parseInt(n.slice(2),16);if(n[1]==="o")return t*parseInt(n.slice(2),8)}return t*parseInt(n,10)}function mh(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!we.isNegativeZero(e)}var ga=new Ce("tag:yaml.org,2002:int",{kind:"scalar",resolve:ph,construct:hh,predicate:mh,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),gh=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function xh(e){return!(e===null||!gh.test(e)||e[e.length-1]==="_")}function vh(e){var n,t;return n=e.replace(/_/g,"").toLowerCase(),t=n[0]==="-"?-1:1,"+-".indexOf(n[0])>=0&&(n=n.slice(1)),n===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:n===".nan"?NaN:t*parseFloat(n,10)}var bh=/^[-+]?[0-9]+e/;function yh(e,n){var t;if(isNaN(e))switch(n){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(n){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(n){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(we.isNegativeZero(e))return"-0.0";return t=e.toString(10),bh.test(t)?t.replace("e",".e"):t}function wh(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||we.isNegativeZero(e))}var xa=new Ce("tag:yaml.org,2002:float",{kind:"scalar",resolve:xh,construct:vh,predicate:wh,represent:yh,defaultStyle:"lowercase"}),va=pa.extend({implicit:[ha,ma,ga,xa]}),ba=va,ya=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),wa=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function kh(e){return e===null?!1:ya.exec(e)!==null||wa.exec(e)!==null}function _h(e){var n,t,r,o,i,s,a,l=0,d=null,h,p,x;if(n=ya.exec(e),n===null&&(n=wa.exec(e)),n===null)throw new Error("Date resolve error");if(t=+n[1],r=+n[2]-1,o=+n[3],!n[4])return new Date(Date.UTC(t,r,o));if(i=+n[4],s=+n[5],a=+n[6],n[7]){for(l=n[7].slice(0,3);l.length<3;)l+="0";l=+l}return n[9]&&(h=+n[10],p=+(n[11]||0),d=(h*60+p)*6e4,n[9]==="-"&&(d=-d)),x=new Date(Date.UTC(t,r,o,i,s,a,l)),d&&x.setTime(x.getTime()-d),x}function Ch(e){return e.toISOString()}var ka=new Ce("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:kh,construct:_h,instanceOf:Date,represent:Ch});function Sh(e){return e==="<<"||e===null}var _a=new Ce("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Sh}),qr=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Eh(e){if(e===null)return!1;var n,t,r=0,o=e.length,i=qr;for(t=0;t<o;t++)if(n=i.indexOf(e.charAt(t)),!(n>64)){if(n<0)return!1;r+=6}return r%8===0}function Ah(e){var n,t,r=e.replace(/[\r\n=]/g,""),o=r.length,i=qr,s=0,a=[];for(n=0;n<o;n++)n%4===0&&n&&(a.push(s>>16&255),a.push(s>>8&255),a.push(s&255)),s=s<<6|i.indexOf(r.charAt(n));return t=o%4*6,t===0?(a.push(s>>16&255),a.push(s>>8&255),a.push(s&255)):t===18?(a.push(s>>10&255),a.push(s>>2&255)):t===12&&a.push(s>>4&255),new Uint8Array(a)}function Nh(e){var n="",t=0,r,o,i=e.length,s=qr;for(r=0;r<i;r++)r%3===0&&r&&(n+=s[t>>18&63],n+=s[t>>12&63],n+=s[t>>6&63],n+=s[t&63]),t=(t<<8)+e[r];return o=i%3,o===0?(n+=s[t>>18&63],n+=s[t>>12&63],n+=s[t>>6&63],n+=s[t&63]):o===2?(n+=s[t>>10&63],n+=s[t>>4&63],n+=s[t<<2&63],n+=s[64]):o===1&&(n+=s[t>>2&63],n+=s[t<<4&63],n+=s[64],n+=s[64]),n}function jh(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Ca=new Ce("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Eh,construct:Ah,predicate:jh,represent:Nh}),Rh=Object.prototype.hasOwnProperty,Oh=Object.prototype.toString;function Th(e){if(e===null)return!0;var n=[],t,r,o,i,s,a=e;for(t=0,r=a.length;t<r;t+=1){if(o=a[t],s=!1,Oh.call(o)!=="[object Object]")return!1;for(i in o)if(Rh.call(o,i))if(!s)s=!0;else return!1;if(!s)return!1;if(n.indexOf(i)===-1)n.push(i);else return!1}return!0}function Ih(e){return e!==null?e:[]}var Sa=new Ce("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Th,construct:Ih}),Ph=Object.prototype.toString;function Mh(e){if(e===null)return!0;var n,t,r,o,i,s=e;for(i=new Array(s.length),n=0,t=s.length;n<t;n+=1){if(r=s[n],Ph.call(r)!=="[object Object]"||(o=Object.keys(r),o.length!==1))return!1;i[n]=[o[0],r[o[0]]]}return!0}function Dh(e){if(e===null)return[];var n,t,r,o,i,s=e;for(i=new Array(s.length),n=0,t=s.length;n<t;n+=1)r=s[n],o=Object.keys(r),i[n]=[o[0],r[o[0]]];return i}var Ea=new Ce("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Mh,construct:Dh}),Fh=Object.prototype.hasOwnProperty;function Lh(e){if(e===null)return!0;var n,t=e;for(n in t)if(Fh.call(t,n)&&t[n]!==null)return!1;return!0}function Bh(e){return e!==null?e:{}}var Aa=new Ce("tag:yaml.org,2002:set",{kind:"mapping",resolve:Lh,construct:Bh}),Xr=ba.extend({implicit:[ka,_a],explicit:[Ca,Sa,Ea,Aa]}),at=Object.prototype.hasOwnProperty,kn=1,Na=2,ja=3,_n=4,rr=1,zh=2,Ho=3,Uh=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,$h=/[\x85\u2028\u2029]/,Wh=/[,\[\]\{\}]/,Ra=/^(?:!|!!|![a-z\-]+!)$/i,Oa=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Ko(e){return Object.prototype.toString.call(e)}function Ke(e){return e===10||e===13}function dt(e){return e===9||e===32}function Te(e){return e===9||e===32||e===10||e===13}function _t(e){return e===44||e===91||e===93||e===123||e===125}function Hh(e){var n;return 48<=e&&e<=57?e-48:(n=e|32,97<=n&&n<=102?n-97+10:-1)}function Kh(e){return e===120?2:e===117?4:e===85?8:0}function Zh(e){return 48<=e&&e<=57?e-48:-1}function Zo(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"":e===95?"":e===76?"\u2028":e===80?"\u2029":""}function Gh(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function Ta(e,n,t){n==="__proto__"?Object.defineProperty(e,n,{configurable:!0,enumerable:!0,writable:!0,value:t}):e[n]=t}var Ia=new Array(256),Pa=new Array(256);for(var yt=0;yt<256;yt++)Ia[yt]=Zo(yt)?1:0,Pa[yt]=Zo(yt);function Yh(e,n){this.input=e,this.filename=n.filename||null,this.schema=n.schema||Xr,this.onWarning=n.onWarning||null,this.legacy=n.legacy||!1,this.json=n.json||!1,this.listener=n.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Ma(e,n){var t={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return t.snippet=Qp(t),new je(n,t)}function ie(e,n){throw Ma(e,n)}function Cn(e,n){e.onWarning&&e.onWarning.call(null,Ma(e,n))}var Go={YAML:function(n,t,r){var o,i,s;n.version!==null&&ie(n,"duplication of %YAML directive"),r.length!==1&&ie(n,"YAML directive accepts exactly one argument"),o=/^([0-9]+)\.([0-9]+)$/.exec(r[0]),o===null&&ie(n,"ill-formed argument of the YAML directive"),i=parseInt(o[1],10),s=parseInt(o[2],10),i!==1&&ie(n,"unacceptable YAML version of the document"),n.version=r[0],n.checkLineBreaks=s<2,s!==1&&s!==2&&Cn(n,"unsupported YAML version of the document")},TAG:function(n,t,r){var o,i;r.length!==2&&ie(n,"TAG directive accepts exactly two arguments"),o=r[0],i=r[1],Ra.test(o)||ie(n,"ill-formed tag handle (first argument) of the TAG directive"),at.call(n.tagMap,o)&&ie(n,'there is a previously declared suffix for "'+o+'" tag handle'),Oa.test(i)||ie(n,"ill-formed tag prefix (second argument) of the TAG directive");try{i=decodeURIComponent(i)}catch{ie(n,"tag prefix is malformed: "+i)}n.tagMap[o]=i}};function rt(e,n,t,r){var o,i,s,a;if(n<t){if(a=e.input.slice(n,t),r)for(o=0,i=a.length;o<i;o+=1)s=a.charCodeAt(o),s===9||32<=s&&s<=1114111||ie(e,"expected valid JSON character");else Uh.test(a)&&ie(e,"the stream contains non-printable characters");e.result+=a}}function Yo(e,n,t,r){var o,i,s,a;for(we.isObject(t)||ie(e,"cannot merge mappings; the provided source object is unacceptable"),o=Object.keys(t),s=0,a=o.length;s<a;s+=1)i=o[s],at.call(n,i)||(Ta(n,i,t[i]),r[i]=!0)}function Ct(e,n,t,r,o,i,s,a,l){var d,h;if(Array.isArray(o))for(o=Array.prototype.slice.call(o),d=0,h=o.length;d<h;d+=1)Array.isArray(o[d])&&ie(e,"nested arrays are not supported inside keys"),typeof o=="object"&&Ko(o[d])==="[object Object]"&&(o[d]="[object Object]");if(typeof o=="object"&&Ko(o)==="[object Object]"&&(o="[object Object]"),o=String(o),n===null&&(n={}),r==="tag:yaml.org,2002:merge")if(Array.isArray(i))for(d=0,h=i.length;d<h;d+=1)Yo(e,n,i[d],t);else Yo(e,n,i,t);else!e.json&&!at.call(t,o)&&at.call(n,o)&&(e.line=s||e.line,e.lineStart=a||e.lineStart,e.position=l||e.position,ie(e,"duplicated mapping key")),Ta(n,o,i),delete t[o];return n}function Qr(e){var n;n=e.input.charCodeAt(e.position),n===10?e.position++:n===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):ie(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function ve(e,n,t){for(var r=0,o=e.input.charCodeAt(e.position);o!==0;){for(;dt(o);)o===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),o=e.input.charCodeAt(++e.position);if(n&&o===35)do o=e.input.charCodeAt(++e.position);while(o!==10&&o!==13&&o!==0);if(Ke(o))for(Qr(e),o=e.input.charCodeAt(e.position),r++,e.lineIndent=0;o===32;)e.lineIndent++,o=e.input.charCodeAt(++e.position);else break}return t!==-1&&r!==0&&e.lineIndent<t&&Cn(e,"deficient indentation"),r}function Un(e){var n=e.position,t;return t=e.input.charCodeAt(n),!!((t===45||t===46)&&t===e.input.charCodeAt(n+1)&&t===e.input.charCodeAt(n+2)&&(n+=3,t=e.input.charCodeAt(n),t===0||Te(t)))}function Jr(e,n){n===1?e.result+=" ":n>1&&(e.result+=we.repeat(`
`,n-1))}function Vh(e,n,t){var r,o,i,s,a,l,d,h,p=e.kind,x=e.result,u;if(u=e.input.charCodeAt(e.position),Te(u)||_t(u)||u===35||u===38||u===42||u===33||u===124||u===62||u===39||u===34||u===37||u===64||u===96||(u===63||u===45)&&(o=e.input.charCodeAt(e.position+1),Te(o)||t&&_t(o)))return!1;for(e.kind="scalar",e.result="",i=s=e.position,a=!1;u!==0;){if(u===58){if(o=e.input.charCodeAt(e.position+1),Te(o)||t&&_t(o))break}else if(u===35){if(r=e.input.charCodeAt(e.position-1),Te(r))break}else{if(e.position===e.lineStart&&Un(e)||t&&_t(u))break;if(Ke(u))if(l=e.line,d=e.lineStart,h=e.lineIndent,ve(e,!1,-1),e.lineIndent>=n){a=!0,u=e.input.charCodeAt(e.position);continue}else{e.position=s,e.line=l,e.lineStart=d,e.lineIndent=h;break}}a&&(rt(e,i,s,!1),Jr(e,e.line-l),i=s=e.position,a=!1),dt(u)||(s=e.position+1),u=e.input.charCodeAt(++e.position)}return rt(e,i,s,!1),e.result?!0:(e.kind=p,e.result=x,!1)}function qh(e,n){var t,r,o;if(t=e.input.charCodeAt(e.position),t!==39)return!1;for(e.kind="scalar",e.result="",e.position++,r=o=e.position;(t=e.input.charCodeAt(e.position))!==0;)if(t===39)if(rt(e,r,e.position,!0),t=e.input.charCodeAt(++e.position),t===39)r=e.position,e.position++,o=e.position;else return!0;else Ke(t)?(rt(e,r,o,!0),Jr(e,ve(e,!1,n)),r=o=e.position):e.position===e.lineStart&&Un(e)?ie(e,"unexpected end of the document within a single quoted scalar"):(e.position++,o=e.position);ie(e,"unexpected end of the stream within a single quoted scalar")}function Xh(e,n){var t,r,o,i,s,a;if(a=e.input.charCodeAt(e.position),a!==34)return!1;for(e.kind="scalar",e.result="",e.position++,t=r=e.position;(a=e.input.charCodeAt(e.position))!==0;){if(a===34)return rt(e,t,e.position,!0),e.position++,!0;if(a===92){if(rt(e,t,e.position,!0),a=e.input.charCodeAt(++e.position),Ke(a))ve(e,!1,n);else if(a<256&&Ia[a])e.result+=Pa[a],e.position++;else if((s=Kh(a))>0){for(o=s,i=0;o>0;o--)a=e.input.charCodeAt(++e.position),(s=Hh(a))>=0?i=(i<<4)+s:ie(e,"expected hexadecimal character");e.result+=Gh(i),e.position++}else ie(e,"unknown escape sequence");t=r=e.position}else Ke(a)?(rt(e,t,r,!0),Jr(e,ve(e,!1,n)),t=r=e.position):e.position===e.lineStart&&Un(e)?ie(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}ie(e,"unexpected end of the stream within a double quoted scalar")}function Qh(e,n){var t=!0,r,o,i,s=e.tag,a,l=e.anchor,d,h,p,x,u,b=Object.create(null),f,m,g,w;if(w=e.input.charCodeAt(e.position),w===91)h=93,u=!1,a=[];else if(w===123)h=125,u=!0,a={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=a),w=e.input.charCodeAt(++e.position);w!==0;){if(ve(e,!0,n),w=e.input.charCodeAt(e.position),w===h)return e.position++,e.tag=s,e.anchor=l,e.kind=u?"mapping":"sequence",e.result=a,!0;t?w===44&&ie(e,"expected the node content, but found ','"):ie(e,"missed comma between flow collection entries"),m=f=g=null,p=x=!1,w===63&&(d=e.input.charCodeAt(e.position+1),Te(d)&&(p=x=!0,e.position++,ve(e,!0,n))),r=e.line,o=e.lineStart,i=e.position,jt(e,n,kn,!1,!0),m=e.tag,f=e.result,ve(e,!0,n),w=e.input.charCodeAt(e.position),(x||e.line===r)&&w===58&&(p=!0,w=e.input.charCodeAt(++e.position),ve(e,!0,n),jt(e,n,kn,!1,!0),g=e.result),u?Ct(e,a,b,m,f,g,r,o,i):p?a.push(Ct(e,null,b,m,f,g,r,o,i)):a.push(f),ve(e,!0,n),w=e.input.charCodeAt(e.position),w===44?(t=!0,w=e.input.charCodeAt(++e.position)):t=!1}ie(e,"unexpected end of the stream within a flow collection")}function Jh(e,n){var t,r,o=rr,i=!1,s=!1,a=n,l=0,d=!1,h,p;if(p=e.input.charCodeAt(e.position),p===124)r=!1;else if(p===62)r=!0;else return!1;for(e.kind="scalar",e.result="";p!==0;)if(p=e.input.charCodeAt(++e.position),p===43||p===45)rr===o?o=p===43?Ho:zh:ie(e,"repeat of a chomping mode identifier");else if((h=Zh(p))>=0)h===0?ie(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):s?ie(e,"repeat of an indentation width identifier"):(a=n+h-1,s=!0);else break;if(dt(p)){do p=e.input.charCodeAt(++e.position);while(dt(p));if(p===35)do p=e.input.charCodeAt(++e.position);while(!Ke(p)&&p!==0)}for(;p!==0;){for(Qr(e),e.lineIndent=0,p=e.input.charCodeAt(e.position);(!s||e.lineIndent<a)&&p===32;)e.lineIndent++,p=e.input.charCodeAt(++e.position);if(!s&&e.lineIndent>a&&(a=e.lineIndent),Ke(p)){l++;continue}if(e.lineIndent<a){o===Ho?e.result+=we.repeat(`
`,i?1+l:l):o===rr&&i&&(e.result+=`
`);break}for(r?dt(p)?(d=!0,e.result+=we.repeat(`
`,i?1+l:l)):d?(d=!1,e.result+=we.repeat(`
`,l+1)):l===0?i&&(e.result+=" "):e.result+=we.repeat(`
`,l):e.result+=we.repeat(`
`,i?1+l:l),i=!0,s=!0,l=0,t=e.position;!Ke(p)&&p!==0;)p=e.input.charCodeAt(++e.position);rt(e,t,e.position,!1)}return!0}function Vo(e,n){var t,r=e.tag,o=e.anchor,i=[],s,a=!1,l;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=i),l=e.input.charCodeAt(e.position);l!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,ie(e,"tab characters must not be used in indentation")),!(l!==45||(s=e.input.charCodeAt(e.position+1),!Te(s))));){if(a=!0,e.position++,ve(e,!0,-1)&&e.lineIndent<=n){i.push(null),l=e.input.charCodeAt(e.position);continue}if(t=e.line,jt(e,n,ja,!1,!0),i.push(e.result),ve(e,!0,-1),l=e.input.charCodeAt(e.position),(e.line===t||e.lineIndent>n)&&l!==0)ie(e,"bad indentation of a sequence entry");else if(e.lineIndent<n)break}return a?(e.tag=r,e.anchor=o,e.kind="sequence",e.result=i,!0):!1}function em(e,n,t){var r,o,i,s,a,l,d=e.tag,h=e.anchor,p={},x=Object.create(null),u=null,b=null,f=null,m=!1,g=!1,w;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=p),w=e.input.charCodeAt(e.position);w!==0;){if(!m&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,ie(e,"tab characters must not be used in indentation")),r=e.input.charCodeAt(e.position+1),i=e.line,(w===63||w===58)&&Te(r))w===63?(m&&(Ct(e,p,x,u,b,null,s,a,l),u=b=f=null),g=!0,m=!0,o=!0):m?(m=!1,o=!0):ie(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,w=r;else{if(s=e.line,a=e.lineStart,l=e.position,!jt(e,t,Na,!1,!0))break;if(e.line===i){for(w=e.input.charCodeAt(e.position);dt(w);)w=e.input.charCodeAt(++e.position);if(w===58)w=e.input.charCodeAt(++e.position),Te(w)||ie(e,"a whitespace character is expected after the key-value separator within a block mapping"),m&&(Ct(e,p,x,u,b,null,s,a,l),u=b=f=null),g=!0,m=!1,o=!1,u=e.tag,b=e.result;else if(g)ie(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=d,e.anchor=h,!0}else if(g)ie(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=d,e.anchor=h,!0}if((e.line===i||e.lineIndent>n)&&(m&&(s=e.line,a=e.lineStart,l=e.position),jt(e,n,_n,!0,o)&&(m?b=e.result:f=e.result),m||(Ct(e,p,x,u,b,f,s,a,l),u=b=f=null),ve(e,!0,-1),w=e.input.charCodeAt(e.position)),(e.line===i||e.lineIndent>n)&&w!==0)ie(e,"bad indentation of a mapping entry");else if(e.lineIndent<n)break}return m&&Ct(e,p,x,u,b,null,s,a,l),g&&(e.tag=d,e.anchor=h,e.kind="mapping",e.result=p),g}function tm(e){var n,t=!1,r=!1,o,i,s;if(s=e.input.charCodeAt(e.position),s!==33)return!1;if(e.tag!==null&&ie(e,"duplication of a tag property"),s=e.input.charCodeAt(++e.position),s===60?(t=!0,s=e.input.charCodeAt(++e.position)):s===33?(r=!0,o="!!",s=e.input.charCodeAt(++e.position)):o="!",n=e.position,t){do s=e.input.charCodeAt(++e.position);while(s!==0&&s!==62);e.position<e.length?(i=e.input.slice(n,e.position),s=e.input.charCodeAt(++e.position)):ie(e,"unexpected end of the stream within a verbatim tag")}else{for(;s!==0&&!Te(s);)s===33&&(r?ie(e,"tag suffix cannot contain exclamation marks"):(o=e.input.slice(n-1,e.position+1),Ra.test(o)||ie(e,"named tag handle cannot contain such characters"),r=!0,n=e.position+1)),s=e.input.charCodeAt(++e.position);i=e.input.slice(n,e.position),Wh.test(i)&&ie(e,"tag suffix cannot contain flow indicator characters")}i&&!Oa.test(i)&&ie(e,"tag name cannot contain such characters: "+i);try{i=decodeURIComponent(i)}catch{ie(e,"tag name is malformed: "+i)}return t?e.tag=i:at.call(e.tagMap,o)?e.tag=e.tagMap[o]+i:o==="!"?e.tag="!"+i:o==="!!"?e.tag="tag:yaml.org,2002:"+i:ie(e,'undeclared tag handle "'+o+'"'),!0}function nm(e){var n,t;if(t=e.input.charCodeAt(e.position),t!==38)return!1;for(e.anchor!==null&&ie(e,"duplication of an anchor property"),t=e.input.charCodeAt(++e.position),n=e.position;t!==0&&!Te(t)&&!_t(t);)t=e.input.charCodeAt(++e.position);return e.position===n&&ie(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(n,e.position),!0}function rm(e){var n,t,r;if(r=e.input.charCodeAt(e.position),r!==42)return!1;for(r=e.input.charCodeAt(++e.position),n=e.position;r!==0&&!Te(r)&&!_t(r);)r=e.input.charCodeAt(++e.position);return e.position===n&&ie(e,"name of an alias node must contain at least one character"),t=e.input.slice(n,e.position),at.call(e.anchorMap,t)||ie(e,'unidentified alias "'+t+'"'),e.result=e.anchorMap[t],ve(e,!0,-1),!0}function jt(e,n,t,r,o){var i,s,a,l=1,d=!1,h=!1,p,x,u,b,f,m;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,i=s=a=_n===t||ja===t,r&&ve(e,!0,-1)&&(d=!0,e.lineIndent>n?l=1:e.lineIndent===n?l=0:e.lineIndent<n&&(l=-1)),l===1)for(;tm(e)||nm(e);)ve(e,!0,-1)?(d=!0,a=i,e.lineIndent>n?l=1:e.lineIndent===n?l=0:e.lineIndent<n&&(l=-1)):a=!1;if(a&&(a=d||o),(l===1||_n===t)&&(kn===t||Na===t?f=n:f=n+1,m=e.position-e.lineStart,l===1?a&&(Vo(e,m)||em(e,m,f))||Qh(e,f)?h=!0:(s&&Jh(e,f)||qh(e,f)||Xh(e,f)?h=!0:rm(e)?(h=!0,(e.tag!==null||e.anchor!==null)&&ie(e,"alias node should not have any properties")):Vh(e,f,kn===t)&&(h=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):l===0&&(h=a&&Vo(e,m))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&ie(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),p=0,x=e.implicitTypes.length;p<x;p+=1)if(b=e.implicitTypes[p],b.resolve(e.result)){e.result=b.construct(e.result),e.tag=b.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(at.call(e.typeMap[e.kind||"fallback"],e.tag))b=e.typeMap[e.kind||"fallback"][e.tag];else for(b=null,u=e.typeMap.multi[e.kind||"fallback"],p=0,x=u.length;p<x;p+=1)if(e.tag.slice(0,u[p].tag.length)===u[p].tag){b=u[p];break}b||ie(e,"unknown tag !<"+e.tag+">"),e.result!==null&&b.kind!==e.kind&&ie(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+b.kind+'", not "'+e.kind+'"'),b.resolve(e.result,e.tag)?(e.result=b.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):ie(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||h}function om(e){var n=e.position,t,r,o,i=!1,s;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(s=e.input.charCodeAt(e.position))!==0&&(ve(e,!0,-1),s=e.input.charCodeAt(e.position),!(e.lineIndent>0||s!==37));){for(i=!0,s=e.input.charCodeAt(++e.position),t=e.position;s!==0&&!Te(s);)s=e.input.charCodeAt(++e.position);for(r=e.input.slice(t,e.position),o=[],r.length<1&&ie(e,"directive name must not be less than one character in length");s!==0;){for(;dt(s);)s=e.input.charCodeAt(++e.position);if(s===35){do s=e.input.charCodeAt(++e.position);while(s!==0&&!Ke(s));break}if(Ke(s))break;for(t=e.position;s!==0&&!Te(s);)s=e.input.charCodeAt(++e.position);o.push(e.input.slice(t,e.position))}s!==0&&Qr(e),at.call(Go,r)?Go[r](e,r,o):Cn(e,'unknown document directive "'+r+'"')}if(ve(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,ve(e,!0,-1)):i&&ie(e,"directives end mark is expected"),jt(e,e.lineIndent-1,_n,!1,!0),ve(e,!0,-1),e.checkLineBreaks&&$h.test(e.input.slice(n,e.position))&&Cn(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&Un(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,ve(e,!0,-1));return}if(e.position<e.length-1)ie(e,"end of the stream or a document separator is expected");else return}function Da(e,n){e=String(e),n=n||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var t=new Yh(e,n),r=e.indexOf("\0");for(r!==-1&&(t.position=r,ie(t,"null byte is not allowed in input")),t.input+="\0";t.input.charCodeAt(t.position)===32;)t.lineIndent+=1,t.position+=1;for(;t.position<t.length-1;)om(t);return t.documents}function im(e,n,t){n!==null&&typeof n=="object"&&typeof t>"u"&&(t=n,n=null);var r=Da(e,t);if(typeof n!="function")return r;for(var o=0,i=r.length;o<i;o+=1)n(r[o])}function sm(e,n){var t=Da(e,n);if(t.length!==0){if(t.length===1)return t[0];throw new je("expected a single document in the stream, but found more")}}var am=im,lm=sm,Fa={loadAll:am,load:lm},La=Object.prototype.toString,Ba=Object.prototype.hasOwnProperty,eo=65279,cm=9,Zt=10,um=13,dm=32,fm=33,pm=34,xr=35,hm=37,mm=38,gm=39,xm=42,za=44,vm=45,Sn=58,bm=61,ym=62,wm=63,km=64,Ua=91,$a=93,_m=96,Wa=123,Cm=124,Ha=125,Ne={};Ne[0]="\\0";Ne[7]="\\a";Ne[8]="\\b";Ne[9]="\\t";Ne[10]="\\n";Ne[11]="\\v";Ne[12]="\\f";Ne[13]="\\r";Ne[27]="\\e";Ne[34]='\\"';Ne[92]="\\\\";Ne[133]="\\N";Ne[160]="\\_";Ne[8232]="\\L";Ne[8233]="\\P";var Sm=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Em=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Am(e,n){var t,r,o,i,s,a,l;if(n===null)return{};for(t={},r=Object.keys(n),o=0,i=r.length;o<i;o+=1)s=r[o],a=String(n[s]),s.slice(0,2)==="!!"&&(s="tag:yaml.org,2002:"+s.slice(2)),l=e.compiledTypeMap.fallback[s],l&&Ba.call(l.styleAliases,a)&&(a=l.styleAliases[a]),t[s]=a;return t}function Nm(e){var n,t,r;if(n=e.toString(16).toUpperCase(),e<=255)t="x",r=2;else if(e<=65535)t="u",r=4;else if(e<=4294967295)t="U",r=8;else throw new je("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+t+we.repeat("0",r-n.length)+n}var jm=1,Gt=2;function Rm(e){this.schema=e.schema||Xr,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=we.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Am(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?Gt:jm,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function qo(e,n){for(var t=we.repeat(" ",n),r=0,o=-1,i="",s,a=e.length;r<a;)o=e.indexOf(`
`,r),o===-1?(s=e.slice(r),r=a):(s=e.slice(r,o+1),r=o+1),s.length&&s!==`
`&&(i+=t),i+=s;return i}function vr(e,n){return`
`+we.repeat(" ",e.indent*n)}function Om(e,n){var t,r,o;for(t=0,r=e.implicitTypes.length;t<r;t+=1)if(o=e.implicitTypes[t],o.resolve(n))return!0;return!1}function En(e){return e===dm||e===cm}function Yt(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==eo||65536<=e&&e<=1114111}function Xo(e){return Yt(e)&&e!==eo&&e!==um&&e!==Zt}function Qo(e,n,t){var r=Xo(e),o=r&&!En(e);return(t?r:r&&e!==za&&e!==Ua&&e!==$a&&e!==Wa&&e!==Ha)&&e!==xr&&!(n===Sn&&!o)||Xo(n)&&!En(n)&&e===xr||n===Sn&&o}function Tm(e){return Yt(e)&&e!==eo&&!En(e)&&e!==vm&&e!==wm&&e!==Sn&&e!==za&&e!==Ua&&e!==$a&&e!==Wa&&e!==Ha&&e!==xr&&e!==mm&&e!==xm&&e!==fm&&e!==Cm&&e!==bm&&e!==ym&&e!==gm&&e!==pm&&e!==hm&&e!==km&&e!==_m}function Im(e){return!En(e)&&e!==Sn}function Lt(e,n){var t=e.charCodeAt(n),r;return t>=55296&&t<=56319&&n+1<e.length&&(r=e.charCodeAt(n+1),r>=56320&&r<=57343)?(t-55296)*1024+r-56320+65536:t}function Ka(e){var n=/^\n* /;return n.test(e)}var Za=1,br=2,Ga=3,Ya=4,kt=5;function Pm(e,n,t,r,o,i,s,a){var l,d=0,h=null,p=!1,x=!1,u=r!==-1,b=-1,f=Tm(Lt(e,0))&&Im(Lt(e,e.length-1));if(n||s)for(l=0;l<e.length;d>=65536?l+=2:l++){if(d=Lt(e,l),!Yt(d))return kt;f=f&&Qo(d,h,a),h=d}else{for(l=0;l<e.length;d>=65536?l+=2:l++){if(d=Lt(e,l),d===Zt)p=!0,u&&(x=x||l-b-1>r&&e[b+1]!==" ",b=l);else if(!Yt(d))return kt;f=f&&Qo(d,h,a),h=d}x=x||u&&l-b-1>r&&e[b+1]!==" "}return!p&&!x?f&&!s&&!o(e)?Za:i===Gt?kt:br:t>9&&Ka(e)?kt:s?i===Gt?kt:br:x?Ya:Ga}function Mm(e,n,t,r,o){e.dump=(function(){if(n.length===0)return e.quotingType===Gt?'""':"''";if(!e.noCompatMode&&(Sm.indexOf(n)!==-1||Em.test(n)))return e.quotingType===Gt?'"'+n+'"':"'"+n+"'";var i=e.indent*Math.max(1,t),s=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-i),a=r||e.flowLevel>-1&&t>=e.flowLevel;function l(d){return Om(e,d)}switch(Pm(n,a,e.indent,s,l,e.quotingType,e.forceQuotes&&!r,o)){case Za:return n;case br:return"'"+n.replace(/'/g,"''")+"'";case Ga:return"|"+Jo(n,e.indent)+ei(qo(n,i));case Ya:return">"+Jo(n,e.indent)+ei(qo(Dm(n,s),i));case kt:return'"'+Fm(n)+'"';default:throw new je("impossible error: invalid scalar style")}})()}function Jo(e,n){var t=Ka(e)?String(n):"",r=e[e.length-1]===`
`,o=r&&(e[e.length-2]===`
`||e===`
`),i=o?"+":r?"":"-";return t+i+`
`}function ei(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Dm(e,n){for(var t=/(\n+)([^\n]*)/g,r=(function(){var d=e.indexOf(`
`);return d=d!==-1?d:e.length,t.lastIndex=d,ti(e.slice(0,d),n)})(),o=e[0]===`
`||e[0]===" ",i,s;s=t.exec(e);){var a=s[1],l=s[2];i=l[0]===" ",r+=a+(!o&&!i&&l!==""?`
`:"")+ti(l,n),o=i}return r}function ti(e,n){if(e===""||e[0]===" ")return e;for(var t=/ [^ ]/g,r,o=0,i,s=0,a=0,l="";r=t.exec(e);)a=r.index,a-o>n&&(i=s>o?s:a,l+=`
`+e.slice(o,i),o=i+1),s=a;return l+=`
`,e.length-o>n&&s>o?l+=e.slice(o,s)+`
`+e.slice(s+1):l+=e.slice(o),l.slice(1)}function Fm(e){for(var n="",t=0,r,o=0;o<e.length;t>=65536?o+=2:o++)t=Lt(e,o),r=Ne[t],!r&&Yt(t)?(n+=e[o],t>=65536&&(n+=e[o+1])):n+=r||Nm(t);return n}function Lm(e,n,t){var r="",o=e.tag,i,s,a;for(i=0,s=t.length;i<s;i+=1)a=t[i],e.replacer&&(a=e.replacer.call(t,String(i),a)),(Je(e,n,a,!1,!1)||typeof a>"u"&&Je(e,n,null,!1,!1))&&(r!==""&&(r+=","+(e.condenseFlow?"":" ")),r+=e.dump);e.tag=o,e.dump="["+r+"]"}function ni(e,n,t,r){var o="",i=e.tag,s,a,l;for(s=0,a=t.length;s<a;s+=1)l=t[s],e.replacer&&(l=e.replacer.call(t,String(s),l)),(Je(e,n+1,l,!0,!0,!1,!0)||typeof l>"u"&&Je(e,n+1,null,!0,!0,!1,!0))&&((!r||o!=="")&&(o+=vr(e,n)),e.dump&&Zt===e.dump.charCodeAt(0)?o+="-":o+="- ",o+=e.dump);e.tag=i,e.dump=o||"[]"}function Bm(e,n,t){var r="",o=e.tag,i=Object.keys(t),s,a,l,d,h;for(s=0,a=i.length;s<a;s+=1)h="",r!==""&&(h+=", "),e.condenseFlow&&(h+='"'),l=i[s],d=t[l],e.replacer&&(d=e.replacer.call(t,l,d)),Je(e,n,l,!1,!1)&&(e.dump.length>1024&&(h+="? "),h+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Je(e,n,d,!1,!1)&&(h+=e.dump,r+=h));e.tag=o,e.dump="{"+r+"}"}function zm(e,n,t,r){var o="",i=e.tag,s=Object.keys(t),a,l,d,h,p,x;if(e.sortKeys===!0)s.sort();else if(typeof e.sortKeys=="function")s.sort(e.sortKeys);else if(e.sortKeys)throw new je("sortKeys must be a boolean or a function");for(a=0,l=s.length;a<l;a+=1)x="",(!r||o!=="")&&(x+=vr(e,n)),d=s[a],h=t[d],e.replacer&&(h=e.replacer.call(t,d,h)),Je(e,n+1,d,!0,!0,!0)&&(p=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,p&&(e.dump&&Zt===e.dump.charCodeAt(0)?x+="?":x+="? "),x+=e.dump,p&&(x+=vr(e,n)),Je(e,n+1,h,!0,p)&&(e.dump&&Zt===e.dump.charCodeAt(0)?x+=":":x+=": ",x+=e.dump,o+=x));e.tag=i,e.dump=o||"{}"}function ri(e,n,t){var r,o,i,s,a,l;for(o=t?e.explicitTypes:e.implicitTypes,i=0,s=o.length;i<s;i+=1)if(a=o[i],(a.instanceOf||a.predicate)&&(!a.instanceOf||typeof n=="object"&&n instanceof a.instanceOf)&&(!a.predicate||a.predicate(n))){if(t?a.multi&&a.representName?e.tag=a.representName(n):e.tag=a.tag:e.tag="?",a.represent){if(l=e.styleMap[a.tag]||a.defaultStyle,La.call(a.represent)==="[object Function]")r=a.represent(n,l);else if(Ba.call(a.represent,l))r=a.represent[l](n,l);else throw new je("!<"+a.tag+'> tag resolver accepts not "'+l+'" style');e.dump=r}return!0}return!1}function Je(e,n,t,r,o,i,s){e.tag=null,e.dump=t,ri(e,t,!1)||ri(e,t,!0);var a=La.call(e.dump),l=r,d;r&&(r=e.flowLevel<0||e.flowLevel>n);var h=a==="[object Object]"||a==="[object Array]",p,x;if(h&&(p=e.duplicates.indexOf(t),x=p!==-1),(e.tag!==null&&e.tag!=="?"||x||e.indent!==2&&n>0)&&(o=!1),x&&e.usedDuplicates[p])e.dump="*ref_"+p;else{if(h&&x&&!e.usedDuplicates[p]&&(e.usedDuplicates[p]=!0),a==="[object Object]")r&&Object.keys(e.dump).length!==0?(zm(e,n,e.dump,o),x&&(e.dump="&ref_"+p+e.dump)):(Bm(e,n,e.dump),x&&(e.dump="&ref_"+p+" "+e.dump));else if(a==="[object Array]")r&&e.dump.length!==0?(e.noArrayIndent&&!s&&n>0?ni(e,n-1,e.dump,o):ni(e,n,e.dump,o),x&&(e.dump="&ref_"+p+e.dump)):(Lm(e,n,e.dump),x&&(e.dump="&ref_"+p+" "+e.dump));else if(a==="[object String]")e.tag!=="?"&&Mm(e,e.dump,n,i,l);else{if(a==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new je("unacceptable kind of an object to dump "+a)}e.tag!==null&&e.tag!=="?"&&(d=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?d="!"+d:d.slice(0,18)==="tag:yaml.org,2002:"?d="!!"+d.slice(18):d="!<"+d+">",e.dump=d+" "+e.dump)}return!0}function Um(e,n){var t=[],r=[],o,i;for(yr(e,t,r),o=0,i=r.length;o<i;o+=1)n.duplicates.push(t[r[o]]);n.usedDuplicates=new Array(i)}function yr(e,n,t){var r,o,i;if(e!==null&&typeof e=="object")if(o=n.indexOf(e),o!==-1)t.indexOf(o)===-1&&t.push(o);else if(n.push(e),Array.isArray(e))for(o=0,i=e.length;o<i;o+=1)yr(e[o],n,t);else for(r=Object.keys(e),o=0,i=r.length;o<i;o+=1)yr(e[r[o]],n,t)}function $m(e,n){n=n||{};var t=new Rm(n);t.noRefs||Um(e,t);var r=e;return t.replacer&&(r=t.replacer.call({"":r},"",r)),Je(t,0,r,!0,!0)?t.dump+`
`:""}var Wm=$m,Hm={dump:Wm};function to(e,n){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+n+" instead, which is now safe by default.")}}var Km=Ce,Zm=ca,Gm=pa,Ym=va,Vm=ba,qm=Xr,Xm=Fa.load,Qm=Fa.loadAll,Va=Hm.dump,Jm=je,eg={binary:Ca,float:xa,map:fa,null:ha,pairs:Ea,set:Aa,timestamp:ka,bool:ma,int:ga,merge:_a,omap:Sa,seq:da,str:ua},tg=to("safeLoad","load"),ng=to("safeLoadAll","loadAll"),rg=to("safeDump","dump"),og={Type:Km,Schema:Zm,FAILSAFE_SCHEMA:Gm,JSON_SCHEMA:Ym,CORE_SCHEMA:Vm,DEFAULT_SCHEMA:qm,load:Xm,loadAll:Qm,dump:Va,YAMLException:Jm,types:eg,safeLoad:tg,safeLoadAll:ng,safeDump:rg};class Ve extends Error{constructor(n){super(n),this.name="ContextMapParseError"}}function $e(e){return e?Array.isArray(e)?e.filter(n=>typeof n=="string"):[]:[]}function ig(e,n){let t;try{t=og.load(e)}catch(a){throw new Ve(`Invalid YAML: ${a instanceof Error?a.message:"parse error"}`)}if(!t||typeof t!="object"||!t.contexts)throw new Ve("Missing 'contexts' key in context-map.yaml");if(typeof t.contexts!="object"||Array.isArray(t.contexts))throw new Ve("'contexts' must be an object mapping keys to context definitions");const r=Object.keys(t.contexts);if(r.length===0)throw new Ve("context-map.yaml must define at least one context");const o=new Map,i=[];for(const a of r){const l=t.contexts[a];if(!l||typeof l!="object")throw new Ve(`Context '${a}' must be an object`);if(!l.label||typeof l.label!="string")throw new Ve(`Context '${a}' is missing required 'label' field`);const d=$e(l.depends_on);for(const p of d)if(!t.contexts[p])throw new Ve(`Context '${a}' depends on unknown context '${p}'`);const h=[...$e(l.permanent),...$e(l.stable),...$e(l.working),...$e(l.optional_stable)];i.push(...h),o.set(a,l)}for(const a of i)if(!n.has(a))throw new Ve(`Referenced file not found in package: ${a}`);return{contexts:sg(o)}}function sg(e){const n=[],t=new Set,r=new Set;function o(i){if(r.has(i))return;if(t.has(i))throw new Ve(`Circular dependency detected involving context: ${i}`);t.add(i);const s=e.get(i),a=$e(s.depends_on);for(const l of a)o(l);t.delete(i),r.add(i),n.push({key:i,label:s.label,permanent:$e(s.permanent),stable:$e(s.stable),working:$e(s.working),optionalStable:$e(s.optional_stable),dependsOn:a,output:typeof s.output=="string"?s.output:void 0})}for(const i of e.keys())o(i);return n}function ag(e){const n=e.toLowerCase();return n.startsWith("references/permanent/")?"PERMANENT":n.startsWith("references/working/")?"WORKING":(n.startsWith("references/stable/"),"STABLE")}function or(e){const n=e.split("/");return n[n.length-1]}function lg(e,n){let t,r;for(const[a,l]of e)if(or(a).toLowerCase()==="skill.md"&&!a.includes("references/")){t=l,r=a;break}if(!t)throw new Error("No SKILL.md found in directory");const o=sa(t,n),i=[];for(const[a,l]of e){if(a===r)continue;const d=a.toLowerCase();d.startsWith("references/")&&d.endsWith(".md")&&i.push({filename:or(a),content:l,zone:ag(a),relativePath:a})}i.sort((a,l)=>a.relativePath.localeCompare(l.relativePath));let s;for(const[a,l]of e)if(or(a).toLowerCase()==="context-map.yaml"&&!a.includes("/")){try{s=ig(l,new Set(e.keys()))}catch{}break}return{skill:o,references:i,contextMap:s}}function cn(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ir={exports:{}};var oi;function cg(){return oi||(oi=1,(function(e,n){(function(t){e.exports=t()})(function(){return(function t(r,o,i){function s(d,h){if(!o[d]){if(!r[d]){var p=typeof cn=="function"&&cn;if(!h&&p)return p(d,!0);if(a)return a(d,!0);var x=new Error("Cannot find module '"+d+"'");throw x.code="MODULE_NOT_FOUND",x}var u=o[d]={exports:{}};r[d][0].call(u.exports,function(b){var f=r[d][1][b];return s(f||b)},u,u.exports,t,r,o,i)}return o[d].exports}for(var a=typeof cn=="function"&&cn,l=0;l<i.length;l++)s(i[l]);return s})({1:[function(t,r,o){var i=t("./utils"),s=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(l){for(var d,h,p,x,u,b,f,m=[],g=0,w=l.length,_=w,E=i.getTypeOf(l)!=="string";g<l.length;)_=w-g,p=E?(d=l[g++],h=g<w?l[g++]:0,g<w?l[g++]:0):(d=l.charCodeAt(g++),h=g<w?l.charCodeAt(g++):0,g<w?l.charCodeAt(g++):0),x=d>>2,u=(3&d)<<4|h>>4,b=1<_?(15&h)<<2|p>>6:64,f=2<_?63&p:64,m.push(a.charAt(x)+a.charAt(u)+a.charAt(b)+a.charAt(f));return m.join("")},o.decode=function(l){var d,h,p,x,u,b,f=0,m=0,g="data:";if(l.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var w,_=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&_--,l.charAt(l.length-2)===a.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=s.uint8array?new Uint8Array(0|_):new Array(0|_);f<l.length;)d=a.indexOf(l.charAt(f++))<<2|(x=a.indexOf(l.charAt(f++)))>>4,h=(15&x)<<4|(u=a.indexOf(l.charAt(f++)))>>2,p=(3&u)<<6|(b=a.indexOf(l.charAt(f++))),w[m++]=d,u!==64&&(w[m++]=h),b!==64&&(w[m++]=p);return w}},{"./support":30,"./utils":32}],2:[function(t,r,o){var i=t("./external"),s=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function d(h,p,x,u,b){this.compressedSize=h,this.uncompressedSize=p,this.crc32=x,this.compression=u,this.compressedContent=b}d.prototype={getContentWorker:function(){var h=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),p=this;return h.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(h,p,x){return h.pipe(new a).pipe(new l("uncompressedSize")).pipe(p.compressWorker(x)).pipe(new l("compressedSize")).withStreamInfo("compression",p)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,r,o){var i=t("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},o.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,r,o){var i=t("./utils"),s=(function(){for(var a,l=[],d=0;d<256;d++){a=d;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;l[d]=a}return l})();r.exports=function(a,l){return a!==void 0&&a.length?i.getTypeOf(a)!=="string"?(function(d,h,p,x){var u=s,b=x+p;d^=-1;for(var f=x;f<b;f++)d=d>>>8^u[255&(d^h[f])];return-1^d})(0|l,a,a.length,0):(function(d,h,p,x){var u=s,b=x+p;d^=-1;for(var f=x;f<b;f++)d=d>>>8^u[255&(d^h.charCodeAt(f))];return-1^d})(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(t,r,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(t,r,o){var i=null;i=typeof Promise<"u"?Promise:t("lie"),r.exports={Promise:i}},{lie:37}],7:[function(t,r,o){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=t("pako"),a=t("./utils"),l=t("./stream/GenericWorker"),d=i?"uint8array":"array";function h(p,x){l.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=x,this.meta={}}o.magic="\b\0",a.inherits(h,l),h.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(d,p.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(x){p.push({data:x,meta:p.meta})}},o.compressWorker=function(p){return new h("Deflate",p)},o.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,r,o){function i(u,b){var f,m="";for(f=0;f<b;f++)m+=String.fromCharCode(255&u),u>>>=8;return m}function s(u,b,f,m,g,w){var _,E,S=u.file,R=u.compression,j=w!==d.utf8encode,M=a.transformTo("string",w(S.name)),I=a.transformTo("string",d.utf8encode(S.name)),L=S.comment,K=a.transformTo("string",w(L)),C=a.transformTo("string",d.utf8encode(L)),D=I.length!==S.name.length,y=C.length!==L.length,U="",V="",H="",X=S.dir,B=S.date,Z={crc32:0,compressedSize:0,uncompressedSize:0};b&&!f||(Z.crc32=u.crc32,Z.compressedSize=u.compressedSize,Z.uncompressedSize=u.uncompressedSize);var P=0;b&&(P|=8),j||!D&&!y||(P|=2048);var T=0,te=0;X&&(T|=16),g==="UNIX"?(te=798,T|=(function(J,ce){var q=J;return J||(q=ce?16893:33204),(65535&q)<<16})(S.unixPermissions,X)):(te=20,T|=(function(J){return 63&(J||0)})(S.dosPermissions)),_=B.getUTCHours(),_<<=6,_|=B.getUTCMinutes(),_<<=5,_|=B.getUTCSeconds()/2,E=B.getUTCFullYear()-1980,E<<=4,E|=B.getUTCMonth()+1,E<<=5,E|=B.getUTCDate(),D&&(V=i(1,1)+i(h(M),4)+I,U+="up"+i(V.length,2)+V),y&&(H=i(1,1)+i(h(K),4)+C,U+="uc"+i(H.length,2)+H);var ee="";return ee+=`
\0`,ee+=i(P,2),ee+=R.magic,ee+=i(_,2),ee+=i(E,2),ee+=i(Z.crc32,4),ee+=i(Z.compressedSize,4),ee+=i(Z.uncompressedSize,4),ee+=i(M.length,2),ee+=i(U.length,2),{fileRecord:p.LOCAL_FILE_HEADER+ee+M+U,dirRecord:p.CENTRAL_FILE_HEADER+i(te,2)+ee+i(K.length,2)+"\0\0\0\0"+i(T,4)+i(m,4)+M+U+K}}var a=t("../utils"),l=t("../stream/GenericWorker"),d=t("../utf8"),h=t("../crc32"),p=t("../signature");function x(u,b,f,m){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=f,this.encodeFileName=m,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(x,l),x.prototype.push=function(u){var b=u.meta.percent||0,f=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:f?(b+100*(f-m-1))/f:100}}))},x.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var b=this.streamFiles&&!u.file.dir;if(b){var f=s(u,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:f.fileRecord,meta:{percent:0}})}else this.accumulate=!0},x.prototype.closedSource=function(u){this.accumulate=!1;var b=this.streamFiles&&!u.file.dir,f=s(u,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(f.dirRecord),b)this.push({data:(function(m){return p.DATA_DESCRIPTOR+i(m.crc32,4)+i(m.compressedSize,4)+i(m.uncompressedSize,4)})(u),meta:{percent:100}});else for(this.push({data:f.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},x.prototype.flush=function(){for(var u=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var f=this.bytesWritten-u,m=(function(g,w,_,E,S){var R=a.transformTo("string",S(E));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(g,2)+i(g,2)+i(w,4)+i(_,4)+i(R.length,2)+R})(this.dirRecords.length,f,u,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},x.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},x.prototype.registerPrevious=function(u){this._sources.push(u);var b=this;return u.on("data",function(f){b.processChunk(f)}),u.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),u.on("error",function(f){b.error(f)}),this},x.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},x.prototype.error=function(u){var b=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var f=0;f<b.length;f++)try{b[f].error(u)}catch{}return!0},x.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,b=0;b<u.length;b++)u[b].lock()},r.exports=x},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,r,o){var i=t("../compressions"),s=t("./ZipFileWorker");o.generateWorker=function(a,l,d){var h=new s(l.streamFiles,d,l.platform,l.encodeFileName),p=0;try{a.forEach(function(x,u){p++;var b=(function(w,_){var E=w||_,S=i[E];if(!S)throw new Error(E+" is not a valid compression method !");return S})(u.options.compression,l.compression),f=u.options.compressionOptions||l.compressionOptions||{},m=u.dir,g=u.date;u._compressWorker(b,f).withStreamInfo("file",{name:x,dir:m,date:g,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(h)}),h.entriesCount=p}catch(x){h.error(x)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,r,o){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var a in this)typeof this[a]!="function"&&(s[a]=this[a]);return s}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.10.1",i.loadAsync=function(s,a){return new i().loadAsync(s,a)},i.external=t("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,r,o){var i=t("./utils"),s=t("./external"),a=t("./utf8"),l=t("./zipEntries"),d=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function p(x){return new s.Promise(function(u,b){var f=x.decompressed.getContentWorker().pipe(new d);f.on("error",function(m){b(m)}).on("end",function(){f.streamInfo.crc32!==x.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}r.exports=function(x,u){var b=this;return u=i.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(x)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",x,!0,u.optimizedBinaryString,u.base64).then(function(f){var m=new l(u);return m.load(f),m}).then(function(f){var m=[s.Promise.resolve(f)],g=f.files;if(u.checkCRC32)for(var w=0;w<g.length;w++)m.push(p(g[w]));return s.Promise.all(m)}).then(function(f){for(var m=f.shift(),g=m.files,w=0;w<g.length;w++){var _=g[w],E=_.fileNameStr,S=i.resolve(_.fileNameStr);b.file(S,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:u.createFolders}),_.dir||(b.file(S).unsafeOriginalName=E)}return m.zipComment.length&&(b.comment=m.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,r,o){var i=t("../utils"),s=t("../stream/GenericWorker");function a(l,d){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(d)}i.inherits(a,s),a.prototype._bindStream=function(l){var d=this;(this._stream=l).pause(),l.on("data",function(h){d.push({data:h,meta:{percent:0}})}).on("error",function(h){d.isPaused?this.generatedError=h:d.error(h)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},a.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,r,o){var i=t("readable-stream").Readable;function s(a,l,d){i.call(this,l),this._helper=a;var h=this;a.on("data",function(p,x){h.push(p)||h._helper.pause(),d&&d(x)}).on("error",function(p){h.emit("error",p)}).on("end",function(){h.push(null)})}t("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(t,r,o){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(t,r,o){function i(S,R,j){var M,I=a.getTypeOf(R),L=a.extend(j||{},h);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(S=g(S)),L.createFolders&&(M=m(S))&&w.call(this,M,!0);var K=I==="string"&&L.binary===!1&&L.base64===!1;j&&j.binary!==void 0||(L.binary=!K),(R instanceof p&&R.uncompressedSize===0||L.dir||!R||R.length===0)&&(L.base64=!1,L.binary=!0,R="",L.compression="STORE",I="string");var C=null;C=R instanceof p||R instanceof l?R:b.isNode&&b.isStream(R)?new f(S,R):a.prepareContent(S,R,L.binary,L.optimizedBinaryString,L.base64);var D=new x(S,C,L);this.files[S]=D}var s=t("./utf8"),a=t("./utils"),l=t("./stream/GenericWorker"),d=t("./stream/StreamHelper"),h=t("./defaults"),p=t("./compressedObject"),x=t("./zipObject"),u=t("./generate"),b=t("./nodejsUtils"),f=t("./nodejs/NodejsStreamInputAdapter"),m=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var R=S.lastIndexOf("/");return 0<R?S.substring(0,R):""},g=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},w=function(S,R){return R=R!==void 0?R:h.createFolders,S=g(S),this.files[S]||i.call(this,S,null,{dir:!0,createFolders:R}),this.files[S]};function _(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var R,j,M;for(R in this.files)M=this.files[R],(j=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&S(j,M)},filter:function(S){var R=[];return this.forEach(function(j,M){S(j,M)&&R.push(M)}),R},file:function(S,R,j){if(arguments.length!==1)return S=this.root+S,i.call(this,S,R,j),this;if(_(S)){var M=S;return this.filter(function(L,K){return!K.dir&&M.test(L)})}var I=this.files[this.root+S];return I&&!I.dir?I:null},folder:function(S){if(!S)return this;if(_(S))return this.filter(function(I,L){return L.dir&&S.test(I)});var R=this.root+S,j=w.call(this,R),M=this.clone();return M.root=j.name,M},remove:function(S){S=this.root+S;var R=this.files[S];if(R||(S.slice(-1)!=="/"&&(S+="/"),R=this.files[S]),R&&!R.dir)delete this.files[S];else for(var j=this.filter(function(I,L){return L.name.slice(0,S.length)===S}),M=0;M<j.length;M++)delete this.files[j[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var R,j={};try{if((j=a.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=j.type.toLowerCase(),j.compression=j.compression.toUpperCase(),j.type==="binarystring"&&(j.type="string"),!j.type)throw new Error("No output type specified.");a.checkSupport(j.type),j.platform!=="darwin"&&j.platform!=="freebsd"&&j.platform!=="linux"&&j.platform!=="sunos"||(j.platform="UNIX"),j.platform==="win32"&&(j.platform="DOS");var M=j.comment||this.comment||"";R=u.generateWorker(this,j,M)}catch(I){(R=new l("error")).error(I)}return new d(R,j.type||"string",j.mimeType)},generateAsync:function(S,R){return this.generateInternalStream(S).accumulate(R)},generateNodeStream:function(S,R){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(R)}};r.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,r,o){r.exports=t("stream")},{stream:void 0}],17:[function(t,r,o){var i=t("./DataReader");function s(a){i.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}t("../utils").inherits(s,i),s.prototype.byteAt=function(a){return this.data[this.zero+a]},s.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),d=a.charCodeAt(1),h=a.charCodeAt(2),p=a.charCodeAt(3),x=this.length-4;0<=x;--x)if(this.data[x]===l&&this.data[x+1]===d&&this.data[x+2]===h&&this.data[x+3]===p)return x-this.zero;return-1},s.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),d=a.charCodeAt(1),h=a.charCodeAt(2),p=a.charCodeAt(3),x=this.readData(4);return l===x[0]&&d===x[1]&&h===x[2]&&p===x[3]},s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(t,r,o){var i=t("../utils");function s(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,d=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)d=(d<<8)+this.byteAt(l);return this.index+=a,d},readString:function(a){return i.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=s},{"../utils":32}],19:[function(t,r,o){var i=t("./Uint8ArrayReader");function s(a){i.call(this,a)}t("../utils").inherits(s,i),s.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,r,o){var i=t("./DataReader");function s(a){i.call(this,a)}t("../utils").inherits(s,i),s.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},s.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},s.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},s.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(t,r,o){var i=t("./ArrayReader");function s(a){i.call(this,a)}t("../utils").inherits(s,i),s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(t,r,o){var i=t("../utils"),s=t("../support"),a=t("./ArrayReader"),l=t("./StringReader"),d=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");r.exports=function(p){var x=i.getTypeOf(p);return i.checkSupport(x),x!=="string"||s.uint8array?x==="nodebuffer"?new d(p):s.uint8array?new h(i.transformTo("uint8array",p)):new a(i.transformTo("array",p)):new l(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,r,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,r,o){var i=t("./GenericWorker"),s=t("../utils");function a(l){i.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(a,i),a.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,r,o){var i=t("./GenericWorker"),s=t("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,i),a.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,r,o){var i=t("../utils"),s=t("./GenericWorker");function a(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(a,s),a.prototype.processChunk=function(l){if(l){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+l.data.length}s.prototype.processChunk.call(this,l)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,r,o){var i=t("../utils"),s=t("./GenericWorker");function a(l){s.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){d.dataIsReady=!0,d.data=h,d.max=h&&h.length||0,d.type=i.getTypeOf(h),d.isPaused||d._tickAndRepeat()},function(h){d.error(h)})}i.inherits(a,s),a.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,d);break;case"uint8array":l=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":l=this.data.slice(this.index,d)}return this.index=d,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,r,o){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,a){return this._listeners[s].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,a){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,a)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var a=this;return s.on("data",function(l){a.processChunk(l)}),s.on("end",function(){a.end()}),s.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,a){return this.extraStreamInfo[s]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=i},{}],29:[function(t,r,o){var i=t("../utils"),s=t("./ConvertWorker"),a=t("./GenericWorker"),l=t("../base64"),d=t("../support"),h=t("../external"),p=null;if(d.nodestream)try{p=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function x(b,f){return new h.Promise(function(m,g){var w=[],_=b._internalType,E=b._outputType,S=b._mimeType;b.on("data",function(R,j){w.push(R),f&&f(j)}).on("error",function(R){w=[],g(R)}).on("end",function(){try{var R=(function(j,M,I){switch(j){case"blob":return i.newBlob(i.transformTo("arraybuffer",M),I);case"base64":return l.encode(M);default:return i.transformTo(j,M)}})(E,(function(j,M){var I,L=0,K=null,C=0;for(I=0;I<M.length;I++)C+=M[I].length;switch(j){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(K=new Uint8Array(C),I=0;I<M.length;I++)K.set(M[I],L),L+=M[I].length;return K;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+j+"'")}})(_,w),S);m(R)}catch(j){g(j)}w=[]}).resume()})}function u(b,f,m){var g=f;switch(f){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=f,this._mimeType=m,i.checkSupport(g),this._worker=b.pipe(new s(g)),b.lock()}catch(w){this._worker=new a("error"),this._worker.error(w)}}u.prototype={accumulate:function(b){return x(this,b)},on:function(b,f){var m=this;return b==="data"?this._worker.on(b,function(g){f.call(m,g.data,g.meta)}):this._worker.on(b,function(){i.delay(f,arguments,m)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},b)}},r.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,r,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var i=new ArrayBuffer(0);try{o.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),o.blob=s.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!t("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(t,r,o){for(var i=t("./utils"),s=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),d=new Array(256),h=0;h<256;h++)d[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;d[254]=d[254]=1;function p(){l.call(this,"utf-8 decode"),this.leftOver=null}function x(){l.call(this,"utf-8 encode")}o.utf8encode=function(u){return s.nodebuffer?a.newBufferFrom(u,"utf-8"):(function(b){var f,m,g,w,_,E=b.length,S=0;for(w=0;w<E;w++)(64512&(m=b.charCodeAt(w)))==55296&&w+1<E&&(64512&(g=b.charCodeAt(w+1)))==56320&&(m=65536+(m-55296<<10)+(g-56320),w++),S+=m<128?1:m<2048?2:m<65536?3:4;for(f=s.uint8array?new Uint8Array(S):new Array(S),w=_=0;_<S;w++)(64512&(m=b.charCodeAt(w)))==55296&&w+1<E&&(64512&(g=b.charCodeAt(w+1)))==56320&&(m=65536+(m-55296<<10)+(g-56320),w++),m<128?f[_++]=m:(m<2048?f[_++]=192|m>>>6:(m<65536?f[_++]=224|m>>>12:(f[_++]=240|m>>>18,f[_++]=128|m>>>12&63),f[_++]=128|m>>>6&63),f[_++]=128|63&m);return f})(u)},o.utf8decode=function(u){return s.nodebuffer?i.transformTo("nodebuffer",u).toString("utf-8"):(function(b){var f,m,g,w,_=b.length,E=new Array(2*_);for(f=m=0;f<_;)if((g=b[f++])<128)E[m++]=g;else if(4<(w=d[g]))E[m++]=65533,f+=w-1;else{for(g&=w===2?31:w===3?15:7;1<w&&f<_;)g=g<<6|63&b[f++],w--;1<w?E[m++]=65533:g<65536?E[m++]=g:(g-=65536,E[m++]=55296|g>>10&1023,E[m++]=56320|1023&g)}return E.length!==m&&(E.subarray?E=E.subarray(0,m):E.length=m),i.applyFromCharCode(E)})(u=i.transformTo(s.uint8array?"uint8array":"array",u))},i.inherits(p,l),p.prototype.processChunk=function(u){var b=i.transformTo(s.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var f=b;(b=new Uint8Array(f.length+this.leftOver.length)).set(this.leftOver,0),b.set(f,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var m=(function(w,_){var E;for((_=_||w.length)>w.length&&(_=w.length),E=_-1;0<=E&&(192&w[E])==128;)E--;return E<0||E===0?_:E+d[w[E]]>_?E:_})(b),g=b;m!==b.length&&(s.uint8array?(g=b.subarray(0,m),this.leftOver=b.subarray(m,b.length)):(g=b.slice(0,m),this.leftOver=b.slice(m,b.length))),this.push({data:o.utf8decode(g),meta:u.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=p,i.inherits(x,l),x.prototype.processChunk=function(u){this.push({data:o.utf8encode(u.data),meta:u.meta})},o.Utf8EncodeWorker=x},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,r,o){var i=t("./support"),s=t("./base64"),a=t("./nodejsUtils"),l=t("./external");function d(f){return f}function h(f,m){for(var g=0;g<f.length;++g)m[g]=255&f.charCodeAt(g);return m}t("setimmediate"),o.newBlob=function(f,m){o.checkSupport("blob");try{return new Blob([f],{type:m})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(f),g.getBlob(m)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(f,m,g){var w=[],_=0,E=f.length;if(E<=g)return String.fromCharCode.apply(null,f);for(;_<E;)m==="array"||m==="nodebuffer"?w.push(String.fromCharCode.apply(null,f.slice(_,Math.min(_+g,E)))):w.push(String.fromCharCode.apply(null,f.subarray(_,Math.min(_+g,E)))),_+=g;return w.join("")},stringifyByChar:function(f){for(var m="",g=0;g<f.length;g++)m+=String.fromCharCode(f[g]);return m},applyCanBeUsed:{uint8array:(function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function x(f){var m=65536,g=o.getTypeOf(f),w=!0;if(g==="uint8array"?w=p.applyCanBeUsed.uint8array:g==="nodebuffer"&&(w=p.applyCanBeUsed.nodebuffer),w)for(;1<m;)try{return p.stringifyByChunk(f,g,m)}catch{m=Math.floor(m/2)}return p.stringifyByChar(f)}function u(f,m){for(var g=0;g<f.length;g++)m[g]=f[g];return m}o.applyFromCharCode=x;var b={};b.string={string:d,array:function(f){return h(f,new Array(f.length))},arraybuffer:function(f){return b.string.uint8array(f).buffer},uint8array:function(f){return h(f,new Uint8Array(f.length))},nodebuffer:function(f){return h(f,a.allocBuffer(f.length))}},b.array={string:x,array:d,arraybuffer:function(f){return new Uint8Array(f).buffer},uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return a.newBufferFrom(f)}},b.arraybuffer={string:function(f){return x(new Uint8Array(f))},array:function(f){return u(new Uint8Array(f),new Array(f.byteLength))},arraybuffer:d,uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return a.newBufferFrom(new Uint8Array(f))}},b.uint8array={string:x,array:function(f){return u(f,new Array(f.length))},arraybuffer:function(f){return f.buffer},uint8array:d,nodebuffer:function(f){return a.newBufferFrom(f)}},b.nodebuffer={string:x,array:function(f){return u(f,new Array(f.length))},arraybuffer:function(f){return b.nodebuffer.uint8array(f).buffer},uint8array:function(f){return u(f,new Uint8Array(f.length))},nodebuffer:d},o.transformTo=function(f,m){if(m=m||"",!f)return m;o.checkSupport(f);var g=o.getTypeOf(m);return b[g][f](m)},o.resolve=function(f){for(var m=f.split("/"),g=[],w=0;w<m.length;w++){var _=m[w];_==="."||_===""&&w!==0&&w!==m.length-1||(_===".."?g.pop():g.push(_))}return g.join("/")},o.getTypeOf=function(f){return typeof f=="string"?"string":Object.prototype.toString.call(f)==="[object Array]"?"array":i.nodebuffer&&a.isBuffer(f)?"nodebuffer":i.uint8array&&f instanceof Uint8Array?"uint8array":i.arraybuffer&&f instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(f){if(!i[f.toLowerCase()])throw new Error(f+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(f){var m,g,w="";for(g=0;g<(f||"").length;g++)w+="\\x"+((m=f.charCodeAt(g))<16?"0":"")+m.toString(16).toUpperCase();return w},o.delay=function(f,m,g){setImmediate(function(){f.apply(g||null,m||[])})},o.inherits=function(f,m){function g(){}g.prototype=m.prototype,f.prototype=new g},o.extend=function(){var f,m,g={};for(f=0;f<arguments.length;f++)for(m in arguments[f])Object.prototype.hasOwnProperty.call(arguments[f],m)&&g[m]===void 0&&(g[m]=arguments[f][m]);return g},o.prepareContent=function(f,m,g,w,_){return l.Promise.resolve(m).then(function(E){return i.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new l.Promise(function(S,R){var j=new FileReader;j.onload=function(M){S(M.target.result)},j.onerror=function(M){R(M.target.error)},j.readAsArrayBuffer(E)}):E}).then(function(E){var S=o.getTypeOf(E);return S?(S==="arraybuffer"?E=o.transformTo("uint8array",E):S==="string"&&(_?E=s.decode(E):g&&w!==!0&&(E=(function(R){return h(R,i.uint8array?new Uint8Array(R.length):new Array(R.length))})(E))),E):l.Promise.reject(new Error("Can't read the data of '"+f+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,r,o){var i=t("./reader/readerFor"),s=t("./utils"),a=t("./signature"),l=t("./zipEntry"),d=t("./support");function h(p){this.files=[],this.loadOptions=p}h.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var x=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(x)+", expected "+s.pretty(p)+")")}},isSignature:function(p,x){var u=this.reader.index;this.reader.setIndex(p);var b=this.reader.readString(4)===x;return this.reader.setIndex(u),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),x=d.uint8array?"uint8array":"array",u=s.transformTo(x,p);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,x,u,b=this.zip64EndOfCentralSize-44;0<b;)p=this.reader.readInt(2),x=this.reader.readInt(4),u=this.reader.readData(x),this.zip64ExtensibleData[p]={id:p,length:x,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,x;for(p=0;p<this.files.length;p++)x=this.files[p],this.reader.setIndex(x.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),x.readLocalPart(this.reader),x.handleUTF8(),x.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(p=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var x=p;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var b=x-u;if(0<b)this.isSignature(x,a.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(p){this.reader=i(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,r,o){var i=t("./reader/readerFor"),s=t("./utils"),a=t("./compressedObject"),l=t("./crc32"),d=t("./utf8"),h=t("./compressions"),p=t("./support");function x(u,b){this.options=u,this.loadOptions=b}x.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var b,f;if(u.skip(22),this.fileNameLength=u.readInt(2),f=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(f),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=(function(m){for(var g in h)if(Object.prototype.hasOwnProperty.call(h,g)&&h[g].magic===m)return h[g];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,b,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var b=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(b),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var b,f,m,g=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<g;)b=u.readInt(2),f=u.readInt(2),m=u.readData(f),this.extraFields[b]={id:b,length:f,value:m};u.setIndex(g)},handleUTF8:function(){var u=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var f=s.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(f)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var g=s.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var b=i(u.value);return b.readInt(1)!==1||l(this.fileName)!==b.readInt(4)?null:d.utf8decode(b.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var b=i(u.value);return b.readInt(1)!==1||l(this.fileComment)!==b.readInt(4)?null:d.utf8decode(b.readData(u.length-5))}return null}},r.exports=x},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,r,o){function i(b,f,m){this.name=b,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=f,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var s=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),l=t("./utf8"),d=t("./compressedObject"),h=t("./stream/GenericWorker");i.prototype={internalStream:function(b){var f=null,m="string";try{if(!b)throw new Error("No output type specified.");var g=(m=b.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),f=this._decompressWorker();var w=!this._dataBinary;w&&!g&&(f=f.pipe(new l.Utf8EncodeWorker)),!w&&g&&(f=f.pipe(new l.Utf8DecodeWorker))}catch(_){(f=new h("error")).error(_)}return new s(f,m,"")},async:function(b,f){return this.internalStream(b).accumulate(f)},nodeStream:function(b,f){return this.internalStream(b||"nodebuffer").toNodejsStream(f)},_compressWorker:function(b,f){if(this._data instanceof d&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new l.Utf8EncodeWorker)),d.createWorkerFrom(m,b,f)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],x=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<p.length;u++)i.prototype[p[u]]=x;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,r,o){(function(i){var s,a,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var d=0,h=new l(b),p=i.document.createTextNode("");h.observe(p,{characterData:!0}),s=function(){p.data=d=++d%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var f=i.document.createElement("script");f.onreadystatechange=function(){b(),f.onreadystatechange=null,f.parentNode.removeChild(f),f=null},i.document.documentElement.appendChild(f)}:function(){setTimeout(b,0)};else{var x=new i.MessageChannel;x.port1.onmessage=b,s=function(){x.port2.postMessage(0)}}var u=[];function b(){var f,m;a=!0;for(var g=u.length;g;){for(m=u,u=[],f=-1;++f<g;)m[f]();g=u.length}a=!1}r.exports=function(f){u.push(f)!==1||a||s()}}).call(this,typeof nt<"u"?nt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,r,o){var i=t("immediate");function s(){}var a={},l=["REJECTED"],d=["FULFILLED"],h=["PENDING"];function p(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,g!==s&&f(this,g)}function x(g,w,_){this.promise=g,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}function u(g,w,_){i(function(){var E;try{E=w(_)}catch(S){return a.reject(g,S)}E===g?a.reject(g,new TypeError("Cannot resolve promise with itself")):a.resolve(g,E)})}function b(g){var w=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof w=="function")return function(){w.apply(g,arguments)}}function f(g,w){var _=!1;function E(j){_||(_=!0,a.reject(g,j))}function S(j){_||(_=!0,a.resolve(g,j))}var R=m(function(){w(S,E)});R.status==="error"&&E(R.value)}function m(g,w){var _={};try{_.value=g(w),_.status="success"}catch(E){_.status="error",_.value=E}return _}(r.exports=p).prototype.finally=function(g){if(typeof g!="function")return this;var w=this.constructor;return this.then(function(_){return w.resolve(g()).then(function(){return _})},function(_){return w.resolve(g()).then(function(){throw _})})},p.prototype.catch=function(g){return this.then(null,g)},p.prototype.then=function(g,w){if(typeof g!="function"&&this.state===d||typeof w!="function"&&this.state===l)return this;var _=new this.constructor(s);return this.state!==h?u(_,this.state===d?g:w,this.outcome):this.queue.push(new x(_,g,w)),_},x.prototype.callFulfilled=function(g){a.resolve(this.promise,g)},x.prototype.otherCallFulfilled=function(g){u(this.promise,this.onFulfilled,g)},x.prototype.callRejected=function(g){a.reject(this.promise,g)},x.prototype.otherCallRejected=function(g){u(this.promise,this.onRejected,g)},a.resolve=function(g,w){var _=m(b,w);if(_.status==="error")return a.reject(g,_.value);var E=_.value;if(E)f(g,E);else{g.state=d,g.outcome=w;for(var S=-1,R=g.queue.length;++S<R;)g.queue[S].callFulfilled(w)}return g},a.reject=function(g,w){g.state=l,g.outcome=w;for(var _=-1,E=g.queue.length;++_<E;)g.queue[_].callRejected(w);return g},p.resolve=function(g){return g instanceof this?g:a.resolve(new this(s),g)},p.reject=function(g){var w=new this(s);return a.reject(w,g)},p.all=function(g){var w=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=g.length,E=!1;if(!_)return this.resolve([]);for(var S=new Array(_),R=0,j=-1,M=new this(s);++j<_;)I(g[j],j);return M;function I(L,K){w.resolve(L).then(function(C){S[K]=C,++R!==_||E||(E=!0,a.resolve(M,S))},function(C){E||(E=!0,a.reject(M,C))})}},p.race=function(g){var w=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=g.length,E=!1;if(!_)return this.resolve([]);for(var S=-1,R=new this(s);++S<_;)j=g[S],w.resolve(j).then(function(M){E||(E=!0,a.resolve(R,M))},function(M){E||(E=!0,a.reject(R,M))});var j;return R}},{immediate:36}],38:[function(t,r,o){var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,r,o){var i=t("./zlib/deflate"),s=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/messages"),d=t("./zlib/zstream"),h=Object.prototype.toString,p=0,x=-1,u=0,b=8;function f(g){if(!(this instanceof f))return new f(g);this.options=s.assign({level:x,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},g||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var _=i.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(_!==p)throw new Error(l[_]);if(w.header&&i.deflateSetHeader(this.strm,w.header),w.dictionary){var E;if(E=typeof w.dictionary=="string"?a.string2buf(w.dictionary):h.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(_=i.deflateSetDictionary(this.strm,E))!==p)throw new Error(l[_]);this._dict_set=!0}}function m(g,w){var _=new f(w);if(_.push(g,!0),_.err)throw _.msg||l[_.err];return _.result}f.prototype.push=function(g,w){var _,E,S=this.strm,R=this.options.chunkSize;if(this.ended)return!1;E=w===~~w?w:w===!0?4:0,typeof g=="string"?S.input=a.string2buf(g):h.call(g)==="[object ArrayBuffer]"?S.input=new Uint8Array(g):S.input=g,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new s.Buf8(R),S.next_out=0,S.avail_out=R),(_=i.deflate(S,E))!==1&&_!==p)return this.onEnd(_),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(s.shrinkBuf(S.output,S.next_out))):this.onData(s.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&_!==1);return E===4?(_=i.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===p):E!==2||(this.onEnd(p),!(S.avail_out=0))},f.prototype.onData=function(g){this.chunks.push(g)},f.prototype.onEnd=function(g){g===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},o.Deflate=f,o.deflate=m,o.deflateRaw=function(g,w){return(w=w||{}).raw=!0,m(g,w)},o.gzip=function(g,w){return(w=w||{}).gzip=!0,m(g,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,r,o){var i=t("./zlib/inflate"),s=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/constants"),d=t("./zlib/messages"),h=t("./zlib/zstream"),p=t("./zlib/gzheader"),x=Object.prototype.toString;function u(f){if(!(this instanceof u))return new u(f);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},f||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||f&&f.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&(15&m.windowBits)==0&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var g=i.inflateInit2(this.strm,m.windowBits);if(g!==l.Z_OK)throw new Error(d[g]);this.header=new p,i.inflateGetHeader(this.strm,this.header)}function b(f,m){var g=new u(m);if(g.push(f,!0),g.err)throw g.msg||d[g.err];return g.result}u.prototype.push=function(f,m){var g,w,_,E,S,R,j=this.strm,M=this.options.chunkSize,I=this.options.dictionary,L=!1;if(this.ended)return!1;w=m===~~m?m:m===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof f=="string"?j.input=a.binstring2buf(f):x.call(f)==="[object ArrayBuffer]"?j.input=new Uint8Array(f):j.input=f,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new s.Buf8(M),j.next_out=0,j.avail_out=M),(g=i.inflate(j,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&I&&(R=typeof I=="string"?a.string2buf(I):x.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,g=i.inflateSetDictionary(this.strm,R)),g===l.Z_BUF_ERROR&&L===!0&&(g=l.Z_OK,L=!1),g!==l.Z_STREAM_END&&g!==l.Z_OK)return this.onEnd(g),!(this.ended=!0);j.next_out&&(j.avail_out!==0&&g!==l.Z_STREAM_END&&(j.avail_in!==0||w!==l.Z_FINISH&&w!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=a.utf8border(j.output,j.next_out),E=j.next_out-_,S=a.buf2string(j.output,_),j.next_out=E,j.avail_out=M-E,E&&s.arraySet(j.output,j.output,_,E,0),this.onData(S)):this.onData(s.shrinkBuf(j.output,j.next_out)))),j.avail_in===0&&j.avail_out===0&&(L=!0)}while((0<j.avail_in||j.avail_out===0)&&g!==l.Z_STREAM_END);return g===l.Z_STREAM_END&&(w=l.Z_FINISH),w===l.Z_FINISH?(g=i.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===l.Z_OK):w!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(j.avail_out=0))},u.prototype.onData=function(f){this.chunks.push(f)},u.prototype.onEnd=function(f){f===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},o.Inflate=u,o.inflate=b,o.inflateRaw=function(f,m){return(m=m||{}).raw=!0,b(f,m)},o.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,r,o){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(l){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var h=d.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var p in h)h.hasOwnProperty(p)&&(l[p]=h[p])}}return l},o.shrinkBuf=function(l,d){return l.length===d?l:l.subarray?l.subarray(0,d):(l.length=d,l)};var s={arraySet:function(l,d,h,p,x){if(d.subarray&&l.subarray)l.set(d.subarray(h,h+p),x);else for(var u=0;u<p;u++)l[x+u]=d[h+u]},flattenChunks:function(l){var d,h,p,x,u,b;for(d=p=0,h=l.length;d<h;d++)p+=l[d].length;for(b=new Uint8Array(p),d=x=0,h=l.length;d<h;d++)u=l[d],b.set(u,x),x+=u.length;return b}},a={arraySet:function(l,d,h,p,x){for(var u=0;u<p;u++)l[x+u]=d[h+u]},flattenChunks:function(l){return[].concat.apply([],l)}};o.setTyped=function(l){l?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,s)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,a))},o.setTyped(i)},{}],42:[function(t,r,o){var i=t("./common"),s=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new i.Buf8(256),d=0;d<256;d++)l[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function h(p,x){if(x<65537&&(p.subarray&&a||!p.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(p,x));for(var u="",b=0;b<x;b++)u+=String.fromCharCode(p[b]);return u}l[254]=l[254]=1,o.string2buf=function(p){var x,u,b,f,m,g=p.length,w=0;for(f=0;f<g;f++)(64512&(u=p.charCodeAt(f)))==55296&&f+1<g&&(64512&(b=p.charCodeAt(f+1)))==56320&&(u=65536+(u-55296<<10)+(b-56320),f++),w+=u<128?1:u<2048?2:u<65536?3:4;for(x=new i.Buf8(w),f=m=0;m<w;f++)(64512&(u=p.charCodeAt(f)))==55296&&f+1<g&&(64512&(b=p.charCodeAt(f+1)))==56320&&(u=65536+(u-55296<<10)+(b-56320),f++),u<128?x[m++]=u:(u<2048?x[m++]=192|u>>>6:(u<65536?x[m++]=224|u>>>12:(x[m++]=240|u>>>18,x[m++]=128|u>>>12&63),x[m++]=128|u>>>6&63),x[m++]=128|63&u);return x},o.buf2binstring=function(p){return h(p,p.length)},o.binstring2buf=function(p){for(var x=new i.Buf8(p.length),u=0,b=x.length;u<b;u++)x[u]=p.charCodeAt(u);return x},o.buf2string=function(p,x){var u,b,f,m,g=x||p.length,w=new Array(2*g);for(u=b=0;u<g;)if((f=p[u++])<128)w[b++]=f;else if(4<(m=l[f]))w[b++]=65533,u+=m-1;else{for(f&=m===2?31:m===3?15:7;1<m&&u<g;)f=f<<6|63&p[u++],m--;1<m?w[b++]=65533:f<65536?w[b++]=f:(f-=65536,w[b++]=55296|f>>10&1023,w[b++]=56320|1023&f)}return h(w,b)},o.utf8border=function(p,x){var u;for((x=x||p.length)>p.length&&(x=p.length),u=x-1;0<=u&&(192&p[u])==128;)u--;return u<0||u===0?x:u+l[p[u]]>x?u:x}},{"./common":41}],43:[function(t,r,o){r.exports=function(i,s,a,l){for(var d=65535&i|0,h=i>>>16&65535|0,p=0;a!==0;){for(a-=p=2e3<a?2e3:a;h=h+(d=d+s[l++]|0)|0,--p;);d%=65521,h%=65521}return d|h<<16|0}},{}],44:[function(t,r,o){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,r,o){var i=(function(){for(var s,a=[],l=0;l<256;l++){s=l;for(var d=0;d<8;d++)s=1&s?3988292384^s>>>1:s>>>1;a[l]=s}return a})();r.exports=function(s,a,l,d){var h=i,p=d+l;s^=-1;for(var x=d;x<p;x++)s=s>>>8^h[255&(s^a[x])];return-1^s}},{}],46:[function(t,r,o){var i,s=t("../utils/common"),a=t("./trees"),l=t("./adler32"),d=t("./crc32"),h=t("./messages"),p=0,x=4,u=0,b=-2,f=-1,m=4,g=2,w=8,_=9,E=286,S=30,R=19,j=2*E+1,M=15,I=3,L=258,K=L+I+1,C=42,D=113,y=1,U=2,V=3,H=4;function X(v,$){return v.msg=h[$],$}function B(v){return(v<<1)-(4<v?9:0)}function Z(v){for(var $=v.length;0<=--$;)v[$]=0}function P(v){var $=v.state,z=$.pending;z>v.avail_out&&(z=v.avail_out),z!==0&&(s.arraySet(v.output,$.pending_buf,$.pending_out,z,v.next_out),v.next_out+=z,$.pending_out+=z,v.total_out+=z,v.avail_out-=z,$.pending-=z,$.pending===0&&($.pending_out=0))}function T(v,$){a._tr_flush_block(v,0<=v.block_start?v.block_start:-1,v.strstart-v.block_start,$),v.block_start=v.strstart,P(v.strm)}function te(v,$){v.pending_buf[v.pending++]=$}function ee(v,$){v.pending_buf[v.pending++]=$>>>8&255,v.pending_buf[v.pending++]=255&$}function J(v,$){var z,N,A=v.max_chain_length,O=v.strstart,W=v.prev_length,G=v.nice_match,F=v.strstart>v.w_size-K?v.strstart-(v.w_size-K):0,Y=v.window,ne=v.w_mask,Q=v.prev,oe=v.strstart+L,fe=Y[O+W-1],ue=Y[O+W];v.prev_length>=v.good_match&&(A>>=2),G>v.lookahead&&(G=v.lookahead);do if(Y[(z=$)+W]===ue&&Y[z+W-1]===fe&&Y[z]===Y[O]&&Y[++z]===Y[O+1]){O+=2,z++;do;while(Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&O<oe);if(N=L-(oe-O),O=oe-L,W<N){if(v.match_start=$,G<=(W=N))break;fe=Y[O+W-1],ue=Y[O+W]}}while(($=Q[$&ne])>F&&--A!=0);return W<=v.lookahead?W:v.lookahead}function ce(v){var $,z,N,A,O,W,G,F,Y,ne,Q=v.w_size;do{if(A=v.window_size-v.lookahead-v.strstart,v.strstart>=Q+(Q-K)){for(s.arraySet(v.window,v.window,Q,Q,0),v.match_start-=Q,v.strstart-=Q,v.block_start-=Q,$=z=v.hash_size;N=v.head[--$],v.head[$]=Q<=N?N-Q:0,--z;);for($=z=Q;N=v.prev[--$],v.prev[$]=Q<=N?N-Q:0,--z;);A+=Q}if(v.strm.avail_in===0)break;if(W=v.strm,G=v.window,F=v.strstart+v.lookahead,Y=A,ne=void 0,ne=W.avail_in,Y<ne&&(ne=Y),z=ne===0?0:(W.avail_in-=ne,s.arraySet(G,W.input,W.next_in,ne,F),W.state.wrap===1?W.adler=l(W.adler,G,ne,F):W.state.wrap===2&&(W.adler=d(W.adler,G,ne,F)),W.next_in+=ne,W.total_in+=ne,ne),v.lookahead+=z,v.lookahead+v.insert>=I)for(O=v.strstart-v.insert,v.ins_h=v.window[O],v.ins_h=(v.ins_h<<v.hash_shift^v.window[O+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[O+I-1])&v.hash_mask,v.prev[O&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=O,O++,v.insert--,!(v.lookahead+v.insert<I)););}while(v.lookahead<K&&v.strm.avail_in!==0)}function q(v,$){for(var z,N;;){if(v.lookahead<K){if(ce(v),v.lookahead<K&&$===p)return y;if(v.lookahead===0)break}if(z=0,v.lookahead>=I&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,z=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),z!==0&&v.strstart-z<=v.w_size-K&&(v.match_length=J(v,z)),v.match_length>=I)if(N=a._tr_tally(v,v.strstart-v.match_start,v.match_length-I),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=I){for(v.match_length--;v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,z=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart,--v.match_length!=0;);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else N=a._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(N&&(T(v,!1),v.strm.avail_out===0))return y}return v.insert=v.strstart<I-1?v.strstart:I-1,$===x?(T(v,!0),v.strm.avail_out===0?V:H):v.last_lit&&(T(v,!1),v.strm.avail_out===0)?y:U}function re(v,$){for(var z,N,A;;){if(v.lookahead<K){if(ce(v),v.lookahead<K&&$===p)return y;if(v.lookahead===0)break}if(z=0,v.lookahead>=I&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,z=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=I-1,z!==0&&v.prev_length<v.max_lazy_match&&v.strstart-z<=v.w_size-K&&(v.match_length=J(v,z),v.match_length<=5&&(v.strategy===1||v.match_length===I&&4096<v.strstart-v.match_start)&&(v.match_length=I-1)),v.prev_length>=I&&v.match_length<=v.prev_length){for(A=v.strstart+v.lookahead-I,N=a._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-I),v.lookahead-=v.prev_length-1,v.prev_length-=2;++v.strstart<=A&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,z=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),--v.prev_length!=0;);if(v.match_available=0,v.match_length=I-1,v.strstart++,N&&(T(v,!1),v.strm.avail_out===0))return y}else if(v.match_available){if((N=a._tr_tally(v,0,v.window[v.strstart-1]))&&T(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return y}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(N=a._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<I-1?v.strstart:I-1,$===x?(T(v,!0),v.strm.avail_out===0?V:H):v.last_lit&&(T(v,!1),v.strm.avail_out===0)?y:U}function se(v,$,z,N,A){this.good_length=v,this.max_lazy=$,this.nice_length=z,this.max_chain=N,this.func=A}function me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*j),this.dyn_dtree=new s.Buf16(2*(2*S+1)),this.bl_tree=new s.Buf16(2*(2*R+1)),Z(this.dyn_ltree),Z(this.dyn_dtree),Z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(M+1),this.heap=new s.Buf16(2*E+1),Z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*E+1),Z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function he(v){var $;return v&&v.state?(v.total_in=v.total_out=0,v.data_type=g,($=v.state).pending=0,$.pending_out=0,$.wrap<0&&($.wrap=-$.wrap),$.status=$.wrap?C:D,v.adler=$.wrap===2?0:1,$.last_flush=p,a._tr_init($),u):X(v,b)}function Oe(v){var $=he(v);return $===u&&(function(z){z.window_size=2*z.w_size,Z(z.head),z.max_lazy_match=i[z.level].max_lazy,z.good_match=i[z.level].good_length,z.nice_match=i[z.level].nice_length,z.max_chain_length=i[z.level].max_chain,z.strstart=0,z.block_start=0,z.lookahead=0,z.insert=0,z.match_length=z.prev_length=I-1,z.match_available=0,z.ins_h=0})(v.state),$}function ke(v,$,z,N,A,O){if(!v)return b;var W=1;if($===f&&($=6),N<0?(W=0,N=-N):15<N&&(W=2,N-=16),A<1||_<A||z!==w||N<8||15<N||$<0||9<$||O<0||m<O)return X(v,b);N===8&&(N=9);var G=new me;return(v.state=G).strm=v,G.wrap=W,G.gzhead=null,G.w_bits=N,G.w_size=1<<G.w_bits,G.w_mask=G.w_size-1,G.hash_bits=A+7,G.hash_size=1<<G.hash_bits,G.hash_mask=G.hash_size-1,G.hash_shift=~~((G.hash_bits+I-1)/I),G.window=new s.Buf8(2*G.w_size),G.head=new s.Buf16(G.hash_size),G.prev=new s.Buf16(G.w_size),G.lit_bufsize=1<<A+6,G.pending_buf_size=4*G.lit_bufsize,G.pending_buf=new s.Buf8(G.pending_buf_size),G.d_buf=1*G.lit_bufsize,G.l_buf=3*G.lit_bufsize,G.level=$,G.strategy=O,G.method=z,Oe(v)}i=[new se(0,0,0,0,function(v,$){var z=65535;for(z>v.pending_buf_size-5&&(z=v.pending_buf_size-5);;){if(v.lookahead<=1){if(ce(v),v.lookahead===0&&$===p)return y;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var N=v.block_start+z;if((v.strstart===0||v.strstart>=N)&&(v.lookahead=v.strstart-N,v.strstart=N,T(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-K&&(T(v,!1),v.strm.avail_out===0))return y}return v.insert=0,$===x?(T(v,!0),v.strm.avail_out===0?V:H):(v.strstart>v.block_start&&(T(v,!1),v.strm.avail_out),y)}),new se(4,4,8,4,q),new se(4,5,16,8,q),new se(4,6,32,32,q),new se(4,4,16,16,re),new se(8,16,32,32,re),new se(8,16,128,128,re),new se(8,32,128,256,re),new se(32,128,258,1024,re),new se(32,258,258,4096,re)],o.deflateInit=function(v,$){return ke(v,$,w,15,8,0)},o.deflateInit2=ke,o.deflateReset=Oe,o.deflateResetKeep=he,o.deflateSetHeader=function(v,$){return v&&v.state?v.state.wrap!==2?b:(v.state.gzhead=$,u):b},o.deflate=function(v,$){var z,N,A,O;if(!v||!v.state||5<$||$<0)return v?X(v,b):b;if(N=v.state,!v.output||!v.input&&v.avail_in!==0||N.status===666&&$!==x)return X(v,v.avail_out===0?-5:b);if(N.strm=v,z=N.last_flush,N.last_flush=$,N.status===C)if(N.wrap===2)v.adler=0,te(N,31),te(N,139),te(N,8),N.gzhead?(te(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),te(N,255&N.gzhead.time),te(N,N.gzhead.time>>8&255),te(N,N.gzhead.time>>16&255),te(N,N.gzhead.time>>24&255),te(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),te(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(te(N,255&N.gzhead.extra.length),te(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(v.adler=d(v.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(te(N,0),te(N,0),te(N,0),te(N,0),te(N,0),te(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),te(N,3),N.status=D);else{var W=w+(N.w_bits-8<<4)<<8;W|=(2<=N.strategy||N.level<2?0:N.level<6?1:N.level===6?2:3)<<6,N.strstart!==0&&(W|=32),W+=31-W%31,N.status=D,ee(N,W),N.strstart!==0&&(ee(N,v.adler>>>16),ee(N,65535&v.adler)),v.adler=1}if(N.status===69)if(N.gzhead.extra){for(A=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>A&&(v.adler=d(v.adler,N.pending_buf,N.pending-A,A)),P(v),A=N.pending,N.pending!==N.pending_buf_size));)te(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>A&&(v.adler=d(v.adler,N.pending_buf,N.pending-A,A)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(N.status===73)if(N.gzhead.name){A=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>A&&(v.adler=d(v.adler,N.pending_buf,N.pending-A,A)),P(v),A=N.pending,N.pending===N.pending_buf_size)){O=1;break}O=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,te(N,O)}while(O!==0);N.gzhead.hcrc&&N.pending>A&&(v.adler=d(v.adler,N.pending_buf,N.pending-A,A)),O===0&&(N.gzindex=0,N.status=91)}else N.status=91;if(N.status===91)if(N.gzhead.comment){A=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>A&&(v.adler=d(v.adler,N.pending_buf,N.pending-A,A)),P(v),A=N.pending,N.pending===N.pending_buf_size)){O=1;break}O=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,te(N,O)}while(O!==0);N.gzhead.hcrc&&N.pending>A&&(v.adler=d(v.adler,N.pending_buf,N.pending-A,A)),O===0&&(N.status=103)}else N.status=103;if(N.status===103&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&P(v),N.pending+2<=N.pending_buf_size&&(te(N,255&v.adler),te(N,v.adler>>8&255),v.adler=0,N.status=D)):N.status=D),N.pending!==0){if(P(v),v.avail_out===0)return N.last_flush=-1,u}else if(v.avail_in===0&&B($)<=B(z)&&$!==x)return X(v,-5);if(N.status===666&&v.avail_in!==0)return X(v,-5);if(v.avail_in!==0||N.lookahead!==0||$!==p&&N.status!==666){var G=N.strategy===2?(function(F,Y){for(var ne;;){if(F.lookahead===0&&(ce(F),F.lookahead===0)){if(Y===p)return y;break}if(F.match_length=0,ne=a._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++,ne&&(T(F,!1),F.strm.avail_out===0))return y}return F.insert=0,Y===x?(T(F,!0),F.strm.avail_out===0?V:H):F.last_lit&&(T(F,!1),F.strm.avail_out===0)?y:U})(N,$):N.strategy===3?(function(F,Y){for(var ne,Q,oe,fe,ue=F.window;;){if(F.lookahead<=L){if(ce(F),F.lookahead<=L&&Y===p)return y;if(F.lookahead===0)break}if(F.match_length=0,F.lookahead>=I&&0<F.strstart&&(Q=ue[oe=F.strstart-1])===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]){fe=F.strstart+L;do;while(Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&oe<fe);F.match_length=L-(fe-oe),F.match_length>F.lookahead&&(F.match_length=F.lookahead)}if(F.match_length>=I?(ne=a._tr_tally(F,1,F.match_length-I),F.lookahead-=F.match_length,F.strstart+=F.match_length,F.match_length=0):(ne=a._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++),ne&&(T(F,!1),F.strm.avail_out===0))return y}return F.insert=0,Y===x?(T(F,!0),F.strm.avail_out===0?V:H):F.last_lit&&(T(F,!1),F.strm.avail_out===0)?y:U})(N,$):i[N.level].func(N,$);if(G!==V&&G!==H||(N.status=666),G===y||G===V)return v.avail_out===0&&(N.last_flush=-1),u;if(G===U&&($===1?a._tr_align(N):$!==5&&(a._tr_stored_block(N,0,0,!1),$===3&&(Z(N.head),N.lookahead===0&&(N.strstart=0,N.block_start=0,N.insert=0))),P(v),v.avail_out===0))return N.last_flush=-1,u}return $!==x?u:N.wrap<=0?1:(N.wrap===2?(te(N,255&v.adler),te(N,v.adler>>8&255),te(N,v.adler>>16&255),te(N,v.adler>>24&255),te(N,255&v.total_in),te(N,v.total_in>>8&255),te(N,v.total_in>>16&255),te(N,v.total_in>>24&255)):(ee(N,v.adler>>>16),ee(N,65535&v.adler)),P(v),0<N.wrap&&(N.wrap=-N.wrap),N.pending!==0?u:1)},o.deflateEnd=function(v){var $;return v&&v.state?($=v.state.status)!==C&&$!==69&&$!==73&&$!==91&&$!==103&&$!==D&&$!==666?X(v,b):(v.state=null,$===D?X(v,-3):u):b},o.deflateSetDictionary=function(v,$){var z,N,A,O,W,G,F,Y,ne=$.length;if(!v||!v.state||(O=(z=v.state).wrap)===2||O===1&&z.status!==C||z.lookahead)return b;for(O===1&&(v.adler=l(v.adler,$,ne,0)),z.wrap=0,ne>=z.w_size&&(O===0&&(Z(z.head),z.strstart=0,z.block_start=0,z.insert=0),Y=new s.Buf8(z.w_size),s.arraySet(Y,$,ne-z.w_size,z.w_size,0),$=Y,ne=z.w_size),W=v.avail_in,G=v.next_in,F=v.input,v.avail_in=ne,v.next_in=0,v.input=$,ce(z);z.lookahead>=I;){for(N=z.strstart,A=z.lookahead-(I-1);z.ins_h=(z.ins_h<<z.hash_shift^z.window[N+I-1])&z.hash_mask,z.prev[N&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=N,N++,--A;);z.strstart=N,z.lookahead=I-1,ce(z)}return z.strstart+=z.lookahead,z.block_start=z.strstart,z.insert=z.lookahead,z.lookahead=0,z.match_length=z.prev_length=I-1,z.match_available=0,v.next_in=G,v.input=F,v.avail_in=W,z.wrap=O,u},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,r,o){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,r,o){r.exports=function(i,s){var a,l,d,h,p,x,u,b,f,m,g,w,_,E,S,R,j,M,I,L,K,C,D,y,U;a=i.state,l=i.next_in,y=i.input,d=l+(i.avail_in-5),h=i.next_out,U=i.output,p=h-(s-i.avail_out),x=h+(i.avail_out-257),u=a.dmax,b=a.wsize,f=a.whave,m=a.wnext,g=a.window,w=a.hold,_=a.bits,E=a.lencode,S=a.distcode,R=(1<<a.lenbits)-1,j=(1<<a.distbits)-1;e:do{_<15&&(w+=y[l++]<<_,_+=8,w+=y[l++]<<_,_+=8),M=E[w&R];t:for(;;){if(w>>>=I=M>>>24,_-=I,(I=M>>>16&255)===0)U[h++]=65535&M;else{if(!(16&I)){if((64&I)==0){M=E[(65535&M)+(w&(1<<I)-1)];continue t}if(32&I){a.mode=12;break e}i.msg="invalid literal/length code",a.mode=30;break e}L=65535&M,(I&=15)&&(_<I&&(w+=y[l++]<<_,_+=8),L+=w&(1<<I)-1,w>>>=I,_-=I),_<15&&(w+=y[l++]<<_,_+=8,w+=y[l++]<<_,_+=8),M=S[w&j];n:for(;;){if(w>>>=I=M>>>24,_-=I,!(16&(I=M>>>16&255))){if((64&I)==0){M=S[(65535&M)+(w&(1<<I)-1)];continue n}i.msg="invalid distance code",a.mode=30;break e}if(K=65535&M,_<(I&=15)&&(w+=y[l++]<<_,(_+=8)<I&&(w+=y[l++]<<_,_+=8)),u<(K+=w&(1<<I)-1)){i.msg="invalid distance too far back",a.mode=30;break e}if(w>>>=I,_-=I,(I=h-p)<K){if(f<(I=K-I)&&a.sane){i.msg="invalid distance too far back",a.mode=30;break e}if(D=g,(C=0)===m){if(C+=b-I,I<L){for(L-=I;U[h++]=g[C++],--I;);C=h-K,D=U}}else if(m<I){if(C+=b+m-I,(I-=m)<L){for(L-=I;U[h++]=g[C++],--I;);if(C=0,m<L){for(L-=I=m;U[h++]=g[C++],--I;);C=h-K,D=U}}}else if(C+=m-I,I<L){for(L-=I;U[h++]=g[C++],--I;);C=h-K,D=U}for(;2<L;)U[h++]=D[C++],U[h++]=D[C++],U[h++]=D[C++],L-=3;L&&(U[h++]=D[C++],1<L&&(U[h++]=D[C++]))}else{for(C=h-K;U[h++]=U[C++],U[h++]=U[C++],U[h++]=U[C++],2<(L-=3););L&&(U[h++]=U[C++],1<L&&(U[h++]=U[C++]))}break}}break}}while(l<d&&h<x);l-=L=_>>3,w&=(1<<(_-=L<<3))-1,i.next_in=l,i.next_out=h,i.avail_in=l<d?d-l+5:5-(l-d),i.avail_out=h<x?x-h+257:257-(h-x),a.hold=w,a.bits=_}},{}],49:[function(t,r,o){var i=t("../utils/common"),s=t("./adler32"),a=t("./crc32"),l=t("./inffast"),d=t("./inftrees"),h=1,p=2,x=0,u=-2,b=1,f=852,m=592;function g(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _(C){var D;return C&&C.state?(D=C.state,C.total_in=C.total_out=D.total=0,C.msg="",D.wrap&&(C.adler=1&D.wrap),D.mode=b,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new i.Buf32(f),D.distcode=D.distdyn=new i.Buf32(m),D.sane=1,D.back=-1,x):u}function E(C){var D;return C&&C.state?((D=C.state).wsize=0,D.whave=0,D.wnext=0,_(C)):u}function S(C,D){var y,U;return C&&C.state?(U=C.state,D<0?(y=0,D=-D):(y=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?u:(U.window!==null&&U.wbits!==D&&(U.window=null),U.wrap=y,U.wbits=D,E(C))):u}function R(C,D){var y,U;return C?(U=new w,(C.state=U).window=null,(y=S(C,D))!==x&&(C.state=null),y):u}var j,M,I=!0;function L(C){if(I){var D;for(j=new i.Buf32(512),M=new i.Buf32(32),D=0;D<144;)C.lens[D++]=8;for(;D<256;)C.lens[D++]=9;for(;D<280;)C.lens[D++]=7;for(;D<288;)C.lens[D++]=8;for(d(h,C.lens,0,288,j,0,C.work,{bits:9}),D=0;D<32;)C.lens[D++]=5;d(p,C.lens,0,32,M,0,C.work,{bits:5}),I=!1}C.lencode=j,C.lenbits=9,C.distcode=M,C.distbits=5}function K(C,D,y,U){var V,H=C.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new i.Buf8(H.wsize)),U>=H.wsize?(i.arraySet(H.window,D,y-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):(U<(V=H.wsize-H.wnext)&&(V=U),i.arraySet(H.window,D,y-U,V,H.wnext),(U-=V)?(i.arraySet(H.window,D,y-U,U,0),H.wnext=U,H.whave=H.wsize):(H.wnext+=V,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=V))),0}o.inflateReset=E,o.inflateReset2=S,o.inflateResetKeep=_,o.inflateInit=function(C){return R(C,15)},o.inflateInit2=R,o.inflate=function(C,D){var y,U,V,H,X,B,Z,P,T,te,ee,J,ce,q,re,se,me,he,Oe,ke,v,$,z,N,A=0,O=new i.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return u;(y=C.state).mode===12&&(y.mode=13),X=C.next_out,V=C.output,Z=C.avail_out,H=C.next_in,U=C.input,B=C.avail_in,P=y.hold,T=y.bits,te=B,ee=Z,$=x;e:for(;;)switch(y.mode){case b:if(y.wrap===0){y.mode=13;break}for(;T<16;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(2&y.wrap&&P===35615){O[y.check=0]=255&P,O[1]=P>>>8&255,y.check=a(y.check,O,2,0),T=P=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&P)<<8)+(P>>8))%31){C.msg="incorrect header check",y.mode=30;break}if((15&P)!=8){C.msg="unknown compression method",y.mode=30;break}if(T-=4,v=8+(15&(P>>>=4)),y.wbits===0)y.wbits=v;else if(v>y.wbits){C.msg="invalid window size",y.mode=30;break}y.dmax=1<<v,C.adler=y.check=1,y.mode=512&P?10:12,T=P=0;break;case 2:for(;T<16;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(y.flags=P,(255&y.flags)!=8){C.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){C.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=P>>8&1),512&y.flags&&(O[0]=255&P,O[1]=P>>>8&255,y.check=a(y.check,O,2,0)),T=P=0,y.mode=3;case 3:for(;T<32;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.head&&(y.head.time=P),512&y.flags&&(O[0]=255&P,O[1]=P>>>8&255,O[2]=P>>>16&255,O[3]=P>>>24&255,y.check=a(y.check,O,4,0)),T=P=0,y.mode=4;case 4:for(;T<16;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.head&&(y.head.xflags=255&P,y.head.os=P>>8),512&y.flags&&(O[0]=255&P,O[1]=P>>>8&255,y.check=a(y.check,O,2,0)),T=P=0,y.mode=5;case 5:if(1024&y.flags){for(;T<16;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.length=P,y.head&&(y.head.extra_len=P),512&y.flags&&(O[0]=255&P,O[1]=P>>>8&255,y.check=a(y.check,O,2,0)),T=P=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(B<(J=y.length)&&(J=B),J&&(y.head&&(v=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),i.arraySet(y.head.extra,U,H,J,v)),512&y.flags&&(y.check=a(y.check,U,J,H)),B-=J,H+=J,y.length-=J),y.length))break e;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(B===0)break e;for(J=0;v=U[H+J++],y.head&&v&&y.length<65536&&(y.head.name+=String.fromCharCode(v)),v&&J<B;);if(512&y.flags&&(y.check=a(y.check,U,J,H)),B-=J,H+=J,v)break e}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(B===0)break e;for(J=0;v=U[H+J++],y.head&&v&&y.length<65536&&(y.head.comment+=String.fromCharCode(v)),v&&J<B;);if(512&y.flags&&(y.check=a(y.check,U,J,H)),B-=J,H+=J,v)break e}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;T<16;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(P!==(65535&y.check)){C.msg="header crc mismatch",y.mode=30;break}T=P=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),C.adler=y.check=0,y.mode=12;break;case 10:for(;T<32;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}C.adler=y.check=g(P),T=P=0,y.mode=11;case 11:if(y.havedict===0)return C.next_out=X,C.avail_out=Z,C.next_in=H,C.avail_in=B,y.hold=P,y.bits=T,2;C.adler=y.check=1,y.mode=12;case 12:if(D===5||D===6)break e;case 13:if(y.last){P>>>=7&T,T-=7&T,y.mode=27;break}for(;T<3;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}switch(y.last=1&P,T-=1,3&(P>>>=1)){case 0:y.mode=14;break;case 1:if(L(y),y.mode=20,D!==6)break;P>>>=2,T-=2;break e;case 2:y.mode=17;break;case 3:C.msg="invalid block type",y.mode=30}P>>>=2,T-=2;break;case 14:for(P>>>=7&T,T-=7&T;T<32;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if((65535&P)!=(P>>>16^65535)){C.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&P,T=P=0,y.mode=15,D===6)break e;case 15:y.mode=16;case 16:if(J=y.length){if(B<J&&(J=B),Z<J&&(J=Z),J===0)break e;i.arraySet(V,U,H,J,X),B-=J,H+=J,Z-=J,X+=J,y.length-=J;break}y.mode=12;break;case 17:for(;T<14;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(y.nlen=257+(31&P),P>>>=5,T-=5,y.ndist=1+(31&P),P>>>=5,T-=5,y.ncode=4+(15&P),P>>>=4,T-=4,286<y.nlen||30<y.ndist){C.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;T<3;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.lens[W[y.have++]]=7&P,P>>>=3,T-=3}for(;y.have<19;)y.lens[W[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,z={bits:y.lenbits},$=d(0,y.lens,0,19,y.lencode,0,y.work,z),y.lenbits=z.bits,$){C.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;se=(A=y.lencode[P&(1<<y.lenbits)-1])>>>16&255,me=65535&A,!((re=A>>>24)<=T);){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(me<16)P>>>=re,T-=re,y.lens[y.have++]=me;else{if(me===16){for(N=re+2;T<N;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(P>>>=re,T-=re,y.have===0){C.msg="invalid bit length repeat",y.mode=30;break}v=y.lens[y.have-1],J=3+(3&P),P>>>=2,T-=2}else if(me===17){for(N=re+3;T<N;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}T-=re,v=0,J=3+(7&(P>>>=re)),P>>>=3,T-=3}else{for(N=re+7;T<N;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}T-=re,v=0,J=11+(127&(P>>>=re)),P>>>=7,T-=7}if(y.have+J>y.nlen+y.ndist){C.msg="invalid bit length repeat",y.mode=30;break}for(;J--;)y.lens[y.have++]=v}}if(y.mode===30)break;if(y.lens[256]===0){C.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,z={bits:y.lenbits},$=d(h,y.lens,0,y.nlen,y.lencode,0,y.work,z),y.lenbits=z.bits,$){C.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,z={bits:y.distbits},$=d(p,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,z),y.distbits=z.bits,$){C.msg="invalid distances set",y.mode=30;break}if(y.mode=20,D===6)break e;case 20:y.mode=21;case 21:if(6<=B&&258<=Z){C.next_out=X,C.avail_out=Z,C.next_in=H,C.avail_in=B,y.hold=P,y.bits=T,l(C,ee),X=C.next_out,V=C.output,Z=C.avail_out,H=C.next_in,U=C.input,B=C.avail_in,P=y.hold,T=y.bits,y.mode===12&&(y.back=-1);break}for(y.back=0;se=(A=y.lencode[P&(1<<y.lenbits)-1])>>>16&255,me=65535&A,!((re=A>>>24)<=T);){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(se&&(240&se)==0){for(he=re,Oe=se,ke=me;se=(A=y.lencode[ke+((P&(1<<he+Oe)-1)>>he)])>>>16&255,me=65535&A,!(he+(re=A>>>24)<=T);){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}P>>>=he,T-=he,y.back+=he}if(P>>>=re,T-=re,y.back+=re,y.length=me,se===0){y.mode=26;break}if(32&se){y.back=-1,y.mode=12;break}if(64&se){C.msg="invalid literal/length code",y.mode=30;break}y.extra=15&se,y.mode=22;case 22:if(y.extra){for(N=y.extra;T<N;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.length+=P&(1<<y.extra)-1,P>>>=y.extra,T-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;se=(A=y.distcode[P&(1<<y.distbits)-1])>>>16&255,me=65535&A,!((re=A>>>24)<=T);){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if((240&se)==0){for(he=re,Oe=se,ke=me;se=(A=y.distcode[ke+((P&(1<<he+Oe)-1)>>he)])>>>16&255,me=65535&A,!(he+(re=A>>>24)<=T);){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}P>>>=he,T-=he,y.back+=he}if(P>>>=re,T-=re,y.back+=re,64&se){C.msg="invalid distance code",y.mode=30;break}y.offset=me,y.extra=15&se,y.mode=24;case 24:if(y.extra){for(N=y.extra;T<N;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.offset+=P&(1<<y.extra)-1,P>>>=y.extra,T-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){C.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(Z===0)break e;if(J=ee-Z,y.offset>J){if((J=y.offset-J)>y.whave&&y.sane){C.msg="invalid distance too far back",y.mode=30;break}ce=J>y.wnext?(J-=y.wnext,y.wsize-J):y.wnext-J,J>y.length&&(J=y.length),q=y.window}else q=V,ce=X-y.offset,J=y.length;for(Z<J&&(J=Z),Z-=J,y.length-=J;V[X++]=q[ce++],--J;);y.length===0&&(y.mode=21);break;case 26:if(Z===0)break e;V[X++]=y.length,Z--,y.mode=21;break;case 27:if(y.wrap){for(;T<32;){if(B===0)break e;B--,P|=U[H++]<<T,T+=8}if(ee-=Z,C.total_out+=ee,y.total+=ee,ee&&(C.adler=y.check=y.flags?a(y.check,V,ee,X-ee):s(y.check,V,ee,X-ee)),ee=Z,(y.flags?P:g(P))!==y.check){C.msg="incorrect data check",y.mode=30;break}T=P=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;T<32;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(P!==(4294967295&y.total)){C.msg="incorrect length check",y.mode=30;break}T=P=0}y.mode=29;case 29:$=1;break e;case 30:$=-3;break e;case 31:return-4;default:return u}return C.next_out=X,C.avail_out=Z,C.next_in=H,C.avail_in=B,y.hold=P,y.bits=T,(y.wsize||ee!==C.avail_out&&y.mode<30&&(y.mode<27||D!==4))&&K(C,C.output,C.next_out,ee-C.avail_out)?(y.mode=31,-4):(te-=C.avail_in,ee-=C.avail_out,C.total_in+=te,C.total_out+=ee,y.total+=ee,y.wrap&&ee&&(C.adler=y.check=y.flags?a(y.check,V,ee,C.next_out-ee):s(y.check,V,ee,C.next_out-ee)),C.data_type=y.bits+(y.last?64:0)+(y.mode===12?128:0)+(y.mode===20||y.mode===15?256:0),(te==0&&ee===0||D===4)&&$===x&&($=-5),$)},o.inflateEnd=function(C){if(!C||!C.state)return u;var D=C.state;return D.window&&(D.window=null),C.state=null,x},o.inflateGetHeader=function(C,D){var y;return C&&C.state?(2&(y=C.state).wrap)==0?u:((y.head=D).done=!1,x):u},o.inflateSetDictionary=function(C,D){var y,U=D.length;return C&&C.state?(y=C.state).wrap!==0&&y.mode!==11?u:y.mode===11&&s(1,D,U,0)!==y.check?-3:K(C,D,U,U)?(y.mode=31,-4):(y.havedict=1,x):u},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,r,o){var i=t("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(h,p,x,u,b,f,m,g){var w,_,E,S,R,j,M,I,L,K=g.bits,C=0,D=0,y=0,U=0,V=0,H=0,X=0,B=0,Z=0,P=0,T=null,te=0,ee=new i.Buf16(16),J=new i.Buf16(16),ce=null,q=0;for(C=0;C<=15;C++)ee[C]=0;for(D=0;D<u;D++)ee[p[x+D]]++;for(V=K,U=15;1<=U&&ee[U]===0;U--);if(U<V&&(V=U),U===0)return b[f++]=20971520,b[f++]=20971520,g.bits=1,0;for(y=1;y<U&&ee[y]===0;y++);for(V<y&&(V=y),C=B=1;C<=15;C++)if(B<<=1,(B-=ee[C])<0)return-1;if(0<B&&(h===0||U!==1))return-1;for(J[1]=0,C=1;C<15;C++)J[C+1]=J[C]+ee[C];for(D=0;D<u;D++)p[x+D]!==0&&(m[J[p[x+D]]++]=D);if(j=h===0?(T=ce=m,19):h===1?(T=s,te-=257,ce=a,q-=257,256):(T=l,ce=d,-1),C=y,R=f,X=D=P=0,E=-1,S=(Z=1<<(H=V))-1,h===1&&852<Z||h===2&&592<Z)return 1;for(;;){for(M=C-X,L=m[D]<j?(I=0,m[D]):m[D]>j?(I=ce[q+m[D]],T[te+m[D]]):(I=96,0),w=1<<C-X,y=_=1<<H;b[R+(P>>X)+(_-=w)]=M<<24|I<<16|L|0,_!==0;);for(w=1<<C-1;P&w;)w>>=1;if(w!==0?(P&=w-1,P+=w):P=0,D++,--ee[C]==0){if(C===U)break;C=p[x+m[D]]}if(V<C&&(P&S)!==E){for(X===0&&(X=V),R+=y,B=1<<(H=C-X);H+X<U&&!((B-=ee[H+X])<=0);)H++,B<<=1;if(Z+=1<<H,h===1&&852<Z||h===2&&592<Z)return 1;b[E=P&S]=V<<24|H<<16|R-f|0}}return P!==0&&(b[R+P]=C-X<<24|64<<16|0),g.bits=V,0}},{"../utils/common":41}],51:[function(t,r,o){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,r,o){var i=t("../utils/common"),s=0,a=1;function l(A){for(var O=A.length;0<=--O;)A[O]=0}var d=0,h=29,p=256,x=p+1+h,u=30,b=19,f=2*x+1,m=15,g=16,w=7,_=256,E=16,S=17,R=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=new Array(2*(x+2));l(K);var C=new Array(2*u);l(C);var D=new Array(512);l(D);var y=new Array(256);l(y);var U=new Array(h);l(U);var V,H,X,B=new Array(u);function Z(A,O,W,G,F){this.static_tree=A,this.extra_bits=O,this.extra_base=W,this.elems=G,this.max_length=F,this.has_stree=A&&A.length}function P(A,O){this.dyn_tree=A,this.max_code=0,this.stat_desc=O}function T(A){return A<256?D[A]:D[256+(A>>>7)]}function te(A,O){A.pending_buf[A.pending++]=255&O,A.pending_buf[A.pending++]=O>>>8&255}function ee(A,O,W){A.bi_valid>g-W?(A.bi_buf|=O<<A.bi_valid&65535,te(A,A.bi_buf),A.bi_buf=O>>g-A.bi_valid,A.bi_valid+=W-g):(A.bi_buf|=O<<A.bi_valid&65535,A.bi_valid+=W)}function J(A,O,W){ee(A,W[2*O],W[2*O+1])}function ce(A,O){for(var W=0;W|=1&A,A>>>=1,W<<=1,0<--O;);return W>>>1}function q(A,O,W){var G,F,Y=new Array(m+1),ne=0;for(G=1;G<=m;G++)Y[G]=ne=ne+W[G-1]<<1;for(F=0;F<=O;F++){var Q=A[2*F+1];Q!==0&&(A[2*F]=ce(Y[Q]++,Q))}}function re(A){var O;for(O=0;O<x;O++)A.dyn_ltree[2*O]=0;for(O=0;O<u;O++)A.dyn_dtree[2*O]=0;for(O=0;O<b;O++)A.bl_tree[2*O]=0;A.dyn_ltree[2*_]=1,A.opt_len=A.static_len=0,A.last_lit=A.matches=0}function se(A){8<A.bi_valid?te(A,A.bi_buf):0<A.bi_valid&&(A.pending_buf[A.pending++]=A.bi_buf),A.bi_buf=0,A.bi_valid=0}function me(A,O,W,G){var F=2*O,Y=2*W;return A[F]<A[Y]||A[F]===A[Y]&&G[O]<=G[W]}function he(A,O,W){for(var G=A.heap[W],F=W<<1;F<=A.heap_len&&(F<A.heap_len&&me(O,A.heap[F+1],A.heap[F],A.depth)&&F++,!me(O,G,A.heap[F],A.depth));)A.heap[W]=A.heap[F],W=F,F<<=1;A.heap[W]=G}function Oe(A,O,W){var G,F,Y,ne,Q=0;if(A.last_lit!==0)for(;G=A.pending_buf[A.d_buf+2*Q]<<8|A.pending_buf[A.d_buf+2*Q+1],F=A.pending_buf[A.l_buf+Q],Q++,G===0?J(A,F,O):(J(A,(Y=y[F])+p+1,O),(ne=j[Y])!==0&&ee(A,F-=U[Y],ne),J(A,Y=T(--G),W),(ne=M[Y])!==0&&ee(A,G-=B[Y],ne)),Q<A.last_lit;);J(A,_,O)}function ke(A,O){var W,G,F,Y=O.dyn_tree,ne=O.stat_desc.static_tree,Q=O.stat_desc.has_stree,oe=O.stat_desc.elems,fe=-1;for(A.heap_len=0,A.heap_max=f,W=0;W<oe;W++)Y[2*W]!==0?(A.heap[++A.heap_len]=fe=W,A.depth[W]=0):Y[2*W+1]=0;for(;A.heap_len<2;)Y[2*(F=A.heap[++A.heap_len]=fe<2?++fe:0)]=1,A.depth[F]=0,A.opt_len--,Q&&(A.static_len-=ne[2*F+1]);for(O.max_code=fe,W=A.heap_len>>1;1<=W;W--)he(A,Y,W);for(F=oe;W=A.heap[1],A.heap[1]=A.heap[A.heap_len--],he(A,Y,1),G=A.heap[1],A.heap[--A.heap_max]=W,A.heap[--A.heap_max]=G,Y[2*F]=Y[2*W]+Y[2*G],A.depth[F]=(A.depth[W]>=A.depth[G]?A.depth[W]:A.depth[G])+1,Y[2*W+1]=Y[2*G+1]=F,A.heap[1]=F++,he(A,Y,1),2<=A.heap_len;);A.heap[--A.heap_max]=A.heap[1],(function(ue,Me){var It,ze,Pt,xe,en,Wn,Ye=Me.dyn_tree,no=Me.max_code,el=Me.stat_desc.static_tree,tl=Me.stat_desc.has_stree,nl=Me.stat_desc.extra_bits,ro=Me.stat_desc.extra_base,Mt=Me.stat_desc.max_length,tn=0;for(xe=0;xe<=m;xe++)ue.bl_count[xe]=0;for(Ye[2*ue.heap[ue.heap_max]+1]=0,It=ue.heap_max+1;It<f;It++)Mt<(xe=Ye[2*Ye[2*(ze=ue.heap[It])+1]+1]+1)&&(xe=Mt,tn++),Ye[2*ze+1]=xe,no<ze||(ue.bl_count[xe]++,en=0,ro<=ze&&(en=nl[ze-ro]),Wn=Ye[2*ze],ue.opt_len+=Wn*(xe+en),tl&&(ue.static_len+=Wn*(el[2*ze+1]+en)));if(tn!==0){do{for(xe=Mt-1;ue.bl_count[xe]===0;)xe--;ue.bl_count[xe]--,ue.bl_count[xe+1]+=2,ue.bl_count[Mt]--,tn-=2}while(0<tn);for(xe=Mt;xe!==0;xe--)for(ze=ue.bl_count[xe];ze!==0;)no<(Pt=ue.heap[--It])||(Ye[2*Pt+1]!==xe&&(ue.opt_len+=(xe-Ye[2*Pt+1])*Ye[2*Pt],Ye[2*Pt+1]=xe),ze--)}})(A,O),q(Y,fe,A.bl_count)}function v(A,O,W){var G,F,Y=-1,ne=O[1],Q=0,oe=7,fe=4;for(ne===0&&(oe=138,fe=3),O[2*(W+1)+1]=65535,G=0;G<=W;G++)F=ne,ne=O[2*(G+1)+1],++Q<oe&&F===ne||(Q<fe?A.bl_tree[2*F]+=Q:F!==0?(F!==Y&&A.bl_tree[2*F]++,A.bl_tree[2*E]++):Q<=10?A.bl_tree[2*S]++:A.bl_tree[2*R]++,Y=F,fe=(Q=0)===ne?(oe=138,3):F===ne?(oe=6,3):(oe=7,4))}function $(A,O,W){var G,F,Y=-1,ne=O[1],Q=0,oe=7,fe=4;for(ne===0&&(oe=138,fe=3),G=0;G<=W;G++)if(F=ne,ne=O[2*(G+1)+1],!(++Q<oe&&F===ne)){if(Q<fe)for(;J(A,F,A.bl_tree),--Q!=0;);else F!==0?(F!==Y&&(J(A,F,A.bl_tree),Q--),J(A,E,A.bl_tree),ee(A,Q-3,2)):Q<=10?(J(A,S,A.bl_tree),ee(A,Q-3,3)):(J(A,R,A.bl_tree),ee(A,Q-11,7));Y=F,fe=(Q=0)===ne?(oe=138,3):F===ne?(oe=6,3):(oe=7,4)}}l(B);var z=!1;function N(A,O,W,G){ee(A,(d<<1)+(G?1:0),3),(function(F,Y,ne,Q){se(F),te(F,ne),te(F,~ne),i.arraySet(F.pending_buf,F.window,Y,ne,F.pending),F.pending+=ne})(A,O,W)}o._tr_init=function(A){z||((function(){var O,W,G,F,Y,ne=new Array(m+1);for(F=G=0;F<h-1;F++)for(U[F]=G,O=0;O<1<<j[F];O++)y[G++]=F;for(y[G-1]=F,F=Y=0;F<16;F++)for(B[F]=Y,O=0;O<1<<M[F];O++)D[Y++]=F;for(Y>>=7;F<u;F++)for(B[F]=Y<<7,O=0;O<1<<M[F]-7;O++)D[256+Y++]=F;for(W=0;W<=m;W++)ne[W]=0;for(O=0;O<=143;)K[2*O+1]=8,O++,ne[8]++;for(;O<=255;)K[2*O+1]=9,O++,ne[9]++;for(;O<=279;)K[2*O+1]=7,O++,ne[7]++;for(;O<=287;)K[2*O+1]=8,O++,ne[8]++;for(q(K,x+1,ne),O=0;O<u;O++)C[2*O+1]=5,C[2*O]=ce(O,5);V=new Z(K,j,p+1,x,m),H=new Z(C,M,0,u,m),X=new Z(new Array(0),I,0,b,w)})(),z=!0),A.l_desc=new P(A.dyn_ltree,V),A.d_desc=new P(A.dyn_dtree,H),A.bl_desc=new P(A.bl_tree,X),A.bi_buf=0,A.bi_valid=0,re(A)},o._tr_stored_block=N,o._tr_flush_block=function(A,O,W,G){var F,Y,ne=0;0<A.level?(A.strm.data_type===2&&(A.strm.data_type=(function(Q){var oe,fe=4093624447;for(oe=0;oe<=31;oe++,fe>>>=1)if(1&fe&&Q.dyn_ltree[2*oe]!==0)return s;if(Q.dyn_ltree[18]!==0||Q.dyn_ltree[20]!==0||Q.dyn_ltree[26]!==0)return a;for(oe=32;oe<p;oe++)if(Q.dyn_ltree[2*oe]!==0)return a;return s})(A)),ke(A,A.l_desc),ke(A,A.d_desc),ne=(function(Q){var oe;for(v(Q,Q.dyn_ltree,Q.l_desc.max_code),v(Q,Q.dyn_dtree,Q.d_desc.max_code),ke(Q,Q.bl_desc),oe=b-1;3<=oe&&Q.bl_tree[2*L[oe]+1]===0;oe--);return Q.opt_len+=3*(oe+1)+5+5+4,oe})(A),F=A.opt_len+3+7>>>3,(Y=A.static_len+3+7>>>3)<=F&&(F=Y)):F=Y=W+5,W+4<=F&&O!==-1?N(A,O,W,G):A.strategy===4||Y===F?(ee(A,2+(G?1:0),3),Oe(A,K,C)):(ee(A,4+(G?1:0),3),(function(Q,oe,fe,ue){var Me;for(ee(Q,oe-257,5),ee(Q,fe-1,5),ee(Q,ue-4,4),Me=0;Me<ue;Me++)ee(Q,Q.bl_tree[2*L[Me]+1],3);$(Q,Q.dyn_ltree,oe-1),$(Q,Q.dyn_dtree,fe-1)})(A,A.l_desc.max_code+1,A.d_desc.max_code+1,ne+1),Oe(A,A.dyn_ltree,A.dyn_dtree)),re(A),G&&se(A)},o._tr_tally=function(A,O,W){return A.pending_buf[A.d_buf+2*A.last_lit]=O>>>8&255,A.pending_buf[A.d_buf+2*A.last_lit+1]=255&O,A.pending_buf[A.l_buf+A.last_lit]=255&W,A.last_lit++,O===0?A.dyn_ltree[2*W]++:(A.matches++,O--,A.dyn_ltree[2*(y[W]+p+1)]++,A.dyn_dtree[2*T(O)]++),A.last_lit===A.lit_bufsize-1},o._tr_align=function(A){ee(A,2,3),J(A,_,K),(function(O){O.bi_valid===16?(te(O,O.bi_buf),O.bi_buf=0,O.bi_valid=0):8<=O.bi_valid&&(O.pending_buf[O.pending++]=255&O.bi_buf,O.bi_buf>>=8,O.bi_valid-=8)})(A)}},{"../utils/common":41}],53:[function(t,r,o){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,r,o){(function(i){(function(s,a){if(!s.setImmediate){var l,d,h,p,x=1,u={},b=!1,f=s.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(s);m=m&&m.setTimeout?m:s,l={}.toString.call(s.process)==="[object process]"?function(E){process.nextTick(function(){w(E)})}:(function(){if(s.postMessage&&!s.importScripts){var E=!0,S=s.onmessage;return s.onmessage=function(){E=!1},s.postMessage("","*"),s.onmessage=S,E}})()?(p="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",_,!1):s.attachEvent("onmessage",_),function(E){s.postMessage(p+E,"*")}):s.MessageChannel?((h=new MessageChannel).port1.onmessage=function(E){w(E.data)},function(E){h.port2.postMessage(E)}):f&&"onreadystatechange"in f.createElement("script")?(d=f.documentElement,function(E){var S=f.createElement("script");S.onreadystatechange=function(){w(E),S.onreadystatechange=null,d.removeChild(S),S=null},d.appendChild(S)}):function(E){setTimeout(w,0,E)},m.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var S=new Array(arguments.length-1),R=0;R<S.length;R++)S[R]=arguments[R+1];var j={callback:E,args:S};return u[x]=j,l(x),x++},m.clearImmediate=g}function g(E){delete u[E]}function w(E){if(b)setTimeout(w,0,E);else{var S=u[E];if(S){b=!0;try{(function(R){var j=R.callback,M=R.args;switch(M.length){case 0:j();break;case 1:j(M[0]);break;case 2:j(M[0],M[1]);break;case 3:j(M[0],M[1],M[2]);break;default:j.apply(a,M)}})(S)}finally{g(E),b=!1}}}}function _(E){E.source===s&&typeof E.data=="string"&&E.data.indexOf(p)===0&&w(+E.data.slice(p.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof nt<"u"?nt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(ir)),ir.exports}var ug=cg();const wr=il(ug);function qa({sessionId:e,onSuccess:n,onError:t}){const[r,o]=k.useState(!1),[i,s]=k.useState(null),a=_e(ae.skills.importSkill),l=_e(ae.skills.importSkillWithReferences),d=_e(ae.contextMapImport.importAsProject),h=k.useCallback(async(m,g,w,_,E)=>{o(!0);try{const S=sa(m,_);await a({sessionId:e,content:S.content,metadata:{skillName:S.metadata.skillName,skillDescription:S.metadata.skillDescription,sourceType:g,sourceRef:w},zone:E}),n?.(S.metadata.skillName,0)}catch(S){const R=S instanceof Bt||S instanceof Error?S.message:"Import failed";t?.(R)}finally{o(!1)}},[e,a,n,t]),p=k.useCallback(async m=>{o(!0);try{const g=await wr.loadAsync(m),w=new Map,_=Object.keys(g.files).filter(R=>!g.files[R].dir),E=dg(_);for(const[R,j]of Object.entries(g.files)){if(j.dir)continue;const M=E?R.slice(E.length):R;if(!M)continue;const I=await j.async("string");w.set(M,I)}const S=lg(w,m.name.replace(/\.zip$/i,""));if(S.contextMap&&S.contextMap.contexts.length>1){s({skillName:S.skill.metadata.skillName,skillDescription:S.skill.metadata.skillDescription,skillContent:S.skill.content,contextMap:S.contextMap,files:Array.from(w.entries()).map(([R,j])=>({path:R,content:j})),sourceType:"upload",sourceRef:m.name}),o(!1);return}S.references.length>0?await l({sessionId:e,skill:{content:S.skill.content,metadata:{skillName:S.skill.metadata.skillName,skillDescription:S.skill.metadata.skillDescription,sourceType:"upload",sourceRef:m.name}},references:S.references.map(R=>({content:R.content,filename:R.filename,zone:R.zone,relativePath:R.relativePath}))}):await a({sessionId:e,content:S.skill.content,metadata:{skillName:S.skill.metadata.skillName,skillDescription:S.skill.metadata.skillDescription,sourceType:"upload",sourceRef:m.name}}),n?.(S.skill.metadata.skillName,S.references.length)}catch(g){const w=g instanceof Bt||g instanceof Error?g.message:"ZIP import failed";t?.(w)}finally{o(!1)}},[e,a,l,n,t]),x=k.useCallback(async(m,g)=>{if(m.name.toLowerCase().endsWith(".zip")){await p(m);return}const w=await m.text();await h(w,"upload",m.name,m.name.replace(/\.md$/,""),g)},[h,p]),u=k.useCallback(async m=>{o(!0);try{const g=fg(m),w=await fetch(g);if(!w.ok)throw new Error(`Failed to fetch: ${w.status} ${w.statusText}`);const _=await w.text();o(!1),await h(_,"url",m)}catch(g){const w=g instanceof Error?g.message:"URL import failed";t?.(w),o(!1)}},[h,t]),b=k.useCallback(async()=>{if(i){o(!0);try{await d({sessionId:e,skillName:i.skillName,skillDescription:i.skillDescription,skillContent:i.skillContent,contexts:i.contextMap.contexts.map(g=>({key:g.key,label:g.label,permanent:g.permanent,stable:g.stable,working:g.working})),files:i.files,sourceType:i.sourceType,sourceRef:i.sourceRef});const m=i.contextMap.contexts.length;s(null),n?.(i.skillName,m)}catch(m){const g=m instanceof Error?m.message:"Project import failed";t?.(g)}finally{o(!1)}}},[i,e,d,n,t]),f=k.useCallback(()=>{s(null)},[]);return{importFromFile:x,importFromUrl:u,importFromContent:h,isImporting:r,pendingProjectImport:i,confirmProjectImport:b,cancelProjectImport:f}}function dg(e){if(e.length===0)return"";const n=e[0],t=n.indexOf("/");if(t===-1)return"";const r=n.slice(0,t+1);return e.every(o=>o.startsWith(r))?r:""}function fg(e){try{const n=new URL(e);if(n.hostname==="github.com"){const t=n.pathname.split("/"),r=t.indexOf("blob");if(r!==-1)return t.splice(r,1),`https://raw.githubusercontent.com${t.join("/")}`;const o=t.indexOf("tree");if(o!==-1)return t.splice(o,1),`https://raw.githubusercontent.com${t.join("/")}/SKILL.md`}return e}catch{return e}}function Xa({pending:e,onConfirm:n,onCancel:t,isImporting:r}){const o=e.contextMap.contexts;return c.jsx(Fe.div,{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",initial:be.initial,animate:be.animate,exit:be.exit,transition:be.transition,children:c.jsxs(Fe.div,{className:"bg-card border border-border rounded-lg shadow-lg w-full max-w-lg max-h-[80vh] flex flex-col",initial:ye.initial,animate:ye.animate,exit:ye.exit,transition:ye.transition,onClick:i=>i.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Cl,{className:"w-5 h-5 text-amber-600"}),c.jsx("h2",{className:"text-lg font-semibold",children:"Import as Project"})]}),c.jsx(de,{variant:"ghost",size:"sm",onClick:t,disabled:r,children:c.jsx(jn,{className:"w-4 h-4"})})]}),c.jsxs("div",{className:"p-4 space-y-3 overflow-y-auto flex-1",children:[c.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.jsx("strong",{children:e.skillName})," defines a"," ",o.length,"-step workflow:"]}),c.jsx("div",{className:"space-y-2",children:o.map((i,s)=>{const a=i.permanent.length+i.stable.length+i.working.length;return c.jsxs("div",{className:"border border-border rounded p-2.5",children:[c.jsxs("div",{className:"text-sm font-medium",children:[s+1,". ",i.label]}),c.jsxs("div",{className:"text-xs text-muted-foreground mt-0.5",children:[a," reference",a!==1?"s":"",i.permanent.length>0&&` (${i.permanent.length} permanent)`,i.stable.length>0&&` (${i.stable.length} stable)`,i.working.length>0&&` (${i.working.length} working)`]})]},i.key)})})]}),c.jsxs("div",{className:"p-3 bg-muted/30 border-t border-border text-sm text-muted-foreground shrink-0",children:["Your current session becomes step 1:"," ",c.jsx("strong",{children:o[0]?.label}),"."," ",o.length>1&&`${o.length-1} more step${o.length>2?"s":""} will be created as a project workflow.`]}),c.jsxs("div",{className:"p-4 flex justify-end gap-2 border-t border-border shrink-0",children:[c.jsx(de,{variant:"outline",onClick:t,disabled:r,children:"Cancel"}),c.jsx(de,{onClick:n,disabled:r,children:r?"Importing...":"Import as Project"})]})]})})}function pg({isOpen:e,onClose:n,sessionId:t}){const[r,o]=k.useState(""),[i,s]=k.useState(null),[a,l]=k.useState(null),[d,h]=k.useState(null),[p,x]=k.useState(!1),[u,b]=k.useState("~/.claude/skills/"),[f,m]=k.useState(!1),g=k.useRef(null),_=Se(ae.features.getFlags)?.skillScanEnabled??!1,E=zt(ae.skillsNode.scanFolder),S=zt(ae.skillsNode.importFromScan),{importFromFile:R,importFromUrl:j,isImporting:M,pendingProjectImport:I,confirmProjectImport:L,cancelProjectImport:K}=qa({sessionId:t,onSuccess:(Z,P)=>{const T=P?` (+ ${P} reference${P!==1?"s":""})`:"";l(`Imported skill: ${Z}${T}`),s(null)},onError:Z=>{s(Z),l(null)}}),C=async Z=>{const P=Z.target.files?.[0];if(!P)return;const T=P.name.toLowerCase();if(!T.endsWith(".md")&&!T.endsWith(".zip")){s("Only .md and .zip files are supported");return}s(null),l(null),await R(P),g.current&&(g.current.value="")},D=k.useCallback(async Z=>{Z.preventDefault(),Z.stopPropagation(),m(!1);const P=Z.dataTransfer.files[0];if(!P)return;const T=P.name.toLowerCase();if(!T.endsWith(".md")&&!T.endsWith(".zip")){s("Only .md and .zip files are supported");return}s(null),l(null),await R(P)},[R]),y=k.useCallback(Z=>{Z.preventDefault(),Z.stopPropagation(),m(!0)},[]),U=k.useCallback(Z=>{Z.preventDefault(),Z.stopPropagation(),m(!1)},[]),V=async()=>{r.trim()&&(s(null),l(null),await j(r.trim()),i||o(""))},H=async()=>{x(!0),s(null),h(null);try{const Z=await E({folderPath:u||void 0});Z.error?s(Z.error):Z.skills.length===0?s("No SKILL.md files found in the specified folder"):h(Z.skills)}catch(Z){s(Z instanceof Error?Z.message:"Scan failed")}finally{x(!1)}},X=async Z=>{s(null),l(null);try{const P=await S({sessionId:t,skills:Z.map(te=>({content:te.content,skillName:te.name,skillDescription:te.description,folderPath:te.folderPath,references:te.references?.map(ee=>({filename:ee.filename,content:ee.content,zone:ee.zone,relativePath:ee.relativePath}))}))}),T=P.references?` (+ ${P.references} references)`:"";l(`Imported ${P.imported} skill${P.imported!==1?"s":""}${T}`),h(null)}catch(P){s(P instanceof Error?P.message:"Import failed")}},B=()=>{s(null),l(null),h(null),o(""),n()};return c.jsx(Nn,{children:e&&c.jsxs(Fe.div,{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",initial:be.initial,animate:be.animate,exit:be.exit,transition:be.transition,children:[c.jsxs(Fe.div,{className:"bg-card border border-border rounded-lg shadow-lg w-full max-w-lg max-h-[80vh] overflow-y-auto",initial:ye.initial,animate:ye.animate,exit:ye.exit,transition:ye.transition,onClick:Z=>Z.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Sr,{className:"w-5 h-5 text-amber-600"}),c.jsx("h2",{className:"text-lg font-semibold",children:"Import Skill"})]}),c.jsx(de,{variant:"ghost",size:"sm",onClick:B,children:c.jsx(jn,{className:"w-4 h-4"})})]}),c.jsxs("div",{className:"p-4 space-y-5",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[c.jsx(gi,{className:"w-4 h-4 text-muted-foreground"}),"Upload SKILL.md or .zip"]}),c.jsxs("div",{className:pe("border-2 border-dashed rounded-lg p-4 text-center cursor-pointer transition-colors",f?"border-primary bg-primary/5":"border-border hover:border-muted-foreground/50"),onClick:()=>g.current?.click(),onDrop:D,onDragOver:y,onDragLeave:U,children:[c.jsx("input",{ref:g,type:"file",accept:".md,.zip",onChange:C,className:"hidden"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:f?"Drop file here":"Click or drop a .md or .zip file here"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[c.jsx(xi,{className:"w-4 h-4 text-muted-foreground"}),"Import from URL"]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"text",value:r,onChange:Z=>o(Z.target.value),onKeyDown:Z=>{Z.key==="Enter"&&V()},placeholder:"https://raw.githubusercontent.com/.../SKILL.md",className:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"}),c.jsx(ft,{onClick:V,disabled:!r.trim()||M,debounceMs:500,size:"sm",children:"Import"})]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Paste a raw GitHub URL or any direct link to a SKILL.md file"})]}),_&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[c.jsx(vi,{className:"w-4 h-4 text-muted-foreground"}),"Scan Local Folder"]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"text",value:u,onChange:Z=>b(Z.target.value),placeholder:"~/.claude/skills/",className:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"}),c.jsx(ft,{onClick:H,disabled:p,debounceMs:500,size:"sm",children:p?"Scanning...":"Scan"})]}),d&&c.jsx(hg,{results:d,onImport:X,isImporting:M})]}),i&&c.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-destructive/10 text-destructive text-sm",children:[c.jsx(sl,{className:"w-4 h-4 mt-0.5 shrink-0"}),i]}),a&&c.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-green-500/10 text-green-700 dark:text-green-400 text-sm",children:[c.jsx(al,{className:"w-4 h-4 mt-0.5 shrink-0"}),a]})]})]}),I&&c.jsx(Xa,{pending:I,onConfirm:L,onCancel:K,isImporting:M})]})})}function hg({results:e,onImport:n,isImporting:t}){const[r,o]=k.useState(()=>new Set(e.map((s,a)=>a))),i=s=>{const a=new Set(r);a.has(s)?a.delete(s):a.add(s),o(a)};return c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"text-sm font-medium",children:["Found ",e.length," skill",e.length!==1?"s":"",":"]}),c.jsx("div",{className:"max-h-60 overflow-y-auto space-y-1",children:e.map((s,a)=>c.jsxs("label",{className:pe("flex items-start gap-2 p-2 rounded border cursor-pointer transition-colors",r.has(a)?"border-amber-300 bg-amber-50/50 dark:border-amber-700 dark:bg-amber-950/30":"border-border hover:bg-muted/50"),children:[c.jsx("input",{type:"checkbox",checked:r.has(a),onChange:()=>i(a),className:"mt-0.5"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"text-sm font-medium",children:s.name}),c.jsx("div",{className:"text-xs text-muted-foreground line-clamp-1",children:s.description}),c.jsxs("div",{className:"text-xs text-muted-foreground font-mono",children:["~",s.tokenEstimate," tokens",s.references&&s.references.length>0&&c.jsxs("span",{className:"ml-2",children:[" ",s.references.length," ref",s.references.length!==1?"s":""]})]})]})]},a))}),c.jsx(ft,{onClick:()=>n(e.filter((s,a)=>r.has(a))),disabled:r.size===0||t,debounceMs:500,className:"w-full",children:t?"Importing...":`Import ${r.size} Skill${r.size!==1?"s":""}`})]})}function Qa(e,n,t){const r=e.split(`
`);for(const o of r){const i=o.match(/^#+\s+(.+)/);if(i)return i[1].trim()}for(const o of r){const i=o.trim();if(i)return i.length>60?i.slice(0,60):i}return`${n}-${t}`}function tt(e){return e.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9\-_]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,50)||"untitled"}function Ja(e,n,t){const r=`${e}${n}`;if(!t.has(r))return r;for(let o=1;o<1e3;o++){const i=`${e}-${o}${n}`;if(!t.has(i))return i}return`${e}-${Date.now()}${n}`}var pn={exports:{}},mg=pn.exports,ii;function gg(){return ii||(ii=1,(function(e,n){(function(t,r){r()})(mg,function(){function t(d,h){return typeof h>"u"?h={autoBom:!1}:typeof h!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),h={autoBom:!h}),h.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(d.type)?new Blob(["\uFEFF",d],{type:d.type}):d}function r(d,h,p){var x=new XMLHttpRequest;x.open("GET",d),x.responseType="blob",x.onload=function(){l(x.response,h,p)},x.onerror=function(){console.error("could not download file")},x.send()}function o(d){var h=new XMLHttpRequest;h.open("HEAD",d,!1);try{h.send()}catch{}return 200<=h.status&&299>=h.status}function i(d){try{d.dispatchEvent(new MouseEvent("click"))}catch{var h=document.createEvent("MouseEvents");h.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),d.dispatchEvent(h)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof nt=="object"&&nt.global===nt?nt:void 0,a=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(d,h,p){var x=s.URL||s.webkitURL,u=document.createElement("a");h=h||d.name||"download",u.download=h,u.rel="noopener",typeof d=="string"?(u.href=d,u.origin===location.origin?i(u):o(u.href)?r(d,h,p):i(u,u.target="_blank")):(u.href=x.createObjectURL(d),setTimeout(function(){x.revokeObjectURL(u.href)},4e4),setTimeout(function(){i(u)},0))}:"msSaveOrOpenBlob"in navigator?function(d,h,p){if(h=h||d.name||"download",typeof d!="string")navigator.msSaveOrOpenBlob(t(d,p),h);else if(o(d))r(d,h,p);else{var x=document.createElement("a");x.href=d,x.target="_blank",setTimeout(function(){i(x)})}}:function(d,h,p,x){if(x=x||open("","_blank"),x&&(x.document.title=x.document.body.innerText="downloading..."),typeof d=="string")return r(d,h,p);var u=d.type==="application/octet-stream",b=/constructor/i.test(s.HTMLElement)||s.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||u&&b||a)&&typeof FileReader<"u"){var m=new FileReader;m.onloadend=function(){var _=m.result;_=f?_:_.replace(/^data:[^;]*;/,"data:attachment/file;"),x?x.location.href=_:location=_,x=null},m.readAsDataURL(d)}else{var g=s.URL||s.webkitURL,w=g.createObjectURL(d);x?x.location=w:location.href=w,x=null,setTimeout(function(){g.revokeObjectURL(w)},4e4)}});s.saveAs=l.saveAs=l,e.exports=l})})(pn)),pn.exports}var si=gg();function xg(e,n,t){const r=new Map;for(let o=0;o<n.length;o++){const i=n[o],s=i.zone.toLowerCase();let a;if(i.metadata?.skillName)a=tt(i.metadata.skillName.replace(/\.md$/i,""));else{const h=Qa(i.content,i.type,o);a=tt(h)}const l=Ja(a,".md",t);t.add(l);const d=`references/${s}/${l}`;e.file(d,i.content),r.set(i._id,d)}return r}function ai(e,n){if(e.length>0){const t=e[0],r=t.metadata?.skillName||n,o=t.metadata?.skillDescription||"";return`---
name: "${r}"
description: "${o}"
---

${t.content}`}return`---
name: "${n}"
description: "Exported from ContextForge"
---

This skill was exported from a ContextForge session.`}function vg({sessionId:e,projectId:n}){const t=Se(ae.skillExport.getExportData,e?{sessionId:e}:"skip"),r=n??t?.session.projectId??null,o=Se(ae.skillExport.getProjectExportData,r?{projectId:r}:"skip"),[i,s]=k.useState(!1),a=!!r&&!!o,l=k.useCallback(async()=>{if(t){s(!0);try{const u=new wr,{session:b,blocks:f}=t,m=f.filter(S=>S.type==="skill"),g=f.filter(S=>S.type!=="skill");u.file("SKILL.md",ai(m,b.name||"Exported Skill")),xg(u,g,new Set);const _=await u.generateAsync({type:"blob"}),E=tt(m[0]?.metadata?.skillName||b.name||"skill-export");si.saveAs(_,`${E}.zip`)}finally{s(!1)}}},[t]),d=k.useCallback(async()=>{if(o){s(!0);try{const u=new wr,{project:b,steps:f}=o,m=[];for(const j of f)m.push(...j.blocks.filter(M=>M.type==="skill"));u.file("SKILL.md",ai(m,b.name||"Exported Project"));const g=new Map,w=new Set,_=[];for(const j of f){const M=j.blocks.filter(L=>L.type!=="skill"),I={permanent:[],stable:[],working:[]};for(let L=0;L<M.length;L++){const K=M[L],C=K.zone.toLowerCase(),D=g.get(K.content);if(D){I[C].push(D);continue}let y;if(K.metadata?.skillName)y=tt(K.metadata.skillName.replace(/\.md$/i,""));else{const H=Qa(K.content,K.type,L);y=tt(H)}const U=Ja(y,".md",w);w.add(U);const V=`references/${C}/${U}`;u.file(V,K.content),g.set(K.content,V),I[C].push(V)}_.push({stepName:j.session.name||`Step ${j.session.stepNumber+1}`,...I})}const E={contexts:{}};for(let j=0;j<_.length;j++){const M=_[j],I=tt(M.stepName)||`step-${j+1}`,L={label:M.stepName};M.permanent.length>0&&(L.permanent=M.permanent),M.stable.length>0&&(L.stable=M.stable),M.working.length>0&&(L.working=M.working),j>0&&(L.depends_on=[tt(_[j-1].stepName)||`step-${j}`]),E.contexts[I]=L}u.file("context-map.yaml",Va(E,{lineWidth:-1}));const S=await u.generateAsync({type:"blob"}),R=tt(b.name||"project-export");si.saveAs(S,`${R}.zip`)}finally{s(!1)}}},[o]),h=a?d:l,p=a?o?.steps.reduce((u,b)=>u+b.blocks.length,0)??0:t?.blocks.length??0,x=a?!!o&&o.steps.length>0:!!t&&t.blocks.length>0;return{exportAsZip:h,isExporting:i,isReady:x,isProject:a,blockCount:p,stepCount:o?.steps.length??0}}function bg({isOpen:e,onClose:n,sessionId:t,projectId:r}){const{exportAsZip:o,isExporting:i,isReady:s,isProject:a,blockCount:l,stepCount:d}=vg({sessionId:t,projectId:r}),h=async()=>{await o(),n()};return c.jsx(Nn,{children:e&&c.jsx(Fe.div,{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",initial:be.initial,animate:be.animate,exit:be.exit,transition:be.transition,children:c.jsxs(Fe.div,{className:"bg-card border border-border rounded-lg shadow-lg w-full max-w-md",initial:ye.initial,animate:ye.animate,exit:ye.exit,transition:ye.transition,onClick:p=>p.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(wl,{className:"w-5 h-5 text-amber-600"}),c.jsx("h2",{className:"text-lg font-semibold",children:a?"Export Project":"Export as Skill"})]}),c.jsx(de,{variant:"ghost",size:"sm",onClick:n,children:c.jsx(jn,{className:"w-4 h-4"})})]}),c.jsxs("div",{className:"p-4 space-y-3",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:a?"Export this project as a Claude Code-compatible skill package with context-map (.zip).":"Export this session as a Claude Code-compatible skill package (.zip)."}),c.jsxs("div",{className:"text-sm space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-muted-foreground",children:"Blocks:"}),c.jsx("span",{className:"font-medium",children:l})]}),a&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-muted-foreground",children:"Steps:"}),c.jsx("span",{className:"font-medium",children:d})]})]}),c.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/30 rounded p-2.5",children:["The ZIP will contain:",c.jsxs("ul",{className:"mt-1 ml-4 list-disc space-y-0.5",children:[c.jsx("li",{children:"SKILL.md  skill definition with frontmatter"}),c.jsx("li",{children:"references/permanent/  permanent zone blocks"}),c.jsx("li",{children:"references/stable/  stable zone blocks"}),c.jsx("li",{children:"references/working/  working zone blocks"}),a&&c.jsx("li",{children:"context-map.yaml  workflow step definitions"})]})]})]}),c.jsxs("div",{className:"p-4 flex justify-end gap-2 border-t border-border",children:[c.jsx(de,{variant:"outline",onClick:n,children:"Cancel"}),c.jsxs(de,{onClick:h,disabled:!s||i,children:[c.jsx(ki,{className:"w-4 h-4 mr-1"}),i?"Exporting...":"Download ZIP"]})]})]})})})}function yg({...e}){return c.jsx(sp,{"data-slot":"popover",...e})}function wg({...e}){return c.jsx(ap,{"data-slot":"popover-trigger",...e})}function kg({className:e,align:n="center",sideOffset:t=4,...r}){return c.jsx(lp,{children:c.jsx(cp,{"data-slot":"popover-content",align:n,sideOffset:t,className:pe("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...r})})}function _g({sessionId:e,zone:n,children:t}){const[r,o]=k.useState(!1),[i,s]=k.useState(""),[a,l]=k.useState(null),d=Se(ae.sessions.list),h=Se(ae.blocks.list,a?{sessionId:a}:"skip"),p=_e(ae.blocks.createLinked),x=d?.filter(m=>m._id!==e)??[],u=i?x.filter(m=>(m.name??"").toLowerCase().includes(i.toLowerCase())):x,b=h??[],f=async m=>{await p({sessionId:e,refBlockId:m,zone:n}),o(!1),l(null),s("")};return c.jsxs(yg,{open:r,onOpenChange:m=>{o(m),m||(l(null),s(""))},children:[c.jsx(wg,{asChild:!0,children:t}),c.jsx(kg,{className:"w-80 p-0",align:"start",children:a?c.jsxs("div",{className:"p-2 space-y-1",children:[c.jsx("button",{className:"text-xs text-muted-foreground hover:text-foreground mb-1",onClick:()=>{l(null),s("")},children:" Back to sessions"}),c.jsxs("div",{className:"max-h-60 overflow-y-auto space-y-0.5",children:[b.map(m=>{const g=bi(m.type),w=m.content.split(`
`)[0]?.slice(0,60)??"";return c.jsxs("button",{className:"w-full text-left px-2 py-1.5 rounded hover:bg-accent flex items-center gap-1.5",onClick:()=>f(m._id),children:[c.jsx("span",{className:pe("shrink-0 rounded px-1 py-0.5 text-[9px] font-medium",g.color),children:g.displayName}),c.jsx("span",{className:"text-xs truncate text-foreground",children:w||"(empty)"})]},m._id)}),b.length===0&&c.jsx("p",{className:"px-2 py-3 text-sm text-muted-foreground text-center",children:"No blocks in this session"})]})]}):c.jsxs("div",{className:"p-2 space-y-1",children:[c.jsx(kl,{placeholder:"Search sessions...",value:i,onChange:m=>s(m.target.value),className:"h-8 text-sm",autoFocus:!0}),c.jsxs("div",{className:"max-h-48 overflow-y-auto",children:[u.map(m=>c.jsx("button",{className:"w-full text-left px-2 py-1.5 text-sm rounded hover:bg-accent truncate",onClick:()=>l(m._id),children:m.name??"Untitled"},m._id)),u.length===0&&c.jsx("p",{className:"px-2 py-3 text-sm text-muted-foreground text-center",children:"No other sessions"})]})]})})]})}const $n={PERMANENT:{label:"Permanent",description:"Always included",tint:"bg-blue-500/[0.02] dark:bg-blue-400/[0.03] border-blue-500/10 dark:border-blue-400/10"},STABLE:{label:"Stable",description:"Reference material",tint:"bg-emerald-500/[0.02] dark:bg-emerald-400/[0.03] border-emerald-500/10 dark:border-emerald-400/10"},WORKING:{label:"Working",description:"Draft content",tint:"bg-amber-500/[0.02] dark:bg-amber-400/[0.03] border-amber-500/10 dark:border-amber-400/10"}};function Cg(e){return Math.ceil(e.length/4)}function Sg({sessionId:e}){const[n,t]=k.useState(""),[r,o]=k.useState("note"),[i,s]=k.useState("WORKING"),[a,l]=k.useState(!1),d=k.useMemo(()=>ml(),[]),h=_e(ae.blocks.create),p=Se(ae.metrics.getZoneMetrics,{sessionId:e}),x=k.useMemo(()=>n.trim()?Cg(n.trim()):0,[n]),u=k.useMemo(()=>{if(!p||!n.trim())return null;const f=p.zones[i];if(!f)return null;const m=f.tokens+x,g=Math.round(m/f.budget*100);return{percentUsed:g,wouldExceed:m>f.budget,isWarning:g>80&&g<=95,isDanger:g>95}},[p,i,x,n]),b=async f=>{f.preventDefault(),!(!n.trim()||u?.wouldExceed)&&(await h({sessionId:e,content:n.trim(),type:r,zone:i}),t(""),l(!1))};return a?c.jsxs("form",{onSubmit:b,className:"rounded border border-border bg-card p-3 space-y-2",children:[c.jsxs("div",{className:"flex gap-2",children:[c.jsx("select",{value:r,onChange:f=>{const m=f.target.value;o(m);const g=oo[m];g&&s(g.defaultZone)},className:"rounded border border-input bg-background px-2 py-1 text-xs flex-1",children:Object.entries(d).map(([f,m])=>c.jsx("optgroup",{label:gl[f],children:m.map(g=>c.jsx("option",{value:g,children:oo[g].displayName},g))},f))}),c.jsx("select",{value:i,onChange:f=>s(f.target.value),className:"rounded border border-input bg-background px-2 py-1 text-xs",children:Er.map(f=>c.jsx("option",{value:f,children:$n[f].label},f))})]}),c.jsx("textarea",{value:n,onChange:f=>t(f.target.value),placeholder:"Block content...",rows:2,className:pe("w-full rounded border bg-background px-2 py-1.5 text-sm resize-none",u?.wouldExceed?"border-destructive":"border-input"),autoFocus:!0}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("span",{className:"text-xs text-muted-foreground",children:[x>0&&`~${x} tokens`,u?.wouldExceed&&c.jsx("span",{className:"text-destructive ml-2",children:"Exceeds budget"})]}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx(de,{type:"button",variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>l(!1),children:"Cancel"}),c.jsx(ft,{type:"submit",size:"sm",className:"h-6 px-2 text-xs",disabled:!n.trim()||u?.wouldExceed,debounceMs:300,children:"Add"})]})]})]}):c.jsx(de,{variant:"outline",size:"sm",onClick:()=>l(!0),className:"h-7 text-xs",children:"+ Add Block"})}function Eg({sessionId:e}){const[n,t]=k.useState(!1);return c.jsxs("div",{children:[c.jsxs(de,{variant:"ghost",size:"sm",onClick:()=>t(!n),className:"h-7 px-2 text-xs text-muted-foreground",children:[n?"":""," Tools"]}),n&&c.jsx("div",{className:"mt-2 space-y-3",children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[c.jsx(oa,{sessionId:e}),c.jsx(Rp,{sessionId:e})]})})]})}function Ag(e){const n=Math.floor((Date.now()-e)/1e3);return n<60?"now":n<3600?`${Math.floor(n/60)}m`:n<86400?`${Math.floor(n/3600)}h`:`${Math.floor(n/86400)}d`}function Ng({id:e,content:n,type:t,zone:r,createdAt:o,tokens:i,isDraft:s,isCompressed:a,compressionRatio:l,sessionId:d,isSelected:h,onSelect:p,metadata:x,refBlockId:u,contentHash:b}){const[f,m]=k.useState(!1),[g,w]=k.useState(!1),_=_e(ae.blocks.remove),E=_e(ae.blocks.move),S=_e(ae.blocks.toggleDraft),R=_e(ae.blocks.unlink),j=_e(ae.blocks.createLinked),{toast:M}=kr(),I=Se(ae.blocks.findDuplicate,b&&!u?{contentHash:b,excludeSessionId:d}:"skip"),L=Lp({onDelete:async()=>{await _({id:e})},getTitle:()=>"Delete this block?",getDescription:()=>`"${n.slice(0,100)}${n.length>100?"...":""}" will be permanently deleted.`}),{compressSingle:K,isCompressing:C}=Vr({sessionId:d,onSuccess:T=>{M.success("Block compressed!",`Saved ${T.tokensSaved} tokens (${T.compressionRatio.toFixed(1)}x)`)},onError:T=>{M.error("Compression failed",T)}}),D=async T=>{T.stopPropagation(),L.requestDelete({id:e,content:n})},y=async(T,te)=>{T.stopPropagation(),await E({id:e,zone:te})},U=async T=>{if(T.stopPropagation(),navigator.clipboard)await navigator.clipboard.writeText(n);else{const te=document.createElement("textarea");te.value=n,te.style.position="fixed",te.style.left="-999999px",te.style.top="-999999px",document.body.appendChild(te),te.focus(),te.select();try{document.execCommand("copy")}finally{document.body.removeChild(te)}}w(!0),setTimeout(()=>w(!1),1500)},V=async T=>{T.stopPropagation(),await K({_id:e,content:n,type:t,tokens:i,isCompressed:a},"semantic")},H=async T=>{T.stopPropagation(),await S({id:e})},X=bi(t),B=Er.filter(T=>T!==r),Z=(i??0)>=100,P=T=>{T.stopPropagation(),p?.(T.target.checked)};return c.jsxs("div",{className:pe("rounded-lg border bg-card p-2.5 select-none transition-all duration-150","hover:shadow-sm hover:border-border/80",h?"border-primary bg-primary/5 shadow-sm":"border-border",s&&"opacity-50",u?"border-l-2 border-l-[oklch(0.65_0.08_220)]":""),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[c.jsxs("div",{className:"flex items-center justify-between gap-1 mb-1",children:[c.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[p&&c.jsx("input",{type:"checkbox",checked:h,onChange:P,className:"shrink-0 w-3 h-3 rounded border-input",onClick:T=>T.stopPropagation()}),c.jsx("span",{className:pe("shrink-0 rounded px-1.5 py-0.5 text-[10px] font-medium",X.color),children:X.displayName}),s&&c.jsx("span",{className:"shrink-0 rounded px-1.5 py-0.5 text-[10px] font-medium bg-yellow-500/10 text-yellow-600 dark:text-yellow-400",children:"Draft"}),c.jsx("span",{className:"text-[10px] text-muted-foreground",children:Ag(o)}),i!=null&&c.jsxs("span",{className:"text-[10px] text-muted-foreground font-mono",children:[i,"t"]}),a&&l&&c.jsxs("span",{className:"shrink-0 rounded px-1.5 py-0.5 text-[10px] font-medium bg-blue-500/10 text-blue-600 dark:text-blue-400 flex items-center gap-0.5",children:[c.jsx(Rn,{className:"w-2.5 h-2.5"}),l.toFixed(1),"x"]}),u&&c.jsx("span",{title:"Linked block  used in multiple sessions",className:"inline-flex items-center",children:c.jsx(sr,{className:"w-2.5 h-2.5 text-muted-foreground"})})]}),f&&c.jsxs("div",{className:"flex gap-0.5 shrink-0",children:[Z&&c.jsx(ft,{onClick:V,disabled:C,variant:"ghost",size:"sm",className:"h-auto px-1.5 py-0.5 text-[10px]",debounceMs:300,children:C?"...":"Compress"}),c.jsx("button",{onClick:H,className:"px-1.5 py-0.5 text-[10px] rounded hover:bg-muted",children:s?"Undraft":"Draft"}),c.jsx("button",{onClick:U,className:pe("px-1.5 py-0.5 text-[10px] rounded transition-colors",g&&"bg-emerald-300/20 text-emerald-600 dark:text-emerald-400"),children:g?"Copied!":"Copy"}),c.jsx(ui,{to:"/app/blocks/$blockId",params:{blockId:e},onClick:T=>T.stopPropagation(),className:"px-1.5 py-0.5 text-[10px] rounded hover:bg-muted",children:"Edit"}),u&&c.jsx(ft,{variant:"ghost",size:"sm",className:"h-5 px-1 text-[10px]",onClick:()=>R({id:e}),title:"Unlink  make independent copy",children:c.jsx(jl,{className:"w-3 h-3"})}),c.jsx("button",{onClick:D,className:"px-1.5 py-0.5 text-[10px] rounded hover:bg-destructive/10 text-destructive",children:"Del"})]})]}),t==="skill"&&x?.skillName&&c.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[c.jsx("span",{className:"text-xs font-medium truncate",children:x.skillName}),x.sourceType==="local"&&c.jsx(vi,{className:"w-3 h-3 text-muted-foreground shrink-0"}),x.sourceType==="upload"&&c.jsx(gi,{className:"w-3 h-3 text-muted-foreground shrink-0"}),x.sourceType==="url"&&c.jsx(xi,{className:"w-3 h-3 text-muted-foreground shrink-0"})]}),t==="skill"&&x?.skillDescription&&c.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-1 mb-0.5",children:x.skillDescription}),t==="reference"&&x?.parentSkillName&&c.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[c.jsx(Sr,{className:"w-2.5 h-2.5 text-muted-foreground shrink-0"}),c.jsxs("span",{className:"text-[10px] text-muted-foreground truncate",children:["from: ",x.parentSkillName]})]}),c.jsx("p",{className:"text-xs text-foreground whitespace-pre-wrap break-words line-clamp-2 leading-tight",children:n}),f&&c.jsx("div",{className:"flex gap-1 mt-1",children:B.map(T=>c.jsxs("button",{onClick:te=>y(te,T),className:"px-1.5 py-0.5 text-[10px] rounded border border-input hover:bg-muted",children:[" ",$n[T].label]},T))}),I&&!u&&c.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-accent/50 text-[10px] text-muted-foreground mt-1",children:[c.jsx(sr,{className:"w-3 h-3 shrink-0"}),c.jsxs("span",{className:"truncate",children:["Same as block in ",I.sessionName,"."]}),c.jsx("button",{className:"text-primary hover:underline font-medium shrink-0",onClick:async()=>{await j({sessionId:d,refBlockId:I.blockId,zone:r}),await _({id:e})},children:"Link?"})]}),c.jsx(di,{open:L.isOpen,onOpenChange:T=>!T&&L.cancelDelete(),title:L.title,description:L.description,onConfirm:L.confirmDelete,loading:L.isDeleting})]})}function jg({sessionId:e,zone:n,zoneMetrics:t,selectedBlockIds:r,onBlockSelect:o,onSkillFile:i}){const[s,a]=k.useState(!1),l=Se(ae.blocks.listByZone,{sessionId:e,zone:n}),d=$n[n],{toast:h}=kr(),{isDragOver:p,dropProps:x}=Ml({sessionId:e,zone:n,onSkillFile:i,onSuccess:()=>{},onError:()=>{}}),{compressAndMerge:u,isCompressing:b,result:f,error:m}=Vr({sessionId:e,onSuccess:C=>{h.success(`${d.label} zone compressed!`,`Merged ${l?.length} blocks, saved ${C.tokensSaved} tokens`)},onError:C=>{h.error("Zone compression failed",C)}}),g=()=>{a(!0)},w=async(C,D)=>{!l||l.length===0||await u(l.map(y=>({_id:y._id,content:y.content,type:y.type,tokens:y.tokens??void 0,isCompressed:y.isCompressed})),{strategy:"semantic",targetZone:n,targetType:D})},_=l?[...l].sort((C,D)=>C.position-D.position):[],{optimisticOrder:E,activeBlock:S}=hl(),R=E[n],j=k.useMemo(()=>new Map(_.map(C=>[C._id,C])),[_]),M=k.useMemo(()=>R?R.map(C=>{const D=j.get(C);return D||(S&&S._id===C?{_id:S._id,content:S.content,type:S.type,zone:n,position:S.position,createdAt:S.createdAt,tokens:S.tokens??null,isCompressed:S.isCompressed??!1,compressionRatio:S.compressionRatio??null,metadata:S.metadata??null,sessionId:e,_creationTime:S.createdAt}:null)}).filter(Boolean):_,[R,_,j,S,e,n]),I=k.useMemo(()=>M.map(C=>C._id),[M]),L=t&&t.percentUsed>95,K=t&&t.percentUsed>80&&t.percentUsed<=95;return c.jsxs("div",{className:"flex flex-col h-full relative",...x,children:[c.jsxs("div",{className:"mb-2",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("div",{className:"flex-1 min-w-0",children:t?c.jsx(mr,{zone:d.label,blockCount:t.blocks,tokens:t.tokens,budget:t.budget,onCompress:g,isCompressing:b}):c.jsx(wn,{})}),c.jsx(_g,{sessionId:e,zone:n,children:c.jsx("button",{className:"w-5 h-5 rounded border border-dashed border-border hover:border-foreground/30 flex items-center justify-center transition-colors shrink-0",title:"Link a block from another session",children:c.jsx(sr,{className:"w-3 h-3 text-muted-foreground"})})})]}),L&&c.jsxs("div",{className:"mt-1 p-1 rounded bg-destructive/10 text-destructive text-[10px]",children:[t?.percentUsed,"% - consider archiving"]}),K&&c.jsxs("div",{className:"mt-1 p-1 rounded bg-yellow-500/10 text-yellow-600 dark:text-yellow-400 text-[10px]",children:[t?.percentUsed,"% used"]})]}),c.jsx(Ol,{zone:n,itemIds:I,children:c.jsx("div",{className:"flex-1 space-y-1.5 min-h-[60px] overflow-y-auto",children:l===void 0?c.jsx("div",{className:"space-y-1.5",children:[0,1].map(C=>c.jsxs("div",{className:"rounded-lg border border-border bg-card p-2.5",children:[c.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[c.jsx(ge,{className:"h-4 w-14 rounded"}),c.jsx(ge,{className:"h-3 w-10"}),c.jsx(ge,{className:"h-3 w-8"})]}),c.jsx(ge,{className:"h-3 w-full mb-1"}),c.jsx(ge,{className:"h-3 w-3/4"})]},C))}):M.length===0?c.jsx("div",{className:"text-xs text-muted-foreground text-center py-4 border border-dashed border-border rounded",children:"Drop here"}):M.map(C=>c.jsx(Rl,{id:C._id,zone:C.zone,position:C.position,children:c.jsx(Ng,{id:C._id,content:C.content,type:C.type,zone:C.zone,createdAt:C.createdAt,tokens:C.tokens??void 0,isDraft:C.isDraft,isCompressed:C.isCompressed,compressionRatio:C.compressionRatio,sessionId:e,isSelected:r.has(C._id),onSelect:D=>o(C._id,D),metadata:C.metadata??void 0,refBlockId:C.refBlockId,contentHash:C.contentHash})},C._id))})}),p&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-primary/10 border-2 border-dashed border-primary rounded z-10 pointer-events-none",children:c.jsx("div",{className:"text-xs font-medium text-primary",children:"Drop file"})}),l&&c.jsx(ia,{isOpen:s,onClose:()=>a(!1),blocks:l.map(C=>({_id:C._id,content:C.content,type:C.type,tokens:C.tokens??void 0,isCompressed:C.isCompressed})),onCompress:w,isCompressing:b,result:f,error:m})]})}function Rg({sessionId:e,selectedBlockIds:n,onBlockSelect:t,onSkillFile:r}){const o=Se(ae.metrics.getZoneMetrics,{sessionId:e});return c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 flex-1 min-h-0",children:Er.map(i=>c.jsx("div",{className:pe("rounded-lg border p-2 flex flex-col min-h-0 overflow-hidden",$n[i].tint),children:c.jsx(jg,{sessionId:e,zone:i,zoneMetrics:o?.zones[i],selectedBlockIds:n,onBlockSelect:t,onSkillFile:r})},i))})}function Og(){const{createSession:e}=Cr();return c.jsxs("div",{className:"text-center py-12",children:[c.jsx("h2",{className:"text-lg font-semibold mb-2",children:"No Session Selected"}),c.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create a session to start."}),c.jsx(de,{onClick:()=>e("My First Session"),children:"Create Session"})]})}function Tg({sessionId:e}){const n=ll(),{switchSession:t}=Cr(),r=Se(ae.sessions.getWorkflowContext,{sessionId:e}),o=_e(ae.sessions.goToNextStep),[i,s]=k.useState(!1);if(!r)return null;const a=async()=>{s(!0);try{const l=await o({sessionId:e});localStorage.setItem("contextforge-session-id",l.sessionId),t(l.sessionId),n({to:"/app"})}finally{s(!1)}};return c.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 rounded-md bg-muted/50 border border-border text-xs",children:[c.jsx(ui,{to:"/app/projects/$projectId",params:{projectId:r.projectId},className:"text-muted-foreground hover:text-foreground",children:r.workflowName}),c.jsx("span",{className:"text-muted-foreground",children:""}),c.jsxs("span",{className:"font-medium",children:["Step ",r.currentStepIndex+1,"/",r.totalSteps]}),c.jsx("span",{className:"text-muted-foreground",children:""}),c.jsx("span",{children:r.currentStepName}),r.hasNextStep&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-muted-foreground",children:""}),c.jsx(de,{variant:"ghost",size:"sm",onClick:a,disabled:i,className:"h-5 px-2 text-xs",children:i?"...":`Next: ${r.nextStepName} `})]}),!r.hasNextStep&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-muted-foreground",children:""}),c.jsx("span",{className:"text-green-600 dark:text-green-400",children:" Final step"})]})]})}function Kg(){const{sessionId:e,isLoading:n}=Cr(),[t,r]=k.useState(new Set),[o,i]=k.useState(!1),[s,a]=k.useState(!1),[l,d]=k.useState(!1),{toast:h}=kr(),{importFromFile:p,isImporting:x,pendingProjectImport:u,confirmProjectImport:b,cancelProjectImport:f}=qa({sessionId:e,onSuccess:(K,C)=>{const D=C?` (+ ${C} reference${C!==1?"s":""})`:"";h.success("Skill imported",`${K}${D}`)},onError:K=>h.error("Skill import failed",K)}),m=k.useCallback((K,C)=>{p(K,C)},[p]),g=Se(ae.blocks.list,e?{sessionId:e}:"skip"),{compressAndMerge:w,isCompressing:_,result:E,error:S}=Vr({sessionId:e,onSuccess:K=>{r(new Set),h.success("Compression successful!",`Saved ${K.tokensSaved} tokens (${K.compressionRatio.toFixed(1)}x compression)`)},onError:K=>{h.error("Compression failed",K)}}),R=g?g.filter(K=>t.has(K._id)):[],j=(K,C)=>{r(D=>{const y=new Set(D);return C?y.add(K):y.delete(K),y})},M=()=>{r(new Set)},I=()=>{i(!0)},L=async(K,C)=>{await w(R,{strategy:"semantic",targetZone:K,targetType:C})};return n?c.jsxs("div",{className:"flex flex-col gap-3 h-[calc(100vh-120px)]",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ge,{className:"h-5 w-24"}),c.jsx(ge,{className:"h-1.5 w-12 rounded-full"}),c.jsx(ge,{className:"h-5 w-10"}),c.jsx(ge,{className:"h-7 w-20 rounded-md"})]}),c.jsx("div",{className:"grid grid-cols-3 gap-3 flex-1 min-h-0",children:[0,1,2].map(K=>c.jsxs("div",{className:"flex flex-col h-full",children:[c.jsx("div",{className:"mb-2",children:c.jsx(wn,{})}),c.jsx("div",{className:"flex-1 space-y-1.5",children:[0,1].map(C=>c.jsxs("div",{className:"rounded-lg border border-border bg-card p-2.5",children:[c.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[c.jsx(ge,{className:"h-4 w-14 rounded"}),c.jsx(ge,{className:"h-3 w-10"}),c.jsx(ge,{className:"h-3 w-8"})]}),c.jsx(ge,{className:"h-3 w-full mb-1"}),c.jsx(ge,{className:"h-3 w-3/4"})]},C))})]},K))})]}):e?c.jsxs("div",{className:"flex flex-col gap-3 h-[calc(100vh-120px)]",children:[c.jsx(Tg,{sessionId:e}),c.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(oa,{sessionId:e,collapsed:!0}),c.jsx(Sg,{sessionId:e}),c.jsxs(de,{variant:"outline",size:"sm",onClick:()=>a(!0),className:"h-7 text-xs",children:[c.jsx(Sr,{className:"w-3 h-3 mr-1"}),"Import Skill"]}),c.jsxs(de,{variant:"outline",size:"sm",onClick:()=>d(!0),className:"h-7 text-xs",children:[c.jsx(ki,{className:"w-3 h-3 mr-1"}),"Export Skill"]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Np,{sessionId:e,compact:!0}),c.jsx(Eg,{sessionId:e})]})]}),c.jsx(Rg,{sessionId:e,selectedBlockIds:t,onBlockSelect:j,onSkillFile:m}),t.size>0&&c.jsxs("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 bg-card border border-border rounded-xl shadow-xl shadow-black/5 dark:shadow-black/20 p-3 flex items-center gap-3 z-40 backdrop-blur-sm",children:[c.jsxs("span",{className:"text-sm font-medium",children:[t.size," block",t.size>1?"s":""," selected"]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(de,{variant:"ghost",size:"sm",onClick:M,children:"Clear"}),c.jsxs(de,{size:"sm",onClick:I,disabled:t.size<2,children:[c.jsx(Rn,{className:"w-4 h-4 mr-1"}),"Compress & Merge"]})]})]}),c.jsx(ia,{isOpen:o,onClose:()=>i(!1),blocks:R,onCompress:L,isCompressing:_,result:E,error:S}),e&&c.jsx(pg,{isOpen:s,onClose:()=>a(!1),sessionId:e}),e&&c.jsx(bg,{isOpen:l,onClose:()=>d(!1),sessionId:e}),u&&c.jsx(Xa,{pending:u,onConfirm:b,onCancel:f,isImporting:x})]}):c.jsx(Og,{})}export{Kg as component};
