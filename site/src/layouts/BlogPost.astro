---
import Base from "./Base.astro"
import Header from "../components/Header.astro"
import Footer from "../components/Footer.astro"

interface Props {
  title: string
  description: string
  publishedAt: Date
  updatedAt?: Date
  author: string
  tags: string[]
  ogImage?: string
}

const { title, description, publishedAt, updatedAt, author, tags, ogImage } = Astro.props

const formattedDate = publishedAt.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
})
---

<Base
  title={title}
  description={description}
  ogImage={ogImage}
  ogType="article"
  publishedAt={publishedAt}
  updatedAt={updatedAt}
>
  <div class="min-h-screen bg-background text-foreground flex flex-col">
    <Header />
    <main class="flex-1 mx-auto max-w-3xl px-6 sm:px-8 py-14 sm:py-20">
      <article>
        <header class="mb-10">
          <div class="flex flex-wrap gap-2 mb-4">
            {tags.map((tag) => (
              <span class="inline-block px-2 py-0.5 rounded-md text-xs font-medium bg-secondary text-secondary-foreground">
                {tag}
              </span>
            ))}
          </div>
          <h1 class="text-3xl sm:text-4xl font-bold tracking-tight mb-4">{title}</h1>
          <div class="flex items-center gap-3 text-sm text-muted-foreground">
            <span>{author}</span>
            <span>&middot;</span>
            <time datetime={publishedAt.toISOString()}>{formattedDate}</time>
          </div>
        </header>

        <div class="prose prose-neutral dark:prose-invert max-w-none prose-headings:font-semibold prose-a:text-primary prose-a:underline prose-a:underline-offset-2">
          <slot />
        </div>
      </article>

      <nav class="mt-14 pt-8 border-t border-border/50">
        <a href="/blog" class="text-sm text-muted-foreground hover:text-foreground transition-colors">
          &larr; Back to all posts
        </a>
      </nav>
    </main>
    <Footer />
  </div>

  <!-- JSON-LD BlogPosting -->
  <script is:inline define:vars={{ title, description, formattedDate, author }}>
    const script = document.createElement("script")
    script.type = "application/ld+json"
    script.textContent = JSON.stringify({
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      headline: title,
      description: description,
      datePublished: formattedDate,
      author: { "@type": "Person", name: author },
      publisher: { "@type": "Organization", name: "ContextForge" },
    })
    document.head.appendChild(script)
  </script>
</Base>
