import{a as F,R as A,r as a,d as B,f as H,L as R,j as e,e as O,c as D,g as I,A as E,m as T,h as v,i as y,s as z,O as W,k as G,b as V,l as q,u as K}from"./index-lxgQ_mJ1.js";import{a as k}from"./api-CRlO8hFs.js";import{B as N}from"./button-NEfGHqYM.js";import{C as Q,D as J}from"./confirm-dialog-BwJeYPZ2.js";import{S as X,u as Y}from"./SessionContext-BuMPhUm7.js";import{D as Z}from"./debounced-button-DXneJHO6.js";import{A as ee}from"./anvil-DJ7WBMuO.js";import{S as te,M as se}from"./sun-Bb8keKg3.js";function ne({children:t}){const{isLoading:s,isAuthenticated:i}=F();return s||!i?null:A.createElement(A.Fragment,null,t)}function ae({children:t}){const{isLoading:s,isAuthenticated:i}=F();return s||i?null:A.createElement(A.Fragment,null,t)}function re({children:t}){const{isLoading:s}=F();return s?A.createElement(A.Fragment,null,t):null}const oe=t=>!t.isLayoutDirty&&t.willUpdate(!1);function M(){const t=new Set,s=new WeakMap,i=()=>t.forEach(oe);return{add:r=>{t.add(r),s.set(r,r.addEventListener("willUpdate",i))},remove:r=>{t.delete(r);const o=s.get(r);o&&(o(),s.delete(r)),i()},dirty:i}}const ie=a.createContext(null);function le(){const t=a.useRef(!1);return B(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function ce(){const t=le(),[s,i]=a.useState(0),r=a.useCallback(()=>{t.current&&i(s+1)},[s]);return[a.useCallback(()=>H.postRender(r),[r]),s]}const $=t=>t===!0,de=t=>$(t===!0)||t==="id",me=({children:t,id:s,inherit:i=!0})=>{const r=a.useContext(R),o=a.useContext(ie),[u,p]=ce(),m=a.useRef(null),l=r.id||o;m.current===null&&(de(i)&&l&&(s=s?l+"-"+s:l),m.current={id:s,group:$(i)&&r.group||M()});const x=a.useMemo(()=>({...m.current,forceRender:u}),[p]);return e.jsx(R.Provider,{value:x,children:t})};const ue=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],xe=O("chevron-down",ue);const pe=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],he=O("trash-2",pe);function ge({isOpen:t,onClose:s,sessionId:i,onSuccess:r}){const[o,u]=a.useState(""),[p,m]=a.useState(""),[l,x]=a.useState("new"),[f,g]=a.useState(!1),[h,w]=a.useState(null),b=D(k.templates.list),S=I(k.templates.createFromSession),j=async d=>{if(d.preventDefault(),!!o.trim()){g(!0),w(null);try{const C=await S({sessionId:i,name:o.trim(),description:p.trim()||void 0,overwriteTemplateId:l==="new"?void 0:l});r?.(C),c()}catch(C){w(C instanceof Error?C.message:"Failed to save template")}finally{g(!1)}}},c=()=>{u(""),m(""),x("new"),w(null),s()},n=d=>{if(d==="new")x("new"),u(""),m("");else{const C=d;x(C);const P=b?.find(U=>U._id===C);P&&(u(P.name),m(P.description??""))}};return e.jsx(E,{children:t&&e.jsx(T.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",initial:v.initial,animate:v.animate,exit:v.exit,transition:v.transition,children:e.jsxs(T.div,{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-md p-6 mt-auto",initial:y.initial,animate:y.animate,exit:y.exit,transition:y.transition,onClick:d=>d.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Save as Template"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create a new template or overwrite an existing one with the current session's blocks."}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"template-select",className:"block text-sm font-medium mb-1",children:"Save To"}),e.jsxs("select",{id:"template-select",value:l,onChange:d=>n(d.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"new",children:"Create new template"}),b&&b.length>0&&e.jsx("optgroup",{label:"Overwrite existing",children:b.map(d=>e.jsx("option",{value:d._id,children:d.name},d._id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"template-name",className:"block text-sm font-medium mb-1",children:"Template Name *"}),e.jsx("input",{id:"template-name",type:"text",value:o,onChange:d=>u(d.target.value),placeholder:"e.g., Persona Generation Setup",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"template-description",className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{id:"template-description",value:p,onChange:d=>m(d.target.value),placeholder:"What is this template for?",rows:3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none"})]}),l!=="new"&&e.jsx("div",{className:"p-3 rounded-md bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-300 dark:border-yellow-700 text-yellow-800 dark:text-yellow-200 text-sm",children:"This will overwrite the existing template's blocks."}),h&&e.jsx("div",{className:"p-3 rounded-md bg-destructive/10 border border-destructive text-destructive text-sm",children:h}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:c,children:"Cancel"}),e.jsx(Z,{type:"submit",disabled:!o.trim()||f,debounceMs:500,children:f?"Saving...":l==="new"?"Save Template":"Overwrite Template"})]})]})]})})})}function fe({isOpen:t,onClose:s,sessionId:i,onSuccess:r}){const[o,u]=a.useState(null),[p,m]=a.useState(!0),[l,x]=a.useState(!1),[f,g]=a.useState(null),h=D(k.templates.list),w=I(k.templates.applyToSession),b=async c=>{if(c.preventDefault(),!!o){x(!0),g(null);try{await w({templateId:o,sessionId:i,clearExisting:p}),r?.(),S()}catch(n){g(n instanceof Error?n.message:"Failed to apply template")}finally{x(!1)}}},S=()=>{u(null),m(!0),g(null),s()},j=h?.find(c=>c._id===o);return e.jsx(E,{children:t&&e.jsx(T.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",initial:v.initial,animate:v.animate,exit:v.exit,transition:v.transition,children:e.jsxs(T.div,{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-lg p-6 mt-auto",initial:y.initial,animate:y.animate,exit:y.exit,transition:y.transition,onClick:c=>c.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Apply Template"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Load a template's blocks and system prompt into the current session."}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"template-select",className:"block text-sm font-medium mb-1",children:"Select Template"}),h===void 0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading templates..."}):h.length===0?e.jsx("div",{className:"text-sm text-muted-foreground p-4 border border-dashed border-border rounded-md text-center",children:"No templates yet. Save your current session as a template first."}):e.jsxs("select",{id:"template-select",value:o??"",onChange:c=>u(c.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Choose a template..."}),h.map(c=>e.jsxs("option",{value:c._id,children:[c.name," (",c.blocks.length," blocks)"]},c._id))]})]}),j&&e.jsxs("div",{className:"p-3 rounded-md bg-muted/50 border border-border",children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:j.name}),j.description&&e.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:j.description}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[j.blocks.length," blocks",j.systemPrompt&&" â€¢ Has system prompt"]}),e.jsx("div",{className:"mt-2 flex gap-2 flex-wrap",children:["PERMANENT","STABLE","WORKING"].map(c=>{const n=j.blocks.filter(d=>d.zone===c).length;return n===0?null:e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary",children:[c,": ",n]},c)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"clear-existing",checked:p,onChange:c=>m(c.target.checked),className:"rounded border-input"}),e.jsx("label",{htmlFor:"clear-existing",className:"text-sm",children:"Clear existing blocks (recommended)"})]}),!p&&e.jsx("div",{className:"p-2 rounded-md bg-yellow-50 dark:bg-yellow-950/30 border border-yellow-200 dark:border-yellow-800 text-yellow-700 dark:text-yellow-400 text-xs",children:"Template blocks will be added to existing content. This may cause duplicates."}),f&&e.jsx("div",{className:"p-3 rounded-md bg-destructive/10 border border-destructive text-destructive text-sm",children:f}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:S,children:"Cancel"}),e.jsx(N,{type:"submit",disabled:!o||l||h?.length===0,children:l?"Applying...":"Apply Template"})]})]})]})})})}function be({isOpen:t,onClose:s,sessionId:i,onSuccess:r}){const[o,u]=a.useState(""),[p,m]=a.useState(!1),[l,x]=a.useState(!1),[f,g]=a.useState(""),h=D(k.projects.list),w=D(k.sessions.get,{id:i}),b=I(k.projects.addSession),S=I(k.projects.create),j=async n=>{if(n.preventDefault(),!(!o&&!l)){m(!0);try{let d=o;l&&f.trim()&&(d=await S({name:f.trim()})),await b({projectId:d,sessionId:i}),u(""),g(""),x(!1),r?.(),s()}finally{m(!1)}}},c=w?.projectId;return e.jsx(E,{children:t&&e.jsx(T.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",initial:v.initial,animate:v.animate,exit:v.exit,transition:v.transition,children:e.jsxs(T.div,{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-md p-6 mt-auto",initial:y.initial,animate:y.animate,exit:y.exit,transition:y.transition,onClick:n=>n.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Add Session to Project"}),c&&e.jsx("div",{className:"mb-4 p-3 rounded-md bg-muted",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"This session is currently in a project. Adding it to another project will move it."})}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[l?e.jsxs("div",{children:[e.jsx("label",{htmlFor:"new-project-name",className:"block text-sm font-medium mb-1",children:"New Project Name"}),e.jsx("input",{id:"new-project-name",type:"text",value:f,onChange:n=>g(n.target.value),placeholder:"My New Project",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",autoFocus:!0}),e.jsx(N,{type:"button",variant:"link",className:"mt-2 p-0 h-auto text-sm",onClick:()=>x(!1),children:"Back to project list"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"project-select",className:"block text-sm font-medium mb-1",children:"Select Project"}),e.jsxs("select",{id:"project-select",value:o,onChange:n=>u(n.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Choose a project..."}),h?.map(n=>e.jsxs("option",{value:n._id,disabled:n._id===c,children:[n.name," (",n.sessionCount," sessions)",n._id===c?" (current)":""]},n._id))]})]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"or"})}),e.jsx(N,{type:"button",variant:"outline",className:"w-full",onClick:()=>x(!0),children:"+ Create New Project"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:s,children:"Cancel"}),e.jsx(N,{type:"submit",disabled:p||!l&&!o||l&&!f.trim(),children:p?"Adding...":"Add to Project"})]})]})]})})})}function je({sessions:t,currentSessionId:s,onSelectSession:i,onCreateSession:r,onSessionDeleted:o,isLoading:u}){const[p,m]=a.useState(!1),[l,x]=a.useState(null),[f,g]=a.useState(!1),h=a.useRef(null),w=I(k.sessions.remove);a.useEffect(()=>{function n(d){h.current&&!h.current.contains(d.target)&&m(!1)}return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const S=t.find(n=>n._id===s)?.name??(s?`Session ${s.slice(-6)}`:"Select session..."),j=async()=>{if(l){g(!0);try{const n=l._id;await w({id:n});const d=t.filter(C=>C._id!==n);o(n,d),x(null)}finally{g(!1)}}},c=l?.name??(l?`Session ${l._id.slice(-6)}`:"");return e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("button",{onClick:()=>m(!p),disabled:u,className:"flex items-center gap-2 rounded-md border border-input bg-background px-3 py-1.5 text-sm hover:bg-accent transition-colors",children:[e.jsx("span",{className:"max-w-[200px] truncate",children:S}),e.jsx(xe,{className:`h-3.5 w-3.5 opacity-50 transition-transform ${p?"rotate-180":""}`})]}),p&&e.jsxs("div",{className:"absolute top-full left-0 mt-1.5 w-72 rounded-lg border border-border bg-background shadow-lg z-50",children:[e.jsx("div",{className:"max-h-60 overflow-y-auto p-1.5",children:t.length===0?e.jsx("div",{className:"px-3 py-2.5 text-sm text-muted-foreground",children:"No sessions yet"}):t.map(n=>e.jsxs("div",{className:`flex items-center justify-between px-3 py-2 rounded-md hover:bg-accent group ${n._id===s?"bg-accent/50":""}`,children:[e.jsx("button",{onClick:()=>{i(n._id),m(!1)},className:"flex-1 text-left text-sm truncate pr-2",children:n.name??`Session ${n._id.slice(-6)}`}),e.jsx("button",{onClick:d=>{d.stopPropagation(),x(n)},className:"p-1 rounded opacity-0 group-hover:opacity-100 hover:bg-destructive/10 hover:text-destructive transition-opacity shrink-0",title:"Delete session",children:e.jsx(he,{className:"h-3.5 w-3.5"})})]},n._id))}),e.jsx("div",{className:"border-t border-border p-1.5",children:e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>{r(),m(!1)},className:"w-full justify-start text-xs",children:"+ New Session"})})]}),e.jsx(Q,{open:l!==null,onOpenChange:n=>!n&&x(null),title:"Delete this session?",description:`"${c}" and all its blocks will be permanently deleted.`,onConfirm:j,loading:f})]})}function ve(){const[t,s]=a.useState(()=>document.documentElement.classList.contains("dark"));return a.useEffect(()=>{t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[t]),{isDark:t,toggle:()=>s(!t)}}function ye(){const{signOut:t}=K(),[s,i]=a.useState(!1),r=async()=>{i(!0);try{await t()}finally{i(!1)}};return e.jsx(N,{variant:"outline",size:"sm",onClick:r,disabled:s,children:s?"Signing out...":"Sign Out"})}function Ne(){const t=V();return a.useEffect(()=>{t({to:"/login",replace:!0})},[t]),null}function we(){const{sessionId:t,switchSession:s,createSession:i,clearSession:r,isLoading:o}=Y(),u=D(k.sessions.list),[p,m]=a.useState(!1),[l,x]=a.useState(!1),[f,g]=a.useState(!1),h=async()=>{const b=`Session ${(u?.length??0)+1}`;await i(b)},w=(b,S)=>{b===t&&(S.length>0?s(S[0]._id):r())};return o||u===void 0?e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading..."}):e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(je,{sessions:u,currentSessionId:t,onSelectSession:s,onCreateSession:h,onSessionDeleted:w,isLoading:o}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-5 bg-border mx-1"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>m(!0),title:"Save current session as a reusable template",className:"text-xs h-7 px-2",children:"Save"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>x(!0),title:"Apply a template to this session",className:"text-xs h-7 px-2",children:"Apply"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>g(!0),title:"Add this session to a project",className:"text-xs h-7 px-2",children:"+ Project"}),e.jsx(ge,{isOpen:p,onClose:()=>m(!1),sessionId:t,onSuccess:()=>{}}),e.jsx(fe,{isOpen:l,onClose:()=>x(!1),sessionId:t,onSuccess:()=>{}}),e.jsx(be,{isOpen:f,onClose:()=>g(!1),sessionId:t,onSuccess:()=>{}})]})]})}function Se(){const{isDark:t,toggle:s}=ve();return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{}),e.jsx("div",{className:"w-px h-5 bg-border ml-1"}),e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-lg border border-border bg-background hover:bg-accent flex items-center justify-center transition-colors","aria-label":"Toggle theme",children:t?e.jsx(te,{className:"w-3.5 h-3.5 text-muted-foreground"}):e.jsx(se,{className:"w-3.5 h-3.5 text-muted-foreground"})}),e.jsx(ye,{})]})}function L({to:t,children:s,exact:i}){const r=q({select:u=>u.location.pathname}),o=i?r===t:r.startsWith(t)&&(t!=="/app"||r==="/app"||r==="/app/");return e.jsxs(G,{to:t,className:`relative text-sm py-1 transition-colors ${o?"text-foreground font-medium":"text-muted-foreground hover:text-foreground"}`,children:[s,o&&e.jsx(T.div,{className:"absolute -bottom-[13px] left-0 right-0 h-[2px] bg-foreground",layoutId:"nav-indicator",transition:z.snappy})]})}function _({rightContent:t}){return e.jsx("header",{className:"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-30",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-8 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs(G,{to:"/app",className:"flex items-center gap-2.5 hover:opacity-80 transition-opacity",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-foreground/5 border border-border flex items-center justify-center",children:e.jsx(ee,{className:"w-4 h-4 text-foreground/70"})}),e.jsx("span",{className:"text-lg font-bold tracking-tight",children:"ContextForge"})]}),e.jsx(me,{children:e.jsxs("nav",{className:"flex items-center gap-5",children:[e.jsx(L,{to:"/app",exact:!0,children:"Home"}),e.jsx(L,{to:"/app/templates",children:"Templates"}),e.jsx(L,{to:"/app/projects",children:"Projects"}),e.jsx(L,{to:"/app/workflows",children:"Workflows"}),e.jsx(L,{to:"/app/marketplace",children:"Marketplace"}),e.jsx(L,{to:"/app/settings",children:"Settings"})]})})]}),t]})})}function Re(){return e.jsx(X,{children:e.jsxs(J,{children:[e.jsx(re,{children:e.jsx(ke,{})}),e.jsx(ne,{children:e.jsx(Ce,{})}),e.jsx(ae,{children:e.jsx(Te,{})})]})})}function ke(){return e.jsxs(e.Fragment,{children:[e.jsx(_,{rightContent:e.jsx("span",{className:"text-muted-foreground text-sm",children:"Loading..."})}),e.jsx("main",{className:"mx-auto max-w-6xl px-8 py-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})})})]})}function Ce(){return e.jsxs(e.Fragment,{children:[e.jsx(_,{rightContent:e.jsx(Se,{})}),e.jsx(T.main,{className:"mx-auto max-w-6xl px-8 py-6",initial:{opacity:0},animate:{opacity:1},transition:z.smooth,children:e.jsx(W,{})})]})}function Te(){return e.jsxs(e.Fragment,{children:[e.jsx(_,{rightContent:e.jsx("span",{className:"text-muted-foreground text-sm",children:"Redirecting..."})}),e.jsx("main",{className:"mx-auto max-w-6xl px-8 py-6",children:e.jsx(Ne,{})})]})}export{Re as component};
