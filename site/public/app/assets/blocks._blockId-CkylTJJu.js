import{K as z,j as e,k as P,b as M,d as w,r as a,i as F}from"./index-C_UHGseK.js";import{a as g}from"./api-B6BZvDqw.js";import{B as o}from"./button-nz7UIBa1.js";import{c as G,i as I,P as C,F as O,U,L as Y,d as K,C as Q,B as V,M as $,a as q,r as H,b as J}from"./blockTypes-CCySgePw.js";function T(n){return new Date(n).toLocaleString()}function W({blockId:n}){const b=P(),t=M(g.blocks.get,{id:n}),j=w(g.blocks.update),B=w(g.blocks.remove),[d,x]=a.useState(""),[l,u]=a.useState("note"),[c,i]=a.useState(!1),[y,k]=a.useState(!1),[m,p]=a.useState(!1),[S,r]=a.useState("note"),[N,v]=a.useState(!1),E=a.useMemo(()=>G(),[]);a.useEffect(()=>{if(t){x(t.content);const s=t.type.toLowerCase();u(I(s)?s:"note"),r(s),i(!1)}},[t?._id]),a.useEffect(()=>{if(t){const s=t.type.toLowerCase();s!==l&&(u(s),r(s))}},[t?.type]);const _=s=>{x(s),i(s!==t?.content)},L=async s=>{if(!(!t||s===t.type)){r(s),v(!0);try{await j({id:n,type:s}),u(s),r(s)}catch(h){console.error("Error save type:",h),r(l)}finally{v(!1)}}},D=async()=>{if(!(!t||!c)){k(!0);try{await j({id:n,content:d,type:l}),i(!1),p(!1)}finally{k(!1)}}},A=()=>{m?(x(t?.content||""),r(l),p(!1),i(!1)):b({to:"/app"})},R=async()=>{confirm("Are you sure you want to delete this block?")&&(await B({id:n}),b({to:"/app"}))};return t===void 0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Loading block..."}):t===null?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Block not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The block you're looking for doesn't exist or has been deleted."}),e.jsx(F,{to:"/app",children:e.jsx(o,{children:"Go back to zones"})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Edit Block"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Created ",T(t.createdAt)," · Updated"," ",T(t.updatedAt)]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm text-muted-foreground px-2 py-1 rounded bg-muted",children:t.zone})})]}),t.type==="skill"&&t.metadata&&e.jsxs("div",{className:"rounded-lg border border-border bg-muted/50 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{className:"font-medium",children:t.metadata.skillName}),t.metadata.sourceType==="local"&&e.jsx(O,{className:"w-3.5 h-3.5 text-muted-foreground"}),t.metadata.sourceType==="upload"&&e.jsx(U,{className:"w-3.5 h-3.5 text-muted-foreground"}),t.metadata.sourceType==="url"&&e.jsx(Y,{className:"w-3.5 h-3.5 text-muted-foreground"})]}),t.metadata.skillDescription&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.metadata.skillDescription}),t.metadata.sourceRef&&e.jsx("p",{className:"text-xs text-muted-foreground font-mono truncate",children:t.metadata.sourceRef})]}),t.type==="reference"&&t.metadata?.parentSkillName&&e.jsxs("div",{className:"rounded-lg border border-border bg-muted/50 p-3 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-indigo-600"}),e.jsxs("span",{className:"text-sm",children:["Reference from skill: ",e.jsx("span",{className:"font-medium",children:t.metadata.parentSkillName})]})]}),t.metadata.sourceRef&&e.jsx("p",{className:"text-xs text-muted-foreground font-mono truncate",children:t.metadata.sourceRef})]}),t.refBlockId&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md bg-[oklch(0.65_0.08_220_/_10%)] border border-[oklch(0.65_0.08_220_/_20%)] text-sm",children:[e.jsx(K,{className:"w-4 h-4 text-[oklch(0.65_0.08_220)]"}),e.jsx("span",{children:"Linked block — edits will update all sessions using this block."})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(o,{variant:"destructive",onClick:R,children:"Delete Block"}),c&&e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"You have unsaved changes"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",onClick:A,children:c?"Discard":"Back"}),m?e.jsx(o,{onClick:D,disabled:!c||y,children:y?"Saving...":"Save Changes"}):e.jsx(o,{onClick:()=>p(!0),children:"Edit"})]})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-block-type",className:"block text-sm font-medium mb-1 text-foreground",children:"Type"}),e.jsx("select",{id:"edit-block-type",value:S,onChange:s=>L(s.target.value),disabled:N,className:"w-full max-w-xs rounded-md border border-input bg-background px-3 py-2 text-sm",children:Object.entries(E).map(([s,h])=>e.jsx("optgroup",{label:Q[s],children:h.map(f=>e.jsx("option",{value:f,children:V[f].displayName},f))},s))}),N&&e.jsx("span",{className:"text-xs text-muted-foreground animate-pulse",children:"⟲"})]}),e.jsxs("div",{children:[!m&&e.jsx("div",{className:"prose prose-invert max-w-none",children:e.jsx($,{remarkPlugins:[H,J],components:q,children:d||'No content yet. Click "Edit" to add content.'})}),m&&e.jsx("textarea",{id:"edit-block-content",value:d,onChange:s=>_(s.target.value),className:"w-full h-[60vh] min-h-50 max-h-[70dvh] rounded-md border border-input bg-background px-3 py-2 text-sm font-mono resize-y",placeholder:"Enter block content..."}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[d.length," characters"]})]})]})]})}function se(){const{blockId:n}=z.useParams();return e.jsx(W,{blockId:n})}export{se as component};
