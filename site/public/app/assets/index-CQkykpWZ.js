import{n as ml,f as fi,o as pi,J as gl,p as hi,q as xl,r as k,M as mi,a as vl,t as bl,v as Hn,c as Vt,j as c,d as _e,w as gi,R as ct,x as xi,y as yl,z as pe,B as zt,A as Nn,m as Fe,e as be,g as ye,b as Se,s as vi,X as jn,C as nt,D as wl,E as kl,F as _l,G as _r,k as Cl,i as bi}from"./index-C_UHGseK.js";import{a as ae}from"./api-B6BZvDqw.js";import{c as Cr,u as Ae,B as de}from"./button-nz7UIBa1.js";import{u as Sl,a as El,b as Al,S as Nl,v as jl,C as yi,c as Rl}from"./confirm-dialog-6FnkQ13h.js";import{u as Sr}from"./SessionContext-CKn_YicX.js";import{D as ft}from"./debounced-button-_VXZ6Nw6.js";import{M as wi,a as ki,r as _i,b as Ci,P as Er,U as Si,L as Ei,F as Ai,g as Ni,c as Ol,C as Tl,B as io,d as ar}from"./blockTypes-CCySgePw.js";import{s as ji,a as Ri,g as Il,c as Pl,b as Ml,d as Dl,o as so,e as ao,f as lo}from"./openrouter-CvI0C0jo.js";import{D as Oi}from"./download-C4hFabQ9.js";import{I as Fl}from"./input-PGr6TGjs.js";function Ll(...e){const n=!Array.isArray(e[0]),t=n?0:-1,r=e[0+t],o=e[1+t],i=e[2+t],s=e[3+t],a=ml(o,i,s);return n?a(r):a}function Bl(e,n,t={}){const r=e.get();let o=null,i=r,s;const a=typeof r=="string"?r.replace(/[\d.-]/g,""):void 0,l=()=>{o&&(o.stop(),o=null)},u=()=>{l();const h=uo(e.get()),f=uo(i);h!==f&&(o=new gl({keyframes:[h,f],velocity:e.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...t,onUpdate:s}))};if(e.attach((h,f)=>{i=h,s=x=>f(co(x,a)),fi.postRender(()=>{u(),e.events.animationStart?.notify(),o?.then(()=>{e.events.animationComplete?.notify()})})},l),pi(n)){const h=n.on("change",x=>e.set(co(x,a))),f=e.on("destroy",h);return()=>{h(),f()}}return l}function co(e,n){return n?e+n:e}function uo(e){return typeof e=="number"?e:parseFloat(e)}function Ti(e){const n=hi(()=>xl(e)),{isStatic:t}=k.useContext(mi);if(t){const[,r]=k.useState(e);k.useEffect(()=>n.on("change",r),[])}return n}function Ii(e,n){const t=Ti(n()),r=()=>t.set(n());return r(),vl(()=>{const o=()=>fi.preRender(r,!1,!0),i=e.map(s=>s.on("change",o));return()=>{i.forEach(s=>s()),bl(r)}}),t}function zl(e){Hn.current=[],e();const n=Ii(Hn.current,e);return Hn.current=void 0,n}function Pi(e,n,t,r){if(typeof e=="function")return zl(e);const i=typeof n=="function"?n:Ll(n,t,r),s=Array.isArray(e)?fo(e,i):fo([e],([l])=>i(l)),a=Array.isArray(e)?void 0:e.accelerate;return a&&!a.isTransformed&&typeof n!="function"&&Array.isArray(t)&&r?.clamp!==!1&&(s.accelerate={...a,times:n,keyframes:t,isTransformed:!0}),s}function fo(e,n){const t=hi(()=>[]);return Ii(e,()=>{t.length=0;const r=e.length;for(let o=0;o<r;o++)t[o]=e[o].get();return n(t)})}function Ul(e,n={}){const{isStatic:t}=k.useContext(mi),r=()=>pi(e)?e.get():e;if(t)return Pi(r);const o=Ti(r());return k.useInsertionEffect(()=>Bl(o,e,n),[o,JSON.stringify(n)]),o}function $l(e,n={}){return Ul(e,{type:"spring",...n})}const Wl=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],Hl=Vt("folder-tree",Wl);const Kl=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Zl=Vt("grip-vertical",Kl);const Gl=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Rn=Vt("minimize-2",Gl);const Yl=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Vl=Vt("package",Yl);const ql=[["path",{d:"M15 7h2a5 5 0 0 1 0 10h-2m-6 0H7A5 5 0 0 1 7 7h2",key:"1re2ne"}]],Xl=Vt("unlink-2",ql);function Ql({id:e,zone:n,position:t,children:r}){const{attributes:o,listeners:i,setNodeRef:s,transform:a,transition:l,isDragging:u}=Sl({id:e,data:{type:"block",blockId:e,zone:n,position:t}}),h={transform:El.Transform.toString(a),transition:l,opacity:u?.5:1};return c.jsx("div",{ref:s,style:h,"data-block-id":e,"data-zone":n,"data-dragging":u,children:c.jsxs("div",{className:"flex",children:[c.jsx("button",{type:"button",...o,...i,className:"flex items-center px-0.5 cursor-grab active:cursor-grabbing text-muted-foreground/50 hover:text-muted-foreground touch-none","aria-label":"Drag to reorder",children:c.jsx(Zl,{className:"w-3 h-3"})}),c.jsx("div",{className:"flex-1 min-w-0",children:r})]})})}function Jl({zone:e,itemIds:n,children:t}){const{setNodeRef:r,isOver:o}=Al({id:`zone-${e}`,data:{type:"zone",zone:e}});return c.jsx("div",{ref:r,"data-droppable-zone":e,"data-drop-active":o,className:`
        flex-1 min-h-0 flex flex-col transition-colors duration-200
        ${o?"bg-primary/5 ring-2 ring-primary/20 ring-inset":""}
      `,children:c.jsx(Nl,{items:n,strategy:jl,children:t})})}const Ar=["PERMANENT","STABLE","WORKING"],ec={PERMANENT:"SYSTEM",STABLE:"NOTE",WORKING:"NOTE"};function tc(e){const n=e.name.toLowerCase();return n==="skill.md"||n.endsWith(".zip")}function nc(e){const n=e.name.toLowerCase();return n.endsWith(".txt")||n.endsWith(".md")||n.endsWith(".zip")}function rc({sessionId:e,zone:n,onSkillFile:t,onSuccess:r,onError:o}){const[i,s]=k.useState(!1),a=_e(ae.blocks.create),l=k.useCallback(f=>{f.dataTransfer.types.includes("Files")&&(f.preventDefault(),f.stopPropagation(),s(!0))},[]),u=k.useCallback(f=>{f.dataTransfer.types.includes("Files")&&(f.preventDefault(),f.stopPropagation(),s(!1))},[]),h=k.useCallback(async f=>{if(!f.dataTransfer.types.includes("Files"))return;f.preventDefault(),f.stopPropagation(),s(!1);const d=Array.from(f.dataTransfer.files).filter(nc);if(d.length!==0)for(const b of d)try{if(tc(b))t?.(b,n);else{const p=await b.text(),m=ec[n];await a({sessionId:e,content:p,type:m,zone:n}),r?.(b.name)}}catch{o?.(`Failed to add file: ${b.name}`)}},[e,n,a,t,r,o]);return{isDragOver:i,dropProps:{onDragOver:l,onDragLeave:u,onDrop:h}}}function Ut(e){const n=oc(e),t=k.forwardRef((r,o)=>{const{children:i,...s}=r,a=k.Children.toArray(i),l=a.find(sc);if(l){const u=l.props.children,h=a.map(f=>f===l?k.Children.count(u)>1?k.Children.only(null):k.isValidElement(u)?u.props.children:null:f);return c.jsx(n,{...s,ref:o,children:k.isValidElement(u)?k.cloneElement(u,void 0,h):null})}return c.jsx(n,{...s,ref:o,children:i})});return t.displayName=`${e}.Slot`,t}function oc(e){const n=k.forwardRef((t,r)=>{const{children:o,...i}=t;if(k.isValidElement(o)){const s=lc(o),a=ac(i,o.props);return o.type!==k.Fragment&&(a.ref=r?Cr(r,s):s),k.cloneElement(o,a)}return k.Children.count(o)>1?k.Children.only(null):null});return n.displayName=`${e}.SlotClone`,n}var ic=Symbol("radix.slottable");function sc(e){return k.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===ic}function ac(e,n){const t={...n};for(const r in n){const o=e[r],i=n[r];/^on[A-Z]/.test(r)?o&&i?t[r]=(...a)=>{const l=i(...a);return o(...a),l}:o&&(t[r]=o):r==="style"?t[r]={...o,...i}:r==="className"&&(t[r]=[o,i].filter(Boolean).join(" "))}return{...e,...t}}function lc(e){let n=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,t=n&&"isReactWarning"in n&&n.isReactWarning;return t?e.ref:(n=Object.getOwnPropertyDescriptor(e,"ref")?.get,t=n&&"isReactWarning"in n&&n.isReactWarning,t?e.props.ref:e.props.ref||e.ref)}var cc=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ee=cc.reduce((e,n)=>{const t=Ut(`Primitive.${n}`),r=k.forwardRef((o,i)=>{const{asChild:s,...a}=o,l=s?t:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),c.jsx(l,{...a,ref:i})});return r.displayName=`Primitive.${n}`,{...e,[n]:r}},{});function Mi(e,n){e&&gi.flushSync(()=>e.dispatchEvent(n))}function Rt(e,n=[]){let t=[];function r(i,s){const a=k.createContext(s),l=t.length;t=[...t,s];const u=f=>{const{scope:x,children:d,...b}=f,p=x?.[e]?.[l]||a,m=k.useMemo(()=>b,Object.values(b));return c.jsx(p.Provider,{value:m,children:d})};u.displayName=i+"Provider";function h(f,x){const d=x?.[e]?.[l]||a,b=k.useContext(d);if(b)return b;if(s!==void 0)return s;throw new Error(`\`${f}\` must be used within \`${i}\``)}return[u,h]}const o=()=>{const i=t.map(s=>k.createContext(s));return function(a){const l=a?.[e]||i;return k.useMemo(()=>({[`__scope${e}`]:{...a,[e]:l}}),[a,l])}};return o.scopeName=e,[r,uc(o,...n)]}function uc(...e){const n=e[0];if(e.length===1)return n;const t=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(i){const s=r.reduce((a,{useScope:l,scopeName:u})=>{const f=l(i)[`__scope${u}`];return{...a,...f}},{});return k.useMemo(()=>({[`__scope${n.scopeName}`]:s}),[s])}};return t.scopeName=n.scopeName,t}function Di(e){const n=e+"CollectionProvider",[t,r]=Rt(n),[o,i]=t(n,{collectionRef:{current:null},itemMap:new Map}),s=p=>{const{scope:m,children:g}=p,w=ct.useRef(null),_=ct.useRef(new Map).current;return c.jsx(o,{scope:m,itemMap:_,collectionRef:w,children:g})};s.displayName=n;const a=e+"CollectionSlot",l=Ut(a),u=ct.forwardRef((p,m)=>{const{scope:g,children:w}=p,_=i(a,g),E=Ae(m,_.collectionRef);return c.jsx(l,{ref:E,children:w})});u.displayName=a;const h=e+"CollectionItemSlot",f="data-radix-collection-item",x=Ut(h),d=ct.forwardRef((p,m)=>{const{scope:g,children:w,..._}=p,E=ct.useRef(null),S=Ae(m,E),R=i(h,g);return ct.useEffect(()=>(R.itemMap.set(E,{ref:E,..._}),()=>{R.itemMap.delete(E)})),c.jsx(x,{[f]:"",ref:S,children:w})});d.displayName=h;function b(p){const m=i(e+"CollectionConsumer",p);return ct.useCallback(()=>{const w=m.collectionRef.current;if(!w)return[];const _=Array.from(w.querySelectorAll(`[${f}]`));return Array.from(m.itemMap.values()).sort((R,j)=>_.indexOf(R.ref.current)-_.indexOf(j.ref.current))},[m.collectionRef,m.itemMap])}return[{Provider:s,Slot:u,ItemSlot:d},b,r]}function le(e,n,{checkForDefaultPrevented:t=!0}={}){return function(o){if(e?.(o),t===!1||!o.defaultPrevented)return n?.(o)}}var ot=globalThis?.document?k.useLayoutEffect:()=>{},dc=xi[" useInsertionEffect ".trim().toString()]||ot;function Nr({prop:e,defaultProp:n,onChange:t=()=>{},caller:r}){const[o,i,s]=fc({defaultProp:n,onChange:t}),a=e!==void 0,l=a?e:o;{const h=k.useRef(e!==void 0);k.useEffect(()=>{const f=h.current;f!==a&&console.warn(`${r} is changing from ${f?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=a},[a,r])}const u=k.useCallback(h=>{if(a){const f=pc(h)?h(e):h;f!==e&&s.current?.(f)}else i(h)},[a,e,i,s]);return[l,u]}function fc({defaultProp:e,onChange:n}){const[t,r]=k.useState(e),o=k.useRef(t),i=k.useRef(n);return dc(()=>{i.current=n},[n]),k.useEffect(()=>{o.current!==t&&(i.current?.(t),o.current=t)},[t,o]),[t,r,i]}function pc(e){return typeof e=="function"}function hc(e,n){return k.useReducer((t,r)=>n[t][r]??t,e)}var ht=e=>{const{present:n,children:t}=e,r=mc(n),o=typeof t=="function"?t({present:r.isPresent}):k.Children.only(t),i=Ae(r.ref,gc(o));return typeof t=="function"||r.isPresent?k.cloneElement(o,{ref:i}):null};ht.displayName="Presence";function mc(e){const[n,t]=k.useState(),r=k.useRef(null),o=k.useRef(e),i=k.useRef("none"),s=e?"mounted":"unmounted",[a,l]=hc(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return k.useEffect(()=>{const u=rn(r.current);i.current=a==="mounted"?u:"none"},[a]),ot(()=>{const u=r.current,h=o.current;if(h!==e){const x=i.current,d=rn(u);e?l("MOUNT"):d==="none"||u?.display==="none"?l("UNMOUNT"):l(h&&x!==d?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,l]),ot(()=>{if(n){let u;const h=n.ownerDocument.defaultView??window,f=d=>{const p=rn(r.current).includes(CSS.escape(d.animationName));if(d.target===n&&p&&(l("ANIMATION_END"),!o.current)){const m=n.style.animationFillMode;n.style.animationFillMode="forwards",u=h.setTimeout(()=>{n.style.animationFillMode==="forwards"&&(n.style.animationFillMode=m)})}},x=d=>{d.target===n&&(i.current=rn(r.current))};return n.addEventListener("animationstart",x),n.addEventListener("animationcancel",f),n.addEventListener("animationend",f),()=>{h.clearTimeout(u),n.removeEventListener("animationstart",x),n.removeEventListener("animationcancel",f),n.removeEventListener("animationend",f)}}else l("ANIMATION_END")},[n,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:k.useCallback(u=>{r.current=u?getComputedStyle(u):null,t(u)},[])}}function rn(e){return e?.animationName||"none"}function gc(e){let n=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,t=n&&"isReactWarning"in n&&n.isReactWarning;return t?e.ref:(n=Object.getOwnPropertyDescriptor(e,"ref")?.get,t=n&&"isReactWarning"in n&&n.isReactWarning,t?e.props.ref:e.props.ref||e.ref)}var xc=xi[" useId ".trim().toString()]||(()=>{}),vc=0;function mn(e){const[n,t]=k.useState(xc());return ot(()=>{t(r=>r??String(vc++))},[e]),e||(n?`radix-${n}`:"")}var bc=k.createContext(void 0);function Fi(e){const n=k.useContext(bc);return e||n||"ltr"}function qe(e){const n=k.useRef(e);return k.useEffect(()=>{n.current=e}),k.useMemo(()=>(...t)=>n.current?.(...t),[])}function yc(e,n=globalThis?.document){const t=qe(e);k.useEffect(()=>{const r=o=>{o.key==="Escape"&&t(o)};return n.addEventListener("keydown",r,{capture:!0}),()=>n.removeEventListener("keydown",r,{capture:!0})},[t,n])}var wc="DismissableLayer",lr="dismissableLayer.update",kc="dismissableLayer.pointerDownOutside",_c="dismissableLayer.focusOutside",po,Li=k.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),jr=k.forwardRef((e,n)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:i,onInteractOutside:s,onDismiss:a,...l}=e,u=k.useContext(Li),[h,f]=k.useState(null),x=h?.ownerDocument??globalThis?.document,[,d]=k.useState({}),b=Ae(n,j=>f(j)),p=Array.from(u.layers),[m]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),g=p.indexOf(m),w=h?p.indexOf(h):-1,_=u.layersWithOutsidePointerEventsDisabled.size>0,E=w>=g,S=Ec(j=>{const M=j.target,I=[...u.branches].some(L=>L.contains(M));!E||I||(o?.(j),s?.(j),j.defaultPrevented||a?.())},x),R=Ac(j=>{const M=j.target;[...u.branches].some(L=>L.contains(M))||(i?.(j),s?.(j),j.defaultPrevented||a?.())},x);return yc(j=>{w===u.layers.size-1&&(r?.(j),!j.defaultPrevented&&a&&(j.preventDefault(),a()))},x),k.useEffect(()=>{if(h)return t&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(po=x.body.style.pointerEvents,x.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(h)),u.layers.add(h),ho(),()=>{t&&u.layersWithOutsidePointerEventsDisabled.size===1&&(x.body.style.pointerEvents=po)}},[h,x,t,u]),k.useEffect(()=>()=>{h&&(u.layers.delete(h),u.layersWithOutsidePointerEventsDisabled.delete(h),ho())},[h,u]),k.useEffect(()=>{const j=()=>d({});return document.addEventListener(lr,j),()=>document.removeEventListener(lr,j)},[]),c.jsx(Ee.div,{...l,ref:b,style:{pointerEvents:_?E?"auto":"none":void 0,...e.style},onFocusCapture:le(e.onFocusCapture,R.onFocusCapture),onBlurCapture:le(e.onBlurCapture,R.onBlurCapture),onPointerDownCapture:le(e.onPointerDownCapture,S.onPointerDownCapture)})});jr.displayName=wc;var Cc="DismissableLayerBranch",Sc=k.forwardRef((e,n)=>{const t=k.useContext(Li),r=k.useRef(null),o=Ae(n,r);return k.useEffect(()=>{const i=r.current;if(i)return t.branches.add(i),()=>{t.branches.delete(i)}},[t.branches]),c.jsx(Ee.div,{...e,ref:o})});Sc.displayName=Cc;function Ec(e,n=globalThis?.document){const t=qe(e),r=k.useRef(!1),o=k.useRef(()=>{});return k.useEffect(()=>{const i=a=>{if(a.target&&!r.current){let l=function(){Bi(kc,t,u,{discrete:!0})};const u={originalEvent:a};a.pointerType==="touch"?(n.removeEventListener("click",o.current),o.current=l,n.addEventListener("click",o.current,{once:!0})):l()}else n.removeEventListener("click",o.current);r.current=!1},s=window.setTimeout(()=>{n.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(s),n.removeEventListener("pointerdown",i),n.removeEventListener("click",o.current)}},[n,t]),{onPointerDownCapture:()=>r.current=!0}}function Ac(e,n=globalThis?.document){const t=qe(e),r=k.useRef(!1);return k.useEffect(()=>{const o=i=>{i.target&&!r.current&&Bi(_c,t,{originalEvent:i},{discrete:!1})};return n.addEventListener("focusin",o),()=>n.removeEventListener("focusin",o)},[n,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function ho(){const e=new CustomEvent(lr);document.dispatchEvent(e)}function Bi(e,n,t,{discrete:r}){const o=t.originalEvent.target,i=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:t});n&&o.addEventListener(e,n,{once:!0}),r?Mi(o,i):o.dispatchEvent(i)}var Kn="focusScope.autoFocusOnMount",Zn="focusScope.autoFocusOnUnmount",mo={bubbles:!1,cancelable:!0},Nc="FocusScope",Rr=k.forwardRef((e,n)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:i,...s}=e,[a,l]=k.useState(null),u=qe(o),h=qe(i),f=k.useRef(null),x=Ae(n,p=>l(p)),d=k.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;k.useEffect(()=>{if(r){let p=function(_){if(d.paused||!a)return;const E=_.target;a.contains(E)?f.current=E:et(f.current,{select:!0})},m=function(_){if(d.paused||!a)return;const E=_.relatedTarget;E!==null&&(a.contains(E)||et(f.current,{select:!0}))},g=function(_){if(document.activeElement===document.body)for(const S of _)S.removedNodes.length>0&&et(a)};document.addEventListener("focusin",p),document.addEventListener("focusout",m);const w=new MutationObserver(g);return a&&w.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",p),document.removeEventListener("focusout",m),w.disconnect()}}},[r,a,d.paused]),k.useEffect(()=>{if(a){xo.add(d);const p=document.activeElement;if(!a.contains(p)){const g=new CustomEvent(Kn,mo);a.addEventListener(Kn,u),a.dispatchEvent(g),g.defaultPrevented||(jc(Pc(zi(a)),{select:!0}),document.activeElement===p&&et(a))}return()=>{a.removeEventListener(Kn,u),setTimeout(()=>{const g=new CustomEvent(Zn,mo);a.addEventListener(Zn,h),a.dispatchEvent(g),g.defaultPrevented||et(p??document.body,{select:!0}),a.removeEventListener(Zn,h),xo.remove(d)},0)}}},[a,u,h,d]);const b=k.useCallback(p=>{if(!t&&!r||d.paused)return;const m=p.key==="Tab"&&!p.altKey&&!p.ctrlKey&&!p.metaKey,g=document.activeElement;if(m&&g){const w=p.currentTarget,[_,E]=Rc(w);_&&E?!p.shiftKey&&g===E?(p.preventDefault(),t&&et(_,{select:!0})):p.shiftKey&&g===_&&(p.preventDefault(),t&&et(E,{select:!0})):g===w&&p.preventDefault()}},[t,r,d.paused]);return c.jsx(Ee.div,{tabIndex:-1,...s,ref:x,onKeyDown:b})});Rr.displayName=Nc;function jc(e,{select:n=!1}={}){const t=document.activeElement;for(const r of e)if(et(r,{select:n}),document.activeElement!==t)return}function Rc(e){const n=zi(e),t=go(n,e),r=go(n.reverse(),e);return[t,r]}function zi(e){const n=[],t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)n.push(t.currentNode);return n}function go(e,n){for(const t of e)if(!Oc(t,{upTo:n}))return t}function Oc(e,{upTo:n}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n!==void 0&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Tc(e){return e instanceof HTMLInputElement&&"select"in e}function et(e,{select:n=!1}={}){if(e&&e.focus){const t=document.activeElement;e.focus({preventScroll:!0}),e!==t&&Tc(e)&&n&&e.select()}}var xo=Ic();function Ic(){let e=[];return{add(n){const t=e[0];n!==t&&t?.pause(),e=vo(e,n),e.unshift(n)},remove(n){e=vo(e,n),e[0]?.resume()}}}function vo(e,n){const t=[...e],r=t.indexOf(n);return r!==-1&&t.splice(r,1),t}function Pc(e){return e.filter(n=>n.tagName!=="A")}var Mc="Portal",Or=k.forwardRef((e,n)=>{const{container:t,...r}=e,[o,i]=k.useState(!1);ot(()=>i(!0),[]);const s=t||o&&globalThis?.document?.body;return s?yl.createPortal(c.jsx(Ee.div,{...r,ref:n}),s):null});Or.displayName=Mc;var Gn=0;function Ui(){k.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??bo()),document.body.insertAdjacentElement("beforeend",e[1]??bo()),Gn++,()=>{Gn===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(n=>n.remove()),Gn--}},[])}function bo(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var Ue=function(){return Ue=Object.assign||function(n){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Ue.apply(this,arguments)};function $i(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(t[r[o]]=e[r[o]]);return t}function Dc(e,n,t){if(t||arguments.length===2)for(var r=0,o=n.length,i;r<o;r++)(i||!(r in n))&&(i||(i=Array.prototype.slice.call(n,0,r)),i[r]=n[r]);return e.concat(i||Array.prototype.slice.call(n))}var dn="right-scroll-bar-position",fn="width-before-scroll-bar",Fc="with-scroll-bars-hidden",Lc="--removed-body-scroll-bar-size";function Yn(e,n){return typeof e=="function"?e(n):e&&(e.current=n),e}function Bc(e,n){var t=k.useState(function(){return{value:e,callback:n,facade:{get current(){return t.value},set current(r){var o=t.value;o!==r&&(t.value=r,t.callback(r,o))}}}})[0];return t.callback=n,t.facade}var zc=typeof window<"u"?k.useLayoutEffect:k.useEffect,yo=new WeakMap;function Uc(e,n){var t=Bc(null,function(r){return e.forEach(function(o){return Yn(o,r)})});return zc(function(){var r=yo.get(t);if(r){var o=new Set(r),i=new Set(e),s=t.current;o.forEach(function(a){i.has(a)||Yn(a,null)}),i.forEach(function(a){o.has(a)||Yn(a,s)})}yo.set(t,e)},[e]),t}function $c(e){return e}function Wc(e,n){n===void 0&&(n=$c);var t=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:e},useMedium:function(i){var s=n(i,r);return t.push(s),function(){t=t.filter(function(a){return a!==s})}},assignSyncMedium:function(i){for(r=!0;t.length;){var s=t;t=[],s.forEach(i)}t={push:function(a){return i(a)},filter:function(){return t}}},assignMedium:function(i){r=!0;var s=[];if(t.length){var a=t;t=[],a.forEach(i),s=t}var l=function(){var h=s;s=[],h.forEach(i)},u=function(){return Promise.resolve().then(l)};u(),t={push:function(h){s.push(h),u()},filter:function(h){return s=s.filter(h),t}}}};return o}function Hc(e){e===void 0&&(e={});var n=Wc(null);return n.options=Ue({async:!0,ssr:!1},e),n}var Wi=function(e){var n=e.sideCar,t=$i(e,["sideCar"]);if(!n)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=n.read();if(!r)throw new Error("Sidecar medium not found");return k.createElement(r,Ue({},t))};Wi.isSideCarExport=!0;function Kc(e,n){return e.useMedium(n),Wi}var Hi=Hc(),Vn=function(){},On=k.forwardRef(function(e,n){var t=k.useRef(null),r=k.useState({onScrollCapture:Vn,onWheelCapture:Vn,onTouchMoveCapture:Vn}),o=r[0],i=r[1],s=e.forwardProps,a=e.children,l=e.className,u=e.removeScrollBar,h=e.enabled,f=e.shards,x=e.sideCar,d=e.noRelative,b=e.noIsolation,p=e.inert,m=e.allowPinchZoom,g=e.as,w=g===void 0?"div":g,_=e.gapMode,E=$i(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),S=x,R=Uc([t,n]),j=Ue(Ue({},E),o);return k.createElement(k.Fragment,null,h&&k.createElement(S,{sideCar:Hi,removeScrollBar:u,shards:f,noRelative:d,noIsolation:b,inert:p,setCallbacks:i,allowPinchZoom:!!m,lockRef:t,gapMode:_}),s?k.cloneElement(k.Children.only(a),Ue(Ue({},j),{ref:R})):k.createElement(w,Ue({},j,{className:l,ref:R}),a))});On.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};On.classNames={fullWidth:fn,zeroRight:dn};var Zc=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Gc(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var n=Zc();return n&&e.setAttribute("nonce",n),e}function Yc(e,n){e.styleSheet?e.styleSheet.cssText=n:e.appendChild(document.createTextNode(n))}function Vc(e){var n=document.head||document.getElementsByTagName("head")[0];n.appendChild(e)}var qc=function(){var e=0,n=null;return{add:function(t){e==0&&(n=Gc())&&(Yc(n,t),Vc(n)),e++},remove:function(){e--,!e&&n&&(n.parentNode&&n.parentNode.removeChild(n),n=null)}}},Xc=function(){var e=qc();return function(n,t){k.useEffect(function(){return e.add(n),function(){e.remove()}},[n&&t])}},Ki=function(){var e=Xc(),n=function(t){var r=t.styles,o=t.dynamic;return e(r,o),null};return n},Qc={left:0,top:0,right:0,gap:0},qn=function(e){return parseInt(e||"",10)||0},Jc=function(e){var n=window.getComputedStyle(document.body),t=n[e==="padding"?"paddingLeft":"marginLeft"],r=n[e==="padding"?"paddingTop":"marginTop"],o=n[e==="padding"?"paddingRight":"marginRight"];return[qn(t),qn(r),qn(o)]},eu=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Qc;var n=Jc(e),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:n[0],top:n[1],right:n[2],gap:Math.max(0,r-t+n[2]-n[0])}},tu=Ki(),St="data-scroll-locked",nu=function(e,n,t,r){var o=e.left,i=e.top,s=e.right,a=e.gap;return t===void 0&&(t="margin"),`
  .`.concat(Fc,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(St,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([n&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(dn,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(fn,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(dn," .").concat(dn,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(fn," .").concat(fn,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(St,`] {
    `).concat(Lc,": ").concat(a,`px;
  }
`)},wo=function(){var e=parseInt(document.body.getAttribute(St)||"0",10);return isFinite(e)?e:0},ru=function(){k.useEffect(function(){return document.body.setAttribute(St,(wo()+1).toString()),function(){var e=wo()-1;e<=0?document.body.removeAttribute(St):document.body.setAttribute(St,e.toString())}},[])},ou=function(e){var n=e.noRelative,t=e.noImportant,r=e.gapMode,o=r===void 0?"margin":r;ru();var i=k.useMemo(function(){return eu(o)},[o]);return k.createElement(tu,{styles:nu(i,!n,o,t?"":"!important")})},cr=!1;if(typeof window<"u")try{var on=Object.defineProperty({},"passive",{get:function(){return cr=!0,!0}});window.addEventListener("test",on,on),window.removeEventListener("test",on,on)}catch{cr=!1}var xt=cr?{passive:!1}:!1,iu=function(e){return e.tagName==="TEXTAREA"},Zi=function(e,n){if(!(e instanceof Element))return!1;var t=window.getComputedStyle(e);return t[n]!=="hidden"&&!(t.overflowY===t.overflowX&&!iu(e)&&t[n]==="visible")},su=function(e){return Zi(e,"overflowY")},au=function(e){return Zi(e,"overflowX")},ko=function(e,n){var t=n.ownerDocument,r=n;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=Gi(e,r);if(o){var i=Yi(e,r),s=i[1],a=i[2];if(s>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},lu=function(e){var n=e.scrollTop,t=e.scrollHeight,r=e.clientHeight;return[n,t,r]},cu=function(e){var n=e.scrollLeft,t=e.scrollWidth,r=e.clientWidth;return[n,t,r]},Gi=function(e,n){return e==="v"?su(n):au(n)},Yi=function(e,n){return e==="v"?lu(n):cu(n)},uu=function(e,n){return e==="h"&&n==="rtl"?-1:1},du=function(e,n,t,r,o){var i=uu(e,window.getComputedStyle(n).direction),s=i*r,a=t.target,l=n.contains(a),u=!1,h=s>0,f=0,x=0;do{if(!a)break;var d=Yi(e,a),b=d[0],p=d[1],m=d[2],g=p-m-i*b;(b||g)&&Gi(e,a)&&(f+=g,x+=b);var w=a.parentNode;a=w&&w.nodeType===Node.DOCUMENT_FRAGMENT_NODE?w.host:w}while(!l&&a!==document.body||l&&(n.contains(a)||n===a));return(h&&Math.abs(f)<1||!h&&Math.abs(x)<1)&&(u=!0),u},sn=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},_o=function(e){return[e.deltaX,e.deltaY]},Co=function(e){return e&&"current"in e?e.current:e},fu=function(e,n){return e[0]===n[0]&&e[1]===n[1]},pu=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},hu=0,vt=[];function mu(e){var n=k.useRef([]),t=k.useRef([0,0]),r=k.useRef(),o=k.useState(hu++)[0],i=k.useState(Ki)[0],s=k.useRef(e);k.useEffect(function(){s.current=e},[e]),k.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var p=Dc([e.lockRef.current],(e.shards||[]).map(Co),!0).filter(Boolean);return p.forEach(function(m){return m.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),p.forEach(function(m){return m.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var a=k.useCallback(function(p,m){if("touches"in p&&p.touches.length===2||p.type==="wheel"&&p.ctrlKey)return!s.current.allowPinchZoom;var g=sn(p),w=t.current,_="deltaX"in p?p.deltaX:w[0]-g[0],E="deltaY"in p?p.deltaY:w[1]-g[1],S,R=p.target,j=Math.abs(_)>Math.abs(E)?"h":"v";if("touches"in p&&j==="h"&&R.type==="range")return!1;var M=window.getSelection(),I=M&&M.anchorNode,L=I?I===R||I.contains(R):!1;if(L)return!1;var K=ko(j,R);if(!K)return!0;if(K?S=j:(S=j==="v"?"h":"v",K=ko(j,R)),!K)return!1;if(!r.current&&"changedTouches"in p&&(_||E)&&(r.current=S),!S)return!0;var C=r.current||S;return du(C,m,p,C==="h"?_:E)},[]),l=k.useCallback(function(p){var m=p;if(!(!vt.length||vt[vt.length-1]!==i)){var g="deltaY"in m?_o(m):sn(m),w=n.current.filter(function(S){return S.name===m.type&&(S.target===m.target||m.target===S.shadowParent)&&fu(S.delta,g)})[0];if(w&&w.should){m.cancelable&&m.preventDefault();return}if(!w){var _=(s.current.shards||[]).map(Co).filter(Boolean).filter(function(S){return S.contains(m.target)}),E=_.length>0?a(m,_[0]):!s.current.noIsolation;E&&m.cancelable&&m.preventDefault()}}},[]),u=k.useCallback(function(p,m,g,w){var _={name:p,delta:m,target:g,should:w,shadowParent:gu(g)};n.current.push(_),setTimeout(function(){n.current=n.current.filter(function(E){return E!==_})},1)},[]),h=k.useCallback(function(p){t.current=sn(p),r.current=void 0},[]),f=k.useCallback(function(p){u(p.type,_o(p),p.target,a(p,e.lockRef.current))},[]),x=k.useCallback(function(p){u(p.type,sn(p),p.target,a(p,e.lockRef.current))},[]);k.useEffect(function(){return vt.push(i),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:x}),document.addEventListener("wheel",l,xt),document.addEventListener("touchmove",l,xt),document.addEventListener("touchstart",h,xt),function(){vt=vt.filter(function(p){return p!==i}),document.removeEventListener("wheel",l,xt),document.removeEventListener("touchmove",l,xt),document.removeEventListener("touchstart",h,xt)}},[]);var d=e.removeScrollBar,b=e.inert;return k.createElement(k.Fragment,null,b?k.createElement(i,{styles:pu(o)}):null,d?k.createElement(ou,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function gu(e){for(var n=null;e!==null;)e instanceof ShadowRoot&&(n=e.host,e=e.host),e=e.parentNode;return n}const xu=Kc(Hi,mu);var Tr=k.forwardRef(function(e,n){return k.createElement(On,Ue({},e,{ref:n,sideCar:xu}))});Tr.classNames=On.classNames;var vu=function(e){if(typeof document>"u")return null;var n=Array.isArray(e)?e[0]:e;return n.ownerDocument.body},bt=new WeakMap,an=new WeakMap,ln={},Xn=0,Vi=function(e){return e&&(e.host||Vi(e.parentNode))},bu=function(e,n){return n.map(function(t){if(e.contains(t))return t;var r=Vi(t);return r&&e.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)}).filter(function(t){return!!t})},yu=function(e,n,t,r){var o=bu(n,Array.isArray(e)?e:[e]);ln[t]||(ln[t]=new WeakMap);var i=ln[t],s=[],a=new Set,l=new Set(o),u=function(f){!f||a.has(f)||(a.add(f),u(f.parentNode))};o.forEach(u);var h=function(f){!f||l.has(f)||Array.prototype.forEach.call(f.children,function(x){if(a.has(x))h(x);else try{var d=x.getAttribute(r),b=d!==null&&d!=="false",p=(bt.get(x)||0)+1,m=(i.get(x)||0)+1;bt.set(x,p),i.set(x,m),s.push(x),p===1&&b&&an.set(x,!0),m===1&&x.setAttribute(t,"true"),b||x.setAttribute(r,"true")}catch(g){console.error("aria-hidden: cannot operate on ",x,g)}})};return h(n),a.clear(),Xn++,function(){s.forEach(function(f){var x=bt.get(f)-1,d=i.get(f)-1;bt.set(f,x),i.set(f,d),x||(an.has(f)||f.removeAttribute(r),an.delete(f)),d||f.removeAttribute(t)}),Xn--,Xn||(bt=new WeakMap,bt=new WeakMap,an=new WeakMap,ln={})}},qi=function(e,n,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),o=vu(e);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live], script"))),yu(r,o,t,"aria-hidden")):function(){return null}};function wu(e){const[n,t]=k.useState(void 0);return ot(()=>{if(e){t({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const i=o[0];let s,a;if("borderBoxSize"in i){const l=i.borderBoxSize,u=Array.isArray(l)?l[0]:l;s=u.inlineSize,a=u.blockSize}else s=e.offsetWidth,a=e.offsetHeight;t({width:s,height:a})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else t(void 0)},[e]),n}const ku=["top","right","bottom","left"],it=Math.min,Ie=Math.max,gn=Math.round,cn=Math.floor,He=e=>({x:e,y:e}),_u={left:"right",right:"left",bottom:"top",top:"bottom"},Cu={start:"end",end:"start"};function ur(e,n,t){return Ie(e,it(n,t))}function Xe(e,n){return typeof e=="function"?e(n):e}function Qe(e){return e.split("-")[0]}function Ot(e){return e.split("-")[1]}function Ir(e){return e==="x"?"y":"x"}function Pr(e){return e==="y"?"height":"width"}const Su=new Set(["top","bottom"]);function We(e){return Su.has(Qe(e))?"y":"x"}function Mr(e){return Ir(We(e))}function Eu(e,n,t){t===void 0&&(t=!1);const r=Ot(e),o=Mr(e),i=Pr(o);let s=o==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return n.reference[i]>n.floating[i]&&(s=xn(s)),[s,xn(s)]}function Au(e){const n=xn(e);return[dr(e),n,dr(n)]}function dr(e){return e.replace(/start|end/g,n=>Cu[n])}const So=["left","right"],Eo=["right","left"],Nu=["top","bottom"],ju=["bottom","top"];function Ru(e,n,t){switch(e){case"top":case"bottom":return t?n?Eo:So:n?So:Eo;case"left":case"right":return n?Nu:ju;default:return[]}}function Ou(e,n,t,r){const o=Ot(e);let i=Ru(Qe(e),t==="start",r);return o&&(i=i.map(s=>s+"-"+o),n&&(i=i.concat(i.map(dr)))),i}function xn(e){return e.replace(/left|right|bottom|top/g,n=>_u[n])}function Tu(e){return{top:0,right:0,bottom:0,left:0,...e}}function Xi(e){return typeof e!="number"?Tu(e):{top:e,right:e,bottom:e,left:e}}function vn(e){const{x:n,y:t,width:r,height:o}=e;return{width:r,height:o,top:t,left:n,right:n+r,bottom:t+o,x:n,y:t}}function Ao(e,n,t){let{reference:r,floating:o}=e;const i=We(n),s=Mr(n),a=Pr(s),l=Qe(n),u=i==="y",h=r.x+r.width/2-o.width/2,f=r.y+r.height/2-o.height/2,x=r[a]/2-o[a]/2;let d;switch(l){case"top":d={x:h,y:r.y-o.height};break;case"bottom":d={x:h,y:r.y+r.height};break;case"right":d={x:r.x+r.width,y:f};break;case"left":d={x:r.x-o.width,y:f};break;default:d={x:r.x,y:r.y}}switch(Ot(n)){case"start":d[s]-=x*(t&&u?-1:1);break;case"end":d[s]+=x*(t&&u?-1:1);break}return d}async function Iu(e,n){var t;n===void 0&&(n={});const{x:r,y:o,platform:i,rects:s,elements:a,strategy:l}=e,{boundary:u="clippingAncestors",rootBoundary:h="viewport",elementContext:f="floating",altBoundary:x=!1,padding:d=0}=Xe(n,e),b=Xi(d),m=a[x?f==="floating"?"reference":"floating":f],g=vn(await i.getClippingRect({element:(t=await(i.isElement==null?void 0:i.isElement(m)))==null||t?m:m.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:u,rootBoundary:h,strategy:l})),w=f==="floating"?{x:r,y:o,width:s.floating.width,height:s.floating.height}:s.reference,_=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),E=await(i.isElement==null?void 0:i.isElement(_))?await(i.getScale==null?void 0:i.getScale(_))||{x:1,y:1}:{x:1,y:1},S=vn(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:w,offsetParent:_,strategy:l}):w);return{top:(g.top-S.top+b.top)/E.y,bottom:(S.bottom-g.bottom+b.bottom)/E.y,left:(g.left-S.left+b.left)/E.x,right:(S.right-g.right+b.right)/E.x}}const Pu=async(e,n,t)=>{const{placement:r="bottom",strategy:o="absolute",middleware:i=[],platform:s}=t,a=i.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(n));let u=await s.getElementRects({reference:e,floating:n,strategy:o}),{x:h,y:f}=Ao(u,r,l),x=r,d={},b=0;for(let m=0;m<a.length;m++){var p;const{name:g,fn:w}=a[m],{x:_,y:E,data:S,reset:R}=await w({x:h,y:f,initialPlacement:r,placement:x,strategy:o,middlewareData:d,rects:u,platform:{...s,detectOverflow:(p=s.detectOverflow)!=null?p:Iu},elements:{reference:e,floating:n}});h=_??h,f=E??f,d={...d,[g]:{...d[g],...S}},R&&b<=50&&(b++,typeof R=="object"&&(R.placement&&(x=R.placement),R.rects&&(u=R.rects===!0?await s.getElementRects({reference:e,floating:n,strategy:o}):R.rects),{x:h,y:f}=Ao(u,x,l)),m=-1)}return{x:h,y:f,placement:x,strategy:o,middlewareData:d}},Mu=e=>({name:"arrow",options:e,async fn(n){const{x:t,y:r,placement:o,rects:i,platform:s,elements:a,middlewareData:l}=n,{element:u,padding:h=0}=Xe(e,n)||{};if(u==null)return{};const f=Xi(h),x={x:t,y:r},d=Mr(o),b=Pr(d),p=await s.getDimensions(u),m=d==="y",g=m?"top":"left",w=m?"bottom":"right",_=m?"clientHeight":"clientWidth",E=i.reference[b]+i.reference[d]-x[d]-i.floating[b],S=x[d]-i.reference[d],R=await(s.getOffsetParent==null?void 0:s.getOffsetParent(u));let j=R?R[_]:0;(!j||!await(s.isElement==null?void 0:s.isElement(R)))&&(j=a.floating[_]||i.floating[b]);const M=E/2-S/2,I=j/2-p[b]/2-1,L=it(f[g],I),K=it(f[w],I),C=L,D=j-p[b]-K,y=j/2-p[b]/2+M,U=ur(C,y,D),V=!l.arrow&&Ot(o)!=null&&y!==U&&i.reference[b]/2-(y<C?L:K)-p[b]/2<0,H=V?y<C?y-C:y-D:0;return{[d]:x[d]+H,data:{[d]:U,centerOffset:y-U-H,...V&&{alignmentOffset:H}},reset:V}}}),Du=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(n){var t,r;const{placement:o,middlewareData:i,rects:s,initialPlacement:a,platform:l,elements:u}=n,{mainAxis:h=!0,crossAxis:f=!0,fallbackPlacements:x,fallbackStrategy:d="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:p=!0,...m}=Xe(e,n);if((t=i.arrow)!=null&&t.alignmentOffset)return{};const g=Qe(o),w=We(a),_=Qe(a)===a,E=await(l.isRTL==null?void 0:l.isRTL(u.floating)),S=x||(_||!p?[xn(a)]:Au(a)),R=b!=="none";!x&&R&&S.push(...Ou(a,p,b,E));const j=[a,...S],M=await l.detectOverflow(n,m),I=[];let L=((r=i.flip)==null?void 0:r.overflows)||[];if(h&&I.push(M[g]),f){const y=Eu(o,s,E);I.push(M[y[0]],M[y[1]])}if(L=[...L,{placement:o,overflows:I}],!I.every(y=>y<=0)){var K,C;const y=(((K=i.flip)==null?void 0:K.index)||0)+1,U=j[y];if(U&&(!(f==="alignment"?w!==We(U):!1)||L.every(X=>We(X.placement)===w?X.overflows[0]>0:!0)))return{data:{index:y,overflows:L},reset:{placement:U}};let V=(C=L.filter(H=>H.overflows[0]<=0).sort((H,X)=>H.overflows[1]-X.overflows[1])[0])==null?void 0:C.placement;if(!V)switch(d){case"bestFit":{var D;const H=(D=L.filter(X=>{if(R){const B=We(X.placement);return B===w||B==="y"}return!0}).map(X=>[X.placement,X.overflows.filter(B=>B>0).reduce((B,Z)=>B+Z,0)]).sort((X,B)=>X[1]-B[1])[0])==null?void 0:D[0];H&&(V=H);break}case"initialPlacement":V=a;break}if(o!==V)return{reset:{placement:V}}}return{}}}};function No(e,n){return{top:e.top-n.height,right:e.right-n.width,bottom:e.bottom-n.height,left:e.left-n.width}}function jo(e){return ku.some(n=>e[n]>=0)}const Fu=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(n){const{rects:t,platform:r}=n,{strategy:o="referenceHidden",...i}=Xe(e,n);switch(o){case"referenceHidden":{const s=await r.detectOverflow(n,{...i,elementContext:"reference"}),a=No(s,t.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:jo(a)}}}case"escaped":{const s=await r.detectOverflow(n,{...i,altBoundary:!0}),a=No(s,t.floating);return{data:{escapedOffsets:a,escaped:jo(a)}}}default:return{}}}}},Qi=new Set(["left","top"]);async function Lu(e,n){const{placement:t,platform:r,elements:o}=e,i=await(r.isRTL==null?void 0:r.isRTL(o.floating)),s=Qe(t),a=Ot(t),l=We(t)==="y",u=Qi.has(s)?-1:1,h=i&&l?-1:1,f=Xe(n,e);let{mainAxis:x,crossAxis:d,alignmentAxis:b}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return a&&typeof b=="number"&&(d=a==="end"?b*-1:b),l?{x:d*h,y:x*u}:{x:x*u,y:d*h}}const Bu=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(n){var t,r;const{x:o,y:i,placement:s,middlewareData:a}=n,l=await Lu(n,e);return s===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+l.x,y:i+l.y,data:{...l,placement:s}}}}},zu=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(n){const{x:t,y:r,placement:o,platform:i}=n,{mainAxis:s=!0,crossAxis:a=!1,limiter:l={fn:g=>{let{x:w,y:_}=g;return{x:w,y:_}}},...u}=Xe(e,n),h={x:t,y:r},f=await i.detectOverflow(n,u),x=We(Qe(o)),d=Ir(x);let b=h[d],p=h[x];if(s){const g=d==="y"?"top":"left",w=d==="y"?"bottom":"right",_=b+f[g],E=b-f[w];b=ur(_,b,E)}if(a){const g=x==="y"?"top":"left",w=x==="y"?"bottom":"right",_=p+f[g],E=p-f[w];p=ur(_,p,E)}const m=l.fn({...n,[d]:b,[x]:p});return{...m,data:{x:m.x-t,y:m.y-r,enabled:{[d]:s,[x]:a}}}}}},Uu=function(e){return e===void 0&&(e={}),{options:e,fn(n){const{x:t,y:r,placement:o,rects:i,middlewareData:s}=n,{offset:a=0,mainAxis:l=!0,crossAxis:u=!0}=Xe(e,n),h={x:t,y:r},f=We(o),x=Ir(f);let d=h[x],b=h[f];const p=Xe(a,n),m=typeof p=="number"?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(l){const _=x==="y"?"height":"width",E=i.reference[x]-i.floating[_]+m.mainAxis,S=i.reference[x]+i.reference[_]-m.mainAxis;d<E?d=E:d>S&&(d=S)}if(u){var g,w;const _=x==="y"?"width":"height",E=Qi.has(Qe(o)),S=i.reference[f]-i.floating[_]+(E&&((g=s.offset)==null?void 0:g[f])||0)+(E?0:m.crossAxis),R=i.reference[f]+i.reference[_]+(E?0:((w=s.offset)==null?void 0:w[f])||0)-(E?m.crossAxis:0);b<S?b=S:b>R&&(b=R)}return{[x]:d,[f]:b}}}},$u=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(n){var t,r;const{placement:o,rects:i,platform:s,elements:a}=n,{apply:l=()=>{},...u}=Xe(e,n),h=await s.detectOverflow(n,u),f=Qe(o),x=Ot(o),d=We(o)==="y",{width:b,height:p}=i.floating;let m,g;f==="top"||f==="bottom"?(m=f,g=x===(await(s.isRTL==null?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(g=f,m=x==="end"?"top":"bottom");const w=p-h.top-h.bottom,_=b-h.left-h.right,E=it(p-h[m],w),S=it(b-h[g],_),R=!n.middlewareData.shift;let j=E,M=S;if((t=n.middlewareData.shift)!=null&&t.enabled.x&&(M=_),(r=n.middlewareData.shift)!=null&&r.enabled.y&&(j=w),R&&!x){const L=Ie(h.left,0),K=Ie(h.right,0),C=Ie(h.top,0),D=Ie(h.bottom,0);d?M=b-2*(L!==0||K!==0?L+K:Ie(h.left,h.right)):j=p-2*(C!==0||D!==0?C+D:Ie(h.top,h.bottom))}await l({...n,availableWidth:M,availableHeight:j});const I=await s.getDimensions(a.floating);return b!==I.width||p!==I.height?{reset:{rects:!0}}:{}}}};function Tn(){return typeof window<"u"}function Tt(e){return Ji(e)?(e.nodeName||"").toLowerCase():"#document"}function Pe(e){var n;return(e==null||(n=e.ownerDocument)==null?void 0:n.defaultView)||window}function Ge(e){var n;return(n=(Ji(e)?e.ownerDocument:e.document)||window.document)==null?void 0:n.documentElement}function Ji(e){return Tn()?e instanceof Node||e instanceof Pe(e).Node:!1}function Le(e){return Tn()?e instanceof Element||e instanceof Pe(e).Element:!1}function Ze(e){return Tn()?e instanceof HTMLElement||e instanceof Pe(e).HTMLElement:!1}function Ro(e){return!Tn()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Pe(e).ShadowRoot}const Wu=new Set(["inline","contents"]);function qt(e){const{overflow:n,overflowX:t,overflowY:r,display:o}=Be(e);return/auto|scroll|overlay|hidden|clip/.test(n+r+t)&&!Wu.has(o)}const Hu=new Set(["table","td","th"]);function Ku(e){return Hu.has(Tt(e))}const Zu=[":popover-open",":modal"];function In(e){return Zu.some(n=>{try{return e.matches(n)}catch{return!1}})}const Gu=["transform","translate","scale","rotate","perspective"],Yu=["transform","translate","scale","rotate","perspective","filter"],Vu=["paint","layout","strict","content"];function Dr(e){const n=Fr(),t=Le(e)?Be(e):e;return Gu.some(r=>t[r]?t[r]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!n&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!n&&(t.filter?t.filter!=="none":!1)||Yu.some(r=>(t.willChange||"").includes(r))||Vu.some(r=>(t.contain||"").includes(r))}function qu(e){let n=st(e);for(;Ze(n)&&!At(n);){if(Dr(n))return n;if(In(n))return null;n=st(n)}return null}function Fr(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Xu=new Set(["html","body","#document"]);function At(e){return Xu.has(Tt(e))}function Be(e){return Pe(e).getComputedStyle(e)}function Pn(e){return Le(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function st(e){if(Tt(e)==="html")return e;const n=e.assignedSlot||e.parentNode||Ro(e)&&e.host||Ge(e);return Ro(n)?n.host:n}function es(e){const n=st(e);return At(n)?e.ownerDocument?e.ownerDocument.body:e.body:Ze(n)&&qt(n)?n:es(n)}function $t(e,n,t){var r;n===void 0&&(n=[]),t===void 0&&(t=!0);const o=es(e),i=o===((r=e.ownerDocument)==null?void 0:r.body),s=Pe(o);if(i){const a=fr(s);return n.concat(s,s.visualViewport||[],qt(o)?o:[],a&&t?$t(a):[])}return n.concat(o,$t(o,[],t))}function fr(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function ts(e){const n=Be(e);let t=parseFloat(n.width)||0,r=parseFloat(n.height)||0;const o=Ze(e),i=o?e.offsetWidth:t,s=o?e.offsetHeight:r,a=gn(t)!==i||gn(r)!==s;return a&&(t=i,r=s),{width:t,height:r,$:a}}function Lr(e){return Le(e)?e:e.contextElement}function Et(e){const n=Lr(e);if(!Ze(n))return He(1);const t=n.getBoundingClientRect(),{width:r,height:o,$:i}=ts(n);let s=(i?gn(t.width):t.width)/r,a=(i?gn(t.height):t.height)/o;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const Qu=He(0);function ns(e){const n=Pe(e);return!Fr()||!n.visualViewport?Qu:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function Ju(e,n,t){return n===void 0&&(n=!1),!t||n&&t!==Pe(e)?!1:n}function pt(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=!1);const o=e.getBoundingClientRect(),i=Lr(e);let s=He(1);n&&(r?Le(r)&&(s=Et(r)):s=Et(e));const a=Ju(i,t,r)?ns(i):He(0);let l=(o.left+a.x)/s.x,u=(o.top+a.y)/s.y,h=o.width/s.x,f=o.height/s.y;if(i){const x=Pe(i),d=r&&Le(r)?Pe(r):r;let b=x,p=fr(b);for(;p&&r&&d!==b;){const m=Et(p),g=p.getBoundingClientRect(),w=Be(p),_=g.left+(p.clientLeft+parseFloat(w.paddingLeft))*m.x,E=g.top+(p.clientTop+parseFloat(w.paddingTop))*m.y;l*=m.x,u*=m.y,h*=m.x,f*=m.y,l+=_,u+=E,b=Pe(p),p=fr(b)}}return vn({width:h,height:f,x:l,y:u})}function Mn(e,n){const t=Pn(e).scrollLeft;return n?n.left+t:pt(Ge(e)).left+t}function rs(e,n){const t=e.getBoundingClientRect(),r=t.left+n.scrollLeft-Mn(e,t),o=t.top+n.scrollTop;return{x:r,y:o}}function ed(e){let{elements:n,rect:t,offsetParent:r,strategy:o}=e;const i=o==="fixed",s=Ge(r),a=n?In(n.floating):!1;if(r===s||a&&i)return t;let l={scrollLeft:0,scrollTop:0},u=He(1);const h=He(0),f=Ze(r);if((f||!f&&!i)&&((Tt(r)!=="body"||qt(s))&&(l=Pn(r)),Ze(r))){const d=pt(r);u=Et(r),h.x=d.x+r.clientLeft,h.y=d.y+r.clientTop}const x=s&&!f&&!i?rs(s,l):He(0);return{width:t.width*u.x,height:t.height*u.y,x:t.x*u.x-l.scrollLeft*u.x+h.x+x.x,y:t.y*u.y-l.scrollTop*u.y+h.y+x.y}}function td(e){return Array.from(e.getClientRects())}function nd(e){const n=Ge(e),t=Pn(e),r=e.ownerDocument.body,o=Ie(n.scrollWidth,n.clientWidth,r.scrollWidth,r.clientWidth),i=Ie(n.scrollHeight,n.clientHeight,r.scrollHeight,r.clientHeight);let s=-t.scrollLeft+Mn(e);const a=-t.scrollTop;return Be(r).direction==="rtl"&&(s+=Ie(n.clientWidth,r.clientWidth)-o),{width:o,height:i,x:s,y:a}}const Oo=25;function rd(e,n){const t=Pe(e),r=Ge(e),o=t.visualViewport;let i=r.clientWidth,s=r.clientHeight,a=0,l=0;if(o){i=o.width,s=o.height;const h=Fr();(!h||h&&n==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}const u=Mn(r);if(u<=0){const h=r.ownerDocument,f=h.body,x=getComputedStyle(f),d=h.compatMode==="CSS1Compat"&&parseFloat(x.marginLeft)+parseFloat(x.marginRight)||0,b=Math.abs(r.clientWidth-f.clientWidth-d);b<=Oo&&(i-=b)}else u<=Oo&&(i+=u);return{width:i,height:s,x:a,y:l}}const od=new Set(["absolute","fixed"]);function id(e,n){const t=pt(e,!0,n==="fixed"),r=t.top+e.clientTop,o=t.left+e.clientLeft,i=Ze(e)?Et(e):He(1),s=e.clientWidth*i.x,a=e.clientHeight*i.y,l=o*i.x,u=r*i.y;return{width:s,height:a,x:l,y:u}}function To(e,n,t){let r;if(n==="viewport")r=rd(e,t);else if(n==="document")r=nd(Ge(e));else if(Le(n))r=id(n,t);else{const o=ns(e);r={x:n.x-o.x,y:n.y-o.y,width:n.width,height:n.height}}return vn(r)}function os(e,n){const t=st(e);return t===n||!Le(t)||At(t)?!1:Be(t).position==="fixed"||os(t,n)}function sd(e,n){const t=n.get(e);if(t)return t;let r=$t(e,[],!1).filter(a=>Le(a)&&Tt(a)!=="body"),o=null;const i=Be(e).position==="fixed";let s=i?st(e):e;for(;Le(s)&&!At(s);){const a=Be(s),l=Dr(s);!l&&a.position==="fixed"&&(o=null),(i?!l&&!o:!l&&a.position==="static"&&!!o&&od.has(o.position)||qt(s)&&!l&&os(e,s))?r=r.filter(h=>h!==s):o=a,s=st(s)}return n.set(e,r),r}function ad(e){let{element:n,boundary:t,rootBoundary:r,strategy:o}=e;const s=[...t==="clippingAncestors"?In(n)?[]:sd(n,this._c):[].concat(t),r],a=s[0],l=s.reduce((u,h)=>{const f=To(n,h,o);return u.top=Ie(f.top,u.top),u.right=it(f.right,u.right),u.bottom=it(f.bottom,u.bottom),u.left=Ie(f.left,u.left),u},To(n,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function ld(e){const{width:n,height:t}=ts(e);return{width:n,height:t}}function cd(e,n,t){const r=Ze(n),o=Ge(n),i=t==="fixed",s=pt(e,!0,i,n);let a={scrollLeft:0,scrollTop:0};const l=He(0);function u(){l.x=Mn(o)}if(r||!r&&!i)if((Tt(n)!=="body"||qt(o))&&(a=Pn(n)),r){const d=pt(n,!0,i,n);l.x=d.x+n.clientLeft,l.y=d.y+n.clientTop}else o&&u();i&&!r&&o&&u();const h=o&&!r&&!i?rs(o,a):He(0),f=s.left+a.scrollLeft-l.x-h.x,x=s.top+a.scrollTop-l.y-h.y;return{x:f,y:x,width:s.width,height:s.height}}function Qn(e){return Be(e).position==="static"}function Io(e,n){if(!Ze(e)||Be(e).position==="fixed")return null;if(n)return n(e);let t=e.offsetParent;return Ge(e)===t&&(t=t.ownerDocument.body),t}function is(e,n){const t=Pe(e);if(In(e))return t;if(!Ze(e)){let o=st(e);for(;o&&!At(o);){if(Le(o)&&!Qn(o))return o;o=st(o)}return t}let r=Io(e,n);for(;r&&Ku(r)&&Qn(r);)r=Io(r,n);return r&&At(r)&&Qn(r)&&!Dr(r)?t:r||qu(e)||t}const ud=async function(e){const n=this.getOffsetParent||is,t=this.getDimensions,r=await t(e.floating);return{reference:cd(e.reference,await n(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function dd(e){return Be(e).direction==="rtl"}const fd={convertOffsetParentRelativeRectToViewportRelativeRect:ed,getDocumentElement:Ge,getClippingRect:ad,getOffsetParent:is,getElementRects:ud,getClientRects:td,getDimensions:ld,getScale:Et,isElement:Le,isRTL:dd};function ss(e,n){return e.x===n.x&&e.y===n.y&&e.width===n.width&&e.height===n.height}function pd(e,n){let t=null,r;const o=Ge(e);function i(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),i();const u=e.getBoundingClientRect(),{left:h,top:f,width:x,height:d}=u;if(a||n(),!x||!d)return;const b=cn(f),p=cn(o.clientWidth-(h+x)),m=cn(o.clientHeight-(f+d)),g=cn(h),_={rootMargin:-b+"px "+-p+"px "+-m+"px "+-g+"px",threshold:Ie(0,it(1,l))||1};let E=!0;function S(R){const j=R[0].intersectionRatio;if(j!==l){if(!E)return s();j?s(!1,j):r=setTimeout(()=>{s(!1,1e-7)},1e3)}j===1&&!ss(u,e.getBoundingClientRect())&&s(),E=!1}try{t=new IntersectionObserver(S,{..._,root:o.ownerDocument})}catch{t=new IntersectionObserver(S,_)}t.observe(e)}return s(!0),i}function hd(e,n,t,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,u=Lr(e),h=o||i?[...u?$t(u):[],...$t(n)]:[];h.forEach(g=>{o&&g.addEventListener("scroll",t,{passive:!0}),i&&g.addEventListener("resize",t)});const f=u&&a?pd(u,t):null;let x=-1,d=null;s&&(d=new ResizeObserver(g=>{let[w]=g;w&&w.target===u&&d&&(d.unobserve(n),cancelAnimationFrame(x),x=requestAnimationFrame(()=>{var _;(_=d)==null||_.observe(n)})),t()}),u&&!l&&d.observe(u),d.observe(n));let b,p=l?pt(e):null;l&&m();function m(){const g=pt(e);p&&!ss(p,g)&&t(),p=g,b=requestAnimationFrame(m)}return t(),()=>{var g;h.forEach(w=>{o&&w.removeEventListener("scroll",t),i&&w.removeEventListener("resize",t)}),f?.(),(g=d)==null||g.disconnect(),d=null,l&&cancelAnimationFrame(b)}}const md=Bu,gd=zu,xd=Du,vd=$u,bd=Fu,Po=Mu,yd=Uu,wd=(e,n,t)=>{const r=new Map,o={platform:fd,...t},i={...o.platform,_c:r};return Pu(e,n,{...o,platform:i})};var kd=typeof document<"u",_d=function(){},pn=kd?k.useLayoutEffect:_d;function bn(e,n){if(e===n)return!0;if(typeof e!=typeof n)return!1;if(typeof e=="function"&&e.toString()===n.toString())return!0;let t,r,o;if(e&&n&&typeof e=="object"){if(Array.isArray(e)){if(t=e.length,t!==n.length)return!1;for(r=t;r--!==0;)if(!bn(e[r],n[r]))return!1;return!0}if(o=Object.keys(e),t=o.length,t!==Object.keys(n).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(n,o[r]))return!1;for(r=t;r--!==0;){const i=o[r];if(!(i==="_owner"&&e.$$typeof)&&!bn(e[i],n[i]))return!1}return!0}return e!==e&&n!==n}function as(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Mo(e,n){const t=as(e);return Math.round(n*t)/t}function Jn(e){const n=k.useRef(e);return pn(()=>{n.current=e}),n}function Cd(e){e===void 0&&(e={});const{placement:n="bottom",strategy:t="absolute",middleware:r=[],platform:o,elements:{reference:i,floating:s}={},transform:a=!0,whileElementsMounted:l,open:u}=e,[h,f]=k.useState({x:0,y:0,strategy:t,placement:n,middlewareData:{},isPositioned:!1}),[x,d]=k.useState(r);bn(x,r)||d(r);const[b,p]=k.useState(null),[m,g]=k.useState(null),w=k.useCallback(X=>{X!==R.current&&(R.current=X,p(X))},[]),_=k.useCallback(X=>{X!==j.current&&(j.current=X,g(X))},[]),E=i||b,S=s||m,R=k.useRef(null),j=k.useRef(null),M=k.useRef(h),I=l!=null,L=Jn(l),K=Jn(o),C=Jn(u),D=k.useCallback(()=>{if(!R.current||!j.current)return;const X={placement:n,strategy:t,middleware:x};K.current&&(X.platform=K.current),wd(R.current,j.current,X).then(B=>{const Z={...B,isPositioned:C.current!==!1};y.current&&!bn(M.current,Z)&&(M.current=Z,gi.flushSync(()=>{f(Z)}))})},[x,n,t,K,C]);pn(()=>{u===!1&&M.current.isPositioned&&(M.current.isPositioned=!1,f(X=>({...X,isPositioned:!1})))},[u]);const y=k.useRef(!1);pn(()=>(y.current=!0,()=>{y.current=!1}),[]),pn(()=>{if(E&&(R.current=E),S&&(j.current=S),E&&S){if(L.current)return L.current(E,S,D);D()}},[E,S,D,L,I]);const U=k.useMemo(()=>({reference:R,floating:j,setReference:w,setFloating:_}),[w,_]),V=k.useMemo(()=>({reference:E,floating:S}),[E,S]),H=k.useMemo(()=>{const X={position:t,left:0,top:0};if(!V.floating)return X;const B=Mo(V.floating,h.x),Z=Mo(V.floating,h.y);return a?{...X,transform:"translate("+B+"px, "+Z+"px)",...as(V.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:B,top:Z}},[t,a,V.floating,h.x,h.y]);return k.useMemo(()=>({...h,update:D,refs:U,elements:V,floatingStyles:H}),[h,D,U,V,H])}const Sd=e=>{function n(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:e,fn(t){const{element:r,padding:o}=typeof e=="function"?e(t):e;return r&&n(r)?r.current!=null?Po({element:r.current,padding:o}).fn(t):{}:r?Po({element:r,padding:o}).fn(t):{}}}},Ed=(e,n)=>({...md(e),options:[e,n]}),Ad=(e,n)=>({...gd(e),options:[e,n]}),Nd=(e,n)=>({...yd(e),options:[e,n]}),jd=(e,n)=>({...xd(e),options:[e,n]}),Rd=(e,n)=>({...vd(e),options:[e,n]}),Od=(e,n)=>({...bd(e),options:[e,n]}),Td=(e,n)=>({...Sd(e),options:[e,n]});var Id="Arrow",ls=k.forwardRef((e,n)=>{const{children:t,width:r=10,height:o=5,...i}=e;return c.jsx(Ee.svg,{...i,ref:n,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?t:c.jsx("polygon",{points:"0,0 30,0 15,10"})})});ls.displayName=Id;var Pd=ls,Br="Popper",[cs,Dn]=Rt(Br),[Md,us]=cs(Br),ds=e=>{const{__scopePopper:n,children:t}=e,[r,o]=k.useState(null);return c.jsx(Md,{scope:n,anchor:r,onAnchorChange:o,children:t})};ds.displayName=Br;var fs="PopperAnchor",ps=k.forwardRef((e,n)=>{const{__scopePopper:t,virtualRef:r,...o}=e,i=us(fs,t),s=k.useRef(null),a=Ae(n,s),l=k.useRef(null);return k.useEffect(()=>{const u=l.current;l.current=r?.current||s.current,u!==l.current&&i.onAnchorChange(l.current)}),r?null:c.jsx(Ee.div,{...o,ref:a})});ps.displayName=fs;var zr="PopperContent",[Dd,Fd]=cs(zr),hs=k.forwardRef((e,n)=>{const{__scopePopper:t,side:r="bottom",sideOffset:o=0,align:i="center",alignOffset:s=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:u=[],collisionPadding:h=0,sticky:f="partial",hideWhenDetached:x=!1,updatePositionStrategy:d="optimized",onPlaced:b,...p}=e,m=us(zr,t),[g,w]=k.useState(null),_=Ae(n,q=>w(q)),[E,S]=k.useState(null),R=wu(E),j=R?.width??0,M=R?.height??0,I=r+(i!=="center"?"-"+i:""),L=typeof h=="number"?h:{top:0,right:0,bottom:0,left:0,...h},K=Array.isArray(u)?u:[u],C=K.length>0,D={padding:L,boundary:K.filter(Bd),altBoundary:C},{refs:y,floatingStyles:U,placement:V,isPositioned:H,middlewareData:X}=Cd({strategy:"fixed",placement:I,whileElementsMounted:(...q)=>hd(...q,{animationFrame:d==="always"}),elements:{reference:m.anchor},middleware:[Ed({mainAxis:o+M,alignmentAxis:s}),l&&Ad({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?Nd():void 0,...D}),l&&jd({...D}),Rd({...D,apply:({elements:q,rects:re,availableWidth:se,availableHeight:me})=>{const{width:he,height:Oe}=re.reference,ke=q.floating.style;ke.setProperty("--radix-popper-available-width",`${se}px`),ke.setProperty("--radix-popper-available-height",`${me}px`),ke.setProperty("--radix-popper-anchor-width",`${he}px`),ke.setProperty("--radix-popper-anchor-height",`${Oe}px`)}}),E&&Td({element:E,padding:a}),zd({arrowWidth:j,arrowHeight:M}),x&&Od({strategy:"referenceHidden",...D})]}),[B,Z]=xs(V),P=qe(b);ot(()=>{H&&P?.()},[H,P]);const T=X.arrow?.x,te=X.arrow?.y,ee=X.arrow?.centerOffset!==0,[J,ce]=k.useState();return ot(()=>{g&&ce(window.getComputedStyle(g).zIndex)},[g]),c.jsx("div",{ref:y.setFloating,"data-radix-popper-content-wrapper":"",style:{...U,transform:H?U.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:J,"--radix-popper-transform-origin":[X.transformOrigin?.x,X.transformOrigin?.y].join(" "),...X.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:c.jsx(Dd,{scope:t,placedSide:B,onArrowChange:S,arrowX:T,arrowY:te,shouldHideArrow:ee,children:c.jsx(Ee.div,{"data-side":B,"data-align":Z,...p,ref:_,style:{...p.style,animation:H?void 0:"none"}})})})});hs.displayName=zr;var ms="PopperArrow",Ld={top:"bottom",right:"left",bottom:"top",left:"right"},gs=k.forwardRef(function(n,t){const{__scopePopper:r,...o}=n,i=Fd(ms,r),s=Ld[i.placedSide];return c.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:c.jsx(Pd,{...o,ref:t,style:{...o.style,display:"block"}})})});gs.displayName=ms;function Bd(e){return e!==null}var zd=e=>({name:"transformOrigin",options:e,fn(n){const{placement:t,rects:r,middlewareData:o}=n,s=o.arrow?.centerOffset!==0,a=s?0:e.arrowWidth,l=s?0:e.arrowHeight,[u,h]=xs(t),f={start:"0%",center:"50%",end:"100%"}[h],x=(o.arrow?.x??0)+a/2,d=(o.arrow?.y??0)+l/2;let b="",p="";return u==="bottom"?(b=s?f:`${x}px`,p=`${-l}px`):u==="top"?(b=s?f:`${x}px`,p=`${r.floating.height+l}px`):u==="right"?(b=`${-l}px`,p=s?f:`${d}px`):u==="left"&&(b=`${r.floating.width+l}px`,p=s?f:`${d}px`),{data:{x:b,y:p}}}});function xs(e){const[n,t="center"]=e.split("-");return[n,t]}var vs=ds,Ur=ps,bs=hs,ys=gs,er="rovingFocusGroup.onEntryFocus",Ud={bubbles:!1,cancelable:!0},Xt="RovingFocusGroup",[pr,ws,$d]=Di(Xt),[Wd,ks]=Rt(Xt,[$d]),[Hd,Kd]=Wd(Xt),_s=k.forwardRef((e,n)=>c.jsx(pr.Provider,{scope:e.__scopeRovingFocusGroup,children:c.jsx(pr.Slot,{scope:e.__scopeRovingFocusGroup,children:c.jsx(Zd,{...e,ref:n})})}));_s.displayName=Xt;var Zd=k.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:o=!1,dir:i,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:u,preventScrollOnEntryFocus:h=!1,...f}=e,x=k.useRef(null),d=Ae(n,x),b=Fi(i),[p,m]=Nr({prop:s,defaultProp:a??null,onChange:l,caller:Xt}),[g,w]=k.useState(!1),_=qe(u),E=ws(t),S=k.useRef(!1),[R,j]=k.useState(0);return k.useEffect(()=>{const M=x.current;if(M)return M.addEventListener(er,_),()=>M.removeEventListener(er,_)},[_]),c.jsx(Hd,{scope:t,orientation:r,dir:b,loop:o,currentTabStopId:p,onItemFocus:k.useCallback(M=>m(M),[m]),onItemShiftTab:k.useCallback(()=>w(!0),[]),onFocusableItemAdd:k.useCallback(()=>j(M=>M+1),[]),onFocusableItemRemove:k.useCallback(()=>j(M=>M-1),[]),children:c.jsx(Ee.div,{tabIndex:g||R===0?-1:0,"data-orientation":r,...f,ref:d,style:{outline:"none",...e.style},onMouseDown:le(e.onMouseDown,()=>{S.current=!0}),onFocus:le(e.onFocus,M=>{const I=!S.current;if(M.target===M.currentTarget&&I&&!g){const L=new CustomEvent(er,Ud);if(M.currentTarget.dispatchEvent(L),!L.defaultPrevented){const K=E().filter(V=>V.focusable),C=K.find(V=>V.active),D=K.find(V=>V.id===p),U=[C,D,...K].filter(Boolean).map(V=>V.ref.current);Es(U,h)}}S.current=!1}),onBlur:le(e.onBlur,()=>w(!1))})})}),Cs="RovingFocusGroupItem",Ss=k.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:o=!1,tabStopId:i,children:s,...a}=e,l=mn(),u=i||l,h=Kd(Cs,t),f=h.currentTabStopId===u,x=ws(t),{onFocusableItemAdd:d,onFocusableItemRemove:b,currentTabStopId:p}=h;return k.useEffect(()=>{if(r)return d(),()=>b()},[r,d,b]),c.jsx(pr.ItemSlot,{scope:t,id:u,focusable:r,active:o,children:c.jsx(Ee.span,{tabIndex:f?0:-1,"data-orientation":h.orientation,...a,ref:n,onMouseDown:le(e.onMouseDown,m=>{r?h.onItemFocus(u):m.preventDefault()}),onFocus:le(e.onFocus,()=>h.onItemFocus(u)),onKeyDown:le(e.onKeyDown,m=>{if(m.key==="Tab"&&m.shiftKey){h.onItemShiftTab();return}if(m.target!==m.currentTarget)return;const g=Vd(m,h.orientation,h.dir);if(g!==void 0){if(m.metaKey||m.ctrlKey||m.altKey||m.shiftKey)return;m.preventDefault();let _=x().filter(E=>E.focusable).map(E=>E.ref.current);if(g==="last")_.reverse();else if(g==="prev"||g==="next"){g==="prev"&&_.reverse();const E=_.indexOf(m.currentTarget);_=h.loop?qd(_,E+1):_.slice(E+1)}setTimeout(()=>Es(_))}}),children:typeof s=="function"?s({isCurrentTabStop:f,hasTabStop:p!=null}):s})})});Ss.displayName=Cs;var Gd={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Yd(e,n){return n!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Vd(e,n,t){const r=Yd(e.key,t);if(!(n==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(n==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return Gd[r]}function Es(e,n=!1){const t=document.activeElement;for(const r of e)if(r===t||(r.focus({preventScroll:n}),document.activeElement!==t))return}function qd(e,n){return e.map((t,r)=>e[(n+r)%e.length])}var Xd=_s,Qd=Ss,hr=["Enter"," "],Jd=["ArrowDown","PageUp","Home"],As=["ArrowUp","PageDown","End"],ef=[...Jd,...As],tf={ltr:[...hr,"ArrowRight"],rtl:[...hr,"ArrowLeft"]},nf={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Qt="Menu",[Wt,rf,of]=Di(Qt),[mt,Ns]=Rt(Qt,[of,Dn,ks]),Fn=Dn(),js=ks(),[sf,gt]=mt(Qt),[af,Jt]=mt(Qt),Rs=e=>{const{__scopeMenu:n,open:t=!1,children:r,dir:o,onOpenChange:i,modal:s=!0}=e,a=Fn(n),[l,u]=k.useState(null),h=k.useRef(!1),f=qe(i),x=Fi(o);return k.useEffect(()=>{const d=()=>{h.current=!0,document.addEventListener("pointerdown",b,{capture:!0,once:!0}),document.addEventListener("pointermove",b,{capture:!0,once:!0})},b=()=>h.current=!1;return document.addEventListener("keydown",d,{capture:!0}),()=>{document.removeEventListener("keydown",d,{capture:!0}),document.removeEventListener("pointerdown",b,{capture:!0}),document.removeEventListener("pointermove",b,{capture:!0})}},[]),c.jsx(vs,{...a,children:c.jsx(sf,{scope:n,open:t,onOpenChange:f,content:l,onContentChange:u,children:c.jsx(af,{scope:n,onClose:k.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:h,dir:x,modal:s,children:r})})})};Rs.displayName=Qt;var lf="MenuAnchor",$r=k.forwardRef((e,n)=>{const{__scopeMenu:t,...r}=e,o=Fn(t);return c.jsx(Ur,{...o,...r,ref:n})});$r.displayName=lf;var Wr="MenuPortal",[cf,Os]=mt(Wr,{forceMount:void 0}),Ts=e=>{const{__scopeMenu:n,forceMount:t,children:r,container:o}=e,i=gt(Wr,n);return c.jsx(cf,{scope:n,forceMount:t,children:c.jsx(ht,{present:t||i.open,children:c.jsx(Or,{asChild:!0,container:o,children:r})})})};Ts.displayName=Wr;var De="MenuContent",[uf,Hr]=mt(De),Is=k.forwardRef((e,n)=>{const t=Os(De,e.__scopeMenu),{forceMount:r=t.forceMount,...o}=e,i=gt(De,e.__scopeMenu),s=Jt(De,e.__scopeMenu);return c.jsx(Wt.Provider,{scope:e.__scopeMenu,children:c.jsx(ht,{present:r||i.open,children:c.jsx(Wt.Slot,{scope:e.__scopeMenu,children:s.modal?c.jsx(df,{...o,ref:n}):c.jsx(ff,{...o,ref:n})})})})}),df=k.forwardRef((e,n)=>{const t=gt(De,e.__scopeMenu),r=k.useRef(null),o=Ae(n,r);return k.useEffect(()=>{const i=r.current;if(i)return qi(i)},[]),c.jsx(Kr,{...e,ref:o,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:le(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),ff=k.forwardRef((e,n)=>{const t=gt(De,e.__scopeMenu);return c.jsx(Kr,{...e,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),pf=Ut("MenuContent.ScrollLock"),Kr=k.forwardRef((e,n)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:o,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:u,onPointerDownOutside:h,onFocusOutside:f,onInteractOutside:x,onDismiss:d,disableOutsideScroll:b,...p}=e,m=gt(De,t),g=Jt(De,t),w=Fn(t),_=js(t),E=rf(t),[S,R]=k.useState(null),j=k.useRef(null),M=Ae(n,j,m.onContentChange),I=k.useRef(0),L=k.useRef(""),K=k.useRef(0),C=k.useRef(null),D=k.useRef("right"),y=k.useRef(0),U=b?Tr:k.Fragment,V=b?{as:pf,allowPinchZoom:!0}:void 0,H=B=>{const Z=L.current+B,P=E().filter(q=>!q.disabled),T=document.activeElement,te=P.find(q=>q.ref.current===T)?.textValue,ee=P.map(q=>q.textValue),J=Sf(ee,Z,te),ce=P.find(q=>q.textValue===J)?.ref.current;(function q(re){L.current=re,window.clearTimeout(I.current),re!==""&&(I.current=window.setTimeout(()=>q(""),1e3))})(Z),ce&&setTimeout(()=>ce.focus())};k.useEffect(()=>()=>window.clearTimeout(I.current),[]),Ui();const X=k.useCallback(B=>D.current===C.current?.side&&Af(B,C.current?.area),[]);return c.jsx(uf,{scope:t,searchRef:L,onItemEnter:k.useCallback(B=>{X(B)&&B.preventDefault()},[X]),onItemLeave:k.useCallback(B=>{X(B)||(j.current?.focus(),R(null))},[X]),onTriggerLeave:k.useCallback(B=>{X(B)&&B.preventDefault()},[X]),pointerGraceTimerRef:K,onPointerGraceIntentChange:k.useCallback(B=>{C.current=B},[]),children:c.jsx(U,{...V,children:c.jsx(Rr,{asChild:!0,trapped:o,onMountAutoFocus:le(i,B=>{B.preventDefault(),j.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:s,children:c.jsx(jr,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:u,onPointerDownOutside:h,onFocusOutside:f,onInteractOutside:x,onDismiss:d,children:c.jsx(Xd,{asChild:!0,..._,dir:g.dir,orientation:"vertical",loop:r,currentTabStopId:S,onCurrentTabStopIdChange:R,onEntryFocus:le(l,B=>{g.isUsingKeyboardRef.current||B.preventDefault()}),preventScrollOnEntryFocus:!0,children:c.jsx(bs,{role:"menu","aria-orientation":"vertical","data-state":Vs(m.open),"data-radix-menu-content":"",dir:g.dir,...w,...p,ref:M,style:{outline:"none",...p.style},onKeyDown:le(p.onKeyDown,B=>{const P=B.target.closest("[data-radix-menu-content]")===B.currentTarget,T=B.ctrlKey||B.altKey||B.metaKey,te=B.key.length===1;P&&(B.key==="Tab"&&B.preventDefault(),!T&&te&&H(B.key));const ee=j.current;if(B.target!==ee||!ef.includes(B.key))return;B.preventDefault();const ce=E().filter(q=>!q.disabled).map(q=>q.ref.current);As.includes(B.key)&&ce.reverse(),_f(ce)}),onBlur:le(e.onBlur,B=>{B.currentTarget.contains(B.target)||(window.clearTimeout(I.current),L.current="")}),onPointerMove:le(e.onPointerMove,Ht(B=>{const Z=B.target,P=y.current!==B.clientX;if(B.currentTarget.contains(Z)&&P){const T=B.clientX>y.current?"right":"left";D.current=T,y.current=B.clientX}}))})})})})})})});Is.displayName=De;var hf="MenuGroup",Zr=k.forwardRef((e,n)=>{const{__scopeMenu:t,...r}=e;return c.jsx(Ee.div,{role:"group",...r,ref:n})});Zr.displayName=hf;var mf="MenuLabel",Ps=k.forwardRef((e,n)=>{const{__scopeMenu:t,...r}=e;return c.jsx(Ee.div,{...r,ref:n})});Ps.displayName=mf;var yn="MenuItem",Do="menu.itemSelect",Ln=k.forwardRef((e,n)=>{const{disabled:t=!1,onSelect:r,...o}=e,i=k.useRef(null),s=Jt(yn,e.__scopeMenu),a=Hr(yn,e.__scopeMenu),l=Ae(n,i),u=k.useRef(!1),h=()=>{const f=i.current;if(!t&&f){const x=new CustomEvent(Do,{bubbles:!0,cancelable:!0});f.addEventListener(Do,d=>r?.(d),{once:!0}),Mi(f,x),x.defaultPrevented?u.current=!1:s.onClose()}};return c.jsx(Ms,{...o,ref:l,disabled:t,onClick:le(e.onClick,h),onPointerDown:f=>{e.onPointerDown?.(f),u.current=!0},onPointerUp:le(e.onPointerUp,f=>{u.current||f.currentTarget?.click()}),onKeyDown:le(e.onKeyDown,f=>{const x=a.searchRef.current!=="";t||x&&f.key===" "||hr.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});Ln.displayName=yn;var Ms=k.forwardRef((e,n)=>{const{__scopeMenu:t,disabled:r=!1,textValue:o,...i}=e,s=Hr(yn,t),a=js(t),l=k.useRef(null),u=Ae(n,l),[h,f]=k.useState(!1),[x,d]=k.useState("");return k.useEffect(()=>{const b=l.current;b&&d((b.textContent??"").trim())},[i.children]),c.jsx(Wt.ItemSlot,{scope:t,disabled:r,textValue:o??x,children:c.jsx(Qd,{asChild:!0,...a,focusable:!r,children:c.jsx(Ee.div,{role:"menuitem","data-highlighted":h?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...i,ref:u,onPointerMove:le(e.onPointerMove,Ht(b=>{r?s.onItemLeave(b):(s.onItemEnter(b),b.defaultPrevented||b.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:le(e.onPointerLeave,Ht(b=>s.onItemLeave(b))),onFocus:le(e.onFocus,()=>f(!0)),onBlur:le(e.onBlur,()=>f(!1))})})})}),gf="MenuCheckboxItem",Ds=k.forwardRef((e,n)=>{const{checked:t=!1,onCheckedChange:r,...o}=e;return c.jsx(Us,{scope:e.__scopeMenu,checked:t,children:c.jsx(Ln,{role:"menuitemcheckbox","aria-checked":wn(t)?"mixed":t,...o,ref:n,"data-state":Yr(t),onSelect:le(o.onSelect,()=>r?.(wn(t)?!0:!t),{checkForDefaultPrevented:!1})})})});Ds.displayName=gf;var Fs="MenuRadioGroup",[xf,vf]=mt(Fs,{value:void 0,onValueChange:()=>{}}),Ls=k.forwardRef((e,n)=>{const{value:t,onValueChange:r,...o}=e,i=qe(r);return c.jsx(xf,{scope:e.__scopeMenu,value:t,onValueChange:i,children:c.jsx(Zr,{...o,ref:n})})});Ls.displayName=Fs;var Bs="MenuRadioItem",zs=k.forwardRef((e,n)=>{const{value:t,...r}=e,o=vf(Bs,e.__scopeMenu),i=t===o.value;return c.jsx(Us,{scope:e.__scopeMenu,checked:i,children:c.jsx(Ln,{role:"menuitemradio","aria-checked":i,...r,ref:n,"data-state":Yr(i),onSelect:le(r.onSelect,()=>o.onValueChange?.(t),{checkForDefaultPrevented:!1})})})});zs.displayName=Bs;var Gr="MenuItemIndicator",[Us,bf]=mt(Gr,{checked:!1}),$s=k.forwardRef((e,n)=>{const{__scopeMenu:t,forceMount:r,...o}=e,i=bf(Gr,t);return c.jsx(ht,{present:r||wn(i.checked)||i.checked===!0,children:c.jsx(Ee.span,{...o,ref:n,"data-state":Yr(i.checked)})})});$s.displayName=Gr;var yf="MenuSeparator",Ws=k.forwardRef((e,n)=>{const{__scopeMenu:t,...r}=e;return c.jsx(Ee.div,{role:"separator","aria-orientation":"horizontal",...r,ref:n})});Ws.displayName=yf;var wf="MenuArrow",Hs=k.forwardRef((e,n)=>{const{__scopeMenu:t,...r}=e,o=Fn(t);return c.jsx(ys,{...o,...r,ref:n})});Hs.displayName=wf;var kf="MenuSub",[dx,Ks]=mt(kf),Ft="MenuSubTrigger",Zs=k.forwardRef((e,n)=>{const t=gt(Ft,e.__scopeMenu),r=Jt(Ft,e.__scopeMenu),o=Ks(Ft,e.__scopeMenu),i=Hr(Ft,e.__scopeMenu),s=k.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=i,u={__scopeMenu:e.__scopeMenu},h=k.useCallback(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return k.useEffect(()=>h,[h]),k.useEffect(()=>{const f=a.current;return()=>{window.clearTimeout(f),l(null)}},[a,l]),c.jsx($r,{asChild:!0,...u,children:c.jsx(Ms,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":o.contentId,"data-state":Vs(t.open),...e,ref:Cr(n,o.onTriggerChange),onClick:f=>{e.onClick?.(f),!(e.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:le(e.onPointerMove,Ht(f=>{i.onItemEnter(f),!f.defaultPrevented&&!e.disabled&&!t.open&&!s.current&&(i.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{t.onOpenChange(!0),h()},100))})),onPointerLeave:le(e.onPointerLeave,Ht(f=>{h();const x=t.content?.getBoundingClientRect();if(x){const d=t.content?.dataset.side,b=d==="right",p=b?-5:5,m=x[b?"left":"right"],g=x[b?"right":"left"];i.onPointerGraceIntentChange({area:[{x:f.clientX+p,y:f.clientY},{x:m,y:x.top},{x:g,y:x.top},{x:g,y:x.bottom},{x:m,y:x.bottom}],side:d}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(f),f.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:le(e.onKeyDown,f=>{const x=i.searchRef.current!=="";e.disabled||x&&f.key===" "||tf[r.dir].includes(f.key)&&(t.onOpenChange(!0),t.content?.focus(),f.preventDefault())})})})});Zs.displayName=Ft;var Gs="MenuSubContent",Ys=k.forwardRef((e,n)=>{const t=Os(De,e.__scopeMenu),{forceMount:r=t.forceMount,...o}=e,i=gt(De,e.__scopeMenu),s=Jt(De,e.__scopeMenu),a=Ks(Gs,e.__scopeMenu),l=k.useRef(null),u=Ae(n,l);return c.jsx(Wt.Provider,{scope:e.__scopeMenu,children:c.jsx(ht,{present:r||i.open,children:c.jsx(Wt.Slot,{scope:e.__scopeMenu,children:c.jsx(Kr,{id:a.contentId,"aria-labelledby":a.triggerId,...o,ref:u,align:"start",side:s.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:h=>{s.isUsingKeyboardRef.current&&l.current?.focus(),h.preventDefault()},onCloseAutoFocus:h=>h.preventDefault(),onFocusOutside:le(e.onFocusOutside,h=>{h.target!==a.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:le(e.onEscapeKeyDown,h=>{s.onClose(),h.preventDefault()}),onKeyDown:le(e.onKeyDown,h=>{const f=h.currentTarget.contains(h.target),x=nf[s.dir].includes(h.key);f&&x&&(i.onOpenChange(!1),a.trigger?.focus(),h.preventDefault())})})})})})});Ys.displayName=Gs;function Vs(e){return e?"open":"closed"}function wn(e){return e==="indeterminate"}function Yr(e){return wn(e)?"indeterminate":e?"checked":"unchecked"}function _f(e){const n=document.activeElement;for(const t of e)if(t===n||(t.focus(),document.activeElement!==n))return}function Cf(e,n){return e.map((t,r)=>e[(n+r)%e.length])}function Sf(e,n,t){const o=n.length>1&&Array.from(n).every(u=>u===n[0])?n[0]:n,i=t?e.indexOf(t):-1;let s=Cf(e,Math.max(i,0));o.length===1&&(s=s.filter(u=>u!==t));const l=s.find(u=>u.toLowerCase().startsWith(o.toLowerCase()));return l!==t?l:void 0}function Ef(e,n){const{x:t,y:r}=e;let o=!1;for(let i=0,s=n.length-1;i<n.length;s=i++){const a=n[i],l=n[s],u=a.x,h=a.y,f=l.x,x=l.y;h>r!=x>r&&t<(f-u)*(r-h)/(x-h)+u&&(o=!o)}return o}function Af(e,n){if(!n)return!1;const t={x:e.clientX,y:e.clientY};return Ef(t,n)}function Ht(e){return n=>n.pointerType==="mouse"?e(n):void 0}var Nf=Rs,jf=$r,Rf=Ts,Of=Is,Tf=Zr,If=Ps,Pf=Ln,Mf=Ds,Df=Ls,Ff=zs,Lf=$s,Bf=Ws,zf=Hs,Uf=Zs,$f=Ys,Bn="DropdownMenu",[Wf]=Rt(Bn,[Ns]),Re=Ns(),[Hf,qs]=Wf(Bn),Xs=e=>{const{__scopeDropdownMenu:n,children:t,dir:r,open:o,defaultOpen:i,onOpenChange:s,modal:a=!0}=e,l=Re(n),u=k.useRef(null),[h,f]=Nr({prop:o,defaultProp:i??!1,onChange:s,caller:Bn});return c.jsx(Hf,{scope:n,triggerId:mn(),triggerRef:u,contentId:mn(),open:h,onOpenChange:f,onOpenToggle:k.useCallback(()=>f(x=>!x),[f]),modal:a,children:c.jsx(Nf,{...l,open:h,onOpenChange:f,dir:r,modal:a,children:t})})};Xs.displayName=Bn;var Qs="DropdownMenuTrigger",Js=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...o}=e,i=qs(Qs,t),s=Re(t);return c.jsx(jf,{asChild:!0,...s,children:c.jsx(Ee.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...o,ref:Cr(n,i.triggerRef),onPointerDown:le(e.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(i.onOpenToggle(),i.open||a.preventDefault())}),onKeyDown:le(e.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&i.onOpenToggle(),a.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});Js.displayName=Qs;var Kf="DropdownMenuPortal",ea=e=>{const{__scopeDropdownMenu:n,...t}=e,r=Re(n);return c.jsx(Rf,{...r,...t})};ea.displayName=Kf;var ta="DropdownMenuContent",na=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=qs(ta,t),i=Re(t),s=k.useRef(!1);return c.jsx(Of,{id:o.contentId,"aria-labelledby":o.triggerId,...i,...r,ref:n,onCloseAutoFocus:le(e.onCloseAutoFocus,a=>{s.current||o.triggerRef.current?.focus(),s.current=!1,a.preventDefault()}),onInteractOutside:le(e.onInteractOutside,a=>{const l=a.detail.originalEvent,u=l.button===0&&l.ctrlKey===!0,h=l.button===2||u;(!o.modal||h)&&(s.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});na.displayName=ta;var Zf="DropdownMenuGroup",Gf=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(Tf,{...o,...r,ref:n})});Gf.displayName=Zf;var Yf="DropdownMenuLabel",ra=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(If,{...o,...r,ref:n})});ra.displayName=Yf;var Vf="DropdownMenuItem",oa=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(Pf,{...o,...r,ref:n})});oa.displayName=Vf;var qf="DropdownMenuCheckboxItem",Xf=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(Mf,{...o,...r,ref:n})});Xf.displayName=qf;var Qf="DropdownMenuRadioGroup",Jf=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(Df,{...o,...r,ref:n})});Jf.displayName=Qf;var ep="DropdownMenuRadioItem",tp=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(Ff,{...o,...r,ref:n})});tp.displayName=ep;var np="DropdownMenuItemIndicator",rp=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(Lf,{...o,...r,ref:n})});rp.displayName=np;var op="DropdownMenuSeparator",ia=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(Bf,{...o,...r,ref:n})});ia.displayName=op;var ip="DropdownMenuArrow",sp=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(zf,{...o,...r,ref:n})});sp.displayName=ip;var ap="DropdownMenuSubTrigger",lp=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx(Uf,{...o,...r,ref:n})});lp.displayName=ap;var cp="DropdownMenuSubContent",up=k.forwardRef((e,n)=>{const{__scopeDropdownMenu:t,...r}=e,o=Re(t);return c.jsx($f,{...o,...r,ref:n,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});up.displayName=cp;var dp=Xs,fp=Js,pp=ea,hp=na,mp=ra,gp=oa,xp=ia,zn="Popover",[sa]=Rt(zn,[Dn]),en=Dn(),[vp,lt]=sa(zn),aa=e=>{const{__scopePopover:n,children:t,open:r,defaultOpen:o,onOpenChange:i,modal:s=!1}=e,a=en(n),l=k.useRef(null),[u,h]=k.useState(!1),[f,x]=Nr({prop:r,defaultProp:o??!1,onChange:i,caller:zn});return c.jsx(vs,{...a,children:c.jsx(vp,{scope:n,contentId:mn(),triggerRef:l,open:f,onOpenChange:x,onOpenToggle:k.useCallback(()=>x(d=>!d),[x]),hasCustomAnchor:u,onCustomAnchorAdd:k.useCallback(()=>h(!0),[]),onCustomAnchorRemove:k.useCallback(()=>h(!1),[]),modal:s,children:t})})};aa.displayName=zn;var la="PopoverAnchor",bp=k.forwardRef((e,n)=>{const{__scopePopover:t,...r}=e,o=lt(la,t),i=en(t),{onCustomAnchorAdd:s,onCustomAnchorRemove:a}=o;return k.useEffect(()=>(s(),()=>a()),[s,a]),c.jsx(Ur,{...i,...r,ref:n})});bp.displayName=la;var ca="PopoverTrigger",ua=k.forwardRef((e,n)=>{const{__scopePopover:t,...r}=e,o=lt(ca,t),i=en(t),s=Ae(n,o.triggerRef),a=c.jsx(Ee.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":ma(o.open),...r,ref:s,onClick:le(e.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:c.jsx(Ur,{asChild:!0,...i,children:a})});ua.displayName=ca;var Vr="PopoverPortal",[yp,wp]=sa(Vr,{forceMount:void 0}),da=e=>{const{__scopePopover:n,forceMount:t,children:r,container:o}=e,i=lt(Vr,n);return c.jsx(yp,{scope:n,forceMount:t,children:c.jsx(ht,{present:t||i.open,children:c.jsx(Or,{asChild:!0,container:o,children:r})})})};da.displayName=Vr;var Nt="PopoverContent",fa=k.forwardRef((e,n)=>{const t=wp(Nt,e.__scopePopover),{forceMount:r=t.forceMount,...o}=e,i=lt(Nt,e.__scopePopover);return c.jsx(ht,{present:r||i.open,children:i.modal?c.jsx(_p,{...o,ref:n}):c.jsx(Cp,{...o,ref:n})})});fa.displayName=Nt;var kp=Ut("PopoverContent.RemoveScroll"),_p=k.forwardRef((e,n)=>{const t=lt(Nt,e.__scopePopover),r=k.useRef(null),o=Ae(n,r),i=k.useRef(!1);return k.useEffect(()=>{const s=r.current;if(s)return qi(s)},[]),c.jsx(Tr,{as:kp,allowPinchZoom:!0,children:c.jsx(pa,{...e,ref:o,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:le(e.onCloseAutoFocus,s=>{s.preventDefault(),i.current||t.triggerRef.current?.focus()}),onPointerDownOutside:le(e.onPointerDownOutside,s=>{const a=s.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,u=a.button===2||l;i.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:le(e.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1})})})}),Cp=k.forwardRef((e,n)=>{const t=lt(Nt,e.__scopePopover),r=k.useRef(!1),o=k.useRef(!1);return c.jsx(pa,{...e,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{e.onCloseAutoFocus?.(i),i.defaultPrevented||(r.current||t.triggerRef.current?.focus(),i.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:i=>{e.onInteractOutside?.(i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const s=i.target;t.triggerRef.current?.contains(s)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&o.current&&i.preventDefault()}})}),pa=k.forwardRef((e,n)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:h,...f}=e,x=lt(Nt,t),d=en(t);return Ui(),c.jsx(Rr,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:i,children:c.jsx(jr,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:h,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:u,onDismiss:()=>x.onOpenChange(!1),children:c.jsx(bs,{"data-state":ma(x.open),role:"dialog",id:x.contentId,...d,...f,ref:n,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),ha="PopoverClose",Sp=k.forwardRef((e,n)=>{const{__scopePopover:t,...r}=e,o=lt(ha,t);return c.jsx(Ee.button,{type:"button",...r,ref:n,onClick:le(e.onClick,()=>o.onOpenChange(!1))})});Sp.displayName=ha;var Ep="PopoverArrow",Ap=k.forwardRef((e,n)=>{const{__scopePopover:t,...r}=e,o=en(t);return c.jsx(ys,{...o,...r,ref:n})});Ap.displayName=Ep;function ma(e){return e?"open":"closed"}var Np=aa,jp=ua,Rp=da,Op=fa;function Tp({...e}){return c.jsx(dp,{"data-slot":"dropdown-menu",...e})}function Ip({...e}){return c.jsx(fp,{"data-slot":"dropdown-menu-trigger",...e})}function Pp({className:e,sideOffset:n=4,...t}){return c.jsx(pp,{children:c.jsx(hp,{"data-slot":"dropdown-menu-content",sideOffset:n,className:pe("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",e),...t})})}function tr({className:e,inset:n,variant:t="default",...r}){return c.jsx(gp,{"data-slot":"dropdown-menu-item","data-inset":n,"data-variant":t,className:pe("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r})}function Mp({className:e,inset:n,...t}){return c.jsx(mp,{"data-slot":"dropdown-menu-label","data-inset":n,className:pe("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",e),...t})}function Dp({className:e,...n}){return c.jsx(xp,{"data-slot":"dropdown-menu-separator",className:pe("bg-border -mx-1 my-1 h-px",e),...n})}const mr="brainstorming",Fp="Brainstorming Methodology",Lp=`# Brainstorming Ideas Into Designs

## Overview

Help turn ideas into fully formed designs through natural collaborative dialogue.

The user's context blocks are already loaded into this conversation. Use them to understand the project, domain, and constraints. Ask questions one at a time to refine the idea. Once you understand what's being designed, present the design and get user approval.

## Anti-Pattern: "This Is Too Simple To Need A Design"

Every idea goes through this process. "Simple" ideas are where unexamined assumptions cause the most wasted work. The design can be short (a few sentences for truly simple ideas), but you MUST present it and get approval.

## Process Flow

1. **Review the context blocks**  understand the project/domain from what's already loaded
2. **Ask clarifying questions**  one at a time, understand purpose/constraints/success criteria
3. **Propose 2-3 approaches**  with trade-offs and your recommendation
4. **Present design**  in sections scaled to their complexity, get user approval after each section

## The Process

**Understanding the idea:**
- Review the context blocks to understand the project and domain
- Ask questions one at a time to refine the idea
- Prefer multiple choice questions when possible, but open-ended is fine too
- Only one question per message - if a topic needs more exploration, break it into multiple questions
- Focus on understanding: purpose, constraints, success criteria

**Exploring approaches:**
- Propose 2-3 different approaches with trade-offs
- Present options conversationally with your recommendation and reasoning
- Lead with your recommended option and explain why

**Presenting the design:**
- Once you believe you understand what's being designed, present it
- Scale each section to its complexity: a few sentences if straightforward, up to 200-300 words if nuanced
- Ask after each section whether it looks right so far
- Cover whatever aspects are relevant to the domain (structure, flow, trade-offs, edge cases)
- Be ready to go back and clarify if something doesn't make sense

## Key Principles

- **One question at a time** - Don't overwhelm with multiple questions
- **Multiple choice preferred** - Easier to answer than open-ended when possible
- **YAGNI ruthlessly** - Remove unnecessary complexity from all designs
- **Explore alternatives** - Always propose 2-3 approaches before settling
- **Incremental validation** - Present design in sections, get approval before moving on
- **Be flexible** - Go back and clarify when something doesn't make sense`,ut={[mr]:{id:mr,label:Fp,content:Lp}},Bp={[mr]:!0};function Fo(e){const n=[];for(const[t,r]of Object.entries(e))r&&ut[t]&&n.push(`[Active Skill: ${ut[t].label}]
${ut[t].content}`);return n.join(`

`)}const zp=6e4;function Lo(e){if(!e)return"";const n=new Date(e).getTime()-Date.now();if(n<=0)return"now";const t=Math.floor(n/6e4),r=Math.floor(t/60),o=t%60;return r>0?`${r}h ${o}m`:`${o}m`}function Up(e){const n=zt(ae.claudeNode.getSubscriptionUsage),[t,r]=k.useState(null),[o,i]=k.useState(!0),[s,a]=k.useState(null),l=k.useRef(null),u=k.useCallback(async()=>{try{const x=await n();"error"in x?a(x.error):(r(x),a(null))}catch(x){a(x instanceof Error?x.message:String(x))}finally{i(!1)}},[n]);k.useEffect(()=>{if(!e){i(!1);return}return u(),l.current=setInterval(u,zp),()=>{l.current&&clearInterval(l.current)}},[e,u]);const[,h]=k.useState(0);k.useEffect(()=>{if(!e||!t)return;const x=setInterval(()=>h(d=>d+1),3e4);return()=>clearInterval(x)},[e,t]);const f={utilization:0,resetsAt:"",resetsIn:""};return t?{fiveHour:{utilization:t.fiveHour.utilization,resetsAt:t.fiveHour.resetsAt,resetsIn:Lo(t.fiveHour.resetsAt)},sevenDay:{utilization:t.sevenDay.utilization,resetsAt:t.sevenDay.resetsAt,resetsIn:Lo(t.sevenDay.resetsAt)},loading:o,error:s}:{fiveHour:f,sevenDay:f,loading:o,error:s}}function $p({enabled:e}){const{fiveHour:n,sevenDay:t,loading:r,error:o}=Up(e);if(!e)return null;if(r)return c.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-muted text-muted-foreground animate-pulse",children:"5h: "});if(o)return c.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-muted text-muted-foreground",title:`Usage unavailable: ${o}`,children:"5h: --"});const i=n.utilization,s=i>=70&&i<90,a=i>=90,l=[`5-hour: ${i.toFixed(1)}%${n.resetsAt?` (resets ${n.resetsIn})`:""}`,`7-day: ${t.utilization.toFixed(1)}%${t.resetsAt?` (resets ${t.resetsIn})`:""}`].join(`
`);return a?c.jsxs("span",{className:pe("text-xs px-2 py-1 rounded-full font-medium","bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300","ring-1 ring-red-300 dark:ring-red-700"),title:l,children:["5h: ",Math.round(i),"%  ",n.resetsIn," | 7d: ",Math.round(t.utilization),"%"]}):s?c.jsxs("span",{className:"text-xs px-2 py-1 rounded-full font-medium bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300",title:l,children:["5h: ",Math.round(i),"%  ",n.resetsIn]}):c.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300",title:l,children:["5h: ",Math.round(i),"%"]})}function Wp(e){return e<.01?`$${e.toFixed(4)}`:e<1?`$${e.toFixed(3)}`:`$${e.toFixed(2)}`}function Hp({sessionCost:e}){return e<=0?null:c.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",title:`OpenRouter session cost: $${e.toFixed(6)}`,children:Wp(e)})}function Kp({message:e,onCopy:n,onSave:t,onRetry:r,onEdit:o,isStreaming:i}){const[s,a]=k.useState(!1),[l,u]=k.useState(!1),[h,f]=k.useState(e.content),x=()=>{if(navigator.clipboard)navigator.clipboard.writeText(e.content);else{const m=document.createElement("textarea");m.value=e.content,m.style.position="fixed",m.style.left="-999999px",m.style.top="-999999px",document.body.appendChild(m),m.focus(),m.select();try{document.execCommand("copy")}finally{document.body.removeChild(m)}}a(!0),setTimeout(()=>a(!1),1500),n()},d=()=>{h.trim()&&h!==e.content&&o(h.trim()),u(!1)},b=m=>{m.key==="Enter"&&(m.ctrlKey||m.metaKey)?(m.preventDefault(),d()):m.key==="Escape"&&(f(e.content),u(!1))},p=e.role==="user";return c.jsxs("div",{className:pe("flex flex-col gap-1",p?"items-end":"items-start"),children:[c.jsxs("div",{className:pe("max-w-[80%] rounded-lg px-4 py-2",p?"bg-primary text-primary-foreground":"bg-muted"),children:[c.jsx("div",{className:"text-xs font-medium mb-1 opacity-70",children:p?"You":"Assistant"}),l?c.jsxs("div",{className:"space-y-2",children:[c.jsx("textarea",{value:h,onChange:m=>f(m.target.value),onKeyDown:b,className:"w-full min-w-[300px] rounded border border-input bg-background px-2 py-1 text-sm text-foreground resize-none",rows:3,autoFocus:!0}),c.jsxs("div",{className:"flex gap-1 justify-end",children:[c.jsx(de,{variant:"ghost",size:"sm",onClick:()=>{f(e.content),u(!1)},className:"h-6 px-2 text-xs",children:"Cancel"}),c.jsx(de,{size:"sm",onClick:d,disabled:!h.trim()||h===e.content,className:"h-6 px-2 text-xs",children:"Send"})]})]}):p?c.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.content}):c.jsx("div",{className:"text-sm prose prose-sm dark:prose-invert max-w-none",children:c.jsx(wi,{remarkPlugins:[_i,Ci],components:ki,children:e.content||"No answer"})})]}),!l&&c.jsxs("div",{className:"flex gap-1 relative",children:[c.jsx(de,{variant:"ghost",size:"sm",onClick:x,className:"h-6 px-2 text-xs",children:s?"Copied!":"Copy"}),p&&c.jsx(de,{variant:"ghost",size:"sm",onClick:()=>u(!0),disabled:i,className:"h-6 px-2 text-xs",children:"Edit"}),c.jsxs(Tp,{children:[c.jsx(Ip,{asChild:!0,children:c.jsx(de,{variant:"ghost",size:"sm",className:pe("h-6 px-2 text-xs",e.savedAsBlockId&&"text-green-600"),children:e.savedAsBlockId?"Saved":"Save"})}),c.jsxs(Pp,{align:"end",collisionPadding:8,children:[c.jsx(Mp,{className:"text-xs",children:"Save to zone:"}),c.jsx(Dp,{}),c.jsx(tr,{onSelect:()=>t("WORKING"),children:"Working"}),c.jsx(tr,{onSelect:()=>t("STABLE"),children:"Stable"}),c.jsx(tr,{onSelect:()=>t("PERMANENT"),children:"Permanent"})]})]}),c.jsx(de,{variant:"ghost",size:"sm",onClick:r,disabled:i,className:"h-6 px-2 text-xs",title:p?"Resend this message":"Regenerate response",children:"Retry"})]})]})}function Zp({text:e}){return c.jsx("div",{className:"flex flex-col gap-1 items-start",children:c.jsxs("div",{className:"max-w-[80%] rounded-lg px-4 py-2 bg-muted",children:[c.jsxs("div",{className:"text-xs font-medium mb-1 opacity-70 flex items-center gap-2",children:["Assistant",c.jsx("span",{className:"inline-flex items-center",children:c.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary animate-pulse"})})]}),e?c.jsx("div",{className:"text-sm prose prose-sm dark:prose-invert max-w-none",children:c.jsx(wi,{remarkPlugins:[_i,Ci],components:ki,children:e||"No answer."})}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Thinking..."})]})})}function Bo({isOpen:e,onClose:n,messages:t,hasUnsavedContent:r=!1,isStreaming:o,streamingText:i,provider:s,onProviderChange:a,onSendMessage:l,onClearConversation:u,onSaveMessage:h,onRetryMessage:f,onEditMessage:x,error:d,providerHealth:b,systemPrompt:p,disableAgentBehavior:m=!0,onDisableAgentBehaviorChange:g,preventSelfTalk:w=!0,onPreventSelfTalkChange:_,onStopStreaming:E,model:S,onModelChange:R,activeSkills:j,onToggleSkill:M,openrouterSessionCost:I}){const[L,K]=k.useState(""),[C,D]=k.useState(!1),[y,U]=k.useState(null),V=k.useRef(null),H=k.useRef(null),X=k.useRef(null),[B,Z]=k.useState(!0),P=k.useCallback(()=>{const q=H.current;if(!q)return;const{scrollTop:re,scrollHeight:se,clientHeight:me}=q,he=se-re-me<100;Z(he)},[]);k.useEffect(()=>{B&&V.current?.scrollIntoView({behavior:"smooth"})},[t,i,B]),k.useEffect(()=>{e&&setTimeout(()=>X.current?.focus(),100)},[e]),k.useEffect(()=>{const q=re=>{if(r&&e)return re.preventDefault(),re.returnValue="",""};return window.addEventListener("beforeunload",q),()=>window.removeEventListener("beforeunload",q)},[r,e]);const T=k.useCallback(()=>{r?D(!0):n()},[r,n]);k.useEffect(()=>{const q=re=>{re.key==="Escape"&&e&&(re.preventDefault(),T())};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)},[e,T]);const te=k.useCallback(async()=>{if(!L.trim()||o)return;const q=L.trim();K(""),await l(q)},[L,o,l]),ee=q=>{q.key==="Enter"&&(q.ctrlKey||q.metaKey)&&(q.preventDefault(),te())};k.useEffect(()=>{const q=X.current;if(!q)return;q.style.height="auto";const re=200;q.style.height=`${Math.min(q.scrollHeight,re)}px`},[L]),k.useEffect(()=>{if(!b)return;const q=b[s];q!=null&&(!q.ok||"disabled"in q&&q.disabled)&&(b.ollama?.ok?a("ollama"):b.openrouter?.ok&&a("openrouter"))},[b,s,a]);const J=s==="ollama"?b?.ollama?.ok??!0:s==="openrouter"?b?.openrouter?.ok??!0:b?.claude===null||b?.claude===void 0?!0:b.claude.ok&&!b.claude.disabled,ce=t.length===0;return c.jsx(Nn,{children:e&&c.jsxs(Fe.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",initial:be.initial,animate:be.animate,exit:be.exit,transition:be.transition,children:[c.jsxs(Fe.div,{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-5xl h-[80vh] flex flex-col",initial:ye.initial,animate:ye.animate,exit:ye.exit,transition:ye.transition,onClick:q=>q.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("h2",{className:"text-lg font-semibold",children:"Brainstorm"}),c.jsxs("select",{value:s,onChange:q=>a(q.target.value),disabled:!ce||o,className:"text-sm border border-input rounded-md px-2 py-1 bg-background disabled:opacity-50",children:[!b?.claude?.disabled&&c.jsxs("option",{value:"claude",disabled:!b?.claude?.ok,children:["Claude ",b?.claude?.ok?"":"(offline)"]}),c.jsxs("option",{value:"ollama",disabled:!b?.ollama?.ok,children:["Ollama ",b?.ollama?.ok?"":"(offline)"]}),c.jsxs("option",{value:"openrouter",disabled:!b?.openrouter?.ok,children:["OpenRouter ",b?.openrouter?.ok?"":"(offline)"]})]}),s==="claude"&&R&&!b?.claude?.disabled&&c.jsxs("select",{value:S??"",onChange:q=>R(q.target.value||null),disabled:!ce||o,className:"text-sm border border-input rounded-md px-2 py-1 bg-background disabled:opacity-50 max-w-[200px]",children:[c.jsx("option",{value:"",children:"Default (Opus)"}),c.jsx("option",{value:"claude-sonnet-4-5-20250929",children:"Sonnet 4.5"}),c.jsx("option",{value:"claude-opus-4-6",children:"Opus 4.6"}),c.jsx("option",{value:"claude-haiku-4-5-20251001",children:"Haiku 4.5"})]}),s==="claude"&&!b?.claude?.disabled&&c.jsx($p,{enabled:s==="claude"}),s==="openrouter"&&I!=null&&c.jsx(Hp,{sessionCost:I}),s==="claude"&&g&&!b?.claude?.disabled&&c.jsxs("label",{className:"inline-flex items-center gap-1.5 text-xs cursor-pointer",title:"When enabled, appends instructions to prevent Claude from pretending to have tool access",children:[c.jsx("input",{type:"checkbox",checked:m,onChange:q=>g(q.target.checked),disabled:!ce||o,className:"rounded border-input"}),c.jsx("span",{className:"text-muted-foreground",children:"No tools"})]}),s==="claude"&&_&&!b?.claude?.disabled&&c.jsxs("label",{className:"inline-flex items-center gap-1.5 text-xs cursor-pointer",title:"When enabled, prevents the model from simulating user messages and continuing the conversation with itself",children:[c.jsx("input",{type:"checkbox",checked:w,onChange:q=>_(q.target.checked),disabled:!ce||o,className:"rounded border-input"}),c.jsx("span",{className:"text-muted-foreground",children:"No self-talk"})]}),p&&c.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300",title:p,children:"System Prompt Active"}),j&&M&&Object.entries(j).map(([q,re])=>{const se=ut[q];return se?c.jsxs("span",{className:pe("inline-flex items-center gap-1.5 text-xs px-2 py-1 rounded-full cursor-pointer transition-colors",re?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"bg-muted text-muted-foreground line-through"),children:[c.jsx("input",{type:"checkbox",checked:re,onChange:()=>M(q),className:"rounded border-input h-3 w-3"}),c.jsx("span",{onClick:()=>U(y===q?null:q),title:"Click to preview skill content",children:se.label})]},q):null})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(de,{variant:"ghost",size:"sm",onClick:u,disabled:t.length===0&&!i,children:"Clear"}),c.jsx(de,{variant:"ghost",size:"sm",onClick:()=>{o&&E(),T()},children:"Close"})]})]}),y&&ut[y]&&c.jsxs("div",{className:"mx-4 mt-2 p-3 rounded-md bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 max-h-[200px] overflow-y-auto",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("span",{className:"text-xs font-medium text-blue-700 dark:text-blue-300",children:ut[y].label}),c.jsx(de,{variant:"ghost",size:"sm",className:"h-5 px-1 text-xs",onClick:()=>U(null),children:"Close"})]}),c.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-wrap font-mono",children:ut[y].content})]}),c.jsxs("div",{ref:H,onScroll:P,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.length===0&&!o&&c.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[c.jsx("p",{className:"text-lg mb-2",children:"Start a conversation"}),c.jsxs("p",{className:"text-sm",children:["Your context blocks are included automatically.",c.jsx("br",{}),"Messages you save will become blocks."]}),c.jsx("p",{className:"text-xs text-muted-foreground/60 mt-2",children:"AI responses may be inaccurate. Verify before relying on them."})]}),t.map(q=>c.jsx(Kp,{message:q,onCopy:()=>{},onSave:re=>h(q.id,re),onRetry:()=>f(q.id),onEdit:re=>x(q.id,re),isStreaming:o},q.id)),o&&c.jsx(Zp,{text:i}),c.jsx("div",{ref:V})]}),d&&c.jsx("div",{className:"mx-4 mb-2 p-3 rounded-md bg-destructive/10 border border-destructive text-destructive text-sm",children:d}),c.jsxs("div",{className:"p-4 border-t border-border",children:[c.jsxs("div",{className:"flex gap-2 items-end",children:[c.jsx("textarea",{ref:X,value:L,onChange:q=>K(q.target.value),onKeyDown:ee,placeholder:"Type your message... (Ctrl+Enter to send)",rows:3,disabled:o||!J,className:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm resize-none disabled:opacity-50 min-h-[80px] max-h-[200px] overflow-y-auto"}),o?c.jsx(de,{variant:"destructive",onClick:E,className:"self-end",children:"Stop"}):c.jsx(ft,{onClick:te,disabled:!L.trim()||!J,className:"self-end",debounceMs:300,children:"Send"})]}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ctrl+Enter to send, Esc to close  AI responses may be inaccurate"})]})]}),c.jsx(yi,{open:C,onOpenChange:D,title:"Discard conversation?",description:"You have unsaved messages. Are you sure you want to close? Your conversation will be lost.",confirmLabel:"Discard",cancelLabel:"Keep open",destructive:!0,onConfirm:()=>{D(!1),u(),n()}})]})})}const Gp=`

IMPORTANT: In this conversation you do NOT have access to tools, files, or code execution. Do NOT say "let me read that file" or "I'll search for that" - work only with information provided in this conversation.`;function zo(e){return e.filter(t=>t.type==="system_prompt"&&t.zone==="PERMANENT"&&!t.isDraft).sort((t,r)=>t.position-r.position)[0]?.content}function Uo(e,n,t,r){const o=[],i={PERMANENT:[],STABLE:[],WORKING:[]};for(const u of e){if(u.type==="system_prompt"||u.isDraft)continue;const h=u.zone;i[h]&&i[h].push(u)}for(const u of Object.keys(i))i[u].sort((h,f)=>h.position-f.position);const s=i.PERMANENT.map(u=>u.content).join(`

`);s&&o.push({role:"system",content:s});const a=i.STABLE.map(u=>u.content).join(`

`);a&&o.push({role:"user",content:`Reference Material:

${a}`});const l=i.WORKING.map(u=>u.content).join(`

`);l&&o.push({role:"user",content:`Current Context:

${l}`}),r&&o.push({role:"user",content:`Active Skills:

${r}`});for(const u of n)o.push({role:u.role,content:u.content});return o.push({role:"user",content:t}),o}function Dt(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Yp(e){const{sessionId:n,onError:t,defaultDisableAgentBehavior:r=!0}=e,[o,i]=k.useState(!1),[s,a]=k.useState("claude"),[l,u]=k.useState(r),[h,f]=k.useState(!0),[x,d]=k.useState(null),[b,p]=k.useState([]),[m,g]=k.useState(!1),[w,_]=k.useState(()=>({...Bp})),[E,S]=k.useState(null),[R,j]=k.useState(!1),[M,I]=k.useState(""),L=k.useRef(""),[K,C]=k.useState(null),[D,y]=k.useState(0),U=k.useRef("");k.useEffect(()=>{L.current=M},[M]);const V=k.useRef(null),H=Se(ae.blocks.list,{sessionId:n});k.useEffect(()=>{p([]),I(""),C(null),S(null),j(!1),U.current="",V.current?.abort()},[n]);const X=_e(ae.generations.startBrainstormGeneration),B=_e(ae.generations.saveBrainstormMessage),Z=_e(ae.generations.cancel);k.useEffect(()=>{const v=()=>{E&&Z({generationId:E}).catch(()=>{}),V.current?.abort()};return window.addEventListener("beforeunload",v),()=>window.removeEventListener("beforeunload",v)},[E,Z]);const P=Se(ae.generations.get,E?{generationId:E}:"skip");k.useEffect(()=>{if(!P||s!=="claude")return;const v=P.text;if(v!==U.current&&(U.current=v,I(v)),P.status==="complete"&&R){if(j(!1),P.text.trim()){const $={id:Dt(),role:"assistant",content:P.text,timestamp:Date.now()};p(z=>[...z,$])}I(""),S(null)}if(P.status==="error"&&R){j(!1);const $=P.error||"Unknown error";console.error("[Claude Brainstorm] Generation error:",$),P.text?.trim()&&console.error("[Claude Brainstorm] Partial text before error:",P.text),C($),t?.($),I(""),S(null)}P.status==="cancelled"&&R&&(j(!1),I(""),S(null))},[P,R,t,s]);const T=k.useCallback(v=>{v&&a(v),i(!0)},[]),te=k.useCallback(()=>{i(!1),V.current?.abort(),E&&Z({generationId:E}).catch(console.error),j(!1),I(""),S(null),U.current=""},[E,Z]),ee=k.useCallback(()=>{const v=L.current;if(v.trim()){const $={id:Dt(),role:"assistant",content:v+`

*(generation stopped)*`,timestamp:Date.now()};p(z=>[...z,$])}V.current?.abort(),E&&Z({generationId:E}).catch(console.error),j(!1),I(""),S(null),U.current=""},[E,Z]),J=k.useCallback(v=>{_($=>({...$,[v]:!$[v]}))},[]),ce=k.useCallback(()=>{p([]),g(!1),I(""),C(null),S(null),j(!1),y(0),U.current="",V.current?.abort()},[]),q=k.useCallback(async(v,$)=>{if(!H)throw new Error("Blocks not loaded yet");const z=Fo(w),N=Uo(H,$,v,z||void 0),A=zo(H),O=[];A&&O.push({role:"system",content:A});for(const F of N)O.push({role:F.role,content:F.content});let W="";const G=new AbortController;V.current=G;try{const F=ji(O,{signal:G.signal});for await(const Y of F)W+=Y,I(W);if(W.trim()){const Y={id:Dt(),role:"assistant",content:W,timestamp:Date.now()};p(ne=>[...ne,Y])}}finally{I("")}},[H,w]),re=k.useCallback(async(v,$)=>{if(!H)throw new Error("Blocks not loaded yet");const z=Fo(w),N=Uo(H,$,v,z||void 0),A=zo(H),O=[];A&&O.push({role:"system",content:A+Gp});for(const F of N)O.push({role:F.role,content:F.content});let W="";const G=new AbortController;V.current=G;try{const F=Ri(O,{signal:G.signal});let Y;do Y=await F.next(),!Y.done&&Y.value&&(W+=Y.value,I(W));while(!Y.done);const ne=Y.value;if(ne?.promptTokens&&ne?.completionTokens&&ne?.model){const Q=await Il(ne.model);if(Q){const oe=Pl(ne.promptTokens,ne.completionTokens,Q);y(fe=>fe+oe)}}if(W.trim()){const Q={id:Dt(),role:"assistant",content:W,timestamp:Date.now()};p(oe=>[...oe,Q])}}finally{I("")}},[H,w]),se=k.useCallback(async v=>{const $=b.map(A=>({role:A.role,content:A.content})),z=Object.entries(w).filter(([,A])=>A).map(([A])=>A),N=await X({sessionId:n,conversationHistory:$,newMessage:v,disableAgentBehavior:l,preventSelfTalk:h,activeSkillIds:z,model:x??void 0});S(N.generationId)},[n,b,X,l,h,w,x]),me=k.useCallback(async v=>{if(!v.trim()||R)return;C(null);const $=b.map(N=>({role:N.role,content:N.content})),z={id:Dt(),role:"user",content:v.trim(),timestamp:Date.now()};p(N=>[...N,z]),g(!0),j(!0),I(""),U.current="";try{s==="ollama"?await q(v.trim(),$):s==="openrouter"?await re(v.trim(),$):await se(v.trim())}catch(N){if(N instanceof DOMException&&N.name==="AbortError")return;const A=N instanceof Error?N.message:"Unknown error";console.error(`[Brainstorm] ${s} error:`,N),C(A),t?.(A)}finally{(s==="ollama"||s==="openrouter")&&j(!1)}},[s,R,b,q,re,se,t]),he=k.useCallback(async(v,$)=>{const z=b.find(A=>A.id===v);if(!z)throw new Error("Message not found");const N=await B({sessionId:n,content:z.content,role:z.role,zone:$});return p(A=>A.map(O=>O.id===v?{...O,savedAsBlockId:N}:O)),N},[n,b,B]),Oe=k.useCallback(async v=>{if(R)return;const $=b.findIndex(W=>W.id===v);if($===-1)return;const z=b[$];let N,A=0;if(z.role==="assistant"){for(let W=$-1;W>=0;W--)if(b[W].role==="user"){N=b[W],A=W+1;break}}else N=z,A=$+1;if(!N)return;const O=b.slice(0,A-1).map(W=>({role:W.role,content:W.content}));p(W=>W.slice(0,A)),C(null),j(!0),I(""),U.current="";try{s==="ollama"?await q(N.content,O):s==="openrouter"?await re(N.content,O):await se(N.content)}catch(W){if(W instanceof DOMException&&W.name==="AbortError")return;const G=W instanceof Error?W.message:"Unknown error";C(G),t?.(G)}finally{(s==="ollama"||s==="openrouter")&&j(!1)}},[b,R,s,q,re,se,t]),ke=k.useCallback(async(v,$)=>{if(R||!$.trim())return;const z=b.findIndex(O=>O.id===v);if(z===-1)return;const N=b[z];if(N.role!=="user")return;const A=b.slice(0,z).map(O=>({role:O.role,content:O.content}));p(O=>{const W=O.slice(0,z);return W.push({...N,content:$.trim(),timestamp:Date.now()}),W}),C(null),j(!0),I(""),U.current="";try{s==="ollama"?await q($.trim(),A):s==="openrouter"?await re($.trim(),A):await se($.trim())}catch(O){if(O instanceof DOMException&&O.name==="AbortError")return;const W=O instanceof Error?O.message:"Unknown error";C(W),t?.(W)}finally{(s==="ollama"||s==="openrouter")&&j(!1)}},[b,R,s,q,re,se,t]);return{messages:b,isOpen:o,provider:s,hasUnsavedContent:m,open:T,close:te,sendMessage:me,clearConversation:ce,setProvider:a,retryMessage:Oe,editMessage:ke,isStreaming:R,streamingText:M,stopStreaming:ee,saveMessage:he,disableAgentBehavior:l,setDisableAgentBehavior:u,preventSelfTalk:h,setPreventSelfTalk:f,model:x,setModel:d,activeSkills:w,toggleSkill:J,openrouterSessionCost:D,error:K}}function Vp(){const[e,n]=k.useState({ollama:null,claude:null,openrouter:null}),t=Se(ae.features.getFlags);return k.useEffect(()=>{const r=async()=>{const o=await Ml(),i=await Dl();let s=null;if(t?.claudeCodeEnabled)try{const a="http://127.0.0.1:3210",l=a?a.replace(":3210",":3211"):"http://127.0.0.1:3211",u=await fetch(`${l}/api/health/claude`);u.ok?s=await u.json():s={ok:!1,error:"Claude Code not available"}}catch{s={ok:!1,error:"Failed to check Claude Code"}}else s={ok:!1,disabled:!0,error:"Disabled"};n({ollama:o,claude:s,openrouter:i})};if(t!==void 0){r();const o=setInterval(r,3e4);return()=>clearInterval(o)}},[t]),e}function qp({sessionId:e,compact:n=!1}){const t=Vp(),[r,o]=k.useState(!1),[i,s]=k.useState(""),[a,l]=k.useState(!1),u=_e(ae.blocks.create),h=Se(ae.blocks.listByZone,{sessionId:e,zone:"PERMANENT"}),f=k.useMemo(()=>h?h.filter(w=>w.type==="system_prompt").sort((w,_)=>w.position-_.position)[0]??null:null,[h]),x=f?.content??"",d=Yp({sessionId:e,onError:g=>console.error("Brainstorm error:",g)}),b=async(g,w)=>{try{await d.saveMessage(g,w)}catch(_){console.error("Failed to save message:",_)}},p=async()=>{if(i.trim()){l(!0);try{await u({sessionId:e,content:i.trim(),type:"system_prompt",zone:"PERMANENT"}),s("")}finally{l(!1)}}},m=(g,w)=>w===null?c.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-muted-foreground animate-pulse"}),g,"..."]}):w.ok?c.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-green-600",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),g]}):c.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-destructive",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-destructive"}),g]});if(n){const w=t.claude===null&&t.ollama===null&&t.openrouter===null||t.claude?.ok||t.ollama?.ok||t.openrouter?.ok;return c.jsxs(c.Fragment,{children:[c.jsx(de,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>d.open(),disabled:!w,children:d.messages.length>0?`Brainstorm (${d.messages.length})`:"Brainstorm"}),c.jsx(Bo,{isOpen:d.isOpen,onClose:d.close,messages:d.messages,hasUnsavedContent:d.hasUnsavedContent,isStreaming:d.isStreaming,streamingText:d.streamingText,provider:d.provider,onProviderChange:d.setProvider,onSendMessage:_=>d.sendMessage(_),onClearConversation:d.clearConversation,onSaveMessage:b,onRetryMessage:_=>d.retryMessage(_),onEditMessage:(_,E)=>d.editMessage(_,E),error:d.error,providerHealth:t,systemPrompt:x,disableAgentBehavior:d.disableAgentBehavior,onDisableAgentBehaviorChange:d.setDisableAgentBehavior,preventSelfTalk:d.preventSelfTalk,onPreventSelfTalkChange:d.setPreventSelfTalk,onStopStreaming:d.stopStreaming,model:d.model,onModelChange:d.setModel,activeSkills:d.activeSkills,onToggleSkill:d.toggleSkill,openrouterSessionCost:d.openrouterSessionCost})]})}return c.jsxs("div",{className:"rounded-lg border border-border bg-card p-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("h2",{className:"text-xl font-semibold",children:"Brainstorm"}),c.jsxs("div",{className:"flex items-center gap-2",children:[m("Ollama",t.ollama),!t.claude?.disabled&&m("Claude",t.claude),m("OpenRouter",t.openrouter)]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs(de,{variant:"ghost",size:"sm",onClick:()=>o(!r),children:[r?"Hide":"Show"," System Prompt"]}),c.jsx(de,{onClick:()=>d.open(),disabled:!(t.claude===null&&t.ollama===null&&t.openrouter===null)&&!t.claude?.ok&&!t.ollama?.ok&&!t.openrouter?.ok,children:d.messages.length>0?`Continue (${d.messages.length} msgs)`:"Start Brainstorming"})]})]}),c.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Have a multi-turn conversation with your context. Save valuable messages as blocks."}),r&&c.jsxs("div",{className:"mt-4 p-4 rounded-md bg-muted/50 border border-border",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("label",{htmlFor:"system-prompt",className:"text-sm font-medium",children:"System Prompt (LLM Role)"}),f&&c.jsx("span",{className:"inline-flex items-center gap-1 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300 px-2 py-0.5 rounded",children:"Active Block"})]}),f?c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"p-3 rounded-md bg-background border border-input text-sm font-mono whitespace-pre-wrap",children:f.content}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Edit this block in the PERMANENT zone above."})]}):c.jsxs("div",{className:"space-y-2",children:[c.jsx("textarea",{id:"system-prompt",value:i,onChange:g=>s(g.target.value),placeholder:"Define the LLM's role and behavior. E.g., 'You are a game design expert specializing in narrative systems...'",rows:3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none font-mono"}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-xs text-muted-foreground",children:"This prompt will be sent with every brainstorm message."}),c.jsx(de,{size:"sm",onClick:p,disabled:a||!i.trim(),children:a?"Creating...":"Create System Prompt Block"})]})]})]}),d.messages.length>0&&c.jsxs("div",{className:"mt-4 p-3 rounded-md bg-muted/50 border border-border",children:[c.jsxs("div",{className:"text-xs text-muted-foreground mb-2",children:["Recent messages (",d.messages.length," total)"]}),c.jsx("div",{className:"space-y-1",children:d.messages.slice(-3).map(g=>c.jsxs("div",{className:"text-sm truncate",children:[c.jsx("span",{className:"font-medium",children:g.role==="user"?"You: ":"AI: "}),c.jsxs("span",{className:"text-muted-foreground",children:[g.content.slice(0,100),g.content.length>100?"...":""]})]},g.id))})]}),c.jsx(Bo,{isOpen:d.isOpen,onClose:d.close,messages:d.messages,isStreaming:d.isStreaming,streamingText:d.streamingText,provider:d.provider,onProviderChange:d.setProvider,onSendMessage:g=>d.sendMessage(g),onClearConversation:d.clearConversation,onSaveMessage:b,onRetryMessage:g=>d.retryMessage(g),onEditMessage:(g,w)=>d.editMessage(g,w),error:d.error,providerHealth:t,systemPrompt:x,disableAgentBehavior:d.disableAgentBehavior,onDisableAgentBehaviorChange:d.setDisableAgentBehavior,onStopStreaming:d.stopStreaming,model:d.model,onModelChange:d.setModel,activeSkills:d.activeSkills,onToggleSkill:d.toggleSkill,openrouterSessionCost:d.openrouterSessionCost})]})}function $o({value:e,className:n,format:t}){const r=$l(e,vi.gentle);k.useEffect(()=>{r.set(e)},[r,e]);const o=Pi(r,i=>t?t(i):Math.round(i).toString());return c.jsx(Fe.span,{className:n,children:o})}const Wo=e=>e>=1e3?`${(e/1e3).toFixed(1)}K`:Math.round(e).toLocaleString();function gr({zone:e,blockCount:n,tokens:t,budget:r,onCompress:o,isCompressing:i}){const s=Math.round(t/r*100),a=s>80&&s<=95,l=s>95;return c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h3",{className:"font-semibold text-foreground",children:e}),c.jsxs("span",{className:"text-xs text-muted-foreground",children:[n," ",n===1?"block":"blocks"]}),o&&n>1&&c.jsxs("button",{onClick:o,disabled:i,className:"px-1.5 py-0.5 text-[10px] rounded border border-input hover:bg-muted disabled:opacity-50 flex items-center gap-1",title:"Compress all blocks in this zone",children:[c.jsx(Rn,{className:"w-2.5 h-2.5"}),i?"...":"Compress"]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:pe("text-xs font-mono",l&&"text-destructive",a&&"text-yellow-600 dark:text-yellow-500"),children:[c.jsx($o,{value:t,format:Wo})," / ",Wo(r)]}),c.jsx("div",{className:"w-16 h-2 bg-muted rounded-full overflow-hidden",children:c.jsx(Fe.div,{className:pe("h-full",l?"bg-destructive":a?"bg-yellow-500":"bg-primary"),animate:{width:`${Math.min(s,100)}%`},transition:vi.gentle})}),c.jsx("span",{className:pe("text-xs font-mono w-10 text-right",l&&"text-destructive",a&&"text-yellow-600 dark:text-yellow-500"),children:c.jsx($o,{value:s,format:u=>`${Math.round(u)}%`})})]})]})}function ge({className:e,...n}){return c.jsx("div",{"data-slot":"skeleton",className:pe("bg-accent animate-pulse rounded-md",e),...n})}function kn(){return c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ge,{className:"h-4 w-16"}),c.jsx(ge,{className:"h-3 w-14"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ge,{className:"h-3 w-20 font-mono"}),c.jsx(ge,{className:"h-2 w-16 rounded-full"}),c.jsx(ge,{className:"h-3 w-10"})]})]})}const Xp={PERMANENT:"Permanent",STABLE:"Stable",WORKING:"Working"};function ga({sessionId:e,collapsed:n=!1,className:t=""}){const r=Se(ae.metrics.getZoneMetrics,{sessionId:e});if(!r)return n?c.jsxs("div",{className:pe("inline-flex items-center gap-2 text-sm",t),children:[c.jsx(ge,{className:"h-4 w-20"}),c.jsx(ge,{className:"h-1.5 w-12 rounded-full"}),c.jsx(ge,{className:"h-3 w-8"})]}):c.jsxs("div",{className:pe("rounded-lg border border-border bg-card p-4",t),children:[c.jsx(ge,{className:"h-5 w-28 mb-3"}),c.jsxs("div",{className:"space-y-3",children:[[0,1,2].map(l=>c.jsx(kn,{},l)),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx(kn,{})})]})]});const o=Math.round(r.total.tokens/r.total.budget*100),i=o>95,s=o>80&&o<=95,a=l=>l>=1e3?`${(l/1e3).toFixed(1)}K`:l.toLocaleString();return n?c.jsxs("div",{className:pe("inline-flex items-center gap-2 text-sm",i&&"text-destructive",s&&"text-yellow-600 dark:text-yellow-500",t),children:[c.jsxs("span",{className:"font-mono",children:[a(r.total.tokens)," / ",a(r.total.budget)]}),c.jsx("div",{className:"w-12 h-1.5 bg-muted rounded-full overflow-hidden",children:c.jsx("div",{className:pe("h-full transition-all",i?"bg-destructive":s?"bg-yellow-500":"bg-primary"),style:{width:`${Math.min(o,100)}%`}})}),c.jsxs("span",{className:"font-mono text-xs",children:[o,"%"]})]}):c.jsxs("div",{className:pe("rounded-lg border border-border bg-card p-4",t),children:[c.jsx("h3",{className:"font-semibold mb-3 text-foreground",children:"Context Budget"}),c.jsxs("div",{className:"space-y-3",children:[Object.keys(r.zones).map(l=>c.jsx(gr,{zone:Xp[l]||l,blockCount:r.zones[l].blocks,tokens:r.zones[l].tokens,budget:r.zones[l].budget},l)),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx(gr,{zone:"Total",blockCount:r.total.blocks,tokens:r.total.tokens,budget:r.total.budget})})]})]})}function Qp({sessionId:e,className:n}){const[t,r]=k.useState("plain"),[o,i]=k.useState(!1),[s,a]=k.useState(!1),l=Se(ae.context.getAssembled,{sessionId:e,format:t,includePromptPlaceholder:!0}),u=async()=>{if(l?.text)try{await navigator.clipboard.writeText(l.text),i(!0),setTimeout(()=>i(!1),2e3)}catch(f){console.error("Failed to copy:",f)}},h=f=>f>=1e3?`${(f/1e3).toFixed(1)}K`:f.toLocaleString();return c.jsxs("div",{className:pe("rounded-lg border border-border bg-card p-4",n),children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"font-semibold text-foreground",children:"Export Context"}),l&&c.jsxs("span",{className:"text-xs text-muted-foreground font-mono",children:[h(l.tokens)," tokens"]})]}),c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsx("label",{htmlFor:"export-format",className:"text-sm text-muted-foreground",children:"Format:"}),c.jsxs("select",{id:"export-format",value:t,onChange:f=>r(f.target.value),className:"rounded-md border border-input bg-background px-2 py-1 text-sm",children:[c.jsx("option",{value:"plain",children:"Plain Text"}),c.jsx("option",{value:"markdown",children:"Markdown"}),c.jsx("option",{value:"xml",children:"XML (Claude-style)"})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(de,{onClick:u,disabled:!l?.text,className:"flex-1",children:o?"Copied!":"Copy to Clipboard"}),c.jsx(de,{variant:"outline",onClick:()=>a(!s),disabled:!l?.text,children:s?"Hide":"Preview"})]}),s&&l?.text&&c.jsx("div",{className:"mt-3 p-3 rounded-md bg-muted/50 border border-border max-h-[300px] overflow-auto",children:c.jsx("pre",{className:"text-xs whitespace-pre-wrap font-mono text-foreground",children:l.text})})]})}const Jp=`You are a compression specialist. Compress the following {contentType} content from {originalTokens} tokens to approximately {originalTokens}/{targetRatio} tokens while preserving all critical information.

CRITICAL RULES:
- Keep ALL specific names, numbers, dates, and decisions
- Maintain chronological order
- Preserve technical terms and key concepts
- Remove redundant explanations and examples
- Keep conclusions and results
- Output ONLY the compressed content (no meta-commentary)
- If the same phrase is repeated, keep only the first occurrence

CONTENT TO COMPRESS:
{content}

COMPRESSED VERSION:`;async function eh(e,n){const t=n.targetRatio,r=n.contentType||"text",o=rh({content:e,originalTokens:wt(e),targetRatio:t,contentType:r});switch(n.provider){case"ollama":return th(o,n);case"openrouter":return nh(o,n);case"claude-code":throw new Error("Claude Code compression must be called via Convex action");default:throw new Error(`Unknown provider: ${n.provider}`)}}async function th(e,n){const t=[{role:"user",content:e}];let r="";const o=ji(t,{model:n.ollamaModel,temperature:.2,topP:.95});for await(const i of o)r+=i;return r.trim()}async function nh(e,n){const t=[{role:"user",content:e}];let r="";const o=Ri(t,{model:n.openrouterModel,temperature:.2,topP:.95});for await(const i of o)r+=i;return r.trim()}function rh(e){return Jp.replace(/\{(\w+)\}/g,(n,t)=>String(e[t]||""))}function wt(e){return Math.ceil(e.length/4)}function oh(e){const n=[],t=e.match(/\b\d+(?:\.\d+)?\b/g)||[];n.push(...t);const r=e.match(/\b[A-Z][a-z]+\b/g)||[];n.push(...r.slice(0,10));const o=e.match(/\b[A-Z]{2,}\b/g)||[];return n.push(...o.slice(0,5)),n}function ih(e,n){const t=oh(e);if(t.length===0)return .8;const r=n.toLowerCase(),o=t.filter(i=>r.includes(i.toLowerCase())).length;return Math.min(1,o/t.length)}const Ho=100,Ko=1.2;class Zo{provider;providerConfig;constructor(n,t){this.provider=n||this.detectProvider(),this.providerConfig={provider:this.provider,ollamaUrl:t?.ollamaUrl||ao.getUrl(),ollamaModel:t?.ollamaModel||ao.getModel(),openrouterModel:t?.openrouterModel||so.getModel()}}detectProvider(){return so.isConfigured()?"openrouter":"ollama"}async compressBlock(n,t="semantic"){const r=Date.now(),o=this.validateBlock(n);if(!o.valid)return{success:!1,error:o.reason||"Block validation failed",originalTokens:n.tokens||0,compressedTokens:0,compressionRatio:1,tokensSaved:0,strategy:t};try{const i=await this.compressContent(n.content,t,n.type),s=n.tokens||wt(n.content),a=wt(i),l=s/a;if(l<Ko)return{success:!1,error:`Compression ratio ${l.toFixed(2)}x is below minimum ${Ko}x`,originalTokens:s,compressedTokens:a,compressionRatio:l,tokensSaved:0,strategy:t};const u=ih(n.content,i);return u<.6?{success:!1,error:`Compression quality ${(u*100).toFixed(0)}% is too low`,originalTokens:s,compressedTokens:a,compressionRatio:l,tokensSaved:0,strategy:t}:{success:!0,blockId:n._id,originalTokens:s,compressedTokens:a,compressionRatio:l,tokensSaved:s-a,compressedContent:i,strategy:t,provider:this.provider,durationMs:Date.now()-r}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error",originalTokens:n.tokens||0,compressedTokens:0,compressionRatio:1,tokensSaved:0,strategy:t}}}async compressText(n,t="semantic",r="text"){const o=await this.compressContent(n,t,r),i=wt(n),s=wt(o),a=i/s;return{compressedContent:o,originalTokens:i,compressedTokens:s,compressionRatio:a}}async compressContent(n,t,r){switch(t){case"semantic":return eh(n,{provider:this.provider,targetRatio:2,contentType:r,ollamaModel:this.providerConfig.ollamaModel,ollamaUrl:this.providerConfig.ollamaUrl,openrouterModel:this.providerConfig.openrouterModel});case"structural":throw new Error("Structural compression not yet implemented");case"statistical":throw new Error("Statistical compression not yet implemented");default:throw new Error(`Unknown strategy: ${t}`)}}validateBlock(n){const t=n.tokens||wt(n.content);return t<Ho?{valid:!1,reason:`Block has only ${t} tokens (minimum: ${Ho})`}:!n.content||n.content.trim().length===0?{valid:!1,reason:"Block has no content"}:{valid:!0}}getProvider(){return this.provider}getProviderConfig(){return this.providerConfig}}function qr(e){const{sessionId:n,onSuccess:t,onError:r}=e,[o,i]=k.useState(!1),[s,a]=k.useState(null),[l,u]=k.useState(null),h=_e(ae.blocks.compress),f=_e(ae.blocks.compressAndMerge),x=zt(ae.compression.compressWithClaudeCode),d=zt(ae.compression.compressAndMergeWithClaudeCode),b=k.useCallback(async(g,w="semantic")=>{i(!0),a(null),u(null);const _=lo.getProvider();console.log("[Compression Client] Starting single block compression"),console.log(`[Compression Client] Block ID: ${g._id}, Strategy: ${w}`),console.log(`[Compression Client] Compression provider: ${_}`);try{let E;if(_==="claude-code"){console.log("[Compression Client] Using SERVER-SIDE Claude Code action");const S=await x({blockId:g._id,strategy:w});E={success:S.success,blockId:S.blockId,originalTokens:S.originalTokens,compressedTokens:S.compressedTokens,compressionRatio:S.compressionRatio,tokensSaved:S.tokensSaved,strategy:w,provider:"claude-code"}}else{if(console.log(`[Compression Client] Using CLIENT-SIDE compression service (${_})`),E=await new Zo(_).compressBlock(g,w),!E.success)throw new Error(E.error||"Compression failed");await h({blockId:g._id,compressedContent:E.compressedContent,originalTokens:E.originalTokens,compressedTokens:E.compressedTokens,compressionRatio:E.compressionRatio,strategy:w})}console.log("[Compression Client] Single block compression completed successfully"),console.log(`[Compression Client] Ratio: ${E.compressionRatio.toFixed(2)}x, Saved: ${E.tokensSaved} tokens`),u(E),t?.(E)}catch(E){const S=E instanceof Error?E.message:"Unknown error";console.error("[Compression Client] Single block compression failed:",S),a(S),r?.(S)}finally{i(!1)}},[h,x,t,r]),p=k.useCallback(async(g,w)=>{if(g.length===0){const E="No blocks to merge";a(E),r?.(E);return}i(!0),a(null),u(null);const _=lo.getProvider();console.log("[Compression Client Merge] Starting multi-block compression"),console.log(`[Compression Client Merge] Block count: ${g.length}, Strategy: ${w.strategy||"semantic"}`),console.log(`[Compression Client Merge] Compression provider: ${_}`);try{const E=w.strategy||"semantic";let S,R,j,M;if(_==="claude-code"){console.log("[Compression Client Merge] Using SERVER-SIDE Claude Code action");const K=await d({blockIds:g.map(C=>C._id),strategy:E});if(!K.success)throw new Error("Compression action failed");S=K.compressedContent,R=K.originalTokens,j=K.compressedTokens,M=K.compressionRatio}else{console.log(`[Compression Client Merge] Using CLIENT-SIDE compression service (${_})`);const K=g.map((y,U)=>`${`## Block ${U+1} (${y.type})`}

${y.content}`).join(`

---

`),D=await new Zo(_).compressText(K,E,"merged_blocks");S=D.compressedContent,R=D.originalTokens,j=D.compressedTokens,M=D.compressionRatio}if(M<1.2)throw new Error(`Compression ratio ${M.toFixed(2)}x is below minimum 1.2x`);const L={success:!0,newBlockId:(await f({blockIds:g.map(K=>K._id),compressedContent:S,originalTokens:R,compressedTokens:j,compressionRatio:M,strategy:E,targetZone:w.targetZone,targetType:w.targetType,targetPosition:0})).newBlockId,originalTokens:R,compressedTokens:j,compressionRatio:M,tokensSaved:R-j,strategy:E,provider:_};console.log("[Compression Client Merge] Multi-block compression completed successfully"),console.log(`[Compression Client Merge] Ratio: ${M.toFixed(2)}x, Saved: ${R-j} tokens`),u(L),t?.(L)}catch(E){const S=E instanceof Error?E.message:"Unknown error";console.error("[Compression Client Merge] Multi-block compression failed:",S),a(S),r?.(S)}finally{i(!1)}},[d,f,t,r]),m=k.useCallback(async g=>{const w="compressZone is deprecated. Use compressAndMerge with zone blocks directly.";a(w),r?.(w)},[r]);return{compressSingle:b,compressAndMerge:p,compressZone:m,isCompressing:o,error:s,result:l}}function sh({onDelete:e,getTitle:n=()=>"Delete item?",getDescription:t=()=>"This action cannot be undone."}){const[r,o]=k.useState(null),[i,s]=k.useState(!1),a=k.useCallback(h=>{o(h)},[]),l=k.useCallback(()=>{i||o(null)},[i]),u=k.useCallback(async()=>{if(r){s(!0);try{await e(r),o(null)}catch(h){console.error("Delete failed:",h)}finally{s(!1)}}},[r,e]);return{itemToDelete:r,isDeleting:i,isOpen:r!==null,title:r?n(r):"",description:r?t(r):"",requestDelete:a,cancelDelete:l,confirmDelete:u}}const ah={PERMANENT:{label:"Permanent",description:"Always included"},STABLE:{label:"Stable",description:"Reference material"},WORKING:{label:"Working",description:"Draft content"}};function xa({isOpen:e,onClose:n,blocks:t,onCompress:r,isCompressing:o,result:i,error:s}){const[a,l]=k.useState("WORKING"),[u,h]=k.useState("note"),f=t.reduce((p,m)=>p+(m.tokens||0),0),x=async()=>{await r(a,u)},d=()=>{o||n()},b=p=>{p.key==="Escape"&&!o&&n()};return c.jsx(Nn,{children:e&&c.jsx(Fe.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:d,onKeyDown:b,initial:be.initial,animate:be.animate,exit:be.exit,transition:be.transition,children:c.jsxs(Fe.div,{className:"bg-card border border-border rounded-lg shadow-lg max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:p=>p.stopPropagation(),initial:ye.initial,animate:ye.animate,exit:ye.exit,transition:ye.transition,children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Rn,{className:"w-5 h-5"}),c.jsx("h2",{className:"text-lg font-semibold",children:"Compress & Merge Blocks"})]}),c.jsx("button",{onClick:d,disabled:o,className:"text-muted-foreground hover:text-foreground disabled:opacity-50",children:c.jsx(jn,{className:"w-5 h-5"})})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[c.jsxs("div",{className:"rounded-lg border border-border p-3 bg-muted/50",children:[c.jsx("div",{className:"text-sm font-medium mb-2",children:"Merge Summary"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Blocks:"})," ",c.jsx("span",{className:"font-medium",children:t.length})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Total tokens:"})," ",c.jsx("span",{className:"font-medium",children:f})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Expected ratio:"})," ",c.jsx("span",{className:"font-medium",children:"~2.0x"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Target tokens:"})," ",c.jsxs("span",{className:"font-medium",children:["~",Math.ceil(f/2)]})]})]})]}),c.jsxs("div",{children:[c.jsx("div",{className:"text-sm font-medium mb-2",children:"Blocks to merge:"}),c.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:t.map((p,m)=>c.jsxs("div",{className:"rounded border border-border p-2 bg-card",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Block ",m+1]}),c.jsx("span",{className:"text-xs text-muted-foreground",children:p.type}),p.tokens&&c.jsxs("span",{className:"text-xs text-muted-foreground font-mono",children:[p.tokens,"t"]}),p.isCompressed&&c.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-blue-500/10 text-blue-600",children:"Compressed"})]}),c.jsx("p",{className:"text-xs text-foreground line-clamp-2",children:p.content})]},p._id))})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium block mb-1.5",children:"Target Zone"}),c.jsx("select",{value:a,onChange:p=>l(p.target.value),disabled:o,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm disabled:opacity-50",children:Object.entries(ah).map(([p,m])=>c.jsxs("option",{value:p,children:[m.label," - ",m.description]},p))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-medium block mb-1.5",children:"Block Type"}),c.jsxs("select",{value:u,onChange:p=>h(p.target.value),disabled:o,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm disabled:opacity-50",children:[c.jsx("option",{value:"note",children:"Note"}),c.jsx("option",{value:"summary",children:"Summary"}),c.jsx("option",{value:"context",children:"Context"})]})]})]}),i&&i.success&&c.jsxs("div",{className:"rounded-lg border border-green-500/50 bg-green-500/10 p-3",children:[c.jsx("div",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2",children:" Compression successful!"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Ratio:"})," ",c.jsxs("span",{className:"font-medium",children:[i.compressionRatio.toFixed(1),"x"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Saved:"})," ",c.jsxs("span",{className:"font-medium",children:[i.tokensSaved," tokens"]})]})]})]}),s&&c.jsx("div",{className:"rounded-lg border border-destructive/50 bg-destructive/10 p-3 text-destructive text-sm",children:s})]}),c.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-border",children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"This will merge all blocks into one compressed block."}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(de,{variant:"ghost",onClick:d,disabled:o,children:i?.success?"Close":"Cancel"}),!i?.success&&c.jsx(de,{onClick:x,disabled:o||t.length===0,children:o?"Compressing...":"Compress & Merge"})]})]})]})})})}class Bt extends Error{constructor(n){super(n),this.name="SkillParseError"}}function va(e,n){const t=e.trim();if(!t.startsWith("---"))throw new Bt("Not a valid SKILL.md: missing frontmatter (expected --- at start)");const r=t.indexOf("---",3);if(r===-1)throw new Bt("Not a valid SKILL.md: missing closing --- delimiter");const o=t.slice(3,r).trim(),i=t.slice(r+3).trim(),s={};for(const u of o.split(`
`)){const h=u.indexOf(":");if(h===-1)continue;const f=u.slice(0,h).trim().toLowerCase();let x=u.slice(h+1).trim();(x.startsWith('"')&&x.endsWith('"')||x.startsWith("'")&&x.endsWith("'"))&&(x=x.slice(1,-1)),s[f]=x}const a=s.name;if(!a)throw new Bt("Not a valid SKILL.md: missing required 'name' field in frontmatter");const l=s.description||n||"";return{content:i,metadata:{skillName:a,skillDescription:l}}}function ba(e){return typeof e>"u"||e===null}function lh(e){return typeof e=="object"&&e!==null}function ch(e){return Array.isArray(e)?e:ba(e)?[]:[e]}function uh(e,n){var t,r,o,i;if(n)for(i=Object.keys(n),t=0,r=i.length;t<r;t+=1)o=i[t],e[o]=n[o];return e}function dh(e,n){var t="",r;for(r=0;r<n;r+=1)t+=e;return t}function fh(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var ph=ba,hh=lh,mh=ch,gh=dh,xh=fh,vh=uh,we={isNothing:ph,isObject:hh,toArray:mh,repeat:gh,isNegativeZero:xh,extend:vh};function ya(e,n){var t="",r=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(t+='in "'+e.mark.name+'" '),t+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!n&&e.mark.snippet&&(t+=`

`+e.mark.snippet),r+" "+t):r}function Kt(e,n){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=n,this.message=ya(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Kt.prototype=Object.create(Error.prototype);Kt.prototype.constructor=Kt;Kt.prototype.toString=function(n){return this.name+": "+ya(this,n)};var je=Kt;function nr(e,n,t,r,o){var i="",s="",a=Math.floor(o/2)-1;return r-n>a&&(i=" ... ",n=r-a+i.length),t-r>a&&(s=" ...",t=r+a-s.length),{str:i+e.slice(n,t).replace(/\t/g,"")+s,pos:r-n+i.length}}function rr(e,n){return we.repeat(" ",n-e.length)+e}function bh(e,n){if(n=Object.create(n||null),!e.buffer)return null;n.maxLength||(n.maxLength=79),typeof n.indent!="number"&&(n.indent=1),typeof n.linesBefore!="number"&&(n.linesBefore=3),typeof n.linesAfter!="number"&&(n.linesAfter=2);for(var t=/\r?\n|\r|\0/g,r=[0],o=[],i,s=-1;i=t.exec(e.buffer);)o.push(i.index),r.push(i.index+i[0].length),e.position<=i.index&&s<0&&(s=r.length-2);s<0&&(s=r.length-1);var a="",l,u,h=Math.min(e.line+n.linesAfter,o.length).toString().length,f=n.maxLength-(n.indent+h+3);for(l=1;l<=n.linesBefore&&!(s-l<0);l++)u=nr(e.buffer,r[s-l],o[s-l],e.position-(r[s]-r[s-l]),f),a=we.repeat(" ",n.indent)+rr((e.line-l+1).toString(),h)+" | "+u.str+`
`+a;for(u=nr(e.buffer,r[s],o[s],e.position,f),a+=we.repeat(" ",n.indent)+rr((e.line+1).toString(),h)+" | "+u.str+`
`,a+=we.repeat("-",n.indent+h+3+u.pos)+`^
`,l=1;l<=n.linesAfter&&!(s+l>=o.length);l++)u=nr(e.buffer,r[s+l],o[s+l],e.position-(r[s]-r[s+l]),f),a+=we.repeat(" ",n.indent)+rr((e.line+l+1).toString(),h)+" | "+u.str+`
`;return a.replace(/\n$/,"")}var yh=bh,wh=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],kh=["scalar","sequence","mapping"];function _h(e){var n={};return e!==null&&Object.keys(e).forEach(function(t){e[t].forEach(function(r){n[String(r)]=t})}),n}function Ch(e,n){if(n=n||{},Object.keys(n).forEach(function(t){if(wh.indexOf(t)===-1)throw new je('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')}),this.options=n,this.tag=e,this.kind=n.kind||null,this.resolve=n.resolve||function(){return!0},this.construct=n.construct||function(t){return t},this.instanceOf=n.instanceOf||null,this.predicate=n.predicate||null,this.represent=n.represent||null,this.representName=n.representName||null,this.defaultStyle=n.defaultStyle||null,this.multi=n.multi||!1,this.styleAliases=_h(n.styleAliases||null),kh.indexOf(this.kind)===-1)throw new je('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var Ce=Ch;function Go(e,n){var t=[];return e[n].forEach(function(r){var o=t.length;t.forEach(function(i,s){i.tag===r.tag&&i.kind===r.kind&&i.multi===r.multi&&(o=s)}),t[o]=r}),t}function Sh(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},n,t;function r(o){o.multi?(e.multi[o.kind].push(o),e.multi.fallback.push(o)):e[o.kind][o.tag]=e.fallback[o.tag]=o}for(n=0,t=arguments.length;n<t;n+=1)arguments[n].forEach(r);return e}function xr(e){return this.extend(e)}xr.prototype.extend=function(n){var t=[],r=[];if(n instanceof Ce)r.push(n);else if(Array.isArray(n))r=r.concat(n);else if(n&&(Array.isArray(n.implicit)||Array.isArray(n.explicit)))n.implicit&&(t=t.concat(n.implicit)),n.explicit&&(r=r.concat(n.explicit));else throw new je("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(i){if(!(i instanceof Ce))throw new je("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(i.loadKind&&i.loadKind!=="scalar")throw new je("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(i.multi)throw new je("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(i){if(!(i instanceof Ce))throw new je("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var o=Object.create(xr.prototype);return o.implicit=(this.implicit||[]).concat(t),o.explicit=(this.explicit||[]).concat(r),o.compiledImplicit=Go(o,"implicit"),o.compiledExplicit=Go(o,"explicit"),o.compiledTypeMap=Sh(o.compiledImplicit,o.compiledExplicit),o};var wa=xr,ka=new Ce("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),_a=new Ce("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Ca=new Ce("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Sa=new wa({explicit:[ka,_a,Ca]});function Eh(e){if(e===null)return!0;var n=e.length;return n===1&&e==="~"||n===4&&(e==="null"||e==="Null"||e==="NULL")}function Ah(){return null}function Nh(e){return e===null}var Ea=new Ce("tag:yaml.org,2002:null",{kind:"scalar",resolve:Eh,construct:Ah,predicate:Nh,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function jh(e){if(e===null)return!1;var n=e.length;return n===4&&(e==="true"||e==="True"||e==="TRUE")||n===5&&(e==="false"||e==="False"||e==="FALSE")}function Rh(e){return e==="true"||e==="True"||e==="TRUE"}function Oh(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Aa=new Ce("tag:yaml.org,2002:bool",{kind:"scalar",resolve:jh,construct:Rh,predicate:Oh,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function Th(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function Ih(e){return 48<=e&&e<=55}function Ph(e){return 48<=e&&e<=57}function Mh(e){if(e===null)return!1;var n=e.length,t=0,r=!1,o;if(!n)return!1;if(o=e[t],(o==="-"||o==="+")&&(o=e[++t]),o==="0"){if(t+1===n)return!0;if(o=e[++t],o==="b"){for(t++;t<n;t++)if(o=e[t],o!=="_"){if(o!=="0"&&o!=="1")return!1;r=!0}return r&&o!=="_"}if(o==="x"){for(t++;t<n;t++)if(o=e[t],o!=="_"){if(!Th(e.charCodeAt(t)))return!1;r=!0}return r&&o!=="_"}if(o==="o"){for(t++;t<n;t++)if(o=e[t],o!=="_"){if(!Ih(e.charCodeAt(t)))return!1;r=!0}return r&&o!=="_"}}if(o==="_")return!1;for(;t<n;t++)if(o=e[t],o!=="_"){if(!Ph(e.charCodeAt(t)))return!1;r=!0}return!(!r||o==="_")}function Dh(e){var n=e,t=1,r;if(n.indexOf("_")!==-1&&(n=n.replace(/_/g,"")),r=n[0],(r==="-"||r==="+")&&(r==="-"&&(t=-1),n=n.slice(1),r=n[0]),n==="0")return 0;if(r==="0"){if(n[1]==="b")return t*parseInt(n.slice(2),2);if(n[1]==="x")return t*parseInt(n.slice(2),16);if(n[1]==="o")return t*parseInt(n.slice(2),8)}return t*parseInt(n,10)}function Fh(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!we.isNegativeZero(e)}var Na=new Ce("tag:yaml.org,2002:int",{kind:"scalar",resolve:Mh,construct:Dh,predicate:Fh,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Lh=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function Bh(e){return!(e===null||!Lh.test(e)||e[e.length-1]==="_")}function zh(e){var n,t;return n=e.replace(/_/g,"").toLowerCase(),t=n[0]==="-"?-1:1,"+-".indexOf(n[0])>=0&&(n=n.slice(1)),n===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:n===".nan"?NaN:t*parseFloat(n,10)}var Uh=/^[-+]?[0-9]+e/;function $h(e,n){var t;if(isNaN(e))switch(n){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(n){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(n){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(we.isNegativeZero(e))return"-0.0";return t=e.toString(10),Uh.test(t)?t.replace("e",".e"):t}function Wh(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||we.isNegativeZero(e))}var ja=new Ce("tag:yaml.org,2002:float",{kind:"scalar",resolve:Bh,construct:zh,predicate:Wh,represent:$h,defaultStyle:"lowercase"}),Ra=Sa.extend({implicit:[Ea,Aa,Na,ja]}),Oa=Ra,Ta=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Ia=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function Hh(e){return e===null?!1:Ta.exec(e)!==null||Ia.exec(e)!==null}function Kh(e){var n,t,r,o,i,s,a,l=0,u=null,h,f,x;if(n=Ta.exec(e),n===null&&(n=Ia.exec(e)),n===null)throw new Error("Date resolve error");if(t=+n[1],r=+n[2]-1,o=+n[3],!n[4])return new Date(Date.UTC(t,r,o));if(i=+n[4],s=+n[5],a=+n[6],n[7]){for(l=n[7].slice(0,3);l.length<3;)l+="0";l=+l}return n[9]&&(h=+n[10],f=+(n[11]||0),u=(h*60+f)*6e4,n[9]==="-"&&(u=-u)),x=new Date(Date.UTC(t,r,o,i,s,a,l)),u&&x.setTime(x.getTime()-u),x}function Zh(e){return e.toISOString()}var Pa=new Ce("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:Hh,construct:Kh,instanceOf:Date,represent:Zh});function Gh(e){return e==="<<"||e===null}var Ma=new Ce("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Gh}),Xr=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Yh(e){if(e===null)return!1;var n,t,r=0,o=e.length,i=Xr;for(t=0;t<o;t++)if(n=i.indexOf(e.charAt(t)),!(n>64)){if(n<0)return!1;r+=6}return r%8===0}function Vh(e){var n,t,r=e.replace(/[\r\n=]/g,""),o=r.length,i=Xr,s=0,a=[];for(n=0;n<o;n++)n%4===0&&n&&(a.push(s>>16&255),a.push(s>>8&255),a.push(s&255)),s=s<<6|i.indexOf(r.charAt(n));return t=o%4*6,t===0?(a.push(s>>16&255),a.push(s>>8&255),a.push(s&255)):t===18?(a.push(s>>10&255),a.push(s>>2&255)):t===12&&a.push(s>>4&255),new Uint8Array(a)}function qh(e){var n="",t=0,r,o,i=e.length,s=Xr;for(r=0;r<i;r++)r%3===0&&r&&(n+=s[t>>18&63],n+=s[t>>12&63],n+=s[t>>6&63],n+=s[t&63]),t=(t<<8)+e[r];return o=i%3,o===0?(n+=s[t>>18&63],n+=s[t>>12&63],n+=s[t>>6&63],n+=s[t&63]):o===2?(n+=s[t>>10&63],n+=s[t>>4&63],n+=s[t<<2&63],n+=s[64]):o===1&&(n+=s[t>>2&63],n+=s[t<<4&63],n+=s[64],n+=s[64]),n}function Xh(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Da=new Ce("tag:yaml.org,2002:binary",{kind:"scalar",resolve:Yh,construct:Vh,predicate:Xh,represent:qh}),Qh=Object.prototype.hasOwnProperty,Jh=Object.prototype.toString;function em(e){if(e===null)return!0;var n=[],t,r,o,i,s,a=e;for(t=0,r=a.length;t<r;t+=1){if(o=a[t],s=!1,Jh.call(o)!=="[object Object]")return!1;for(i in o)if(Qh.call(o,i))if(!s)s=!0;else return!1;if(!s)return!1;if(n.indexOf(i)===-1)n.push(i);else return!1}return!0}function tm(e){return e!==null?e:[]}var Fa=new Ce("tag:yaml.org,2002:omap",{kind:"sequence",resolve:em,construct:tm}),nm=Object.prototype.toString;function rm(e){if(e===null)return!0;var n,t,r,o,i,s=e;for(i=new Array(s.length),n=0,t=s.length;n<t;n+=1){if(r=s[n],nm.call(r)!=="[object Object]"||(o=Object.keys(r),o.length!==1))return!1;i[n]=[o[0],r[o[0]]]}return!0}function om(e){if(e===null)return[];var n,t,r,o,i,s=e;for(i=new Array(s.length),n=0,t=s.length;n<t;n+=1)r=s[n],o=Object.keys(r),i[n]=[o[0],r[o[0]]];return i}var La=new Ce("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:rm,construct:om}),im=Object.prototype.hasOwnProperty;function sm(e){if(e===null)return!0;var n,t=e;for(n in t)if(im.call(t,n)&&t[n]!==null)return!1;return!0}function am(e){return e!==null?e:{}}var Ba=new Ce("tag:yaml.org,2002:set",{kind:"mapping",resolve:sm,construct:am}),Qr=Oa.extend({implicit:[Pa,Ma],explicit:[Da,Fa,La,Ba]}),at=Object.prototype.hasOwnProperty,_n=1,za=2,Ua=3,Cn=4,or=1,lm=2,Yo=3,cm=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,um=/[\x85\u2028\u2029]/,dm=/[,\[\]\{\}]/,$a=/^(?:!|!!|![a-z\-]+!)$/i,Wa=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Vo(e){return Object.prototype.toString.call(e)}function Ke(e){return e===10||e===13}function dt(e){return e===9||e===32}function Te(e){return e===9||e===32||e===10||e===13}function _t(e){return e===44||e===91||e===93||e===123||e===125}function fm(e){var n;return 48<=e&&e<=57?e-48:(n=e|32,97<=n&&n<=102?n-97+10:-1)}function pm(e){return e===120?2:e===117?4:e===85?8:0}function hm(e){return 48<=e&&e<=57?e-48:-1}function qo(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"":e===95?"":e===76?"\u2028":e===80?"\u2029":""}function mm(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function Ha(e,n,t){n==="__proto__"?Object.defineProperty(e,n,{configurable:!0,enumerable:!0,writable:!0,value:t}):e[n]=t}var Ka=new Array(256),Za=new Array(256);for(var yt=0;yt<256;yt++)Ka[yt]=qo(yt)?1:0,Za[yt]=qo(yt);function gm(e,n){this.input=e,this.filename=n.filename||null,this.schema=n.schema||Qr,this.onWarning=n.onWarning||null,this.legacy=n.legacy||!1,this.json=n.json||!1,this.listener=n.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Ga(e,n){var t={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return t.snippet=yh(t),new je(n,t)}function ie(e,n){throw Ga(e,n)}function Sn(e,n){e.onWarning&&e.onWarning.call(null,Ga(e,n))}var Xo={YAML:function(n,t,r){var o,i,s;n.version!==null&&ie(n,"duplication of %YAML directive"),r.length!==1&&ie(n,"YAML directive accepts exactly one argument"),o=/^([0-9]+)\.([0-9]+)$/.exec(r[0]),o===null&&ie(n,"ill-formed argument of the YAML directive"),i=parseInt(o[1],10),s=parseInt(o[2],10),i!==1&&ie(n,"unacceptable YAML version of the document"),n.version=r[0],n.checkLineBreaks=s<2,s!==1&&s!==2&&Sn(n,"unsupported YAML version of the document")},TAG:function(n,t,r){var o,i;r.length!==2&&ie(n,"TAG directive accepts exactly two arguments"),o=r[0],i=r[1],$a.test(o)||ie(n,"ill-formed tag handle (first argument) of the TAG directive"),at.call(n.tagMap,o)&&ie(n,'there is a previously declared suffix for "'+o+'" tag handle'),Wa.test(i)||ie(n,"ill-formed tag prefix (second argument) of the TAG directive");try{i=decodeURIComponent(i)}catch{ie(n,"tag prefix is malformed: "+i)}n.tagMap[o]=i}};function rt(e,n,t,r){var o,i,s,a;if(n<t){if(a=e.input.slice(n,t),r)for(o=0,i=a.length;o<i;o+=1)s=a.charCodeAt(o),s===9||32<=s&&s<=1114111||ie(e,"expected valid JSON character");else cm.test(a)&&ie(e,"the stream contains non-printable characters");e.result+=a}}function Qo(e,n,t,r){var o,i,s,a;for(we.isObject(t)||ie(e,"cannot merge mappings; the provided source object is unacceptable"),o=Object.keys(t),s=0,a=o.length;s<a;s+=1)i=o[s],at.call(n,i)||(Ha(n,i,t[i]),r[i]=!0)}function Ct(e,n,t,r,o,i,s,a,l){var u,h;if(Array.isArray(o))for(o=Array.prototype.slice.call(o),u=0,h=o.length;u<h;u+=1)Array.isArray(o[u])&&ie(e,"nested arrays are not supported inside keys"),typeof o=="object"&&Vo(o[u])==="[object Object]"&&(o[u]="[object Object]");if(typeof o=="object"&&Vo(o)==="[object Object]"&&(o="[object Object]"),o=String(o),n===null&&(n={}),r==="tag:yaml.org,2002:merge")if(Array.isArray(i))for(u=0,h=i.length;u<h;u+=1)Qo(e,n,i[u],t);else Qo(e,n,i,t);else!e.json&&!at.call(t,o)&&at.call(n,o)&&(e.line=s||e.line,e.lineStart=a||e.lineStart,e.position=l||e.position,ie(e,"duplicated mapping key")),Ha(n,o,i),delete t[o];return n}function Jr(e){var n;n=e.input.charCodeAt(e.position),n===10?e.position++:n===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):ie(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function ve(e,n,t){for(var r=0,o=e.input.charCodeAt(e.position);o!==0;){for(;dt(o);)o===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),o=e.input.charCodeAt(++e.position);if(n&&o===35)do o=e.input.charCodeAt(++e.position);while(o!==10&&o!==13&&o!==0);if(Ke(o))for(Jr(e),o=e.input.charCodeAt(e.position),r++,e.lineIndent=0;o===32;)e.lineIndent++,o=e.input.charCodeAt(++e.position);else break}return t!==-1&&r!==0&&e.lineIndent<t&&Sn(e,"deficient indentation"),r}function Un(e){var n=e.position,t;return t=e.input.charCodeAt(n),!!((t===45||t===46)&&t===e.input.charCodeAt(n+1)&&t===e.input.charCodeAt(n+2)&&(n+=3,t=e.input.charCodeAt(n),t===0||Te(t)))}function eo(e,n){n===1?e.result+=" ":n>1&&(e.result+=we.repeat(`
`,n-1))}function xm(e,n,t){var r,o,i,s,a,l,u,h,f=e.kind,x=e.result,d;if(d=e.input.charCodeAt(e.position),Te(d)||_t(d)||d===35||d===38||d===42||d===33||d===124||d===62||d===39||d===34||d===37||d===64||d===96||(d===63||d===45)&&(o=e.input.charCodeAt(e.position+1),Te(o)||t&&_t(o)))return!1;for(e.kind="scalar",e.result="",i=s=e.position,a=!1;d!==0;){if(d===58){if(o=e.input.charCodeAt(e.position+1),Te(o)||t&&_t(o))break}else if(d===35){if(r=e.input.charCodeAt(e.position-1),Te(r))break}else{if(e.position===e.lineStart&&Un(e)||t&&_t(d))break;if(Ke(d))if(l=e.line,u=e.lineStart,h=e.lineIndent,ve(e,!1,-1),e.lineIndent>=n){a=!0,d=e.input.charCodeAt(e.position);continue}else{e.position=s,e.line=l,e.lineStart=u,e.lineIndent=h;break}}a&&(rt(e,i,s,!1),eo(e,e.line-l),i=s=e.position,a=!1),dt(d)||(s=e.position+1),d=e.input.charCodeAt(++e.position)}return rt(e,i,s,!1),e.result?!0:(e.kind=f,e.result=x,!1)}function vm(e,n){var t,r,o;if(t=e.input.charCodeAt(e.position),t!==39)return!1;for(e.kind="scalar",e.result="",e.position++,r=o=e.position;(t=e.input.charCodeAt(e.position))!==0;)if(t===39)if(rt(e,r,e.position,!0),t=e.input.charCodeAt(++e.position),t===39)r=e.position,e.position++,o=e.position;else return!0;else Ke(t)?(rt(e,r,o,!0),eo(e,ve(e,!1,n)),r=o=e.position):e.position===e.lineStart&&Un(e)?ie(e,"unexpected end of the document within a single quoted scalar"):(e.position++,o=e.position);ie(e,"unexpected end of the stream within a single quoted scalar")}function bm(e,n){var t,r,o,i,s,a;if(a=e.input.charCodeAt(e.position),a!==34)return!1;for(e.kind="scalar",e.result="",e.position++,t=r=e.position;(a=e.input.charCodeAt(e.position))!==0;){if(a===34)return rt(e,t,e.position,!0),e.position++,!0;if(a===92){if(rt(e,t,e.position,!0),a=e.input.charCodeAt(++e.position),Ke(a))ve(e,!1,n);else if(a<256&&Ka[a])e.result+=Za[a],e.position++;else if((s=pm(a))>0){for(o=s,i=0;o>0;o--)a=e.input.charCodeAt(++e.position),(s=fm(a))>=0?i=(i<<4)+s:ie(e,"expected hexadecimal character");e.result+=mm(i),e.position++}else ie(e,"unknown escape sequence");t=r=e.position}else Ke(a)?(rt(e,t,r,!0),eo(e,ve(e,!1,n)),t=r=e.position):e.position===e.lineStart&&Un(e)?ie(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}ie(e,"unexpected end of the stream within a double quoted scalar")}function ym(e,n){var t=!0,r,o,i,s=e.tag,a,l=e.anchor,u,h,f,x,d,b=Object.create(null),p,m,g,w;if(w=e.input.charCodeAt(e.position),w===91)h=93,d=!1,a=[];else if(w===123)h=125,d=!0,a={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=a),w=e.input.charCodeAt(++e.position);w!==0;){if(ve(e,!0,n),w=e.input.charCodeAt(e.position),w===h)return e.position++,e.tag=s,e.anchor=l,e.kind=d?"mapping":"sequence",e.result=a,!0;t?w===44&&ie(e,"expected the node content, but found ','"):ie(e,"missed comma between flow collection entries"),m=p=g=null,f=x=!1,w===63&&(u=e.input.charCodeAt(e.position+1),Te(u)&&(f=x=!0,e.position++,ve(e,!0,n))),r=e.line,o=e.lineStart,i=e.position,jt(e,n,_n,!1,!0),m=e.tag,p=e.result,ve(e,!0,n),w=e.input.charCodeAt(e.position),(x||e.line===r)&&w===58&&(f=!0,w=e.input.charCodeAt(++e.position),ve(e,!0,n),jt(e,n,_n,!1,!0),g=e.result),d?Ct(e,a,b,m,p,g,r,o,i):f?a.push(Ct(e,null,b,m,p,g,r,o,i)):a.push(p),ve(e,!0,n),w=e.input.charCodeAt(e.position),w===44?(t=!0,w=e.input.charCodeAt(++e.position)):t=!1}ie(e,"unexpected end of the stream within a flow collection")}function wm(e,n){var t,r,o=or,i=!1,s=!1,a=n,l=0,u=!1,h,f;if(f=e.input.charCodeAt(e.position),f===124)r=!1;else if(f===62)r=!0;else return!1;for(e.kind="scalar",e.result="";f!==0;)if(f=e.input.charCodeAt(++e.position),f===43||f===45)or===o?o=f===43?Yo:lm:ie(e,"repeat of a chomping mode identifier");else if((h=hm(f))>=0)h===0?ie(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):s?ie(e,"repeat of an indentation width identifier"):(a=n+h-1,s=!0);else break;if(dt(f)){do f=e.input.charCodeAt(++e.position);while(dt(f));if(f===35)do f=e.input.charCodeAt(++e.position);while(!Ke(f)&&f!==0)}for(;f!==0;){for(Jr(e),e.lineIndent=0,f=e.input.charCodeAt(e.position);(!s||e.lineIndent<a)&&f===32;)e.lineIndent++,f=e.input.charCodeAt(++e.position);if(!s&&e.lineIndent>a&&(a=e.lineIndent),Ke(f)){l++;continue}if(e.lineIndent<a){o===Yo?e.result+=we.repeat(`
`,i?1+l:l):o===or&&i&&(e.result+=`
`);break}for(r?dt(f)?(u=!0,e.result+=we.repeat(`
`,i?1+l:l)):u?(u=!1,e.result+=we.repeat(`
`,l+1)):l===0?i&&(e.result+=" "):e.result+=we.repeat(`
`,l):e.result+=we.repeat(`
`,i?1+l:l),i=!0,s=!0,l=0,t=e.position;!Ke(f)&&f!==0;)f=e.input.charCodeAt(++e.position);rt(e,t,e.position,!1)}return!0}function Jo(e,n){var t,r=e.tag,o=e.anchor,i=[],s,a=!1,l;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=i),l=e.input.charCodeAt(e.position);l!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,ie(e,"tab characters must not be used in indentation")),!(l!==45||(s=e.input.charCodeAt(e.position+1),!Te(s))));){if(a=!0,e.position++,ve(e,!0,-1)&&e.lineIndent<=n){i.push(null),l=e.input.charCodeAt(e.position);continue}if(t=e.line,jt(e,n,Ua,!1,!0),i.push(e.result),ve(e,!0,-1),l=e.input.charCodeAt(e.position),(e.line===t||e.lineIndent>n)&&l!==0)ie(e,"bad indentation of a sequence entry");else if(e.lineIndent<n)break}return a?(e.tag=r,e.anchor=o,e.kind="sequence",e.result=i,!0):!1}function km(e,n,t){var r,o,i,s,a,l,u=e.tag,h=e.anchor,f={},x=Object.create(null),d=null,b=null,p=null,m=!1,g=!1,w;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=f),w=e.input.charCodeAt(e.position);w!==0;){if(!m&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,ie(e,"tab characters must not be used in indentation")),r=e.input.charCodeAt(e.position+1),i=e.line,(w===63||w===58)&&Te(r))w===63?(m&&(Ct(e,f,x,d,b,null,s,a,l),d=b=p=null),g=!0,m=!0,o=!0):m?(m=!1,o=!0):ie(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,w=r;else{if(s=e.line,a=e.lineStart,l=e.position,!jt(e,t,za,!1,!0))break;if(e.line===i){for(w=e.input.charCodeAt(e.position);dt(w);)w=e.input.charCodeAt(++e.position);if(w===58)w=e.input.charCodeAt(++e.position),Te(w)||ie(e,"a whitespace character is expected after the key-value separator within a block mapping"),m&&(Ct(e,f,x,d,b,null,s,a,l),d=b=p=null),g=!0,m=!1,o=!1,d=e.tag,b=e.result;else if(g)ie(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=u,e.anchor=h,!0}else if(g)ie(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=u,e.anchor=h,!0}if((e.line===i||e.lineIndent>n)&&(m&&(s=e.line,a=e.lineStart,l=e.position),jt(e,n,Cn,!0,o)&&(m?b=e.result:p=e.result),m||(Ct(e,f,x,d,b,p,s,a,l),d=b=p=null),ve(e,!0,-1),w=e.input.charCodeAt(e.position)),(e.line===i||e.lineIndent>n)&&w!==0)ie(e,"bad indentation of a mapping entry");else if(e.lineIndent<n)break}return m&&Ct(e,f,x,d,b,null,s,a,l),g&&(e.tag=u,e.anchor=h,e.kind="mapping",e.result=f),g}function _m(e){var n,t=!1,r=!1,o,i,s;if(s=e.input.charCodeAt(e.position),s!==33)return!1;if(e.tag!==null&&ie(e,"duplication of a tag property"),s=e.input.charCodeAt(++e.position),s===60?(t=!0,s=e.input.charCodeAt(++e.position)):s===33?(r=!0,o="!!",s=e.input.charCodeAt(++e.position)):o="!",n=e.position,t){do s=e.input.charCodeAt(++e.position);while(s!==0&&s!==62);e.position<e.length?(i=e.input.slice(n,e.position),s=e.input.charCodeAt(++e.position)):ie(e,"unexpected end of the stream within a verbatim tag")}else{for(;s!==0&&!Te(s);)s===33&&(r?ie(e,"tag suffix cannot contain exclamation marks"):(o=e.input.slice(n-1,e.position+1),$a.test(o)||ie(e,"named tag handle cannot contain such characters"),r=!0,n=e.position+1)),s=e.input.charCodeAt(++e.position);i=e.input.slice(n,e.position),dm.test(i)&&ie(e,"tag suffix cannot contain flow indicator characters")}i&&!Wa.test(i)&&ie(e,"tag name cannot contain such characters: "+i);try{i=decodeURIComponent(i)}catch{ie(e,"tag name is malformed: "+i)}return t?e.tag=i:at.call(e.tagMap,o)?e.tag=e.tagMap[o]+i:o==="!"?e.tag="!"+i:o==="!!"?e.tag="tag:yaml.org,2002:"+i:ie(e,'undeclared tag handle "'+o+'"'),!0}function Cm(e){var n,t;if(t=e.input.charCodeAt(e.position),t!==38)return!1;for(e.anchor!==null&&ie(e,"duplication of an anchor property"),t=e.input.charCodeAt(++e.position),n=e.position;t!==0&&!Te(t)&&!_t(t);)t=e.input.charCodeAt(++e.position);return e.position===n&&ie(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(n,e.position),!0}function Sm(e){var n,t,r;if(r=e.input.charCodeAt(e.position),r!==42)return!1;for(r=e.input.charCodeAt(++e.position),n=e.position;r!==0&&!Te(r)&&!_t(r);)r=e.input.charCodeAt(++e.position);return e.position===n&&ie(e,"name of an alias node must contain at least one character"),t=e.input.slice(n,e.position),at.call(e.anchorMap,t)||ie(e,'unidentified alias "'+t+'"'),e.result=e.anchorMap[t],ve(e,!0,-1),!0}function jt(e,n,t,r,o){var i,s,a,l=1,u=!1,h=!1,f,x,d,b,p,m;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,i=s=a=Cn===t||Ua===t,r&&ve(e,!0,-1)&&(u=!0,e.lineIndent>n?l=1:e.lineIndent===n?l=0:e.lineIndent<n&&(l=-1)),l===1)for(;_m(e)||Cm(e);)ve(e,!0,-1)?(u=!0,a=i,e.lineIndent>n?l=1:e.lineIndent===n?l=0:e.lineIndent<n&&(l=-1)):a=!1;if(a&&(a=u||o),(l===1||Cn===t)&&(_n===t||za===t?p=n:p=n+1,m=e.position-e.lineStart,l===1?a&&(Jo(e,m)||km(e,m,p))||ym(e,p)?h=!0:(s&&wm(e,p)||vm(e,p)||bm(e,p)?h=!0:Sm(e)?(h=!0,(e.tag!==null||e.anchor!==null)&&ie(e,"alias node should not have any properties")):xm(e,p,_n===t)&&(h=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):l===0&&(h=a&&Jo(e,m))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&ie(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),f=0,x=e.implicitTypes.length;f<x;f+=1)if(b=e.implicitTypes[f],b.resolve(e.result)){e.result=b.construct(e.result),e.tag=b.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(at.call(e.typeMap[e.kind||"fallback"],e.tag))b=e.typeMap[e.kind||"fallback"][e.tag];else for(b=null,d=e.typeMap.multi[e.kind||"fallback"],f=0,x=d.length;f<x;f+=1)if(e.tag.slice(0,d[f].tag.length)===d[f].tag){b=d[f];break}b||ie(e,"unknown tag !<"+e.tag+">"),e.result!==null&&b.kind!==e.kind&&ie(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+b.kind+'", not "'+e.kind+'"'),b.resolve(e.result,e.tag)?(e.result=b.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):ie(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||h}function Em(e){var n=e.position,t,r,o,i=!1,s;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(s=e.input.charCodeAt(e.position))!==0&&(ve(e,!0,-1),s=e.input.charCodeAt(e.position),!(e.lineIndent>0||s!==37));){for(i=!0,s=e.input.charCodeAt(++e.position),t=e.position;s!==0&&!Te(s);)s=e.input.charCodeAt(++e.position);for(r=e.input.slice(t,e.position),o=[],r.length<1&&ie(e,"directive name must not be less than one character in length");s!==0;){for(;dt(s);)s=e.input.charCodeAt(++e.position);if(s===35){do s=e.input.charCodeAt(++e.position);while(s!==0&&!Ke(s));break}if(Ke(s))break;for(t=e.position;s!==0&&!Te(s);)s=e.input.charCodeAt(++e.position);o.push(e.input.slice(t,e.position))}s!==0&&Jr(e),at.call(Xo,r)?Xo[r](e,r,o):Sn(e,'unknown document directive "'+r+'"')}if(ve(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,ve(e,!0,-1)):i&&ie(e,"directives end mark is expected"),jt(e,e.lineIndent-1,Cn,!1,!0),ve(e,!0,-1),e.checkLineBreaks&&um.test(e.input.slice(n,e.position))&&Sn(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&Un(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,ve(e,!0,-1));return}if(e.position<e.length-1)ie(e,"end of the stream or a document separator is expected");else return}function Ya(e,n){e=String(e),n=n||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var t=new gm(e,n),r=e.indexOf("\0");for(r!==-1&&(t.position=r,ie(t,"null byte is not allowed in input")),t.input+="\0";t.input.charCodeAt(t.position)===32;)t.lineIndent+=1,t.position+=1;for(;t.position<t.length-1;)Em(t);return t.documents}function Am(e,n,t){n!==null&&typeof n=="object"&&typeof t>"u"&&(t=n,n=null);var r=Ya(e,t);if(typeof n!="function")return r;for(var o=0,i=r.length;o<i;o+=1)n(r[o])}function Nm(e,n){var t=Ya(e,n);if(t.length!==0){if(t.length===1)return t[0];throw new je("expected a single document in the stream, but found more")}}var jm=Am,Rm=Nm,Va={loadAll:jm,load:Rm},qa=Object.prototype.toString,Xa=Object.prototype.hasOwnProperty,to=65279,Om=9,Zt=10,Tm=13,Im=32,Pm=33,Mm=34,vr=35,Dm=37,Fm=38,Lm=39,Bm=42,Qa=44,zm=45,En=58,Um=61,$m=62,Wm=63,Hm=64,Ja=91,el=93,Km=96,tl=123,Zm=124,nl=125,Ne={};Ne[0]="\\0";Ne[7]="\\a";Ne[8]="\\b";Ne[9]="\\t";Ne[10]="\\n";Ne[11]="\\v";Ne[12]="\\f";Ne[13]="\\r";Ne[27]="\\e";Ne[34]='\\"';Ne[92]="\\\\";Ne[133]="\\N";Ne[160]="\\_";Ne[8232]="\\L";Ne[8233]="\\P";var Gm=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Ym=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Vm(e,n){var t,r,o,i,s,a,l;if(n===null)return{};for(t={},r=Object.keys(n),o=0,i=r.length;o<i;o+=1)s=r[o],a=String(n[s]),s.slice(0,2)==="!!"&&(s="tag:yaml.org,2002:"+s.slice(2)),l=e.compiledTypeMap.fallback[s],l&&Xa.call(l.styleAliases,a)&&(a=l.styleAliases[a]),t[s]=a;return t}function qm(e){var n,t,r;if(n=e.toString(16).toUpperCase(),e<=255)t="x",r=2;else if(e<=65535)t="u",r=4;else if(e<=4294967295)t="U",r=8;else throw new je("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+t+we.repeat("0",r-n.length)+n}var Xm=1,Gt=2;function Qm(e){this.schema=e.schema||Qr,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=we.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Vm(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?Gt:Xm,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function ei(e,n){for(var t=we.repeat(" ",n),r=0,o=-1,i="",s,a=e.length;r<a;)o=e.indexOf(`
`,r),o===-1?(s=e.slice(r),r=a):(s=e.slice(r,o+1),r=o+1),s.length&&s!==`
`&&(i+=t),i+=s;return i}function br(e,n){return`
`+we.repeat(" ",e.indent*n)}function Jm(e,n){var t,r,o;for(t=0,r=e.implicitTypes.length;t<r;t+=1)if(o=e.implicitTypes[t],o.resolve(n))return!0;return!1}function An(e){return e===Im||e===Om}function Yt(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==to||65536<=e&&e<=1114111}function ti(e){return Yt(e)&&e!==to&&e!==Tm&&e!==Zt}function ni(e,n,t){var r=ti(e),o=r&&!An(e);return(t?r:r&&e!==Qa&&e!==Ja&&e!==el&&e!==tl&&e!==nl)&&e!==vr&&!(n===En&&!o)||ti(n)&&!An(n)&&e===vr||n===En&&o}function eg(e){return Yt(e)&&e!==to&&!An(e)&&e!==zm&&e!==Wm&&e!==En&&e!==Qa&&e!==Ja&&e!==el&&e!==tl&&e!==nl&&e!==vr&&e!==Fm&&e!==Bm&&e!==Pm&&e!==Zm&&e!==Um&&e!==$m&&e!==Lm&&e!==Mm&&e!==Dm&&e!==Hm&&e!==Km}function tg(e){return!An(e)&&e!==En}function Lt(e,n){var t=e.charCodeAt(n),r;return t>=55296&&t<=56319&&n+1<e.length&&(r=e.charCodeAt(n+1),r>=56320&&r<=57343)?(t-55296)*1024+r-56320+65536:t}function rl(e){var n=/^\n* /;return n.test(e)}var ol=1,yr=2,il=3,sl=4,kt=5;function ng(e,n,t,r,o,i,s,a){var l,u=0,h=null,f=!1,x=!1,d=r!==-1,b=-1,p=eg(Lt(e,0))&&tg(Lt(e,e.length-1));if(n||s)for(l=0;l<e.length;u>=65536?l+=2:l++){if(u=Lt(e,l),!Yt(u))return kt;p=p&&ni(u,h,a),h=u}else{for(l=0;l<e.length;u>=65536?l+=2:l++){if(u=Lt(e,l),u===Zt)f=!0,d&&(x=x||l-b-1>r&&e[b+1]!==" ",b=l);else if(!Yt(u))return kt;p=p&&ni(u,h,a),h=u}x=x||d&&l-b-1>r&&e[b+1]!==" "}return!f&&!x?p&&!s&&!o(e)?ol:i===Gt?kt:yr:t>9&&rl(e)?kt:s?i===Gt?kt:yr:x?sl:il}function rg(e,n,t,r,o){e.dump=(function(){if(n.length===0)return e.quotingType===Gt?'""':"''";if(!e.noCompatMode&&(Gm.indexOf(n)!==-1||Ym.test(n)))return e.quotingType===Gt?'"'+n+'"':"'"+n+"'";var i=e.indent*Math.max(1,t),s=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-i),a=r||e.flowLevel>-1&&t>=e.flowLevel;function l(u){return Jm(e,u)}switch(ng(n,a,e.indent,s,l,e.quotingType,e.forceQuotes&&!r,o)){case ol:return n;case yr:return"'"+n.replace(/'/g,"''")+"'";case il:return"|"+ri(n,e.indent)+oi(ei(n,i));case sl:return">"+ri(n,e.indent)+oi(ei(og(n,s),i));case kt:return'"'+ig(n)+'"';default:throw new je("impossible error: invalid scalar style")}})()}function ri(e,n){var t=rl(e)?String(n):"",r=e[e.length-1]===`
`,o=r&&(e[e.length-2]===`
`||e===`
`),i=o?"+":r?"":"-";return t+i+`
`}function oi(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function og(e,n){for(var t=/(\n+)([^\n]*)/g,r=(function(){var u=e.indexOf(`
`);return u=u!==-1?u:e.length,t.lastIndex=u,ii(e.slice(0,u),n)})(),o=e[0]===`
`||e[0]===" ",i,s;s=t.exec(e);){var a=s[1],l=s[2];i=l[0]===" ",r+=a+(!o&&!i&&l!==""?`
`:"")+ii(l,n),o=i}return r}function ii(e,n){if(e===""||e[0]===" ")return e;for(var t=/ [^ ]/g,r,o=0,i,s=0,a=0,l="";r=t.exec(e);)a=r.index,a-o>n&&(i=s>o?s:a,l+=`
`+e.slice(o,i),o=i+1),s=a;return l+=`
`,e.length-o>n&&s>o?l+=e.slice(o,s)+`
`+e.slice(s+1):l+=e.slice(o),l.slice(1)}function ig(e){for(var n="",t=0,r,o=0;o<e.length;t>=65536?o+=2:o++)t=Lt(e,o),r=Ne[t],!r&&Yt(t)?(n+=e[o],t>=65536&&(n+=e[o+1])):n+=r||qm(t);return n}function sg(e,n,t){var r="",o=e.tag,i,s,a;for(i=0,s=t.length;i<s;i+=1)a=t[i],e.replacer&&(a=e.replacer.call(t,String(i),a)),(Je(e,n,a,!1,!1)||typeof a>"u"&&Je(e,n,null,!1,!1))&&(r!==""&&(r+=","+(e.condenseFlow?"":" ")),r+=e.dump);e.tag=o,e.dump="["+r+"]"}function si(e,n,t,r){var o="",i=e.tag,s,a,l;for(s=0,a=t.length;s<a;s+=1)l=t[s],e.replacer&&(l=e.replacer.call(t,String(s),l)),(Je(e,n+1,l,!0,!0,!1,!0)||typeof l>"u"&&Je(e,n+1,null,!0,!0,!1,!0))&&((!r||o!=="")&&(o+=br(e,n)),e.dump&&Zt===e.dump.charCodeAt(0)?o+="-":o+="- ",o+=e.dump);e.tag=i,e.dump=o||"[]"}function ag(e,n,t){var r="",o=e.tag,i=Object.keys(t),s,a,l,u,h;for(s=0,a=i.length;s<a;s+=1)h="",r!==""&&(h+=", "),e.condenseFlow&&(h+='"'),l=i[s],u=t[l],e.replacer&&(u=e.replacer.call(t,l,u)),Je(e,n,l,!1,!1)&&(e.dump.length>1024&&(h+="? "),h+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Je(e,n,u,!1,!1)&&(h+=e.dump,r+=h));e.tag=o,e.dump="{"+r+"}"}function lg(e,n,t,r){var o="",i=e.tag,s=Object.keys(t),a,l,u,h,f,x;if(e.sortKeys===!0)s.sort();else if(typeof e.sortKeys=="function")s.sort(e.sortKeys);else if(e.sortKeys)throw new je("sortKeys must be a boolean or a function");for(a=0,l=s.length;a<l;a+=1)x="",(!r||o!=="")&&(x+=br(e,n)),u=s[a],h=t[u],e.replacer&&(h=e.replacer.call(t,u,h)),Je(e,n+1,u,!0,!0,!0)&&(f=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,f&&(e.dump&&Zt===e.dump.charCodeAt(0)?x+="?":x+="? "),x+=e.dump,f&&(x+=br(e,n)),Je(e,n+1,h,!0,f)&&(e.dump&&Zt===e.dump.charCodeAt(0)?x+=":":x+=": ",x+=e.dump,o+=x));e.tag=i,e.dump=o||"{}"}function ai(e,n,t){var r,o,i,s,a,l;for(o=t?e.explicitTypes:e.implicitTypes,i=0,s=o.length;i<s;i+=1)if(a=o[i],(a.instanceOf||a.predicate)&&(!a.instanceOf||typeof n=="object"&&n instanceof a.instanceOf)&&(!a.predicate||a.predicate(n))){if(t?a.multi&&a.representName?e.tag=a.representName(n):e.tag=a.tag:e.tag="?",a.represent){if(l=e.styleMap[a.tag]||a.defaultStyle,qa.call(a.represent)==="[object Function]")r=a.represent(n,l);else if(Xa.call(a.represent,l))r=a.represent[l](n,l);else throw new je("!<"+a.tag+'> tag resolver accepts not "'+l+'" style');e.dump=r}return!0}return!1}function Je(e,n,t,r,o,i,s){e.tag=null,e.dump=t,ai(e,t,!1)||ai(e,t,!0);var a=qa.call(e.dump),l=r,u;r&&(r=e.flowLevel<0||e.flowLevel>n);var h=a==="[object Object]"||a==="[object Array]",f,x;if(h&&(f=e.duplicates.indexOf(t),x=f!==-1),(e.tag!==null&&e.tag!=="?"||x||e.indent!==2&&n>0)&&(o=!1),x&&e.usedDuplicates[f])e.dump="*ref_"+f;else{if(h&&x&&!e.usedDuplicates[f]&&(e.usedDuplicates[f]=!0),a==="[object Object]")r&&Object.keys(e.dump).length!==0?(lg(e,n,e.dump,o),x&&(e.dump="&ref_"+f+e.dump)):(ag(e,n,e.dump),x&&(e.dump="&ref_"+f+" "+e.dump));else if(a==="[object Array]")r&&e.dump.length!==0?(e.noArrayIndent&&!s&&n>0?si(e,n-1,e.dump,o):si(e,n,e.dump,o),x&&(e.dump="&ref_"+f+e.dump)):(sg(e,n,e.dump),x&&(e.dump="&ref_"+f+" "+e.dump));else if(a==="[object String]")e.tag!=="?"&&rg(e,e.dump,n,i,l);else{if(a==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new je("unacceptable kind of an object to dump "+a)}e.tag!==null&&e.tag!=="?"&&(u=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?u="!"+u:u.slice(0,18)==="tag:yaml.org,2002:"?u="!!"+u.slice(18):u="!<"+u+">",e.dump=u+" "+e.dump)}return!0}function cg(e,n){var t=[],r=[],o,i;for(wr(e,t,r),o=0,i=r.length;o<i;o+=1)n.duplicates.push(t[r[o]]);n.usedDuplicates=new Array(i)}function wr(e,n,t){var r,o,i;if(e!==null&&typeof e=="object")if(o=n.indexOf(e),o!==-1)t.indexOf(o)===-1&&t.push(o);else if(n.push(e),Array.isArray(e))for(o=0,i=e.length;o<i;o+=1)wr(e[o],n,t);else for(r=Object.keys(e),o=0,i=r.length;o<i;o+=1)wr(e[r[o]],n,t)}function ug(e,n){n=n||{};var t=new Qm(n);t.noRefs||cg(e,t);var r=e;return t.replacer&&(r=t.replacer.call({"":r},"",r)),Je(t,0,r,!0,!0)?t.dump+`
`:""}var dg=ug,fg={dump:dg};function no(e,n){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+n+" instead, which is now safe by default.")}}var pg=Ce,hg=wa,mg=Sa,gg=Ra,xg=Oa,vg=Qr,bg=Va.load,yg=Va.loadAll,al=fg.dump,wg=je,kg={binary:Da,float:ja,map:Ca,null:Ea,pairs:La,set:Ba,timestamp:Pa,bool:Aa,int:Na,merge:Ma,omap:Fa,seq:_a,str:ka},_g=no("safeLoad","load"),Cg=no("safeLoadAll","loadAll"),Sg=no("safeDump","dump"),Eg={Type:pg,Schema:hg,FAILSAFE_SCHEMA:mg,JSON_SCHEMA:gg,CORE_SCHEMA:xg,DEFAULT_SCHEMA:vg,load:bg,loadAll:yg,dump:al,YAMLException:wg,types:kg,safeLoad:_g,safeLoadAll:Cg,safeDump:Sg};class Ve extends Error{constructor(n){super(n),this.name="ContextMapParseError"}}function $e(e){return e?Array.isArray(e)?e.filter(n=>typeof n=="string"):[]:[]}function Ag(e,n){let t;try{t=Eg.load(e)}catch(a){throw new Ve(`Invalid YAML: ${a instanceof Error?a.message:"parse error"}`)}if(!t||typeof t!="object"||!t.contexts)throw new Ve("Missing 'contexts' key in context-map.yaml");if(typeof t.contexts!="object"||Array.isArray(t.contexts))throw new Ve("'contexts' must be an object mapping keys to context definitions");const r=Object.keys(t.contexts);if(r.length===0)throw new Ve("context-map.yaml must define at least one context");const o=new Map,i=[];for(const a of r){const l=t.contexts[a];if(!l||typeof l!="object")throw new Ve(`Context '${a}' must be an object`);if(!l.label||typeof l.label!="string")throw new Ve(`Context '${a}' is missing required 'label' field`);const u=$e(l.depends_on);for(const f of u)if(!t.contexts[f])throw new Ve(`Context '${a}' depends on unknown context '${f}'`);const h=[...$e(l.permanent),...$e(l.stable),...$e(l.working),...$e(l.optional_stable)];i.push(...h),o.set(a,l)}for(const a of i)if(!n.has(a))throw new Ve(`Referenced file not found in package: ${a}`);return{contexts:Ng(o)}}function Ng(e){const n=[],t=new Set,r=new Set;function o(i){if(r.has(i))return;if(t.has(i))throw new Ve(`Circular dependency detected involving context: ${i}`);t.add(i);const s=e.get(i),a=$e(s.depends_on);for(const l of a)o(l);t.delete(i),r.add(i),n.push({key:i,label:s.label,permanent:$e(s.permanent),stable:$e(s.stable),working:$e(s.working),optionalStable:$e(s.optional_stable),dependsOn:a,output:typeof s.output=="string"?s.output:void 0})}for(const i of e.keys())o(i);return n}function jg(e){const n=e.toLowerCase();return n.startsWith("references/permanent/")?"PERMANENT":n.startsWith("references/working/")?"WORKING":(n.startsWith("references/stable/"),"STABLE")}function ir(e){const n=e.split("/");return n[n.length-1]}function Rg(e,n){let t,r;for(const[a,l]of e)if(ir(a).toLowerCase()==="skill.md"&&!a.includes("references/")){t=l,r=a;break}if(!t)throw new Error("No SKILL.md found in directory");const o=va(t,n),i=[];for(const[a,l]of e){if(a===r)continue;const u=a.toLowerCase();u.startsWith("references/")&&u.endsWith(".md")&&i.push({filename:ir(a),content:l,zone:jg(a),relativePath:a})}i.sort((a,l)=>a.relativePath.localeCompare(l.relativePath));let s;for(const[a,l]of e)if(ir(a).toLowerCase()==="context-map.yaml"&&!a.includes("/")){try{s=Ag(l,new Set(e.keys()))}catch{}break}return{skill:o,references:i,contextMap:s}}function un(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var sr={exports:{}};var li;function Og(){return li||(li=1,(function(e,n){(function(t){e.exports=t()})(function(){return(function t(r,o,i){function s(u,h){if(!o[u]){if(!r[u]){var f=typeof un=="function"&&un;if(!h&&f)return f(u,!0);if(a)return a(u,!0);var x=new Error("Cannot find module '"+u+"'");throw x.code="MODULE_NOT_FOUND",x}var d=o[u]={exports:{}};r[u][0].call(d.exports,function(b){var p=r[u][1][b];return s(p||b)},d,d.exports,t,r,o,i)}return o[u].exports}for(var a=typeof un=="function"&&un,l=0;l<i.length;l++)s(i[l]);return s})({1:[function(t,r,o){var i=t("./utils"),s=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(l){for(var u,h,f,x,d,b,p,m=[],g=0,w=l.length,_=w,E=i.getTypeOf(l)!=="string";g<l.length;)_=w-g,f=E?(u=l[g++],h=g<w?l[g++]:0,g<w?l[g++]:0):(u=l.charCodeAt(g++),h=g<w?l.charCodeAt(g++):0,g<w?l.charCodeAt(g++):0),x=u>>2,d=(3&u)<<4|h>>4,b=1<_?(15&h)<<2|f>>6:64,p=2<_?63&f:64,m.push(a.charAt(x)+a.charAt(d)+a.charAt(b)+a.charAt(p));return m.join("")},o.decode=function(l){var u,h,f,x,d,b,p=0,m=0,g="data:";if(l.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var w,_=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&_--,l.charAt(l.length-2)===a.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=s.uint8array?new Uint8Array(0|_):new Array(0|_);p<l.length;)u=a.indexOf(l.charAt(p++))<<2|(x=a.indexOf(l.charAt(p++)))>>4,h=(15&x)<<4|(d=a.indexOf(l.charAt(p++)))>>2,f=(3&d)<<6|(b=a.indexOf(l.charAt(p++))),w[m++]=u,d!==64&&(w[m++]=h),b!==64&&(w[m++]=f);return w}},{"./support":30,"./utils":32}],2:[function(t,r,o){var i=t("./external"),s=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function u(h,f,x,d,b){this.compressedSize=h,this.uncompressedSize=f,this.crc32=x,this.compression=d,this.compressedContent=b}u.prototype={getContentWorker:function(){var h=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),f=this;return h.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(h,f,x){return h.pipe(new a).pipe(new l("uncompressedSize")).pipe(f.compressWorker(x)).pipe(new l("compressedSize")).withStreamInfo("compression",f)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,r,o){var i=t("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},o.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,r,o){var i=t("./utils"),s=(function(){for(var a,l=[],u=0;u<256;u++){a=u;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;l[u]=a}return l})();r.exports=function(a,l){return a!==void 0&&a.length?i.getTypeOf(a)!=="string"?(function(u,h,f,x){var d=s,b=x+f;u^=-1;for(var p=x;p<b;p++)u=u>>>8^d[255&(u^h[p])];return-1^u})(0|l,a,a.length,0):(function(u,h,f,x){var d=s,b=x+f;u^=-1;for(var p=x;p<b;p++)u=u>>>8^d[255&(u^h.charCodeAt(p))];return-1^u})(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(t,r,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(t,r,o){var i=null;i=typeof Promise<"u"?Promise:t("lie"),r.exports={Promise:i}},{lie:37}],7:[function(t,r,o){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=t("pako"),a=t("./utils"),l=t("./stream/GenericWorker"),u=i?"uint8array":"array";function h(f,x){l.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=x,this.meta={}}o.magic="\b\0",a.inherits(h,l),h.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,f.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(x){f.push({data:x,meta:f.meta})}},o.compressWorker=function(f){return new h("Deflate",f)},o.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,r,o){function i(d,b){var p,m="";for(p=0;p<b;p++)m+=String.fromCharCode(255&d),d>>>=8;return m}function s(d,b,p,m,g,w){var _,E,S=d.file,R=d.compression,j=w!==u.utf8encode,M=a.transformTo("string",w(S.name)),I=a.transformTo("string",u.utf8encode(S.name)),L=S.comment,K=a.transformTo("string",w(L)),C=a.transformTo("string",u.utf8encode(L)),D=I.length!==S.name.length,y=C.length!==L.length,U="",V="",H="",X=S.dir,B=S.date,Z={crc32:0,compressedSize:0,uncompressedSize:0};b&&!p||(Z.crc32=d.crc32,Z.compressedSize=d.compressedSize,Z.uncompressedSize=d.uncompressedSize);var P=0;b&&(P|=8),j||!D&&!y||(P|=2048);var T=0,te=0;X&&(T|=16),g==="UNIX"?(te=798,T|=(function(J,ce){var q=J;return J||(q=ce?16893:33204),(65535&q)<<16})(S.unixPermissions,X)):(te=20,T|=(function(J){return 63&(J||0)})(S.dosPermissions)),_=B.getUTCHours(),_<<=6,_|=B.getUTCMinutes(),_<<=5,_|=B.getUTCSeconds()/2,E=B.getUTCFullYear()-1980,E<<=4,E|=B.getUTCMonth()+1,E<<=5,E|=B.getUTCDate(),D&&(V=i(1,1)+i(h(M),4)+I,U+="up"+i(V.length,2)+V),y&&(H=i(1,1)+i(h(K),4)+C,U+="uc"+i(H.length,2)+H);var ee="";return ee+=`
\0`,ee+=i(P,2),ee+=R.magic,ee+=i(_,2),ee+=i(E,2),ee+=i(Z.crc32,4),ee+=i(Z.compressedSize,4),ee+=i(Z.uncompressedSize,4),ee+=i(M.length,2),ee+=i(U.length,2),{fileRecord:f.LOCAL_FILE_HEADER+ee+M+U,dirRecord:f.CENTRAL_FILE_HEADER+i(te,2)+ee+i(K.length,2)+"\0\0\0\0"+i(T,4)+i(m,4)+M+U+K}}var a=t("../utils"),l=t("../stream/GenericWorker"),u=t("../utf8"),h=t("../crc32"),f=t("../signature");function x(d,b,p,m){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=p,this.encodeFileName=m,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(x,l),x.prototype.push=function(d){var b=d.meta.percent||0,p=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,l.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:p?(b+100*(p-m-1))/p:100}}))},x.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var b=this.streamFiles&&!d.file.dir;if(b){var p=s(d,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},x.prototype.closedSource=function(d){this.accumulate=!1;var b=this.streamFiles&&!d.file.dir,p=s(d,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),b)this.push({data:(function(m){return f.DATA_DESCRIPTOR+i(m.crc32,4)+i(m.compressedSize,4)+i(m.uncompressedSize,4)})(d),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},x.prototype.flush=function(){for(var d=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var p=this.bytesWritten-d,m=(function(g,w,_,E,S){var R=a.transformTo("string",S(E));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(g,2)+i(g,2)+i(w,4)+i(_,4)+i(R.length,2)+R})(this.dirRecords.length,p,d,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},x.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},x.prototype.registerPrevious=function(d){this._sources.push(d);var b=this;return d.on("data",function(p){b.processChunk(p)}),d.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),d.on("error",function(p){b.error(p)}),this},x.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},x.prototype.error=function(d){var b=this._sources;if(!l.prototype.error.call(this,d))return!1;for(var p=0;p<b.length;p++)try{b[p].error(d)}catch{}return!0},x.prototype.lock=function(){l.prototype.lock.call(this);for(var d=this._sources,b=0;b<d.length;b++)d[b].lock()},r.exports=x},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,r,o){var i=t("../compressions"),s=t("./ZipFileWorker");o.generateWorker=function(a,l,u){var h=new s(l.streamFiles,u,l.platform,l.encodeFileName),f=0;try{a.forEach(function(x,d){f++;var b=(function(w,_){var E=w||_,S=i[E];if(!S)throw new Error(E+" is not a valid compression method !");return S})(d.options.compression,l.compression),p=d.options.compressionOptions||l.compressionOptions||{},m=d.dir,g=d.date;d._compressWorker(b,p).withStreamInfo("file",{name:x,dir:m,date:g,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(h)}),h.entriesCount=f}catch(x){h.error(x)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,r,o){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var a in this)typeof this[a]!="function"&&(s[a]=this[a]);return s}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.10.1",i.loadAsync=function(s,a){return new i().loadAsync(s,a)},i.external=t("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,r,o){var i=t("./utils"),s=t("./external"),a=t("./utf8"),l=t("./zipEntries"),u=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function f(x){return new s.Promise(function(d,b){var p=x.decompressed.getContentWorker().pipe(new u);p.on("error",function(m){b(m)}).on("end",function(){p.streamInfo.crc32!==x.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(x,d){var b=this;return d=i.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(x)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",x,!0,d.optimizedBinaryString,d.base64).then(function(p){var m=new l(d);return m.load(p),m}).then(function(p){var m=[s.Promise.resolve(p)],g=p.files;if(d.checkCRC32)for(var w=0;w<g.length;w++)m.push(f(g[w]));return s.Promise.all(m)}).then(function(p){for(var m=p.shift(),g=m.files,w=0;w<g.length;w++){var _=g[w],E=_.fileNameStr,S=i.resolve(_.fileNameStr);b.file(S,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:d.createFolders}),_.dir||(b.file(S).unsafeOriginalName=E)}return m.zipComment.length&&(b.comment=m.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,r,o){var i=t("../utils"),s=t("../stream/GenericWorker");function a(l,u){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(u)}i.inherits(a,s),a.prototype._bindStream=function(l){var u=this;(this._stream=l).pause(),l.on("data",function(h){u.push({data:h,meta:{percent:0}})}).on("error",function(h){u.isPaused?this.generatedError=h:u.error(h)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,r,o){var i=t("readable-stream").Readable;function s(a,l,u){i.call(this,l),this._helper=a;var h=this;a.on("data",function(f,x){h.push(f)||h._helper.pause(),u&&u(x)}).on("error",function(f){h.emit("error",f)}).on("end",function(){h.push(null)})}t("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(t,r,o){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(t,r,o){function i(S,R,j){var M,I=a.getTypeOf(R),L=a.extend(j||{},h);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(S=g(S)),L.createFolders&&(M=m(S))&&w.call(this,M,!0);var K=I==="string"&&L.binary===!1&&L.base64===!1;j&&j.binary!==void 0||(L.binary=!K),(R instanceof f&&R.uncompressedSize===0||L.dir||!R||R.length===0)&&(L.base64=!1,L.binary=!0,R="",L.compression="STORE",I="string");var C=null;C=R instanceof f||R instanceof l?R:b.isNode&&b.isStream(R)?new p(S,R):a.prepareContent(S,R,L.binary,L.optimizedBinaryString,L.base64);var D=new x(S,C,L);this.files[S]=D}var s=t("./utf8"),a=t("./utils"),l=t("./stream/GenericWorker"),u=t("./stream/StreamHelper"),h=t("./defaults"),f=t("./compressedObject"),x=t("./zipObject"),d=t("./generate"),b=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),m=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var R=S.lastIndexOf("/");return 0<R?S.substring(0,R):""},g=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},w=function(S,R){return R=R!==void 0?R:h.createFolders,S=g(S),this.files[S]||i.call(this,S,null,{dir:!0,createFolders:R}),this.files[S]};function _(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var R,j,M;for(R in this.files)M=this.files[R],(j=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&S(j,M)},filter:function(S){var R=[];return this.forEach(function(j,M){S(j,M)&&R.push(M)}),R},file:function(S,R,j){if(arguments.length!==1)return S=this.root+S,i.call(this,S,R,j),this;if(_(S)){var M=S;return this.filter(function(L,K){return!K.dir&&M.test(L)})}var I=this.files[this.root+S];return I&&!I.dir?I:null},folder:function(S){if(!S)return this;if(_(S))return this.filter(function(I,L){return L.dir&&S.test(I)});var R=this.root+S,j=w.call(this,R),M=this.clone();return M.root=j.name,M},remove:function(S){S=this.root+S;var R=this.files[S];if(R||(S.slice(-1)!=="/"&&(S+="/"),R=this.files[S]),R&&!R.dir)delete this.files[S];else for(var j=this.filter(function(I,L){return L.name.slice(0,S.length)===S}),M=0;M<j.length;M++)delete this.files[j[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var R,j={};try{if((j=a.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=j.type.toLowerCase(),j.compression=j.compression.toUpperCase(),j.type==="binarystring"&&(j.type="string"),!j.type)throw new Error("No output type specified.");a.checkSupport(j.type),j.platform!=="darwin"&&j.platform!=="freebsd"&&j.platform!=="linux"&&j.platform!=="sunos"||(j.platform="UNIX"),j.platform==="win32"&&(j.platform="DOS");var M=j.comment||this.comment||"";R=d.generateWorker(this,j,M)}catch(I){(R=new l("error")).error(I)}return new u(R,j.type||"string",j.mimeType)},generateAsync:function(S,R){return this.generateInternalStream(S).accumulate(R)},generateNodeStream:function(S,R){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(R)}};r.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,r,o){r.exports=t("stream")},{stream:void 0}],17:[function(t,r,o){var i=t("./DataReader");function s(a){i.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}t("../utils").inherits(s,i),s.prototype.byteAt=function(a){return this.data[this.zero+a]},s.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),u=a.charCodeAt(1),h=a.charCodeAt(2),f=a.charCodeAt(3),x=this.length-4;0<=x;--x)if(this.data[x]===l&&this.data[x+1]===u&&this.data[x+2]===h&&this.data[x+3]===f)return x-this.zero;return-1},s.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),u=a.charCodeAt(1),h=a.charCodeAt(2),f=a.charCodeAt(3),x=this.readData(4);return l===x[0]&&u===x[1]&&h===x[2]&&f===x[3]},s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(t,r,o){var i=t("../utils");function s(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,u=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)u=(u<<8)+this.byteAt(l);return this.index+=a,u},readString:function(a){return i.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=s},{"../utils":32}],19:[function(t,r,o){var i=t("./Uint8ArrayReader");function s(a){i.call(this,a)}t("../utils").inherits(s,i),s.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,r,o){var i=t("./DataReader");function s(a){i.call(this,a)}t("../utils").inherits(s,i),s.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},s.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},s.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},s.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(t,r,o){var i=t("./ArrayReader");function s(a){i.call(this,a)}t("../utils").inherits(s,i),s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(t,r,o){var i=t("../utils"),s=t("../support"),a=t("./ArrayReader"),l=t("./StringReader"),u=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");r.exports=function(f){var x=i.getTypeOf(f);return i.checkSupport(x),x!=="string"||s.uint8array?x==="nodebuffer"?new u(f):s.uint8array?new h(i.transformTo("uint8array",f)):new a(i.transformTo("array",f)):new l(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,r,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,r,o){var i=t("./GenericWorker"),s=t("../utils");function a(l){i.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(a,i),a.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,r,o){var i=t("./GenericWorker"),s=t("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,i),a.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,r,o){var i=t("../utils"),s=t("./GenericWorker");function a(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(a,s),a.prototype.processChunk=function(l){if(l){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+l.data.length}s.prototype.processChunk.call(this,l)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,r,o){var i=t("../utils"),s=t("./GenericWorker");function a(l){s.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){u.dataIsReady=!0,u.data=h,u.max=h&&h.length||0,u.type=i.getTypeOf(h),u.isPaused||u._tickAndRepeat()},function(h){u.error(h)})}i.inherits(a,s),a.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,u);break;case"uint8array":l=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":l=this.data.slice(this.index,u)}return this.index=u,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,r,o){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,a){return this._listeners[s].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,a){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,a)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var a=this;return s.on("data",function(l){a.processChunk(l)}),s.on("end",function(){a.end()}),s.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,a){return this.extraStreamInfo[s]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=i},{}],29:[function(t,r,o){var i=t("../utils"),s=t("./ConvertWorker"),a=t("./GenericWorker"),l=t("../base64"),u=t("../support"),h=t("../external"),f=null;if(u.nodestream)try{f=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function x(b,p){return new h.Promise(function(m,g){var w=[],_=b._internalType,E=b._outputType,S=b._mimeType;b.on("data",function(R,j){w.push(R),p&&p(j)}).on("error",function(R){w=[],g(R)}).on("end",function(){try{var R=(function(j,M,I){switch(j){case"blob":return i.newBlob(i.transformTo("arraybuffer",M),I);case"base64":return l.encode(M);default:return i.transformTo(j,M)}})(E,(function(j,M){var I,L=0,K=null,C=0;for(I=0;I<M.length;I++)C+=M[I].length;switch(j){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(K=new Uint8Array(C),I=0;I<M.length;I++)K.set(M[I],L),L+=M[I].length;return K;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+j+"'")}})(_,w),S);m(R)}catch(j){g(j)}w=[]}).resume()})}function d(b,p,m){var g=p;switch(p){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=p,this._mimeType=m,i.checkSupport(g),this._worker=b.pipe(new s(g)),b.lock()}catch(w){this._worker=new a("error"),this._worker.error(w)}}d.prototype={accumulate:function(b){return x(this,b)},on:function(b,p){var m=this;return b==="data"?this._worker.on(b,function(g){p.call(m,g.data,g.meta)}):this._worker.on(b,function(){i.delay(p,arguments,m)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},b)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,r,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var i=new ArrayBuffer(0);try{o.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),o.blob=s.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!t("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(t,r,o){for(var i=t("./utils"),s=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),u=new Array(256),h=0;h<256;h++)u[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;u[254]=u[254]=1;function f(){l.call(this,"utf-8 decode"),this.leftOver=null}function x(){l.call(this,"utf-8 encode")}o.utf8encode=function(d){return s.nodebuffer?a.newBufferFrom(d,"utf-8"):(function(b){var p,m,g,w,_,E=b.length,S=0;for(w=0;w<E;w++)(64512&(m=b.charCodeAt(w)))==55296&&w+1<E&&(64512&(g=b.charCodeAt(w+1)))==56320&&(m=65536+(m-55296<<10)+(g-56320),w++),S+=m<128?1:m<2048?2:m<65536?3:4;for(p=s.uint8array?new Uint8Array(S):new Array(S),w=_=0;_<S;w++)(64512&(m=b.charCodeAt(w)))==55296&&w+1<E&&(64512&(g=b.charCodeAt(w+1)))==56320&&(m=65536+(m-55296<<10)+(g-56320),w++),m<128?p[_++]=m:(m<2048?p[_++]=192|m>>>6:(m<65536?p[_++]=224|m>>>12:(p[_++]=240|m>>>18,p[_++]=128|m>>>12&63),p[_++]=128|m>>>6&63),p[_++]=128|63&m);return p})(d)},o.utf8decode=function(d){return s.nodebuffer?i.transformTo("nodebuffer",d).toString("utf-8"):(function(b){var p,m,g,w,_=b.length,E=new Array(2*_);for(p=m=0;p<_;)if((g=b[p++])<128)E[m++]=g;else if(4<(w=u[g]))E[m++]=65533,p+=w-1;else{for(g&=w===2?31:w===3?15:7;1<w&&p<_;)g=g<<6|63&b[p++],w--;1<w?E[m++]=65533:g<65536?E[m++]=g:(g-=65536,E[m++]=55296|g>>10&1023,E[m++]=56320|1023&g)}return E.length!==m&&(E.subarray?E=E.subarray(0,m):E.length=m),i.applyFromCharCode(E)})(d=i.transformTo(s.uint8array?"uint8array":"array",d))},i.inherits(f,l),f.prototype.processChunk=function(d){var b=i.transformTo(s.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var p=b;(b=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),b.set(p,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var m=(function(w,_){var E;for((_=_||w.length)>w.length&&(_=w.length),E=_-1;0<=E&&(192&w[E])==128;)E--;return E<0||E===0?_:E+u[w[E]]>_?E:_})(b),g=b;m!==b.length&&(s.uint8array?(g=b.subarray(0,m),this.leftOver=b.subarray(m,b.length)):(g=b.slice(0,m),this.leftOver=b.slice(m,b.length))),this.push({data:o.utf8decode(g),meta:d.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=f,i.inherits(x,l),x.prototype.processChunk=function(d){this.push({data:o.utf8encode(d.data),meta:d.meta})},o.Utf8EncodeWorker=x},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,r,o){var i=t("./support"),s=t("./base64"),a=t("./nodejsUtils"),l=t("./external");function u(p){return p}function h(p,m){for(var g=0;g<p.length;++g)m[g]=255&p.charCodeAt(g);return m}t("setimmediate"),o.newBlob=function(p,m){o.checkSupport("blob");try{return new Blob([p],{type:m})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(p),g.getBlob(m)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(p,m,g){var w=[],_=0,E=p.length;if(E<=g)return String.fromCharCode.apply(null,p);for(;_<E;)m==="array"||m==="nodebuffer"?w.push(String.fromCharCode.apply(null,p.slice(_,Math.min(_+g,E)))):w.push(String.fromCharCode.apply(null,p.subarray(_,Math.min(_+g,E)))),_+=g;return w.join("")},stringifyByChar:function(p){for(var m="",g=0;g<p.length;g++)m+=String.fromCharCode(p[g]);return m},applyCanBeUsed:{uint8array:(function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function x(p){var m=65536,g=o.getTypeOf(p),w=!0;if(g==="uint8array"?w=f.applyCanBeUsed.uint8array:g==="nodebuffer"&&(w=f.applyCanBeUsed.nodebuffer),w)for(;1<m;)try{return f.stringifyByChunk(p,g,m)}catch{m=Math.floor(m/2)}return f.stringifyByChar(p)}function d(p,m){for(var g=0;g<p.length;g++)m[g]=p[g];return m}o.applyFromCharCode=x;var b={};b.string={string:u,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return b.string.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:function(p){return h(p,a.allocBuffer(p.length))}},b.array={string:x,array:u,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},b.arraybuffer={string:function(p){return x(new Uint8Array(p))},array:function(p){return d(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:u,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},b.uint8array={string:x,array:function(p){return d(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:u,nodebuffer:function(p){return a.newBufferFrom(p)}},b.nodebuffer={string:x,array:function(p){return d(p,new Array(p.length))},arraybuffer:function(p){return b.nodebuffer.uint8array(p).buffer},uint8array:function(p){return d(p,new Uint8Array(p.length))},nodebuffer:u},o.transformTo=function(p,m){if(m=m||"",!p)return m;o.checkSupport(p);var g=o.getTypeOf(m);return b[g][p](m)},o.resolve=function(p){for(var m=p.split("/"),g=[],w=0;w<m.length;w++){var _=m[w];_==="."||_===""&&w!==0&&w!==m.length-1||(_===".."?g.pop():g.push(_))}return g.join("/")},o.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":i.nodebuffer&&a.isBuffer(p)?"nodebuffer":i.uint8array&&p instanceof Uint8Array?"uint8array":i.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(p){if(!i[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(p){var m,g,w="";for(g=0;g<(p||"").length;g++)w+="\\x"+((m=p.charCodeAt(g))<16?"0":"")+m.toString(16).toUpperCase();return w},o.delay=function(p,m,g){setImmediate(function(){p.apply(g||null,m||[])})},o.inherits=function(p,m){function g(){}g.prototype=m.prototype,p.prototype=new g},o.extend=function(){var p,m,g={};for(p=0;p<arguments.length;p++)for(m in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],m)&&g[m]===void 0&&(g[m]=arguments[p][m]);return g},o.prepareContent=function(p,m,g,w,_){return l.Promise.resolve(m).then(function(E){return i.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new l.Promise(function(S,R){var j=new FileReader;j.onload=function(M){S(M.target.result)},j.onerror=function(M){R(M.target.error)},j.readAsArrayBuffer(E)}):E}).then(function(E){var S=o.getTypeOf(E);return S?(S==="arraybuffer"?E=o.transformTo("uint8array",E):S==="string"&&(_?E=s.decode(E):g&&w!==!0&&(E=(function(R){return h(R,i.uint8array?new Uint8Array(R.length):new Array(R.length))})(E))),E):l.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,r,o){var i=t("./reader/readerFor"),s=t("./utils"),a=t("./signature"),l=t("./zipEntry"),u=t("./support");function h(f){this.files=[],this.loadOptions=f}h.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var x=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(x)+", expected "+s.pretty(f)+")")}},isSignature:function(f,x){var d=this.reader.index;this.reader.setIndex(f);var b=this.reader.readString(4)===x;return this.reader.setIndex(d),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),x=u.uint8array?"uint8array":"array",d=s.transformTo(x,f);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,x,d,b=this.zip64EndOfCentralSize-44;0<b;)f=this.reader.readInt(2),x=this.reader.readInt(4),d=this.reader.readData(x),this.zip64ExtensibleData[f]={id:f,length:x,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,x;for(f=0;f<this.files.length;f++)x=this.files[f],this.reader.setIndex(x.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),x.readLocalPart(this.reader),x.handleUTF8(),x.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var x=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var b=x-d;if(0<b)this.isSignature(x,a.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(f){this.reader=i(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,r,o){var i=t("./reader/readerFor"),s=t("./utils"),a=t("./compressedObject"),l=t("./crc32"),u=t("./utf8"),h=t("./compressions"),f=t("./support");function x(d,b){this.options=d,this.loadOptions=b}x.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var b,p;if(d.skip(22),this.fileNameLength=d.readInt(2),p=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=(function(m){for(var g in h)if(Object.prototype.hasOwnProperty.call(h,g)&&h[g].magic===m)return h[g];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,b,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var b=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(b),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var b,p,m,g=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<g;)b=d.readInt(2),p=d.readInt(2),m=d.readData(p),this.extraFields[b]={id:b,length:p,value:m};d.setIndex(g)},handleUTF8:function(){var d=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var p=s.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var g=s.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var b=i(d.value);return b.readInt(1)!==1||l(this.fileName)!==b.readInt(4)?null:u.utf8decode(b.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var b=i(d.value);return b.readInt(1)!==1||l(this.fileComment)!==b.readInt(4)?null:u.utf8decode(b.readData(d.length-5))}return null}},r.exports=x},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,r,o){function i(b,p,m){this.name=b,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=p,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var s=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),l=t("./utf8"),u=t("./compressedObject"),h=t("./stream/GenericWorker");i.prototype={internalStream:function(b){var p=null,m="string";try{if(!b)throw new Error("No output type specified.");var g=(m=b.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),p=this._decompressWorker();var w=!this._dataBinary;w&&!g&&(p=p.pipe(new l.Utf8EncodeWorker)),!w&&g&&(p=p.pipe(new l.Utf8DecodeWorker))}catch(_){(p=new h("error")).error(_)}return new s(p,m,"")},async:function(b,p){return this.internalStream(b).accumulate(p)},nodeStream:function(b,p){return this.internalStream(b||"nodebuffer").toNodejsStream(p)},_compressWorker:function(b,p){if(this._data instanceof u&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new l.Utf8EncodeWorker)),u.createWorkerFrom(m,b,p)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],x=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<f.length;d++)i.prototype[f[d]]=x;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,r,o){(function(i){var s,a,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var u=0,h=new l(b),f=i.document.createTextNode("");h.observe(f,{characterData:!0}),s=function(){f.data=u=++u%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var p=i.document.createElement("script");p.onreadystatechange=function(){b(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},i.document.documentElement.appendChild(p)}:function(){setTimeout(b,0)};else{var x=new i.MessageChannel;x.port1.onmessage=b,s=function(){x.port2.postMessage(0)}}var d=[];function b(){var p,m;a=!0;for(var g=d.length;g;){for(m=d,d=[],p=-1;++p<g;)m[p]();g=d.length}a=!1}r.exports=function(p){d.push(p)!==1||a||s()}}).call(this,typeof nt<"u"?nt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,r,o){var i=t("immediate");function s(){}var a={},l=["REJECTED"],u=["FULFILLED"],h=["PENDING"];function f(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,g!==s&&p(this,g)}function x(g,w,_){this.promise=g,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}function d(g,w,_){i(function(){var E;try{E=w(_)}catch(S){return a.reject(g,S)}E===g?a.reject(g,new TypeError("Cannot resolve promise with itself")):a.resolve(g,E)})}function b(g){var w=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof w=="function")return function(){w.apply(g,arguments)}}function p(g,w){var _=!1;function E(j){_||(_=!0,a.reject(g,j))}function S(j){_||(_=!0,a.resolve(g,j))}var R=m(function(){w(S,E)});R.status==="error"&&E(R.value)}function m(g,w){var _={};try{_.value=g(w),_.status="success"}catch(E){_.status="error",_.value=E}return _}(r.exports=f).prototype.finally=function(g){if(typeof g!="function")return this;var w=this.constructor;return this.then(function(_){return w.resolve(g()).then(function(){return _})},function(_){return w.resolve(g()).then(function(){throw _})})},f.prototype.catch=function(g){return this.then(null,g)},f.prototype.then=function(g,w){if(typeof g!="function"&&this.state===u||typeof w!="function"&&this.state===l)return this;var _=new this.constructor(s);return this.state!==h?d(_,this.state===u?g:w,this.outcome):this.queue.push(new x(_,g,w)),_},x.prototype.callFulfilled=function(g){a.resolve(this.promise,g)},x.prototype.otherCallFulfilled=function(g){d(this.promise,this.onFulfilled,g)},x.prototype.callRejected=function(g){a.reject(this.promise,g)},x.prototype.otherCallRejected=function(g){d(this.promise,this.onRejected,g)},a.resolve=function(g,w){var _=m(b,w);if(_.status==="error")return a.reject(g,_.value);var E=_.value;if(E)p(g,E);else{g.state=u,g.outcome=w;for(var S=-1,R=g.queue.length;++S<R;)g.queue[S].callFulfilled(w)}return g},a.reject=function(g,w){g.state=l,g.outcome=w;for(var _=-1,E=g.queue.length;++_<E;)g.queue[_].callRejected(w);return g},f.resolve=function(g){return g instanceof this?g:a.resolve(new this(s),g)},f.reject=function(g){var w=new this(s);return a.reject(w,g)},f.all=function(g){var w=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=g.length,E=!1;if(!_)return this.resolve([]);for(var S=new Array(_),R=0,j=-1,M=new this(s);++j<_;)I(g[j],j);return M;function I(L,K){w.resolve(L).then(function(C){S[K]=C,++R!==_||E||(E=!0,a.resolve(M,S))},function(C){E||(E=!0,a.reject(M,C))})}},f.race=function(g){var w=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=g.length,E=!1;if(!_)return this.resolve([]);for(var S=-1,R=new this(s);++S<_;)j=g[S],w.resolve(j).then(function(M){E||(E=!0,a.resolve(R,M))},function(M){E||(E=!0,a.reject(R,M))});var j;return R}},{immediate:36}],38:[function(t,r,o){var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,r,o){var i=t("./zlib/deflate"),s=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/messages"),u=t("./zlib/zstream"),h=Object.prototype.toString,f=0,x=-1,d=0,b=8;function p(g){if(!(this instanceof p))return new p(g);this.options=s.assign({level:x,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},g||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var _=i.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(_!==f)throw new Error(l[_]);if(w.header&&i.deflateSetHeader(this.strm,w.header),w.dictionary){var E;if(E=typeof w.dictionary=="string"?a.string2buf(w.dictionary):h.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(_=i.deflateSetDictionary(this.strm,E))!==f)throw new Error(l[_]);this._dict_set=!0}}function m(g,w){var _=new p(w);if(_.push(g,!0),_.err)throw _.msg||l[_.err];return _.result}p.prototype.push=function(g,w){var _,E,S=this.strm,R=this.options.chunkSize;if(this.ended)return!1;E=w===~~w?w:w===!0?4:0,typeof g=="string"?S.input=a.string2buf(g):h.call(g)==="[object ArrayBuffer]"?S.input=new Uint8Array(g):S.input=g,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new s.Buf8(R),S.next_out=0,S.avail_out=R),(_=i.deflate(S,E))!==1&&_!==f)return this.onEnd(_),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(s.shrinkBuf(S.output,S.next_out))):this.onData(s.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&_!==1);return E===4?(_=i.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===f):E!==2||(this.onEnd(f),!(S.avail_out=0))},p.prototype.onData=function(g){this.chunks.push(g)},p.prototype.onEnd=function(g){g===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},o.Deflate=p,o.deflate=m,o.deflateRaw=function(g,w){return(w=w||{}).raw=!0,m(g,w)},o.gzip=function(g,w){return(w=w||{}).gzip=!0,m(g,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,r,o){var i=t("./zlib/inflate"),s=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/constants"),u=t("./zlib/messages"),h=t("./zlib/zstream"),f=t("./zlib/gzheader"),x=Object.prototype.toString;function d(p){if(!(this instanceof d))return new d(p);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},p||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||p&&p.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&(15&m.windowBits)==0&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var g=i.inflateInit2(this.strm,m.windowBits);if(g!==l.Z_OK)throw new Error(u[g]);this.header=new f,i.inflateGetHeader(this.strm,this.header)}function b(p,m){var g=new d(m);if(g.push(p,!0),g.err)throw g.msg||u[g.err];return g.result}d.prototype.push=function(p,m){var g,w,_,E,S,R,j=this.strm,M=this.options.chunkSize,I=this.options.dictionary,L=!1;if(this.ended)return!1;w=m===~~m?m:m===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof p=="string"?j.input=a.binstring2buf(p):x.call(p)==="[object ArrayBuffer]"?j.input=new Uint8Array(p):j.input=p,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new s.Buf8(M),j.next_out=0,j.avail_out=M),(g=i.inflate(j,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&I&&(R=typeof I=="string"?a.string2buf(I):x.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,g=i.inflateSetDictionary(this.strm,R)),g===l.Z_BUF_ERROR&&L===!0&&(g=l.Z_OK,L=!1),g!==l.Z_STREAM_END&&g!==l.Z_OK)return this.onEnd(g),!(this.ended=!0);j.next_out&&(j.avail_out!==0&&g!==l.Z_STREAM_END&&(j.avail_in!==0||w!==l.Z_FINISH&&w!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=a.utf8border(j.output,j.next_out),E=j.next_out-_,S=a.buf2string(j.output,_),j.next_out=E,j.avail_out=M-E,E&&s.arraySet(j.output,j.output,_,E,0),this.onData(S)):this.onData(s.shrinkBuf(j.output,j.next_out)))),j.avail_in===0&&j.avail_out===0&&(L=!0)}while((0<j.avail_in||j.avail_out===0)&&g!==l.Z_STREAM_END);return g===l.Z_STREAM_END&&(w=l.Z_FINISH),w===l.Z_FINISH?(g=i.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===l.Z_OK):w!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(j.avail_out=0))},d.prototype.onData=function(p){this.chunks.push(p)},d.prototype.onEnd=function(p){p===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},o.Inflate=d,o.inflate=b,o.inflateRaw=function(p,m){return(m=m||{}).raw=!0,b(p,m)},o.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,r,o){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(l){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var h=u.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var f in h)h.hasOwnProperty(f)&&(l[f]=h[f])}}return l},o.shrinkBuf=function(l,u){return l.length===u?l:l.subarray?l.subarray(0,u):(l.length=u,l)};var s={arraySet:function(l,u,h,f,x){if(u.subarray&&l.subarray)l.set(u.subarray(h,h+f),x);else for(var d=0;d<f;d++)l[x+d]=u[h+d]},flattenChunks:function(l){var u,h,f,x,d,b;for(u=f=0,h=l.length;u<h;u++)f+=l[u].length;for(b=new Uint8Array(f),u=x=0,h=l.length;u<h;u++)d=l[u],b.set(d,x),x+=d.length;return b}},a={arraySet:function(l,u,h,f,x){for(var d=0;d<f;d++)l[x+d]=u[h+d]},flattenChunks:function(l){return[].concat.apply([],l)}};o.setTyped=function(l){l?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,s)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,a))},o.setTyped(i)},{}],42:[function(t,r,o){var i=t("./common"),s=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new i.Buf8(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function h(f,x){if(x<65537&&(f.subarray&&a||!f.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(f,x));for(var d="",b=0;b<x;b++)d+=String.fromCharCode(f[b]);return d}l[254]=l[254]=1,o.string2buf=function(f){var x,d,b,p,m,g=f.length,w=0;for(p=0;p<g;p++)(64512&(d=f.charCodeAt(p)))==55296&&p+1<g&&(64512&(b=f.charCodeAt(p+1)))==56320&&(d=65536+(d-55296<<10)+(b-56320),p++),w+=d<128?1:d<2048?2:d<65536?3:4;for(x=new i.Buf8(w),p=m=0;m<w;p++)(64512&(d=f.charCodeAt(p)))==55296&&p+1<g&&(64512&(b=f.charCodeAt(p+1)))==56320&&(d=65536+(d-55296<<10)+(b-56320),p++),d<128?x[m++]=d:(d<2048?x[m++]=192|d>>>6:(d<65536?x[m++]=224|d>>>12:(x[m++]=240|d>>>18,x[m++]=128|d>>>12&63),x[m++]=128|d>>>6&63),x[m++]=128|63&d);return x},o.buf2binstring=function(f){return h(f,f.length)},o.binstring2buf=function(f){for(var x=new i.Buf8(f.length),d=0,b=x.length;d<b;d++)x[d]=f.charCodeAt(d);return x},o.buf2string=function(f,x){var d,b,p,m,g=x||f.length,w=new Array(2*g);for(d=b=0;d<g;)if((p=f[d++])<128)w[b++]=p;else if(4<(m=l[p]))w[b++]=65533,d+=m-1;else{for(p&=m===2?31:m===3?15:7;1<m&&d<g;)p=p<<6|63&f[d++],m--;1<m?w[b++]=65533:p<65536?w[b++]=p:(p-=65536,w[b++]=55296|p>>10&1023,w[b++]=56320|1023&p)}return h(w,b)},o.utf8border=function(f,x){var d;for((x=x||f.length)>f.length&&(x=f.length),d=x-1;0<=d&&(192&f[d])==128;)d--;return d<0||d===0?x:d+l[f[d]]>x?d:x}},{"./common":41}],43:[function(t,r,o){r.exports=function(i,s,a,l){for(var u=65535&i|0,h=i>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;h=h+(u=u+s[l++]|0)|0,--f;);u%=65521,h%=65521}return u|h<<16|0}},{}],44:[function(t,r,o){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,r,o){var i=(function(){for(var s,a=[],l=0;l<256;l++){s=l;for(var u=0;u<8;u++)s=1&s?3988292384^s>>>1:s>>>1;a[l]=s}return a})();r.exports=function(s,a,l,u){var h=i,f=u+l;s^=-1;for(var x=u;x<f;x++)s=s>>>8^h[255&(s^a[x])];return-1^s}},{}],46:[function(t,r,o){var i,s=t("../utils/common"),a=t("./trees"),l=t("./adler32"),u=t("./crc32"),h=t("./messages"),f=0,x=4,d=0,b=-2,p=-1,m=4,g=2,w=8,_=9,E=286,S=30,R=19,j=2*E+1,M=15,I=3,L=258,K=L+I+1,C=42,D=113,y=1,U=2,V=3,H=4;function X(v,$){return v.msg=h[$],$}function B(v){return(v<<1)-(4<v?9:0)}function Z(v){for(var $=v.length;0<=--$;)v[$]=0}function P(v){var $=v.state,z=$.pending;z>v.avail_out&&(z=v.avail_out),z!==0&&(s.arraySet(v.output,$.pending_buf,$.pending_out,z,v.next_out),v.next_out+=z,$.pending_out+=z,v.total_out+=z,v.avail_out-=z,$.pending-=z,$.pending===0&&($.pending_out=0))}function T(v,$){a._tr_flush_block(v,0<=v.block_start?v.block_start:-1,v.strstart-v.block_start,$),v.block_start=v.strstart,P(v.strm)}function te(v,$){v.pending_buf[v.pending++]=$}function ee(v,$){v.pending_buf[v.pending++]=$>>>8&255,v.pending_buf[v.pending++]=255&$}function J(v,$){var z,N,A=v.max_chain_length,O=v.strstart,W=v.prev_length,G=v.nice_match,F=v.strstart>v.w_size-K?v.strstart-(v.w_size-K):0,Y=v.window,ne=v.w_mask,Q=v.prev,oe=v.strstart+L,fe=Y[O+W-1],ue=Y[O+W];v.prev_length>=v.good_match&&(A>>=2),G>v.lookahead&&(G=v.lookahead);do if(Y[(z=$)+W]===ue&&Y[z+W-1]===fe&&Y[z]===Y[O]&&Y[++z]===Y[O+1]){O+=2,z++;do;while(Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&Y[++O]===Y[++z]&&O<oe);if(N=L-(oe-O),O=oe-L,W<N){if(v.match_start=$,G<=(W=N))break;fe=Y[O+W-1],ue=Y[O+W]}}while(($=Q[$&ne])>F&&--A!=0);return W<=v.lookahead?W:v.lookahead}function ce(v){var $,z,N,A,O,W,G,F,Y,ne,Q=v.w_size;do{if(A=v.window_size-v.lookahead-v.strstart,v.strstart>=Q+(Q-K)){for(s.arraySet(v.window,v.window,Q,Q,0),v.match_start-=Q,v.strstart-=Q,v.block_start-=Q,$=z=v.hash_size;N=v.head[--$],v.head[$]=Q<=N?N-Q:0,--z;);for($=z=Q;N=v.prev[--$],v.prev[$]=Q<=N?N-Q:0,--z;);A+=Q}if(v.strm.avail_in===0)break;if(W=v.strm,G=v.window,F=v.strstart+v.lookahead,Y=A,ne=void 0,ne=W.avail_in,Y<ne&&(ne=Y),z=ne===0?0:(W.avail_in-=ne,s.arraySet(G,W.input,W.next_in,ne,F),W.state.wrap===1?W.adler=l(W.adler,G,ne,F):W.state.wrap===2&&(W.adler=u(W.adler,G,ne,F)),W.next_in+=ne,W.total_in+=ne,ne),v.lookahead+=z,v.lookahead+v.insert>=I)for(O=v.strstart-v.insert,v.ins_h=v.window[O],v.ins_h=(v.ins_h<<v.hash_shift^v.window[O+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[O+I-1])&v.hash_mask,v.prev[O&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=O,O++,v.insert--,!(v.lookahead+v.insert<I)););}while(v.lookahead<K&&v.strm.avail_in!==0)}function q(v,$){for(var z,N;;){if(v.lookahead<K){if(ce(v),v.lookahead<K&&$===f)return y;if(v.lookahead===0)break}if(z=0,v.lookahead>=I&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,z=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),z!==0&&v.strstart-z<=v.w_size-K&&(v.match_length=J(v,z)),v.match_length>=I)if(N=a._tr_tally(v,v.strstart-v.match_start,v.match_length-I),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=I){for(v.match_length--;v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,z=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart,--v.match_length!=0;);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else N=a._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(N&&(T(v,!1),v.strm.avail_out===0))return y}return v.insert=v.strstart<I-1?v.strstart:I-1,$===x?(T(v,!0),v.strm.avail_out===0?V:H):v.last_lit&&(T(v,!1),v.strm.avail_out===0)?y:U}function re(v,$){for(var z,N,A;;){if(v.lookahead<K){if(ce(v),v.lookahead<K&&$===f)return y;if(v.lookahead===0)break}if(z=0,v.lookahead>=I&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,z=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=I-1,z!==0&&v.prev_length<v.max_lazy_match&&v.strstart-z<=v.w_size-K&&(v.match_length=J(v,z),v.match_length<=5&&(v.strategy===1||v.match_length===I&&4096<v.strstart-v.match_start)&&(v.match_length=I-1)),v.prev_length>=I&&v.match_length<=v.prev_length){for(A=v.strstart+v.lookahead-I,N=a._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-I),v.lookahead-=v.prev_length-1,v.prev_length-=2;++v.strstart<=A&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+I-1])&v.hash_mask,z=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),--v.prev_length!=0;);if(v.match_available=0,v.match_length=I-1,v.strstart++,N&&(T(v,!1),v.strm.avail_out===0))return y}else if(v.match_available){if((N=a._tr_tally(v,0,v.window[v.strstart-1]))&&T(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return y}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(N=a._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<I-1?v.strstart:I-1,$===x?(T(v,!0),v.strm.avail_out===0?V:H):v.last_lit&&(T(v,!1),v.strm.avail_out===0)?y:U}function se(v,$,z,N,A){this.good_length=v,this.max_lazy=$,this.nice_length=z,this.max_chain=N,this.func=A}function me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*j),this.dyn_dtree=new s.Buf16(2*(2*S+1)),this.bl_tree=new s.Buf16(2*(2*R+1)),Z(this.dyn_ltree),Z(this.dyn_dtree),Z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(M+1),this.heap=new s.Buf16(2*E+1),Z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*E+1),Z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function he(v){var $;return v&&v.state?(v.total_in=v.total_out=0,v.data_type=g,($=v.state).pending=0,$.pending_out=0,$.wrap<0&&($.wrap=-$.wrap),$.status=$.wrap?C:D,v.adler=$.wrap===2?0:1,$.last_flush=f,a._tr_init($),d):X(v,b)}function Oe(v){var $=he(v);return $===d&&(function(z){z.window_size=2*z.w_size,Z(z.head),z.max_lazy_match=i[z.level].max_lazy,z.good_match=i[z.level].good_length,z.nice_match=i[z.level].nice_length,z.max_chain_length=i[z.level].max_chain,z.strstart=0,z.block_start=0,z.lookahead=0,z.insert=0,z.match_length=z.prev_length=I-1,z.match_available=0,z.ins_h=0})(v.state),$}function ke(v,$,z,N,A,O){if(!v)return b;var W=1;if($===p&&($=6),N<0?(W=0,N=-N):15<N&&(W=2,N-=16),A<1||_<A||z!==w||N<8||15<N||$<0||9<$||O<0||m<O)return X(v,b);N===8&&(N=9);var G=new me;return(v.state=G).strm=v,G.wrap=W,G.gzhead=null,G.w_bits=N,G.w_size=1<<G.w_bits,G.w_mask=G.w_size-1,G.hash_bits=A+7,G.hash_size=1<<G.hash_bits,G.hash_mask=G.hash_size-1,G.hash_shift=~~((G.hash_bits+I-1)/I),G.window=new s.Buf8(2*G.w_size),G.head=new s.Buf16(G.hash_size),G.prev=new s.Buf16(G.w_size),G.lit_bufsize=1<<A+6,G.pending_buf_size=4*G.lit_bufsize,G.pending_buf=new s.Buf8(G.pending_buf_size),G.d_buf=1*G.lit_bufsize,G.l_buf=3*G.lit_bufsize,G.level=$,G.strategy=O,G.method=z,Oe(v)}i=[new se(0,0,0,0,function(v,$){var z=65535;for(z>v.pending_buf_size-5&&(z=v.pending_buf_size-5);;){if(v.lookahead<=1){if(ce(v),v.lookahead===0&&$===f)return y;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var N=v.block_start+z;if((v.strstart===0||v.strstart>=N)&&(v.lookahead=v.strstart-N,v.strstart=N,T(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-K&&(T(v,!1),v.strm.avail_out===0))return y}return v.insert=0,$===x?(T(v,!0),v.strm.avail_out===0?V:H):(v.strstart>v.block_start&&(T(v,!1),v.strm.avail_out),y)}),new se(4,4,8,4,q),new se(4,5,16,8,q),new se(4,6,32,32,q),new se(4,4,16,16,re),new se(8,16,32,32,re),new se(8,16,128,128,re),new se(8,32,128,256,re),new se(32,128,258,1024,re),new se(32,258,258,4096,re)],o.deflateInit=function(v,$){return ke(v,$,w,15,8,0)},o.deflateInit2=ke,o.deflateReset=Oe,o.deflateResetKeep=he,o.deflateSetHeader=function(v,$){return v&&v.state?v.state.wrap!==2?b:(v.state.gzhead=$,d):b},o.deflate=function(v,$){var z,N,A,O;if(!v||!v.state||5<$||$<0)return v?X(v,b):b;if(N=v.state,!v.output||!v.input&&v.avail_in!==0||N.status===666&&$!==x)return X(v,v.avail_out===0?-5:b);if(N.strm=v,z=N.last_flush,N.last_flush=$,N.status===C)if(N.wrap===2)v.adler=0,te(N,31),te(N,139),te(N,8),N.gzhead?(te(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),te(N,255&N.gzhead.time),te(N,N.gzhead.time>>8&255),te(N,N.gzhead.time>>16&255),te(N,N.gzhead.time>>24&255),te(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),te(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(te(N,255&N.gzhead.extra.length),te(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(v.adler=u(v.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(te(N,0),te(N,0),te(N,0),te(N,0),te(N,0),te(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),te(N,3),N.status=D);else{var W=w+(N.w_bits-8<<4)<<8;W|=(2<=N.strategy||N.level<2?0:N.level<6?1:N.level===6?2:3)<<6,N.strstart!==0&&(W|=32),W+=31-W%31,N.status=D,ee(N,W),N.strstart!==0&&(ee(N,v.adler>>>16),ee(N,65535&v.adler)),v.adler=1}if(N.status===69)if(N.gzhead.extra){for(A=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>A&&(v.adler=u(v.adler,N.pending_buf,N.pending-A,A)),P(v),A=N.pending,N.pending!==N.pending_buf_size));)te(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>A&&(v.adler=u(v.adler,N.pending_buf,N.pending-A,A)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(N.status===73)if(N.gzhead.name){A=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>A&&(v.adler=u(v.adler,N.pending_buf,N.pending-A,A)),P(v),A=N.pending,N.pending===N.pending_buf_size)){O=1;break}O=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,te(N,O)}while(O!==0);N.gzhead.hcrc&&N.pending>A&&(v.adler=u(v.adler,N.pending_buf,N.pending-A,A)),O===0&&(N.gzindex=0,N.status=91)}else N.status=91;if(N.status===91)if(N.gzhead.comment){A=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>A&&(v.adler=u(v.adler,N.pending_buf,N.pending-A,A)),P(v),A=N.pending,N.pending===N.pending_buf_size)){O=1;break}O=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,te(N,O)}while(O!==0);N.gzhead.hcrc&&N.pending>A&&(v.adler=u(v.adler,N.pending_buf,N.pending-A,A)),O===0&&(N.status=103)}else N.status=103;if(N.status===103&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&P(v),N.pending+2<=N.pending_buf_size&&(te(N,255&v.adler),te(N,v.adler>>8&255),v.adler=0,N.status=D)):N.status=D),N.pending!==0){if(P(v),v.avail_out===0)return N.last_flush=-1,d}else if(v.avail_in===0&&B($)<=B(z)&&$!==x)return X(v,-5);if(N.status===666&&v.avail_in!==0)return X(v,-5);if(v.avail_in!==0||N.lookahead!==0||$!==f&&N.status!==666){var G=N.strategy===2?(function(F,Y){for(var ne;;){if(F.lookahead===0&&(ce(F),F.lookahead===0)){if(Y===f)return y;break}if(F.match_length=0,ne=a._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++,ne&&(T(F,!1),F.strm.avail_out===0))return y}return F.insert=0,Y===x?(T(F,!0),F.strm.avail_out===0?V:H):F.last_lit&&(T(F,!1),F.strm.avail_out===0)?y:U})(N,$):N.strategy===3?(function(F,Y){for(var ne,Q,oe,fe,ue=F.window;;){if(F.lookahead<=L){if(ce(F),F.lookahead<=L&&Y===f)return y;if(F.lookahead===0)break}if(F.match_length=0,F.lookahead>=I&&0<F.strstart&&(Q=ue[oe=F.strstart-1])===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]){fe=F.strstart+L;do;while(Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&Q===ue[++oe]&&oe<fe);F.match_length=L-(fe-oe),F.match_length>F.lookahead&&(F.match_length=F.lookahead)}if(F.match_length>=I?(ne=a._tr_tally(F,1,F.match_length-I),F.lookahead-=F.match_length,F.strstart+=F.match_length,F.match_length=0):(ne=a._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++),ne&&(T(F,!1),F.strm.avail_out===0))return y}return F.insert=0,Y===x?(T(F,!0),F.strm.avail_out===0?V:H):F.last_lit&&(T(F,!1),F.strm.avail_out===0)?y:U})(N,$):i[N.level].func(N,$);if(G!==V&&G!==H||(N.status=666),G===y||G===V)return v.avail_out===0&&(N.last_flush=-1),d;if(G===U&&($===1?a._tr_align(N):$!==5&&(a._tr_stored_block(N,0,0,!1),$===3&&(Z(N.head),N.lookahead===0&&(N.strstart=0,N.block_start=0,N.insert=0))),P(v),v.avail_out===0))return N.last_flush=-1,d}return $!==x?d:N.wrap<=0?1:(N.wrap===2?(te(N,255&v.adler),te(N,v.adler>>8&255),te(N,v.adler>>16&255),te(N,v.adler>>24&255),te(N,255&v.total_in),te(N,v.total_in>>8&255),te(N,v.total_in>>16&255),te(N,v.total_in>>24&255)):(ee(N,v.adler>>>16),ee(N,65535&v.adler)),P(v),0<N.wrap&&(N.wrap=-N.wrap),N.pending!==0?d:1)},o.deflateEnd=function(v){var $;return v&&v.state?($=v.state.status)!==C&&$!==69&&$!==73&&$!==91&&$!==103&&$!==D&&$!==666?X(v,b):(v.state=null,$===D?X(v,-3):d):b},o.deflateSetDictionary=function(v,$){var z,N,A,O,W,G,F,Y,ne=$.length;if(!v||!v.state||(O=(z=v.state).wrap)===2||O===1&&z.status!==C||z.lookahead)return b;for(O===1&&(v.adler=l(v.adler,$,ne,0)),z.wrap=0,ne>=z.w_size&&(O===0&&(Z(z.head),z.strstart=0,z.block_start=0,z.insert=0),Y=new s.Buf8(z.w_size),s.arraySet(Y,$,ne-z.w_size,z.w_size,0),$=Y,ne=z.w_size),W=v.avail_in,G=v.next_in,F=v.input,v.avail_in=ne,v.next_in=0,v.input=$,ce(z);z.lookahead>=I;){for(N=z.strstart,A=z.lookahead-(I-1);z.ins_h=(z.ins_h<<z.hash_shift^z.window[N+I-1])&z.hash_mask,z.prev[N&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=N,N++,--A;);z.strstart=N,z.lookahead=I-1,ce(z)}return z.strstart+=z.lookahead,z.block_start=z.strstart,z.insert=z.lookahead,z.lookahead=0,z.match_length=z.prev_length=I-1,z.match_available=0,v.next_in=G,v.input=F,v.avail_in=W,z.wrap=O,d},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,r,o){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,r,o){r.exports=function(i,s){var a,l,u,h,f,x,d,b,p,m,g,w,_,E,S,R,j,M,I,L,K,C,D,y,U;a=i.state,l=i.next_in,y=i.input,u=l+(i.avail_in-5),h=i.next_out,U=i.output,f=h-(s-i.avail_out),x=h+(i.avail_out-257),d=a.dmax,b=a.wsize,p=a.whave,m=a.wnext,g=a.window,w=a.hold,_=a.bits,E=a.lencode,S=a.distcode,R=(1<<a.lenbits)-1,j=(1<<a.distbits)-1;e:do{_<15&&(w+=y[l++]<<_,_+=8,w+=y[l++]<<_,_+=8),M=E[w&R];t:for(;;){if(w>>>=I=M>>>24,_-=I,(I=M>>>16&255)===0)U[h++]=65535&M;else{if(!(16&I)){if((64&I)==0){M=E[(65535&M)+(w&(1<<I)-1)];continue t}if(32&I){a.mode=12;break e}i.msg="invalid literal/length code",a.mode=30;break e}L=65535&M,(I&=15)&&(_<I&&(w+=y[l++]<<_,_+=8),L+=w&(1<<I)-1,w>>>=I,_-=I),_<15&&(w+=y[l++]<<_,_+=8,w+=y[l++]<<_,_+=8),M=S[w&j];n:for(;;){if(w>>>=I=M>>>24,_-=I,!(16&(I=M>>>16&255))){if((64&I)==0){M=S[(65535&M)+(w&(1<<I)-1)];continue n}i.msg="invalid distance code",a.mode=30;break e}if(K=65535&M,_<(I&=15)&&(w+=y[l++]<<_,(_+=8)<I&&(w+=y[l++]<<_,_+=8)),d<(K+=w&(1<<I)-1)){i.msg="invalid distance too far back",a.mode=30;break e}if(w>>>=I,_-=I,(I=h-f)<K){if(p<(I=K-I)&&a.sane){i.msg="invalid distance too far back",a.mode=30;break e}if(D=g,(C=0)===m){if(C+=b-I,I<L){for(L-=I;U[h++]=g[C++],--I;);C=h-K,D=U}}else if(m<I){if(C+=b+m-I,(I-=m)<L){for(L-=I;U[h++]=g[C++],--I;);if(C=0,m<L){for(L-=I=m;U[h++]=g[C++],--I;);C=h-K,D=U}}}else if(C+=m-I,I<L){for(L-=I;U[h++]=g[C++],--I;);C=h-K,D=U}for(;2<L;)U[h++]=D[C++],U[h++]=D[C++],U[h++]=D[C++],L-=3;L&&(U[h++]=D[C++],1<L&&(U[h++]=D[C++]))}else{for(C=h-K;U[h++]=U[C++],U[h++]=U[C++],U[h++]=U[C++],2<(L-=3););L&&(U[h++]=U[C++],1<L&&(U[h++]=U[C++]))}break}}break}}while(l<u&&h<x);l-=L=_>>3,w&=(1<<(_-=L<<3))-1,i.next_in=l,i.next_out=h,i.avail_in=l<u?u-l+5:5-(l-u),i.avail_out=h<x?x-h+257:257-(h-x),a.hold=w,a.bits=_}},{}],49:[function(t,r,o){var i=t("../utils/common"),s=t("./adler32"),a=t("./crc32"),l=t("./inffast"),u=t("./inftrees"),h=1,f=2,x=0,d=-2,b=1,p=852,m=592;function g(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _(C){var D;return C&&C.state?(D=C.state,C.total_in=C.total_out=D.total=0,C.msg="",D.wrap&&(C.adler=1&D.wrap),D.mode=b,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new i.Buf32(p),D.distcode=D.distdyn=new i.Buf32(m),D.sane=1,D.back=-1,x):d}function E(C){var D;return C&&C.state?((D=C.state).wsize=0,D.whave=0,D.wnext=0,_(C)):d}function S(C,D){var y,U;return C&&C.state?(U=C.state,D<0?(y=0,D=-D):(y=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?d:(U.window!==null&&U.wbits!==D&&(U.window=null),U.wrap=y,U.wbits=D,E(C))):d}function R(C,D){var y,U;return C?(U=new w,(C.state=U).window=null,(y=S(C,D))!==x&&(C.state=null),y):d}var j,M,I=!0;function L(C){if(I){var D;for(j=new i.Buf32(512),M=new i.Buf32(32),D=0;D<144;)C.lens[D++]=8;for(;D<256;)C.lens[D++]=9;for(;D<280;)C.lens[D++]=7;for(;D<288;)C.lens[D++]=8;for(u(h,C.lens,0,288,j,0,C.work,{bits:9}),D=0;D<32;)C.lens[D++]=5;u(f,C.lens,0,32,M,0,C.work,{bits:5}),I=!1}C.lencode=j,C.lenbits=9,C.distcode=M,C.distbits=5}function K(C,D,y,U){var V,H=C.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new i.Buf8(H.wsize)),U>=H.wsize?(i.arraySet(H.window,D,y-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):(U<(V=H.wsize-H.wnext)&&(V=U),i.arraySet(H.window,D,y-U,V,H.wnext),(U-=V)?(i.arraySet(H.window,D,y-U,U,0),H.wnext=U,H.whave=H.wsize):(H.wnext+=V,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=V))),0}o.inflateReset=E,o.inflateReset2=S,o.inflateResetKeep=_,o.inflateInit=function(C){return R(C,15)},o.inflateInit2=R,o.inflate=function(C,D){var y,U,V,H,X,B,Z,P,T,te,ee,J,ce,q,re,se,me,he,Oe,ke,v,$,z,N,A=0,O=new i.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return d;(y=C.state).mode===12&&(y.mode=13),X=C.next_out,V=C.output,Z=C.avail_out,H=C.next_in,U=C.input,B=C.avail_in,P=y.hold,T=y.bits,te=B,ee=Z,$=x;e:for(;;)switch(y.mode){case b:if(y.wrap===0){y.mode=13;break}for(;T<16;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(2&y.wrap&&P===35615){O[y.check=0]=255&P,O[1]=P>>>8&255,y.check=a(y.check,O,2,0),T=P=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&P)<<8)+(P>>8))%31){C.msg="incorrect header check",y.mode=30;break}if((15&P)!=8){C.msg="unknown compression method",y.mode=30;break}if(T-=4,v=8+(15&(P>>>=4)),y.wbits===0)y.wbits=v;else if(v>y.wbits){C.msg="invalid window size",y.mode=30;break}y.dmax=1<<v,C.adler=y.check=1,y.mode=512&P?10:12,T=P=0;break;case 2:for(;T<16;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(y.flags=P,(255&y.flags)!=8){C.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){C.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=P>>8&1),512&y.flags&&(O[0]=255&P,O[1]=P>>>8&255,y.check=a(y.check,O,2,0)),T=P=0,y.mode=3;case 3:for(;T<32;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.head&&(y.head.time=P),512&y.flags&&(O[0]=255&P,O[1]=P>>>8&255,O[2]=P>>>16&255,O[3]=P>>>24&255,y.check=a(y.check,O,4,0)),T=P=0,y.mode=4;case 4:for(;T<16;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.head&&(y.head.xflags=255&P,y.head.os=P>>8),512&y.flags&&(O[0]=255&P,O[1]=P>>>8&255,y.check=a(y.check,O,2,0)),T=P=0,y.mode=5;case 5:if(1024&y.flags){for(;T<16;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.length=P,y.head&&(y.head.extra_len=P),512&y.flags&&(O[0]=255&P,O[1]=P>>>8&255,y.check=a(y.check,O,2,0)),T=P=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(B<(J=y.length)&&(J=B),J&&(y.head&&(v=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),i.arraySet(y.head.extra,U,H,J,v)),512&y.flags&&(y.check=a(y.check,U,J,H)),B-=J,H+=J,y.length-=J),y.length))break e;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(B===0)break e;for(J=0;v=U[H+J++],y.head&&v&&y.length<65536&&(y.head.name+=String.fromCharCode(v)),v&&J<B;);if(512&y.flags&&(y.check=a(y.check,U,J,H)),B-=J,H+=J,v)break e}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(B===0)break e;for(J=0;v=U[H+J++],y.head&&v&&y.length<65536&&(y.head.comment+=String.fromCharCode(v)),v&&J<B;);if(512&y.flags&&(y.check=a(y.check,U,J,H)),B-=J,H+=J,v)break e}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;T<16;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(P!==(65535&y.check)){C.msg="header crc mismatch",y.mode=30;break}T=P=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),C.adler=y.check=0,y.mode=12;break;case 10:for(;T<32;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}C.adler=y.check=g(P),T=P=0,y.mode=11;case 11:if(y.havedict===0)return C.next_out=X,C.avail_out=Z,C.next_in=H,C.avail_in=B,y.hold=P,y.bits=T,2;C.adler=y.check=1,y.mode=12;case 12:if(D===5||D===6)break e;case 13:if(y.last){P>>>=7&T,T-=7&T,y.mode=27;break}for(;T<3;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}switch(y.last=1&P,T-=1,3&(P>>>=1)){case 0:y.mode=14;break;case 1:if(L(y),y.mode=20,D!==6)break;P>>>=2,T-=2;break e;case 2:y.mode=17;break;case 3:C.msg="invalid block type",y.mode=30}P>>>=2,T-=2;break;case 14:for(P>>>=7&T,T-=7&T;T<32;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if((65535&P)!=(P>>>16^65535)){C.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&P,T=P=0,y.mode=15,D===6)break e;case 15:y.mode=16;case 16:if(J=y.length){if(B<J&&(J=B),Z<J&&(J=Z),J===0)break e;i.arraySet(V,U,H,J,X),B-=J,H+=J,Z-=J,X+=J,y.length-=J;break}y.mode=12;break;case 17:for(;T<14;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(y.nlen=257+(31&P),P>>>=5,T-=5,y.ndist=1+(31&P),P>>>=5,T-=5,y.ncode=4+(15&P),P>>>=4,T-=4,286<y.nlen||30<y.ndist){C.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;T<3;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.lens[W[y.have++]]=7&P,P>>>=3,T-=3}for(;y.have<19;)y.lens[W[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,z={bits:y.lenbits},$=u(0,y.lens,0,19,y.lencode,0,y.work,z),y.lenbits=z.bits,$){C.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;se=(A=y.lencode[P&(1<<y.lenbits)-1])>>>16&255,me=65535&A,!((re=A>>>24)<=T);){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(me<16)P>>>=re,T-=re,y.lens[y.have++]=me;else{if(me===16){for(N=re+2;T<N;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(P>>>=re,T-=re,y.have===0){C.msg="invalid bit length repeat",y.mode=30;break}v=y.lens[y.have-1],J=3+(3&P),P>>>=2,T-=2}else if(me===17){for(N=re+3;T<N;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}T-=re,v=0,J=3+(7&(P>>>=re)),P>>>=3,T-=3}else{for(N=re+7;T<N;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}T-=re,v=0,J=11+(127&(P>>>=re)),P>>>=7,T-=7}if(y.have+J>y.nlen+y.ndist){C.msg="invalid bit length repeat",y.mode=30;break}for(;J--;)y.lens[y.have++]=v}}if(y.mode===30)break;if(y.lens[256]===0){C.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,z={bits:y.lenbits},$=u(h,y.lens,0,y.nlen,y.lencode,0,y.work,z),y.lenbits=z.bits,$){C.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,z={bits:y.distbits},$=u(f,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,z),y.distbits=z.bits,$){C.msg="invalid distances set",y.mode=30;break}if(y.mode=20,D===6)break e;case 20:y.mode=21;case 21:if(6<=B&&258<=Z){C.next_out=X,C.avail_out=Z,C.next_in=H,C.avail_in=B,y.hold=P,y.bits=T,l(C,ee),X=C.next_out,V=C.output,Z=C.avail_out,H=C.next_in,U=C.input,B=C.avail_in,P=y.hold,T=y.bits,y.mode===12&&(y.back=-1);break}for(y.back=0;se=(A=y.lencode[P&(1<<y.lenbits)-1])>>>16&255,me=65535&A,!((re=A>>>24)<=T);){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(se&&(240&se)==0){for(he=re,Oe=se,ke=me;se=(A=y.lencode[ke+((P&(1<<he+Oe)-1)>>he)])>>>16&255,me=65535&A,!(he+(re=A>>>24)<=T);){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}P>>>=he,T-=he,y.back+=he}if(P>>>=re,T-=re,y.back+=re,y.length=me,se===0){y.mode=26;break}if(32&se){y.back=-1,y.mode=12;break}if(64&se){C.msg="invalid literal/length code",y.mode=30;break}y.extra=15&se,y.mode=22;case 22:if(y.extra){for(N=y.extra;T<N;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.length+=P&(1<<y.extra)-1,P>>>=y.extra,T-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;se=(A=y.distcode[P&(1<<y.distbits)-1])>>>16&255,me=65535&A,!((re=A>>>24)<=T);){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if((240&se)==0){for(he=re,Oe=se,ke=me;se=(A=y.distcode[ke+((P&(1<<he+Oe)-1)>>he)])>>>16&255,me=65535&A,!(he+(re=A>>>24)<=T);){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}P>>>=he,T-=he,y.back+=he}if(P>>>=re,T-=re,y.back+=re,64&se){C.msg="invalid distance code",y.mode=30;break}y.offset=me,y.extra=15&se,y.mode=24;case 24:if(y.extra){for(N=y.extra;T<N;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}y.offset+=P&(1<<y.extra)-1,P>>>=y.extra,T-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){C.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(Z===0)break e;if(J=ee-Z,y.offset>J){if((J=y.offset-J)>y.whave&&y.sane){C.msg="invalid distance too far back",y.mode=30;break}ce=J>y.wnext?(J-=y.wnext,y.wsize-J):y.wnext-J,J>y.length&&(J=y.length),q=y.window}else q=V,ce=X-y.offset,J=y.length;for(Z<J&&(J=Z),Z-=J,y.length-=J;V[X++]=q[ce++],--J;);y.length===0&&(y.mode=21);break;case 26:if(Z===0)break e;V[X++]=y.length,Z--,y.mode=21;break;case 27:if(y.wrap){for(;T<32;){if(B===0)break e;B--,P|=U[H++]<<T,T+=8}if(ee-=Z,C.total_out+=ee,y.total+=ee,ee&&(C.adler=y.check=y.flags?a(y.check,V,ee,X-ee):s(y.check,V,ee,X-ee)),ee=Z,(y.flags?P:g(P))!==y.check){C.msg="incorrect data check",y.mode=30;break}T=P=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;T<32;){if(B===0)break e;B--,P+=U[H++]<<T,T+=8}if(P!==(4294967295&y.total)){C.msg="incorrect length check",y.mode=30;break}T=P=0}y.mode=29;case 29:$=1;break e;case 30:$=-3;break e;case 31:return-4;default:return d}return C.next_out=X,C.avail_out=Z,C.next_in=H,C.avail_in=B,y.hold=P,y.bits=T,(y.wsize||ee!==C.avail_out&&y.mode<30&&(y.mode<27||D!==4))&&K(C,C.output,C.next_out,ee-C.avail_out)?(y.mode=31,-4):(te-=C.avail_in,ee-=C.avail_out,C.total_in+=te,C.total_out+=ee,y.total+=ee,y.wrap&&ee&&(C.adler=y.check=y.flags?a(y.check,V,ee,C.next_out-ee):s(y.check,V,ee,C.next_out-ee)),C.data_type=y.bits+(y.last?64:0)+(y.mode===12?128:0)+(y.mode===20||y.mode===15?256:0),(te==0&&ee===0||D===4)&&$===x&&($=-5),$)},o.inflateEnd=function(C){if(!C||!C.state)return d;var D=C.state;return D.window&&(D.window=null),C.state=null,x},o.inflateGetHeader=function(C,D){var y;return C&&C.state?(2&(y=C.state).wrap)==0?d:((y.head=D).done=!1,x):d},o.inflateSetDictionary=function(C,D){var y,U=D.length;return C&&C.state?(y=C.state).wrap!==0&&y.mode!==11?d:y.mode===11&&s(1,D,U,0)!==y.check?-3:K(C,D,U,U)?(y.mode=31,-4):(y.havedict=1,x):d},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,r,o){var i=t("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(h,f,x,d,b,p,m,g){var w,_,E,S,R,j,M,I,L,K=g.bits,C=0,D=0,y=0,U=0,V=0,H=0,X=0,B=0,Z=0,P=0,T=null,te=0,ee=new i.Buf16(16),J=new i.Buf16(16),ce=null,q=0;for(C=0;C<=15;C++)ee[C]=0;for(D=0;D<d;D++)ee[f[x+D]]++;for(V=K,U=15;1<=U&&ee[U]===0;U--);if(U<V&&(V=U),U===0)return b[p++]=20971520,b[p++]=20971520,g.bits=1,0;for(y=1;y<U&&ee[y]===0;y++);for(V<y&&(V=y),C=B=1;C<=15;C++)if(B<<=1,(B-=ee[C])<0)return-1;if(0<B&&(h===0||U!==1))return-1;for(J[1]=0,C=1;C<15;C++)J[C+1]=J[C]+ee[C];for(D=0;D<d;D++)f[x+D]!==0&&(m[J[f[x+D]]++]=D);if(j=h===0?(T=ce=m,19):h===1?(T=s,te-=257,ce=a,q-=257,256):(T=l,ce=u,-1),C=y,R=p,X=D=P=0,E=-1,S=(Z=1<<(H=V))-1,h===1&&852<Z||h===2&&592<Z)return 1;for(;;){for(M=C-X,L=m[D]<j?(I=0,m[D]):m[D]>j?(I=ce[q+m[D]],T[te+m[D]]):(I=96,0),w=1<<C-X,y=_=1<<H;b[R+(P>>X)+(_-=w)]=M<<24|I<<16|L|0,_!==0;);for(w=1<<C-1;P&w;)w>>=1;if(w!==0?(P&=w-1,P+=w):P=0,D++,--ee[C]==0){if(C===U)break;C=f[x+m[D]]}if(V<C&&(P&S)!==E){for(X===0&&(X=V),R+=y,B=1<<(H=C-X);H+X<U&&!((B-=ee[H+X])<=0);)H++,B<<=1;if(Z+=1<<H,h===1&&852<Z||h===2&&592<Z)return 1;b[E=P&S]=V<<24|H<<16|R-p|0}}return P!==0&&(b[R+P]=C-X<<24|64<<16|0),g.bits=V,0}},{"../utils/common":41}],51:[function(t,r,o){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,r,o){var i=t("../utils/common"),s=0,a=1;function l(A){for(var O=A.length;0<=--O;)A[O]=0}var u=0,h=29,f=256,x=f+1+h,d=30,b=19,p=2*x+1,m=15,g=16,w=7,_=256,E=16,S=17,R=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=new Array(2*(x+2));l(K);var C=new Array(2*d);l(C);var D=new Array(512);l(D);var y=new Array(256);l(y);var U=new Array(h);l(U);var V,H,X,B=new Array(d);function Z(A,O,W,G,F){this.static_tree=A,this.extra_bits=O,this.extra_base=W,this.elems=G,this.max_length=F,this.has_stree=A&&A.length}function P(A,O){this.dyn_tree=A,this.max_code=0,this.stat_desc=O}function T(A){return A<256?D[A]:D[256+(A>>>7)]}function te(A,O){A.pending_buf[A.pending++]=255&O,A.pending_buf[A.pending++]=O>>>8&255}function ee(A,O,W){A.bi_valid>g-W?(A.bi_buf|=O<<A.bi_valid&65535,te(A,A.bi_buf),A.bi_buf=O>>g-A.bi_valid,A.bi_valid+=W-g):(A.bi_buf|=O<<A.bi_valid&65535,A.bi_valid+=W)}function J(A,O,W){ee(A,W[2*O],W[2*O+1])}function ce(A,O){for(var W=0;W|=1&A,A>>>=1,W<<=1,0<--O;);return W>>>1}function q(A,O,W){var G,F,Y=new Array(m+1),ne=0;for(G=1;G<=m;G++)Y[G]=ne=ne+W[G-1]<<1;for(F=0;F<=O;F++){var Q=A[2*F+1];Q!==0&&(A[2*F]=ce(Y[Q]++,Q))}}function re(A){var O;for(O=0;O<x;O++)A.dyn_ltree[2*O]=0;for(O=0;O<d;O++)A.dyn_dtree[2*O]=0;for(O=0;O<b;O++)A.bl_tree[2*O]=0;A.dyn_ltree[2*_]=1,A.opt_len=A.static_len=0,A.last_lit=A.matches=0}function se(A){8<A.bi_valid?te(A,A.bi_buf):0<A.bi_valid&&(A.pending_buf[A.pending++]=A.bi_buf),A.bi_buf=0,A.bi_valid=0}function me(A,O,W,G){var F=2*O,Y=2*W;return A[F]<A[Y]||A[F]===A[Y]&&G[O]<=G[W]}function he(A,O,W){for(var G=A.heap[W],F=W<<1;F<=A.heap_len&&(F<A.heap_len&&me(O,A.heap[F+1],A.heap[F],A.depth)&&F++,!me(O,G,A.heap[F],A.depth));)A.heap[W]=A.heap[F],W=F,F<<=1;A.heap[W]=G}function Oe(A,O,W){var G,F,Y,ne,Q=0;if(A.last_lit!==0)for(;G=A.pending_buf[A.d_buf+2*Q]<<8|A.pending_buf[A.d_buf+2*Q+1],F=A.pending_buf[A.l_buf+Q],Q++,G===0?J(A,F,O):(J(A,(Y=y[F])+f+1,O),(ne=j[Y])!==0&&ee(A,F-=U[Y],ne),J(A,Y=T(--G),W),(ne=M[Y])!==0&&ee(A,G-=B[Y],ne)),Q<A.last_lit;);J(A,_,O)}function ke(A,O){var W,G,F,Y=O.dyn_tree,ne=O.stat_desc.static_tree,Q=O.stat_desc.has_stree,oe=O.stat_desc.elems,fe=-1;for(A.heap_len=0,A.heap_max=p,W=0;W<oe;W++)Y[2*W]!==0?(A.heap[++A.heap_len]=fe=W,A.depth[W]=0):Y[2*W+1]=0;for(;A.heap_len<2;)Y[2*(F=A.heap[++A.heap_len]=fe<2?++fe:0)]=1,A.depth[F]=0,A.opt_len--,Q&&(A.static_len-=ne[2*F+1]);for(O.max_code=fe,W=A.heap_len>>1;1<=W;W--)he(A,Y,W);for(F=oe;W=A.heap[1],A.heap[1]=A.heap[A.heap_len--],he(A,Y,1),G=A.heap[1],A.heap[--A.heap_max]=W,A.heap[--A.heap_max]=G,Y[2*F]=Y[2*W]+Y[2*G],A.depth[F]=(A.depth[W]>=A.depth[G]?A.depth[W]:A.depth[G])+1,Y[2*W+1]=Y[2*G+1]=F,A.heap[1]=F++,he(A,Y,1),2<=A.heap_len;);A.heap[--A.heap_max]=A.heap[1],(function(ue,Me){var It,ze,Pt,xe,tn,Wn,Ye=Me.dyn_tree,ro=Me.max_code,fl=Me.stat_desc.static_tree,pl=Me.stat_desc.has_stree,hl=Me.stat_desc.extra_bits,oo=Me.stat_desc.extra_base,Mt=Me.stat_desc.max_length,nn=0;for(xe=0;xe<=m;xe++)ue.bl_count[xe]=0;for(Ye[2*ue.heap[ue.heap_max]+1]=0,It=ue.heap_max+1;It<p;It++)Mt<(xe=Ye[2*Ye[2*(ze=ue.heap[It])+1]+1]+1)&&(xe=Mt,nn++),Ye[2*ze+1]=xe,ro<ze||(ue.bl_count[xe]++,tn=0,oo<=ze&&(tn=hl[ze-oo]),Wn=Ye[2*ze],ue.opt_len+=Wn*(xe+tn),pl&&(ue.static_len+=Wn*(fl[2*ze+1]+tn)));if(nn!==0){do{for(xe=Mt-1;ue.bl_count[xe]===0;)xe--;ue.bl_count[xe]--,ue.bl_count[xe+1]+=2,ue.bl_count[Mt]--,nn-=2}while(0<nn);for(xe=Mt;xe!==0;xe--)for(ze=ue.bl_count[xe];ze!==0;)ro<(Pt=ue.heap[--It])||(Ye[2*Pt+1]!==xe&&(ue.opt_len+=(xe-Ye[2*Pt+1])*Ye[2*Pt],Ye[2*Pt+1]=xe),ze--)}})(A,O),q(Y,fe,A.bl_count)}function v(A,O,W){var G,F,Y=-1,ne=O[1],Q=0,oe=7,fe=4;for(ne===0&&(oe=138,fe=3),O[2*(W+1)+1]=65535,G=0;G<=W;G++)F=ne,ne=O[2*(G+1)+1],++Q<oe&&F===ne||(Q<fe?A.bl_tree[2*F]+=Q:F!==0?(F!==Y&&A.bl_tree[2*F]++,A.bl_tree[2*E]++):Q<=10?A.bl_tree[2*S]++:A.bl_tree[2*R]++,Y=F,fe=(Q=0)===ne?(oe=138,3):F===ne?(oe=6,3):(oe=7,4))}function $(A,O,W){var G,F,Y=-1,ne=O[1],Q=0,oe=7,fe=4;for(ne===0&&(oe=138,fe=3),G=0;G<=W;G++)if(F=ne,ne=O[2*(G+1)+1],!(++Q<oe&&F===ne)){if(Q<fe)for(;J(A,F,A.bl_tree),--Q!=0;);else F!==0?(F!==Y&&(J(A,F,A.bl_tree),Q--),J(A,E,A.bl_tree),ee(A,Q-3,2)):Q<=10?(J(A,S,A.bl_tree),ee(A,Q-3,3)):(J(A,R,A.bl_tree),ee(A,Q-11,7));Y=F,fe=(Q=0)===ne?(oe=138,3):F===ne?(oe=6,3):(oe=7,4)}}l(B);var z=!1;function N(A,O,W,G){ee(A,(u<<1)+(G?1:0),3),(function(F,Y,ne,Q){se(F),te(F,ne),te(F,~ne),i.arraySet(F.pending_buf,F.window,Y,ne,F.pending),F.pending+=ne})(A,O,W)}o._tr_init=function(A){z||((function(){var O,W,G,F,Y,ne=new Array(m+1);for(F=G=0;F<h-1;F++)for(U[F]=G,O=0;O<1<<j[F];O++)y[G++]=F;for(y[G-1]=F,F=Y=0;F<16;F++)for(B[F]=Y,O=0;O<1<<M[F];O++)D[Y++]=F;for(Y>>=7;F<d;F++)for(B[F]=Y<<7,O=0;O<1<<M[F]-7;O++)D[256+Y++]=F;for(W=0;W<=m;W++)ne[W]=0;for(O=0;O<=143;)K[2*O+1]=8,O++,ne[8]++;for(;O<=255;)K[2*O+1]=9,O++,ne[9]++;for(;O<=279;)K[2*O+1]=7,O++,ne[7]++;for(;O<=287;)K[2*O+1]=8,O++,ne[8]++;for(q(K,x+1,ne),O=0;O<d;O++)C[2*O+1]=5,C[2*O]=ce(O,5);V=new Z(K,j,f+1,x,m),H=new Z(C,M,0,d,m),X=new Z(new Array(0),I,0,b,w)})(),z=!0),A.l_desc=new P(A.dyn_ltree,V),A.d_desc=new P(A.dyn_dtree,H),A.bl_desc=new P(A.bl_tree,X),A.bi_buf=0,A.bi_valid=0,re(A)},o._tr_stored_block=N,o._tr_flush_block=function(A,O,W,G){var F,Y,ne=0;0<A.level?(A.strm.data_type===2&&(A.strm.data_type=(function(Q){var oe,fe=4093624447;for(oe=0;oe<=31;oe++,fe>>>=1)if(1&fe&&Q.dyn_ltree[2*oe]!==0)return s;if(Q.dyn_ltree[18]!==0||Q.dyn_ltree[20]!==0||Q.dyn_ltree[26]!==0)return a;for(oe=32;oe<f;oe++)if(Q.dyn_ltree[2*oe]!==0)return a;return s})(A)),ke(A,A.l_desc),ke(A,A.d_desc),ne=(function(Q){var oe;for(v(Q,Q.dyn_ltree,Q.l_desc.max_code),v(Q,Q.dyn_dtree,Q.d_desc.max_code),ke(Q,Q.bl_desc),oe=b-1;3<=oe&&Q.bl_tree[2*L[oe]+1]===0;oe--);return Q.opt_len+=3*(oe+1)+5+5+4,oe})(A),F=A.opt_len+3+7>>>3,(Y=A.static_len+3+7>>>3)<=F&&(F=Y)):F=Y=W+5,W+4<=F&&O!==-1?N(A,O,W,G):A.strategy===4||Y===F?(ee(A,2+(G?1:0),3),Oe(A,K,C)):(ee(A,4+(G?1:0),3),(function(Q,oe,fe,ue){var Me;for(ee(Q,oe-257,5),ee(Q,fe-1,5),ee(Q,ue-4,4),Me=0;Me<ue;Me++)ee(Q,Q.bl_tree[2*L[Me]+1],3);$(Q,Q.dyn_ltree,oe-1),$(Q,Q.dyn_dtree,fe-1)})(A,A.l_desc.max_code+1,A.d_desc.max_code+1,ne+1),Oe(A,A.dyn_ltree,A.dyn_dtree)),re(A),G&&se(A)},o._tr_tally=function(A,O,W){return A.pending_buf[A.d_buf+2*A.last_lit]=O>>>8&255,A.pending_buf[A.d_buf+2*A.last_lit+1]=255&O,A.pending_buf[A.l_buf+A.last_lit]=255&W,A.last_lit++,O===0?A.dyn_ltree[2*W]++:(A.matches++,O--,A.dyn_ltree[2*(y[W]+f+1)]++,A.dyn_dtree[2*T(O)]++),A.last_lit===A.lit_bufsize-1},o._tr_align=function(A){ee(A,2,3),J(A,_,K),(function(O){O.bi_valid===16?(te(O,O.bi_buf),O.bi_buf=0,O.bi_valid=0):8<=O.bi_valid&&(O.pending_buf[O.pending++]=255&O.bi_buf,O.bi_buf>>=8,O.bi_valid-=8)})(A)}},{"../utils/common":41}],53:[function(t,r,o){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,r,o){(function(i){(function(s,a){if(!s.setImmediate){var l,u,h,f,x=1,d={},b=!1,p=s.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(s);m=m&&m.setTimeout?m:s,l={}.toString.call(s.process)==="[object process]"?function(E){process.nextTick(function(){w(E)})}:(function(){if(s.postMessage&&!s.importScripts){var E=!0,S=s.onmessage;return s.onmessage=function(){E=!1},s.postMessage("","*"),s.onmessage=S,E}})()?(f="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",_,!1):s.attachEvent("onmessage",_),function(E){s.postMessage(f+E,"*")}):s.MessageChannel?((h=new MessageChannel).port1.onmessage=function(E){w(E.data)},function(E){h.port2.postMessage(E)}):p&&"onreadystatechange"in p.createElement("script")?(u=p.documentElement,function(E){var S=p.createElement("script");S.onreadystatechange=function(){w(E),S.onreadystatechange=null,u.removeChild(S),S=null},u.appendChild(S)}):function(E){setTimeout(w,0,E)},m.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var S=new Array(arguments.length-1),R=0;R<S.length;R++)S[R]=arguments[R+1];var j={callback:E,args:S};return d[x]=j,l(x),x++},m.clearImmediate=g}function g(E){delete d[E]}function w(E){if(b)setTimeout(w,0,E);else{var S=d[E];if(S){b=!0;try{(function(R){var j=R.callback,M=R.args;switch(M.length){case 0:j();break;case 1:j(M[0]);break;case 2:j(M[0],M[1]);break;case 3:j(M[0],M[1],M[2]);break;default:j.apply(a,M)}})(S)}finally{g(E),b=!1}}}}function _(E){E.source===s&&typeof E.data=="string"&&E.data.indexOf(f)===0&&w(+E.data.slice(f.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof nt<"u"?nt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(sr)),sr.exports}var Tg=Og();const kr=wl(Tg);function ll({sessionId:e,onSuccess:n,onError:t}){const[r,o]=k.useState(!1),[i,s]=k.useState(null),a=_e(ae.skills.importSkill),l=_e(ae.skills.importSkillWithReferences),u=_e(ae.contextMapImport.importAsProject),h=k.useCallback(async(m,g,w,_,E)=>{o(!0);try{const S=va(m,_);await a({sessionId:e,content:S.content,metadata:{skillName:S.metadata.skillName,skillDescription:S.metadata.skillDescription,sourceType:g,sourceRef:w},zone:E}),n?.(S.metadata.skillName,0)}catch(S){const R=S instanceof Bt||S instanceof Error?S.message:"Import failed";t?.(R)}finally{o(!1)}},[e,a,n,t]),f=k.useCallback(async m=>{o(!0);try{const g=await kr.loadAsync(m),w=new Map,_=Object.keys(g.files).filter(R=>!g.files[R].dir),E=Ig(_);for(const[R,j]of Object.entries(g.files)){if(j.dir)continue;const M=E?R.slice(E.length):R;if(!M)continue;const I=await j.async("string");w.set(M,I)}const S=Rg(w,m.name.replace(/\.zip$/i,""));if(S.contextMap&&S.contextMap.contexts.length>1){s({skillName:S.skill.metadata.skillName,skillDescription:S.skill.metadata.skillDescription,skillContent:S.skill.content,contextMap:S.contextMap,files:Array.from(w.entries()).map(([R,j])=>({path:R,content:j})),sourceType:"upload",sourceRef:m.name}),o(!1);return}S.references.length>0?await l({sessionId:e,skill:{content:S.skill.content,metadata:{skillName:S.skill.metadata.skillName,skillDescription:S.skill.metadata.skillDescription,sourceType:"upload",sourceRef:m.name}},references:S.references.map(R=>({content:R.content,filename:R.filename,zone:R.zone,relativePath:R.relativePath}))}):await a({sessionId:e,content:S.skill.content,metadata:{skillName:S.skill.metadata.skillName,skillDescription:S.skill.metadata.skillDescription,sourceType:"upload",sourceRef:m.name}}),n?.(S.skill.metadata.skillName,S.references.length)}catch(g){const w=g instanceof Bt||g instanceof Error?g.message:"ZIP import failed";t?.(w)}finally{o(!1)}},[e,a,l,n,t]),x=k.useCallback(async(m,g)=>{if(m.name.toLowerCase().endsWith(".zip")){await f(m);return}const w=await m.text();await h(w,"upload",m.name,m.name.replace(/\.md$/,""),g)},[h,f]),d=k.useCallback(async m=>{o(!0);try{const g=Pg(m),w=await fetch(g);if(!w.ok)throw new Error(`Failed to fetch: ${w.status} ${w.statusText}`);const _=await w.text();o(!1),await h(_,"url",m)}catch(g){const w=g instanceof Error?g.message:"URL import failed";t?.(w),o(!1)}},[h,t]),b=k.useCallback(async()=>{if(i){o(!0);try{await u({sessionId:e,skillName:i.skillName,skillDescription:i.skillDescription,skillContent:i.skillContent,contexts:i.contextMap.contexts.map(g=>({key:g.key,label:g.label,permanent:g.permanent,stable:g.stable,working:g.working})),files:i.files,sourceType:i.sourceType,sourceRef:i.sourceRef});const m=i.contextMap.contexts.length;s(null),n?.(i.skillName,m)}catch(m){const g=m instanceof Error?m.message:"Project import failed";t?.(g)}finally{o(!1)}}},[i,e,u,n,t]),p=k.useCallback(()=>{s(null)},[]);return{importFromFile:x,importFromUrl:d,importFromContent:h,isImporting:r,pendingProjectImport:i,confirmProjectImport:b,cancelProjectImport:p}}function Ig(e){if(e.length===0)return"";const n=e[0],t=n.indexOf("/");if(t===-1)return"";const r=n.slice(0,t+1);return e.every(o=>o.startsWith(r))?r:""}function Pg(e){try{const n=new URL(e);if(n.hostname==="github.com"){const t=n.pathname.split("/"),r=t.indexOf("blob");if(r!==-1)return t.splice(r,1),`https://raw.githubusercontent.com${t.join("/")}`;const o=t.indexOf("tree");if(o!==-1)return t.splice(o,1),`https://raw.githubusercontent.com${t.join("/")}/SKILL.md`}return e}catch{return e}}function cl({pending:e,onConfirm:n,onCancel:t,isImporting:r}){const o=e.contextMap.contexts;return c.jsx(Fe.div,{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",initial:be.initial,animate:be.animate,exit:be.exit,transition:be.transition,children:c.jsxs(Fe.div,{className:"bg-card border border-border rounded-lg shadow-lg w-full max-w-lg max-h-[80vh] flex flex-col",initial:ye.initial,animate:ye.animate,exit:ye.exit,transition:ye.transition,onClick:i=>i.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Hl,{className:"w-5 h-5 text-amber-600"}),c.jsx("h2",{className:"text-lg font-semibold",children:"Import as Project"})]}),c.jsx(de,{variant:"ghost",size:"sm",onClick:t,disabled:r,children:c.jsx(jn,{className:"w-4 h-4"})})]}),c.jsxs("div",{className:"p-4 space-y-3 overflow-y-auto flex-1",children:[c.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.jsx("strong",{children:e.skillName})," defines a"," ",o.length,"-step workflow:"]}),c.jsx("div",{className:"space-y-2",children:o.map((i,s)=>{const a=i.permanent.length+i.stable.length+i.working.length;return c.jsxs("div",{className:"border border-border rounded p-2.5",children:[c.jsxs("div",{className:"text-sm font-medium",children:[s+1,". ",i.label]}),c.jsxs("div",{className:"text-xs text-muted-foreground mt-0.5",children:[a," reference",a!==1?"s":"",i.permanent.length>0&&` (${i.permanent.length} permanent)`,i.stable.length>0&&` (${i.stable.length} stable)`,i.working.length>0&&` (${i.working.length} working)`]})]},i.key)})})]}),c.jsxs("div",{className:"p-3 bg-muted/30 border-t border-border text-sm text-muted-foreground shrink-0",children:["Your current session becomes step 1:"," ",c.jsx("strong",{children:o[0]?.label}),"."," ",o.length>1&&`${o.length-1} more step${o.length>2?"s":""} will be created as a project workflow.`]}),c.jsxs("div",{className:"p-4 flex justify-end gap-2 border-t border-border shrink-0",children:[c.jsx(de,{variant:"outline",onClick:t,disabled:r,children:"Cancel"}),c.jsx(de,{onClick:n,disabled:r,children:r?"Importing...":"Import as Project"})]})]})})}function Mg({isOpen:e,onClose:n,sessionId:t}){const[r,o]=k.useState(""),[i,s]=k.useState(null),[a,l]=k.useState(null),[u,h]=k.useState(null),[f,x]=k.useState(!1),[d,b]=k.useState("~/.claude/skills/"),[p,m]=k.useState(!1),g=k.useRef(null),_=Se(ae.features.getFlags)?.skillScanEnabled??!1,E=zt(ae.skillsNode.scanFolder),S=zt(ae.skillsNode.importFromScan),{importFromFile:R,importFromUrl:j,isImporting:M,pendingProjectImport:I,confirmProjectImport:L,cancelProjectImport:K}=ll({sessionId:t,onSuccess:(Z,P)=>{const T=P?` (+ ${P} reference${P!==1?"s":""})`:"";l(`Imported skill: ${Z}${T}`),s(null)},onError:Z=>{s(Z),l(null)}}),C=async Z=>{const P=Z.target.files?.[0];if(!P)return;const T=P.name.toLowerCase();if(!T.endsWith(".md")&&!T.endsWith(".zip")){s("Only .md and .zip files are supported");return}s(null),l(null),await R(P),g.current&&(g.current.value="")},D=k.useCallback(async Z=>{Z.preventDefault(),Z.stopPropagation(),m(!1);const P=Z.dataTransfer.files[0];if(!P)return;const T=P.name.toLowerCase();if(!T.endsWith(".md")&&!T.endsWith(".zip")){s("Only .md and .zip files are supported");return}s(null),l(null),await R(P)},[R]),y=k.useCallback(Z=>{Z.preventDefault(),Z.stopPropagation(),m(!0)},[]),U=k.useCallback(Z=>{Z.preventDefault(),Z.stopPropagation(),m(!1)},[]),V=async()=>{r.trim()&&(s(null),l(null),await j(r.trim()),i||o(""))},H=async()=>{x(!0),s(null),h(null);try{const Z=await E({folderPath:d||void 0});Z.error?s(Z.error):Z.skills.length===0?s("No SKILL.md files found in the specified folder"):h(Z.skills)}catch(Z){s(Z instanceof Error?Z.message:"Scan failed")}finally{x(!1)}},X=async Z=>{s(null),l(null);try{const P=await S({sessionId:t,skills:Z.map(te=>({content:te.content,skillName:te.name,skillDescription:te.description,folderPath:te.folderPath,references:te.references?.map(ee=>({filename:ee.filename,content:ee.content,zone:ee.zone,relativePath:ee.relativePath}))}))}),T=P.references?` (+ ${P.references} references)`:"";l(`Imported ${P.imported} skill${P.imported!==1?"s":""}${T}`),h(null)}catch(P){s(P instanceof Error?P.message:"Import failed")}},B=()=>{s(null),l(null),h(null),o(""),n()};return c.jsx(Nn,{children:e&&c.jsxs(Fe.div,{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",initial:be.initial,animate:be.animate,exit:be.exit,transition:be.transition,children:[c.jsxs(Fe.div,{className:"bg-card border border-border rounded-lg shadow-lg w-full max-w-lg max-h-[80vh] overflow-y-auto",initial:ye.initial,animate:ye.animate,exit:ye.exit,transition:ye.transition,onClick:Z=>Z.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Er,{className:"w-5 h-5 text-amber-600"}),c.jsx("h2",{className:"text-lg font-semibold",children:"Import Skill"})]}),c.jsx(de,{variant:"ghost",size:"sm",onClick:B,children:c.jsx(jn,{className:"w-4 h-4"})})]}),c.jsxs("div",{className:"p-4 space-y-5",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[c.jsx(Si,{className:"w-4 h-4 text-muted-foreground"}),"Upload SKILL.md or .zip"]}),c.jsxs("div",{className:pe("border-2 border-dashed rounded-lg p-4 text-center cursor-pointer transition-colors",p?"border-primary bg-primary/5":"border-border hover:border-muted-foreground/50"),onClick:()=>g.current?.click(),onDrop:D,onDragOver:y,onDragLeave:U,children:[c.jsx("input",{ref:g,type:"file",accept:".md,.zip",onChange:C,className:"hidden"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:p?"Drop file here":"Click or drop a .md or .zip file here"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[c.jsx(Ei,{className:"w-4 h-4 text-muted-foreground"}),"Import from URL"]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"text",value:r,onChange:Z=>o(Z.target.value),onKeyDown:Z=>{Z.key==="Enter"&&V()},placeholder:"https://raw.githubusercontent.com/.../SKILL.md",className:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"}),c.jsx(ft,{onClick:V,disabled:!r.trim()||M,debounceMs:500,size:"sm",children:"Import"})]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Paste a raw GitHub URL or any direct link to a SKILL.md file"})]}),_&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[c.jsx(Ai,{className:"w-4 h-4 text-muted-foreground"}),"Scan Local Folder"]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"text",value:d,onChange:Z=>b(Z.target.value),placeholder:"~/.claude/skills/",className:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"}),c.jsx(ft,{onClick:H,disabled:f,debounceMs:500,size:"sm",children:f?"Scanning...":"Scan"})]}),u&&c.jsx(Dg,{results:u,onImport:X,isImporting:M})]}),i&&c.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-destructive/10 text-destructive text-sm",children:[c.jsx(kl,{className:"w-4 h-4 mt-0.5 shrink-0"}),i]}),a&&c.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-green-500/10 text-green-700 dark:text-green-400 text-sm",children:[c.jsx(_l,{className:"w-4 h-4 mt-0.5 shrink-0"}),a]})]})]}),I&&c.jsx(cl,{pending:I,onConfirm:L,onCancel:K,isImporting:M})]})})}function Dg({results:e,onImport:n,isImporting:t}){const[r,o]=k.useState(()=>new Set(e.map((s,a)=>a))),i=s=>{const a=new Set(r);a.has(s)?a.delete(s):a.add(s),o(a)};return c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"text-sm font-medium",children:["Found ",e.length," skill",e.length!==1?"s":"",":"]}),c.jsx("div",{className:"max-h-60 overflow-y-auto space-y-1",children:e.map((s,a)=>c.jsxs("label",{className:pe("flex items-start gap-2 p-2 rounded border cursor-pointer transition-colors",r.has(a)?"border-amber-300 bg-amber-50/50 dark:border-amber-700 dark:bg-amber-950/30":"border-border hover:bg-muted/50"),children:[c.jsx("input",{type:"checkbox",checked:r.has(a),onChange:()=>i(a),className:"mt-0.5"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"text-sm font-medium",children:s.name}),c.jsx("div",{className:"text-xs text-muted-foreground line-clamp-1",children:s.description}),c.jsxs("div",{className:"text-xs text-muted-foreground font-mono",children:["~",s.tokenEstimate," tokens",s.references&&s.references.length>0&&c.jsxs("span",{className:"ml-2",children:[" ",s.references.length," ref",s.references.length!==1?"s":""]})]})]})]},a))}),c.jsx(ft,{onClick:()=>n(e.filter((s,a)=>r.has(a))),disabled:r.size===0||t,debounceMs:500,className:"w-full",children:t?"Importing...":`Import ${r.size} Skill${r.size!==1?"s":""}`})]})}function ul(e,n,t){const r=e.split(`
`);for(const o of r){const i=o.match(/^#+\s+(.+)/);if(i)return i[1].trim()}for(const o of r){const i=o.trim();if(i)return i.length>60?i.slice(0,60):i}return`${n}-${t}`}function tt(e){return e.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9\-_]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,50)||"untitled"}function dl(e,n,t){const r=`${e}${n}`;if(!t.has(r))return r;for(let o=1;o<1e3;o++){const i=`${e}-${o}${n}`;if(!t.has(i))return i}return`${e}-${Date.now()}${n}`}var hn={exports:{}},Fg=hn.exports,ci;function Lg(){return ci||(ci=1,(function(e,n){(function(t,r){r()})(Fg,function(){function t(u,h){return typeof h>"u"?h={autoBom:!1}:typeof h!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),h={autoBom:!h}),h.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(u.type)?new Blob(["\uFEFF",u],{type:u.type}):u}function r(u,h,f){var x=new XMLHttpRequest;x.open("GET",u),x.responseType="blob",x.onload=function(){l(x.response,h,f)},x.onerror=function(){console.error("could not download file")},x.send()}function o(u){var h=new XMLHttpRequest;h.open("HEAD",u,!1);try{h.send()}catch{}return 200<=h.status&&299>=h.status}function i(u){try{u.dispatchEvent(new MouseEvent("click"))}catch{var h=document.createEvent("MouseEvents");h.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),u.dispatchEvent(h)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof nt=="object"&&nt.global===nt?nt:void 0,a=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(u,h,f){var x=s.URL||s.webkitURL,d=document.createElement("a");h=h||u.name||"download",d.download=h,d.rel="noopener",typeof u=="string"?(d.href=u,d.origin===location.origin?i(d):o(d.href)?r(u,h,f):i(d,d.target="_blank")):(d.href=x.createObjectURL(u),setTimeout(function(){x.revokeObjectURL(d.href)},4e4),setTimeout(function(){i(d)},0))}:"msSaveOrOpenBlob"in navigator?function(u,h,f){if(h=h||u.name||"download",typeof u!="string")navigator.msSaveOrOpenBlob(t(u,f),h);else if(o(u))r(u,h,f);else{var x=document.createElement("a");x.href=u,x.target="_blank",setTimeout(function(){i(x)})}}:function(u,h,f,x){if(x=x||open("","_blank"),x&&(x.document.title=x.document.body.innerText="downloading..."),typeof u=="string")return r(u,h,f);var d=u.type==="application/octet-stream",b=/constructor/i.test(s.HTMLElement)||s.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||d&&b||a)&&typeof FileReader<"u"){var m=new FileReader;m.onloadend=function(){var _=m.result;_=p?_:_.replace(/^data:[^;]*;/,"data:attachment/file;"),x?x.location.href=_:location=_,x=null},m.readAsDataURL(u)}else{var g=s.URL||s.webkitURL,w=g.createObjectURL(u);x?x.location=w:location.href=w,x=null,setTimeout(function(){g.revokeObjectURL(w)},4e4)}});s.saveAs=l.saveAs=l,e.exports=l})})(hn)),hn.exports}var ui=Lg();function Bg(e,n,t){const r=new Map;for(let o=0;o<n.length;o++){const i=n[o],s=i.zone.toLowerCase();let a;if(i.metadata?.skillName)a=tt(i.metadata.skillName.replace(/\.md$/i,""));else{const h=ul(i.content,i.type,o);a=tt(h)}const l=dl(a,".md",t);t.add(l);const u=`references/${s}/${l}`;e.file(u,i.content),r.set(i._id,u)}return r}function di(e,n){if(e.length>0){const t=e[0],r=t.metadata?.skillName||n,o=t.metadata?.skillDescription||"";return`---
name: "${r}"
description: "${o}"
---

${t.content}`}return`---
name: "${n}"
description: "Exported from ContextForge"
---

This skill was exported from a ContextForge session.`}function zg({sessionId:e,projectId:n}){const t=Se(ae.skillExport.getExportData,e?{sessionId:e}:"skip"),r=n??t?.session.projectId??null,o=Se(ae.skillExport.getProjectExportData,r?{projectId:r}:"skip"),[i,s]=k.useState(!1),a=!!r&&!!o,l=k.useCallback(async()=>{if(t){s(!0);try{const d=new kr,{session:b,blocks:p}=t,m=p.filter(S=>S.type==="skill"),g=p.filter(S=>S.type!=="skill");d.file("SKILL.md",di(m,b.name||"Exported Skill")),Bg(d,g,new Set);const _=await d.generateAsync({type:"blob"}),E=tt(m[0]?.metadata?.skillName||b.name||"skill-export");ui.saveAs(_,`${E}.zip`)}finally{s(!1)}}},[t]),u=k.useCallback(async()=>{if(o){s(!0);try{const d=new kr,{project:b,steps:p}=o,m=[];for(const j of p)m.push(...j.blocks.filter(M=>M.type==="skill"));d.file("SKILL.md",di(m,b.name||"Exported Project"));const g=new Map,w=new Set,_=[];for(const j of p){const M=j.blocks.filter(L=>L.type!=="skill"),I={permanent:[],stable:[],working:[]};for(let L=0;L<M.length;L++){const K=M[L],C=K.zone.toLowerCase(),D=g.get(K.content);if(D){I[C].push(D);continue}let y;if(K.metadata?.skillName)y=tt(K.metadata.skillName.replace(/\.md$/i,""));else{const H=ul(K.content,K.type,L);y=tt(H)}const U=dl(y,".md",w);w.add(U);const V=`references/${C}/${U}`;d.file(V,K.content),g.set(K.content,V),I[C].push(V)}_.push({stepName:j.session.name||`Step ${j.session.stepNumber+1}`,...I})}const E={contexts:{}};for(let j=0;j<_.length;j++){const M=_[j],I=tt(M.stepName)||`step-${j+1}`,L={label:M.stepName};M.permanent.length>0&&(L.permanent=M.permanent),M.stable.length>0&&(L.stable=M.stable),M.working.length>0&&(L.working=M.working),j>0&&(L.depends_on=[tt(_[j-1].stepName)||`step-${j}`]),E.contexts[I]=L}d.file("context-map.yaml",al(E,{lineWidth:-1}));const S=await d.generateAsync({type:"blob"}),R=tt(b.name||"project-export");ui.saveAs(S,`${R}.zip`)}finally{s(!1)}}},[o]),h=a?u:l,f=a?o?.steps.reduce((d,b)=>d+b.blocks.length,0)??0:t?.blocks.length??0,x=a?!!o&&o.steps.length>0:!!t&&t.blocks.length>0;return{exportAsZip:h,isExporting:i,isReady:x,isProject:a,blockCount:f,stepCount:o?.steps.length??0}}function Ug({isOpen:e,onClose:n,sessionId:t,projectId:r}){const{exportAsZip:o,isExporting:i,isReady:s,isProject:a,blockCount:l,stepCount:u}=zg({sessionId:t,projectId:r}),h=async()=>{await o(),n()};return c.jsx(Nn,{children:e&&c.jsx(Fe.div,{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",initial:be.initial,animate:be.animate,exit:be.exit,transition:be.transition,children:c.jsxs(Fe.div,{className:"bg-card border border-border rounded-lg shadow-lg w-full max-w-md",initial:ye.initial,animate:ye.animate,exit:ye.exit,transition:ye.transition,onClick:f=>f.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Vl,{className:"w-5 h-5 text-amber-600"}),c.jsx("h2",{className:"text-lg font-semibold",children:a?"Export Project":"Export as Skill"})]}),c.jsx(de,{variant:"ghost",size:"sm",onClick:n,children:c.jsx(jn,{className:"w-4 h-4"})})]}),c.jsxs("div",{className:"p-4 space-y-3",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:a?"Export this project as a Claude Code-compatible skill package with context-map (.zip).":"Export this session as a Claude Code-compatible skill package (.zip)."}),c.jsxs("div",{className:"text-sm space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-muted-foreground",children:"Blocks:"}),c.jsx("span",{className:"font-medium",children:l})]}),a&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-muted-foreground",children:"Steps:"}),c.jsx("span",{className:"font-medium",children:u})]})]}),c.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/30 rounded p-2.5",children:["The ZIP will contain:",c.jsxs("ul",{className:"mt-1 ml-4 list-disc space-y-0.5",children:[c.jsx("li",{children:"SKILL.md  skill definition with frontmatter"}),c.jsx("li",{children:"references/permanent/  permanent zone blocks"}),c.jsx("li",{children:"references/stable/  stable zone blocks"}),c.jsx("li",{children:"references/working/  working zone blocks"}),a&&c.jsx("li",{children:"context-map.yaml  workflow step definitions"})]})]})]}),c.jsxs("div",{className:"p-4 flex justify-end gap-2 border-t border-border",children:[c.jsx(de,{variant:"outline",onClick:n,children:"Cancel"}),c.jsxs(de,{onClick:h,disabled:!s||i,children:[c.jsx(Oi,{className:"w-4 h-4 mr-1"}),i?"Exporting...":"Download ZIP"]})]})]})})})}function $g({...e}){return c.jsx(Np,{"data-slot":"popover",...e})}function Wg({...e}){return c.jsx(jp,{"data-slot":"popover-trigger",...e})}function Hg({className:e,align:n="center",sideOffset:t=4,...r}){return c.jsx(Rp,{children:c.jsx(Op,{"data-slot":"popover-content",align:n,sideOffset:t,className:pe("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...r})})}function Kg({sessionId:e,zone:n,children:t}){const[r,o]=k.useState(!1),[i,s]=k.useState(""),[a,l]=k.useState(null),u=Se(ae.sessions.list),h=Se(ae.blocks.list,a?{sessionId:a}:"skip"),f=_e(ae.blocks.createLinked),x=u?.filter(m=>m._id!==e)??[],d=i?x.filter(m=>(m.name??"").toLowerCase().includes(i.toLowerCase())):x,b=h??[],p=async m=>{await f({sessionId:e,refBlockId:m,zone:n}),o(!1),l(null),s("")};return c.jsxs($g,{open:r,onOpenChange:m=>{o(m),m||(l(null),s(""))},children:[c.jsx(Wg,{asChild:!0,children:t}),c.jsx(Hg,{className:"w-80 p-0",align:"start",children:a?c.jsxs("div",{className:"p-2 space-y-1",children:[c.jsx("button",{className:"text-xs text-muted-foreground hover:text-foreground mb-1",onClick:()=>{l(null),s("")},children:" Back to sessions"}),c.jsxs("div",{className:"max-h-60 overflow-y-auto space-y-0.5",children:[b.map(m=>{const g=Ni(m.type),w=m.content.split(`
`)[0]?.slice(0,60)??"";return c.jsxs("button",{className:"w-full text-left px-2 py-1.5 rounded hover:bg-accent flex items-center gap-1.5",onClick:()=>p(m._id),children:[c.jsx("span",{className:pe("shrink-0 rounded px-1 py-0.5 text-[9px] font-medium",g.color),children:g.displayName}),c.jsx("span",{className:"text-xs truncate text-foreground",children:w||"(empty)"})]},m._id)}),b.length===0&&c.jsx("p",{className:"px-2 py-3 text-sm text-muted-foreground text-center",children:"No blocks in this session"})]})]}):c.jsxs("div",{className:"p-2 space-y-1",children:[c.jsx(Fl,{placeholder:"Search sessions...",value:i,onChange:m=>s(m.target.value),className:"h-8 text-sm",autoFocus:!0}),c.jsxs("div",{className:"max-h-48 overflow-y-auto",children:[d.map(m=>c.jsx("button",{className:"w-full text-left px-2 py-1.5 text-sm rounded hover:bg-accent truncate",onClick:()=>l(m._id),children:m.name??"Untitled"},m._id)),d.length===0&&c.jsx("p",{className:"px-2 py-3 text-sm text-muted-foreground text-center",children:"No other sessions"})]})]})})]})}const $n={PERMANENT:{label:"Permanent",description:"Always included",tint:"bg-blue-500/[0.02] dark:bg-blue-400/[0.03] border-blue-500/10 dark:border-blue-400/10"},STABLE:{label:"Stable",description:"Reference material",tint:"bg-emerald-500/[0.02] dark:bg-emerald-400/[0.03] border-emerald-500/10 dark:border-emerald-400/10"},WORKING:{label:"Working",description:"Draft content",tint:"bg-amber-500/[0.02] dark:bg-amber-400/[0.03] border-amber-500/10 dark:border-amber-400/10"}};function Zg(e){return Math.ceil(e.length/4)}function Gg({sessionId:e}){const[n,t]=k.useState(""),[r,o]=k.useState("note"),[i,s]=k.useState("WORKING"),[a,l]=k.useState(!1),u=k.useMemo(()=>Ol(),[]),h=_e(ae.blocks.create),f=Se(ae.metrics.getZoneMetrics,{sessionId:e}),x=k.useMemo(()=>n.trim()?Zg(n.trim()):0,[n]),d=k.useMemo(()=>{if(!f||!n.trim())return null;const p=f.zones[i];if(!p)return null;const m=p.tokens+x,g=Math.round(m/p.budget*100);return{percentUsed:g,wouldExceed:m>p.budget,isWarning:g>80&&g<=95,isDanger:g>95}},[f,i,x,n]),b=async p=>{p.preventDefault(),!(!n.trim()||d?.wouldExceed)&&(await h({sessionId:e,content:n.trim(),type:r,zone:i}),t(""),l(!1))};return a?c.jsxs("form",{onSubmit:b,className:"rounded border border-border bg-card p-3 space-y-2",children:[c.jsxs("div",{className:"flex gap-2",children:[c.jsx("select",{value:r,onChange:p=>{const m=p.target.value;o(m);const g=io[m];g&&s(g.defaultZone)},className:"rounded border border-input bg-background px-2 py-1 text-xs flex-1",children:Object.entries(u).map(([p,m])=>c.jsx("optgroup",{label:Tl[p],children:m.map(g=>c.jsx("option",{value:g,children:io[g].displayName},g))},p))}),c.jsx("select",{value:i,onChange:p=>s(p.target.value),className:"rounded border border-input bg-background px-2 py-1 text-xs",children:Ar.map(p=>c.jsx("option",{value:p,children:$n[p].label},p))})]}),c.jsx("textarea",{value:n,onChange:p=>t(p.target.value),placeholder:"Block content...",rows:2,className:pe("w-full rounded border bg-background px-2 py-1.5 text-sm resize-none",d?.wouldExceed?"border-destructive":"border-input"),autoFocus:!0}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("span",{className:"text-xs text-muted-foreground",children:[x>0&&`~${x} tokens`,d?.wouldExceed&&c.jsx("span",{className:"text-destructive ml-2",children:"Exceeds budget"})]}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx(de,{type:"button",variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>l(!1),children:"Cancel"}),c.jsx(ft,{type:"submit",size:"sm",className:"h-6 px-2 text-xs",disabled:!n.trim()||d?.wouldExceed,debounceMs:300,children:"Add"})]})]})]}):c.jsx(de,{variant:"outline",size:"sm",onClick:()=>l(!0),className:"h-7 text-xs",children:"+ Add Block"})}function Yg({sessionId:e}){const[n,t]=k.useState(!1);return c.jsxs("div",{children:[c.jsxs(de,{variant:"ghost",size:"sm",onClick:()=>t(!n),className:"h-7 px-2 text-xs text-muted-foreground",children:[n?"":""," Tools"]}),n&&c.jsx("div",{className:"mt-2 space-y-3",children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[c.jsx(ga,{sessionId:e}),c.jsx(Qp,{sessionId:e})]})})]})}function Vg(e){const n=Math.floor((Date.now()-e)/1e3);return n<60?"now":n<3600?`${Math.floor(n/60)}m`:n<86400?`${Math.floor(n/3600)}h`:`${Math.floor(n/86400)}d`}function qg({id:e,content:n,type:t,zone:r,createdAt:o,tokens:i,isDraft:s,isCompressed:a,compressionRatio:l,sessionId:u,isSelected:h,onSelect:f,metadata:x,refBlockId:d,contentHash:b}){const[p,m]=k.useState(!1),[g,w]=k.useState(!1),_=_e(ae.blocks.remove),E=_e(ae.blocks.move),S=_e(ae.blocks.toggleDraft),R=_e(ae.blocks.unlink),j=_e(ae.blocks.createLinked),{toast:M}=_r(),I=Se(ae.blocks.findDuplicate,b&&!d?{contentHash:b,excludeSessionId:u}:"skip"),L=sh({onDelete:async()=>{await _({id:e})},getTitle:()=>"Delete this block?",getDescription:()=>`"${n.slice(0,100)}${n.length>100?"...":""}" will be permanently deleted.`}),{compressSingle:K,isCompressing:C}=qr({sessionId:u,onSuccess:T=>{M.success("Block compressed!",`Saved ${T.tokensSaved} tokens (${T.compressionRatio.toFixed(1)}x)`)},onError:T=>{M.error("Compression failed",T)}}),D=async T=>{T.stopPropagation(),L.requestDelete({id:e,content:n})},y=async(T,te)=>{T.stopPropagation(),await E({id:e,zone:te})},U=async T=>{if(T.stopPropagation(),navigator.clipboard)await navigator.clipboard.writeText(n);else{const te=document.createElement("textarea");te.value=n,te.style.position="fixed",te.style.left="-999999px",te.style.top="-999999px",document.body.appendChild(te),te.focus(),te.select();try{document.execCommand("copy")}finally{document.body.removeChild(te)}}w(!0),setTimeout(()=>w(!1),1500)},V=async T=>{T.stopPropagation(),await K({_id:e,content:n,type:t,tokens:i,isCompressed:a},"semantic")},H=async T=>{T.stopPropagation(),await S({id:e})},X=Ni(t),B=Ar.filter(T=>T!==r),Z=(i??0)>=100,P=T=>{T.stopPropagation(),f?.(T.target.checked)};return c.jsxs("div",{className:pe("rounded-lg border bg-card p-2.5 select-none transition-all duration-150","hover:shadow-sm hover:border-border/80",h?"border-primary bg-primary/5 shadow-sm":"border-border",s&&"opacity-50",d?"border-l-2 border-l-[oklch(0.65_0.08_220)]":""),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[c.jsxs("div",{className:"flex items-center justify-between gap-1 mb-1",children:[c.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[f&&c.jsx("input",{type:"checkbox",checked:h,onChange:P,className:"shrink-0 w-3 h-3 rounded border-input",onClick:T=>T.stopPropagation()}),c.jsx("span",{className:pe("shrink-0 rounded px-1.5 py-0.5 text-[10px] font-medium",X.color),children:X.displayName}),s&&c.jsx("span",{className:"shrink-0 rounded px-1.5 py-0.5 text-[10px] font-medium bg-yellow-500/10 text-yellow-600 dark:text-yellow-400",children:"Draft"}),c.jsx("span",{className:"text-[10px] text-muted-foreground",children:Vg(o)}),i!=null&&c.jsxs("span",{className:"text-[10px] text-muted-foreground font-mono",children:[i,"t"]}),a&&l&&c.jsxs("span",{className:"shrink-0 rounded px-1.5 py-0.5 text-[10px] font-medium bg-blue-500/10 text-blue-600 dark:text-blue-400 flex items-center gap-0.5",children:[c.jsx(Rn,{className:"w-2.5 h-2.5"}),l.toFixed(1),"x"]}),d&&c.jsx("span",{title:"Linked block  used in multiple sessions",className:"inline-flex items-center",children:c.jsx(ar,{className:"w-2.5 h-2.5 text-muted-foreground"})})]}),p&&c.jsxs("div",{className:"flex gap-0.5 shrink-0",children:[Z&&c.jsx(ft,{onClick:V,disabled:C,variant:"ghost",size:"sm",className:"h-auto px-1.5 py-0.5 text-[10px]",debounceMs:300,children:C?"...":"Compress"}),c.jsx("button",{onClick:H,className:"px-1.5 py-0.5 text-[10px] rounded hover:bg-muted",children:s?"Undraft":"Draft"}),c.jsx("button",{onClick:U,className:pe("px-1.5 py-0.5 text-[10px] rounded transition-colors",g&&"bg-emerald-300/20 text-emerald-600 dark:text-emerald-400"),children:g?"Copied!":"Copy"}),c.jsx(bi,{to:"/app/blocks/$blockId",params:{blockId:e},onClick:T=>T.stopPropagation(),className:"px-1.5 py-0.5 text-[10px] rounded hover:bg-muted",children:"Edit"}),d&&c.jsx(ft,{variant:"ghost",size:"sm",className:"h-5 px-1 text-[10px]",onClick:()=>R({id:e}),title:"Unlink  make independent copy",children:c.jsx(Xl,{className:"w-3 h-3"})}),c.jsx("button",{onClick:D,className:"px-1.5 py-0.5 text-[10px] rounded hover:bg-destructive/10 text-destructive",children:"Del"})]})]}),t==="skill"&&x?.skillName&&c.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[c.jsx("span",{className:"text-xs font-medium truncate",children:x.skillName}),x.sourceType==="local"&&c.jsx(Ai,{className:"w-3 h-3 text-muted-foreground shrink-0"}),x.sourceType==="upload"&&c.jsx(Si,{className:"w-3 h-3 text-muted-foreground shrink-0"}),x.sourceType==="url"&&c.jsx(Ei,{className:"w-3 h-3 text-muted-foreground shrink-0"})]}),t==="skill"&&x?.skillDescription&&c.jsx("p",{className:"text-[10px] text-muted-foreground line-clamp-1 mb-0.5",children:x.skillDescription}),t==="reference"&&x?.parentSkillName&&c.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[c.jsx(Er,{className:"w-2.5 h-2.5 text-muted-foreground shrink-0"}),c.jsxs("span",{className:"text-[10px] text-muted-foreground truncate",children:["from: ",x.parentSkillName]})]}),c.jsx("p",{className:"text-xs text-foreground whitespace-pre-wrap break-words line-clamp-2 leading-tight",children:n}),p&&c.jsx("div",{className:"flex gap-1 mt-1",children:B.map(T=>c.jsxs("button",{onClick:te=>y(te,T),className:"px-1.5 py-0.5 text-[10px] rounded border border-input hover:bg-muted",children:[" ",$n[T].label]},T))}),I&&!d&&c.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-accent/50 text-[10px] text-muted-foreground mt-1",children:[c.jsx(ar,{className:"w-3 h-3 shrink-0"}),c.jsxs("span",{className:"truncate",children:["Same as block in ",I.sessionName,"."]}),c.jsx("button",{className:"text-primary hover:underline font-medium shrink-0",onClick:async()=>{await j({sessionId:u,refBlockId:I.blockId,zone:r}),await _({id:e})},children:"Link?"})]}),c.jsx(yi,{open:L.isOpen,onOpenChange:T=>!T&&L.cancelDelete(),title:L.title,description:L.description,onConfirm:L.confirmDelete,loading:L.isDeleting})]})}function Xg({sessionId:e,zone:n,zoneMetrics:t,selectedBlockIds:r,onBlockSelect:o,onSkillFile:i}){const[s,a]=k.useState(!1),l=Se(ae.blocks.listByZone,{sessionId:e,zone:n}),u=$n[n],{toast:h}=_r(),{isDragOver:f,dropProps:x}=rc({sessionId:e,zone:n,onSkillFile:i,onSuccess:()=>{},onError:()=>{}}),{compressAndMerge:d,isCompressing:b,result:p,error:m}=qr({sessionId:e,onSuccess:C=>{h.success(`${u.label} zone compressed!`,`Merged ${l?.length} blocks, saved ${C.tokensSaved} tokens`)},onError:C=>{h.error("Zone compression failed",C)}}),g=()=>{a(!0)},w=async(C,D)=>{!l||l.length===0||await d(l.map(y=>({_id:y._id,content:y.content,type:y.type,tokens:y.tokens??void 0,isCompressed:y.isCompressed})),{strategy:"semantic",targetZone:n,targetType:D})},_=l?[...l].sort((C,D)=>C.position-D.position):[],{optimisticOrder:E,activeBlock:S}=Rl(),R=E[n],j=k.useMemo(()=>new Map(_.map(C=>[C._id,C])),[_]),M=k.useMemo(()=>R?R.map(C=>{const D=j.get(C);return D||(S&&S._id===C?{_id:S._id,content:S.content,type:S.type,zone:n,position:S.position,createdAt:S.createdAt,tokens:S.tokens??null,isCompressed:S.isCompressed??!1,compressionRatio:S.compressionRatio??null,metadata:S.metadata??null,sessionId:e,_creationTime:S.createdAt}:null)}).filter(Boolean):_,[R,_,j,S,e,n]),I=k.useMemo(()=>M.map(C=>C._id),[M]),L=t&&t.percentUsed>95,K=t&&t.percentUsed>80&&t.percentUsed<=95;return c.jsxs("div",{className:"flex flex-col h-full relative",...x,children:[c.jsxs("div",{className:"mb-2",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("div",{className:"flex-1 min-w-0",children:t?c.jsx(gr,{zone:u.label,blockCount:t.blocks,tokens:t.tokens,budget:t.budget,onCompress:g,isCompressing:b}):c.jsx(kn,{})}),c.jsx(Kg,{sessionId:e,zone:n,children:c.jsx("button",{className:"w-5 h-5 rounded border border-dashed border-border hover:border-foreground/30 flex items-center justify-center transition-colors shrink-0",title:"Link a block from another session",children:c.jsx(ar,{className:"w-3 h-3 text-muted-foreground"})})})]}),L&&c.jsxs("div",{className:"mt-1 p-1 rounded bg-destructive/10 text-destructive text-[10px]",children:[t?.percentUsed,"% - consider archiving"]}),K&&c.jsxs("div",{className:"mt-1 p-1 rounded bg-yellow-500/10 text-yellow-600 dark:text-yellow-400 text-[10px]",children:[t?.percentUsed,"% used"]})]}),c.jsx(Jl,{zone:n,itemIds:I,children:c.jsx("div",{className:"flex-1 space-y-1.5 min-h-[60px] overflow-y-auto",children:l===void 0?c.jsx("div",{className:"space-y-1.5",children:[0,1].map(C=>c.jsxs("div",{className:"rounded-lg border border-border bg-card p-2.5",children:[c.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[c.jsx(ge,{className:"h-4 w-14 rounded"}),c.jsx(ge,{className:"h-3 w-10"}),c.jsx(ge,{className:"h-3 w-8"})]}),c.jsx(ge,{className:"h-3 w-full mb-1"}),c.jsx(ge,{className:"h-3 w-3/4"})]},C))}):M.length===0?c.jsx("div",{className:"text-xs text-muted-foreground text-center py-4 border border-dashed border-border rounded",children:"Drop here"}):M.map(C=>c.jsx(Ql,{id:C._id,zone:C.zone,position:C.position,children:c.jsx(qg,{id:C._id,content:C.content,type:C.type,zone:C.zone,createdAt:C.createdAt,tokens:C.tokens??void 0,isDraft:C.isDraft,isCompressed:C.isCompressed,compressionRatio:C.compressionRatio,sessionId:e,isSelected:r.has(C._id),onSelect:D=>o(C._id,D),metadata:C.metadata??void 0,refBlockId:C.refBlockId,contentHash:C.contentHash})},C._id))})}),f&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-primary/10 border-2 border-dashed border-primary rounded z-10 pointer-events-none",children:c.jsx("div",{className:"text-xs font-medium text-primary",children:"Drop file"})}),l&&c.jsx(xa,{isOpen:s,onClose:()=>a(!1),blocks:l.map(C=>({_id:C._id,content:C.content,type:C.type,tokens:C.tokens??void 0,isCompressed:C.isCompressed})),onCompress:w,isCompressing:b,result:p,error:m})]})}function Qg({sessionId:e,selectedBlockIds:n,onBlockSelect:t,onSkillFile:r}){const o=Se(ae.metrics.getZoneMetrics,{sessionId:e});return c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 flex-1 min-h-0",children:Ar.map(i=>c.jsx("div",{className:pe("rounded-lg border p-2 flex flex-col min-h-0 overflow-hidden",$n[i].tint),children:c.jsx(Xg,{sessionId:e,zone:i,zoneMetrics:o?.zones[i],selectedBlockIds:n,onBlockSelect:t,onSkillFile:r})},i))})}function Jg(){const{createSession:e}=Sr();return c.jsxs("div",{className:"text-center py-12",children:[c.jsx("h2",{className:"text-lg font-semibold mb-2",children:"No Session Selected"}),c.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create a session to start."}),c.jsx(de,{onClick:()=>e("My First Session"),children:"Create Session"})]})}function ex({sessionId:e}){const n=Cl(),{switchSession:t}=Sr(),r=Se(ae.sessions.getWorkflowContext,{sessionId:e}),o=_e(ae.sessions.goToNextStep),[i,s]=k.useState(!1);if(!r)return null;const a=async()=>{s(!0);try{const l=await o({sessionId:e});localStorage.setItem("contextforge-session-id",l.sessionId),t(l.sessionId),n({to:"/app"})}finally{s(!1)}};return c.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 rounded-md bg-muted/50 border border-border text-xs",children:[c.jsx(bi,{to:"/app/projects/$projectId",params:{projectId:r.projectId},className:"text-muted-foreground hover:text-foreground",children:r.workflowName}),c.jsx("span",{className:"text-muted-foreground",children:""}),c.jsxs("span",{className:"font-medium",children:["Step ",r.currentStepIndex+1,"/",r.totalSteps]}),c.jsx("span",{className:"text-muted-foreground",children:""}),c.jsx("span",{children:r.currentStepName}),r.hasNextStep&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-muted-foreground",children:""}),c.jsx(de,{variant:"ghost",size:"sm",onClick:a,disabled:i,className:"h-5 px-2 text-xs",children:i?"...":`Next: ${r.nextStepName} `})]}),!r.hasNextStep&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-muted-foreground",children:""}),c.jsx("span",{className:"text-green-600 dark:text-green-400",children:" Final step"})]})]})}function fx(){const{sessionId:e,isLoading:n}=Sr(),[t,r]=k.useState(new Set),[o,i]=k.useState(!1),[s,a]=k.useState(!1),[l,u]=k.useState(!1),{toast:h}=_r(),{importFromFile:f,isImporting:x,pendingProjectImport:d,confirmProjectImport:b,cancelProjectImport:p}=ll({sessionId:e,onSuccess:(K,C)=>{const D=C?` (+ ${C} reference${C!==1?"s":""})`:"";h.success("Skill imported",`${K}${D}`)},onError:K=>h.error("Skill import failed",K)}),m=k.useCallback((K,C)=>{f(K,C)},[f]),g=Se(ae.blocks.list,e?{sessionId:e}:"skip"),{compressAndMerge:w,isCompressing:_,result:E,error:S}=qr({sessionId:e,onSuccess:K=>{r(new Set),h.success("Compression successful!",`Saved ${K.tokensSaved} tokens (${K.compressionRatio.toFixed(1)}x compression)`)},onError:K=>{h.error("Compression failed",K)}}),R=g?g.filter(K=>t.has(K._id)):[],j=(K,C)=>{r(D=>{const y=new Set(D);return C?y.add(K):y.delete(K),y})},M=()=>{r(new Set)},I=()=>{i(!0)},L=async(K,C)=>{await w(R,{strategy:"semantic",targetZone:K,targetType:C})};return n?c.jsxs("div",{className:"flex flex-col gap-3 h-[calc(100vh-120px)]",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ge,{className:"h-5 w-24"}),c.jsx(ge,{className:"h-1.5 w-12 rounded-full"}),c.jsx(ge,{className:"h-5 w-10"}),c.jsx(ge,{className:"h-7 w-20 rounded-md"})]}),c.jsx("div",{className:"grid grid-cols-3 gap-3 flex-1 min-h-0",children:[0,1,2].map(K=>c.jsxs("div",{className:"flex flex-col h-full",children:[c.jsx("div",{className:"mb-2",children:c.jsx(kn,{})}),c.jsx("div",{className:"flex-1 space-y-1.5",children:[0,1].map(C=>c.jsxs("div",{className:"rounded-lg border border-border bg-card p-2.5",children:[c.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[c.jsx(ge,{className:"h-4 w-14 rounded"}),c.jsx(ge,{className:"h-3 w-10"}),c.jsx(ge,{className:"h-3 w-8"})]}),c.jsx(ge,{className:"h-3 w-full mb-1"}),c.jsx(ge,{className:"h-3 w-3/4"})]},C))})]},K))})]}):e?c.jsxs("div",{className:"flex flex-col gap-3 h-[calc(100vh-120px)]",children:[c.jsx(ex,{sessionId:e}),c.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ga,{sessionId:e,collapsed:!0}),c.jsx(Gg,{sessionId:e}),c.jsxs(de,{variant:"outline",size:"sm",onClick:()=>a(!0),className:"h-7 text-xs",children:[c.jsx(Er,{className:"w-3 h-3 mr-1"}),"Import Skill"]}),c.jsxs(de,{variant:"outline",size:"sm",onClick:()=>u(!0),className:"h-7 text-xs",children:[c.jsx(Oi,{className:"w-3 h-3 mr-1"}),"Export Skill"]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(qp,{sessionId:e,compact:!0}),c.jsx(Yg,{sessionId:e})]})]}),c.jsx(Qg,{sessionId:e,selectedBlockIds:t,onBlockSelect:j,onSkillFile:m}),t.size>0&&c.jsxs("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 bg-card border border-border rounded-xl shadow-xl shadow-black/5 dark:shadow-black/20 p-3 flex items-center gap-3 z-40 backdrop-blur-sm",children:[c.jsxs("span",{className:"text-sm font-medium",children:[t.size," block",t.size>1?"s":""," selected"]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(de,{variant:"ghost",size:"sm",onClick:M,children:"Clear"}),c.jsxs(de,{size:"sm",onClick:I,disabled:t.size<2,children:[c.jsx(Rn,{className:"w-4 h-4 mr-1"}),"Compress & Merge"]})]})]}),c.jsx(xa,{isOpen:o,onClose:()=>i(!1),blocks:R,onCompress:L,isCompressing:_,result:E,error:S}),e&&c.jsx(Mg,{isOpen:s,onClose:()=>a(!1),sessionId:e}),e&&c.jsx(Ug,{isOpen:l,onClose:()=>u(!1),sessionId:e}),d&&c.jsx(cl,{pending:d,onConfirm:b,onCancel:p,isImporting:x})]}):c.jsx(Jg,{})}export{fx as component};
