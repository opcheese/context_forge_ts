import{c as y,g as b,b as C,F as S,r as d,j as e,k as w}from"./index-lxgQ_mJ1.js";import{a as j}from"./api-CRlO8hFs.js";import{B as a}from"./button-NEfGHqYM.js";import{P as D}from"./PublishDialog-By72voQb.js";function I(t){const n=Math.floor((Date.now()-t)/1e3);return n<60?"just now":n<3600?`${Math.floor(n/60)}m ago`:n<86400?`${Math.floor(n/3600)}h ago`:`${Math.floor(n/86400)}d ago`}function W({isOpen:t,onClose:n}){const[c,p]=d.useState(""),[l,m]=d.useState(""),[u,o]=d.useState(!1),i=b(j.workflows.create),x=async s=>{s.preventDefault(),o(!0);try{await i({name:c.trim(),description:l.trim()||void 0}),p(""),m(""),n()}finally{o(!1)}};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Create New Workflow"}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"workflow-name",className:"block text-sm font-medium mb-1",children:"Name"}),e.jsx("input",{id:"workflow-name",type:"text",value:c,onChange:s=>p(s.target.value),placeholder:"IRD Documentation Workflow",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"workflow-description",className:"block text-sm font-medium mb-1",children:"Description (optional)"}),e.jsx("textarea",{id:"workflow-description",value:l,onChange:s=>m(s.target.value),placeholder:"Describe the purpose of this workflow...",rows:3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{type:"button",variant:"outline",onClick:n,children:"Cancel"}),e.jsx(a,{type:"submit",disabled:!c.trim()||u,children:u?"Creating...":"Create Workflow"})]})]})]})}):null}function z({workflow:t,isOpen:n,onClose:c,onStarted:p}){const[l,m]=d.useState(""),[u,o]=d.useState(""),[i,x]=d.useState(!1),s=b(j.workflows.startProject),h=async f=>{f.preventDefault(),x(!0);try{const g=await s({workflowId:t._id,projectName:l.trim(),projectDescription:u.trim()||void 0});m(""),o(""),c(),p(g.projectId)}finally{x(!1)}};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Start Workflow"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:['This will create a new project using the "',t.name,'" workflow.']}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"project-name",className:"block text-sm font-medium mb-1",children:"Project Name"}),e.jsx("input",{id:"project-name",type:"text",value:l,onChange:f=>m(f.target.value),placeholder:"My New Game Design",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"project-description",className:"block text-sm font-medium mb-1",children:"Project Description (optional)"}),e.jsx("textarea",{id:"project-description",value:u,onChange:f=>o(f.target.value),placeholder:"Describe the project...",rows:2,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{type:"button",variant:"outline",onClick:c,children:"Cancel"}),e.jsx(a,{type:"submit",disabled:!l.trim()||i,children:i?"Starting...":"Start Project"})]})]})]})}):null}function F({workflow:t,onStart:n,onDelete:c,onClone:p,onPublish:l,onUnpublish:m}){const[u,o]=d.useState(!1),[i,x]=d.useState(!1);return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(w,{to:"/app/workflows/$workflowId",params:{workflowId:t._id},className:"font-semibold text-lg truncate hover:underline",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:t.description})]}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-nowrap",children:I(t.updatedAt)})]}),e.jsx("div",{className:"mt-3 flex gap-2 flex-wrap",children:e.jsxs("span",{className:"text-xs px-2 py-1 rounded-md bg-muted",children:[t.steps.length," step",t.steps.length!==1?"s":""]})}),i&&t.steps.length>0&&e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Steps:"}),t.steps.map((s,h)=>e.jsxs("div",{className:"text-xs p-2 rounded-md bg-muted/50 flex items-center gap-2",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-primary/10 text-primary flex items-center justify-center font-medium",children:h+1}),e.jsx("span",{className:"font-medium",children:s.name}),s.templateId&&e.jsx("span",{className:"text-muted-foreground",children:"(has template)"}),s.carryForwardZones&&s.carryForwardZones.length>0&&e.jsxs("span",{className:"text-muted-foreground",children:["(carries: ",s.carryForwardZones.join(", "),")"]})]},h))]}),e.jsx("div",{className:"mt-3",children:e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>x(!i),className:"text-xs h-7",children:i?"Hide Steps":"Show Steps"})}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-border flex gap-2 flex-wrap",children:[e.jsx(a,{variant:"default",size:"sm",onClick:n,disabled:t.steps.length===0,children:"Start Workflow"}),e.jsx(w,{to:"/app/workflows/$workflowId",params:{workflowId:t._id},children:e.jsx(a,{variant:"outline",size:"sm",children:"Edit"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:p,children:"Clone"}),u?e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"destructive",size:"sm",onClick:c,children:"Confirm"}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>o(!1),children:"Cancel"})]}):e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>o(!0),className:"text-destructive hover:text-destructive",children:"Delete"}),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:t.publishedMarketplaceId?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 font-medium",children:"Published"}),e.jsx(a,{variant:"ghost",size:"sm",onClick:l,className:"text-xs h-7",children:"Update"}),e.jsx(a,{variant:"ghost",size:"sm",onClick:m,className:"text-xs h-7 text-destructive hover:text-destructive",children:"Unpublish"})]}):e.jsx(a,{variant:"ghost",size:"sm",onClick:l,className:"text-xs h-7",children:"Publish"})})]})]})}function L(){const t=y(j.workflows.list),n=b(j.workflows.remove),c=b(j.workflows.clone),p=b(j.marketplace.unpublish),l=C(),{toast:m}=S(),[u,o]=d.useState(!1),[i,x]=d.useState(null),[s,h]=d.useState(null),f=async r=>{if(r.publishedMarketplaceId)try{await p({id:r.publishedMarketplaceId}),m.success("Unpublished",`"${r.name}" removed from marketplace`)}catch(k){m.error("Error",String(k))}},g=async r=>{await n({id:r})},v=async r=>{await c({workflowId:r._id,name:`${r.name} (Copy)`})},N=r=>{l({to:"/app/projects/$projectId",params:{projectId:r}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Workflows"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Define multi-step document creation pipelines"})]}),e.jsx(a,{onClick:()=>o(!0),children:"+ New Workflow"})]}),t===void 0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Loading workflows..."}):t.length===0?e.jsxs("div",{className:"text-center py-12 border border-dashed border-border rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No workflows yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Create a workflow to define a multi-step document creation process."}),e.jsx(a,{onClick:()=>o(!0),children:"Create Your First Workflow"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:t.map(r=>e.jsx(F,{workflow:r,onStart:()=>x(r),onDelete:()=>g(r._id),onClone:()=>v(r),onPublish:()=>h(r),onUnpublish:()=>f(r)},r._id))}),e.jsx(W,{isOpen:u,onClose:()=>o(!1)}),i&&e.jsx(z,{workflow:i,isOpen:!0,onClose:()=>x(null),onStarted:N}),s&&e.jsx(D,{isOpen:!0,onClose:()=>h(null),type:"workflow",sourceId:s._id,sourceName:s.name,sourceDescription:s.description,publishedMarketplaceId:s.publishedMarketplaceId})]})}export{L as component};
