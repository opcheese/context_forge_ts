import{H as I,k as A,b as E,d as v,r as o,j as e,i as F}from"./index-C_UHGseK.js";import{a as b}from"./api-B6BZvDqw.js";import{B as l}from"./button-nz7UIBa1.js";function W({workflow:r,isOpen:c,onClose:s}){const[u,p]=o.useState(r.name),[x,f]=o.useState(r.description??""),[h,i]=o.useState(!1),g=v(b.workflows.update),m=async d=>{d.preventDefault(),i(!0);try{await g({id:r._id,name:u.trim(),description:x.trim()||void 0}),s()}finally{i(!1)}};return c?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Edit Workflow"}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-name",className:"block text-sm font-medium mb-1",children:"Name"}),e.jsx("input",{id:"edit-name",type:"text",value:u,onChange:d=>p(d.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-description",className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{id:"edit-description",value:x,onChange:d=>f(d.target.value),rows:3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:s,children:"Cancel"}),e.jsx(l,{type:"submit",disabled:!u.trim()||h,children:h?"Saving...":"Save Changes"})]})]})]})}):null}function D({isOpen:r,onClose:c,existingStep:s,onSave:u}){const[p,x]=o.useState(s?.name??""),[f,h]=o.useState(s?.description??""),[i,g]=o.useState(s?.templateId??""),[m,d]=o.useState(s?.carryForwardZones??[]),[j,w]=o.useState(!1),N=E(b.templates.list),k=async t=>{t.preventDefault(),w(!0);try{await u({name:p.trim(),description:f.trim()||void 0,templateId:i||void 0,carryForwardZones:m.length>0?m:void 0}),x(""),h(""),g(""),d([]),c()}finally{w(!1)}},y=t=>{m.includes(t)?d(m.filter(S=>S!==t)):d([...m,t])};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s?"Edit Step":"Add Step"}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"step-name",className:"block text-sm font-medium mb-1",children:"Step Name"}),e.jsx("input",{id:"step-name",type:"text",value:p,onChange:t=>x(t.target.value),placeholder:"IRD Creation",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"step-description",className:"block text-sm font-medium mb-1",children:"Description (optional)"}),e.jsx("textarea",{id:"step-description",value:f,onChange:t=>h(t.target.value),placeholder:"What happens in this step...",rows:2,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"step-template",className:"block text-sm font-medium mb-1",children:"Template (optional)"}),e.jsxs("select",{id:"step-template",value:i,onChange:t=>g(t.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"No template"}),N?.map(t=>e.jsxs("option",{value:t._id,children:[t.name," (",t.blocks.length," blocks)"]},t._id))]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Template blocks and system prompt will be loaded when starting this step."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Carry Forward from Previous Step"}),e.jsx("div",{className:"flex gap-2",children:["PERMANENT","STABLE","WORKING"].map(t=>e.jsx("button",{type:"button",onClick:()=>y(t),className:`px-3 py-1 rounded-md text-xs font-medium transition-colors ${m.includes(t)?t==="PERMANENT"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":t==="STABLE"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:t},t))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Selected zones will be copied from the previous step's session."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:c,children:"Cancel"}),e.jsx(l,{type:"submit",disabled:!p.trim()||j,children:j?"Saving...":s?"Save Changes":"Add Step"})]})]})]})}):null}function Z({step:r,index:c,totalSteps:s,onEdit:u,onDelete:p,onMoveUp:x,onMoveDown:f}){const[h,i]=o.useState(!1);return e.jsx("div",{className:"rounded-lg border border-border bg-card p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 text-primary flex items-center justify-center font-semibold",children:c+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:r.name}),r.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:x,disabled:c===0,className:"h-8 w-8 p-0",children:"↑"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:f,disabled:c===s-1,className:"h-8 w-8 p-0",children:"↓"})]})]}),e.jsxs("div",{className:"mt-2 flex gap-2 flex-wrap",children:[r.template?e.jsxs("span",{className:"text-xs px-2 py-1 rounded-md bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300",children:["Template: ",r.template.name]}):r.templateId?e.jsx("span",{className:"text-xs px-2 py-1 rounded-md bg-muted text-muted-foreground",children:"Template (not found)"}):null,r.carryForwardZones&&r.carryForwardZones.length>0&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-md bg-muted",children:["Carries: ",r.carryForwardZones.join(", ")]})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:u,children:"Edit"}),h?e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"destructive",size:"sm",onClick:p,children:"Confirm"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>i(!1),children:"Cancel"})]}):e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>i(!0),className:"text-destructive hover:text-destructive",children:"Remove"})]})]})]})})}function M(){const{workflowId:r}=I.useParams(),c=A(),s=E(b.workflows.get,{id:r}),u=v(b.workflows.addStep),p=v(b.workflows.updateStep),x=v(b.workflows.removeStep),f=v(b.workflows.reorderSteps),h=v(b.workflows.remove),[i,g]=o.useState(!1),[m,d]=o.useState(!1),[j,w]=o.useState(null),N=async n=>{await u({workflowId:r,name:n.name,description:n.description,templateId:n.templateId,carryForwardZones:n.carryForwardZones})},k=async(n,a)=>{await p({workflowId:r,stepIndex:n,name:a.name,description:a.description,templateId:a.templateId,carryForwardZones:a.carryForwardZones})},y=async n=>{await x({workflowId:r,stepIndex:n})},t=async(n,a)=>{await f({workflowId:r,fromIndex:n,toIndex:a})},S=async()=>{await h({id:r}),c({to:"/app/workflows"})};if(s===void 0)return e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Loading workflow..."});if(s===null)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-lg font-medium mb-2",children:"Workflow not found"}),e.jsx(F,{to:"/app/workflows",children:e.jsx(l,{variant:"outline",children:"Back to Workflows"})})]});const C=j!==null?s.steps[j]:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(F,{to:"/app/workflows",className:"hover:text-foreground",children:"Workflows"}),e.jsx("span",{children:"/"})]}),e.jsx("h1",{className:"text-2xl font-bold",children:s.name}),s.description&&e.jsx("p",{className:"text-muted-foreground mt-1",children:s.description})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(l,{variant:"outline",onClick:()=>g(!0),children:"Edit Info"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Steps (",s.steps.length,")"]}),e.jsx(l,{onClick:()=>d(!0),children:"+ Add Step"})]}),s.steps.length===0?e.jsxs("div",{className:"text-center py-8 border border-dashed border-border rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"This workflow has no steps yet. Add steps to define your document creation process."}),e.jsx(l,{onClick:()=>d(!0),children:"Add First Step"})]}):e.jsx("div",{className:"space-y-3",children:s.steps.map((n,a)=>e.jsx(Z,{step:n,index:a,totalSteps:s.steps.length,onEdit:()=>w(a),onDelete:()=>y(a),onMoveUp:()=>t(a,a-1),onMoveDown:()=>t(a,a+1)},a))})]}),e.jsxs("div",{className:"pt-6 border-t border-border",children:[e.jsx("h3",{className:"text-sm font-medium text-destructive mb-2",children:"Danger Zone"}),e.jsx(l,{variant:"destructive",size:"sm",onClick:S,children:"Delete Workflow"})]}),i&&e.jsx(W,{workflow:s,isOpen:i,onClose:()=>g(!1)}),e.jsx(D,{isOpen:m,onClose:()=>d(!1),onSave:N}),C&&e.jsx(D,{isOpen:j!==null,onClose:()=>w(null),existingStep:C,onSave:n=>k(j,n)})]})}export{M as component};
