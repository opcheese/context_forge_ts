---
import Base from "../layouts/Base.astro"
import Header from "../components/Header.astro"
import Footer from "../components/Footer.astro"
import { readFile } from "node:fs/promises"
import { resolve } from "node:path"

// Read PRIVACY.md from repo root and render as HTML
const privacyMd = await readFile(resolve(process.cwd(), "../PRIVACY.md"), "utf-8")
// Simple markdown-to-HTML (headings, paragraphs, links, lists)
function mdToHtml(md: string): string {
  return md
    .replace(/^### (.+)$/gm, '<h3 class="text-lg font-semibold mt-6 mb-2">$1</h3>')
    .replace(/^## (.+)$/gm, '<h2 class="text-xl font-bold mt-8 mb-3">$1</h2>')
    .replace(/^# (.+)$/gm, '<h1 class="text-2xl font-bold mb-4">$1</h1>')
    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" class="text-primary underline underline-offset-2 hover:text-primary/80" target="_blank" rel="noopener noreferrer">$1</a>')
    .replace(/\*\*([^*]+)\*\*/g, "<strong>$1</strong>")
    .replace(/^- (.+)$/gm, '<li class="ml-4 list-disc">$1</li>')
    .replace(/\n\n/g, '</p><p class="text-muted-foreground leading-relaxed mb-4">')
    .replace(/^/, '<p class="text-muted-foreground leading-relaxed mb-4">')
    .replace(/$/, "</p>")
}
const html = mdToHtml(privacyMd)
---

<Base title="Privacy Policy" description="ContextForge privacy policy â€” how we handle your data.">
  <div class="min-h-screen bg-background text-foreground flex flex-col">
    <Header />
    <main class="flex-1 mx-auto max-w-3xl px-6 sm:px-8 py-14 sm:py-20">
      <article class="prose prose-neutral dark:prose-invert max-w-none" set:html={html} />
    </main>
    <Footer />
  </div>
</Base>
