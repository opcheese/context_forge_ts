import{b as g,d as b,G as f,r as m,j as e}from"./index-C_UHGseK.js";import{a as p}from"./api-B6BZvDqw.js";import{B as l}from"./button-nz7UIBa1.js";import{P as j}from"./PublishDialog-nuvd-uIK.js";function v(t){const a=Math.floor((Date.now()-t)/1e3);return a<60?"just now":a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:`${Math.floor(a/86400)}d ago`}function N({template:t,onDelete:a,onEdit:x,onPublish:d,onUnpublish:u}){const[c,n]=m.useState(!1),[o,h]=m.useState(!1),i=t.blocks.reduce((s,r)=>(s[r.zone]=(s[r.zone]||0)+1,s),{});return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-lg truncate",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:t.description})]}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-nowrap",children:v(t.createdAt)})]}),e.jsxs("div",{className:"mt-3 flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-xs px-2 py-1 rounded-md bg-muted",children:[t.blocks.length," blocks"]}),i.PERMANENT&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-md bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",children:["PERMANENT: ",i.PERMANENT]}),i.STABLE&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-md bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300",children:["STABLE: ",i.STABLE]}),i.WORKING&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-md bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300",children:["WORKING: ",i.WORKING]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>h(!o),className:"text-xs h-7",children:o?"Hide Details":"Show Details"}),o&&e.jsx("div",{className:"mt-3 space-y-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Blocks Preview:"}),e.jsx("div",{className:"space-y-1 max-h-48 overflow-auto",children:t.blocks.map((s,r)=>e.jsxs("div",{className:"text-xs p-2 rounded-md bg-muted/50 flex items-start gap-2",children:[e.jsxs("span",{className:"font-mono text-muted-foreground shrink-0",children:["[",s.zone,"]"]}),e.jsxs("span",{className:"truncate",children:[s.content.slice(0,100),"..."]})]},r))})]})})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-border flex gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:x,children:"Edit"}),c?e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"destructive",size:"sm",onClick:a,children:"Confirm Delete"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>n(!1),children:"Cancel"})]}):e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>n(!0),className:"text-destructive hover:text-destructive",children:"Delete"}),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:t.publishedMarketplaceId?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 font-medium",children:"Published"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:d,className:"text-xs h-7",children:"Update"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:u,className:"text-xs h-7 text-destructive hover:text-destructive",children:"Unpublish"})]}):e.jsx(l,{variant:"ghost",size:"sm",onClick:d,className:"text-xs h-7",children:"Publish"})})]})]})}function y({template:t,isOpen:a,onClose:x}){const[d,u]=m.useState(t.name),[c,n]=m.useState(t.description??""),[o,h]=m.useState(!1),i=b(p.templates.update),s=async r=>{r.preventDefault(),h(!0);try{await i({id:t._id,name:d.trim(),description:c.trim()||void 0}),x()}finally{h(!1)}};return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Edit Template"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"To edit blocks, apply this template to a session, make changes, then save as template to overwrite."}),e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-name",className:"block text-sm font-medium mb-1",children:"Name"}),e.jsx("input",{id:"edit-name",type:"text",value:d,onChange:r=>u(r.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-description",className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{id:"edit-description",value:c,onChange:r=>n(r.target.value),rows:2,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:x,children:"Cancel"}),e.jsx(l,{type:"submit",disabled:!d.trim()||o,children:o?"Saving...":"Save Changes"})]})]})]})}):null}function S(){const t=g(p.templates.list),a=b(p.templates.remove),x=b(p.marketplace.unpublish),{toast:d}=f(),[u,c]=m.useState(null),[n,o]=m.useState(null),h=async s=>{if(s.publishedMarketplaceId)try{await x({id:s.publishedMarketplaceId}),d.success("Unpublished",`"${s.name}" removed from marketplace`)}catch(r){d.error("Error",String(r))}},i=async s=>{await a({id:s})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Template Library"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Reusable session configurations for your workflows"})]}),t===void 0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Loading templates..."}):t.length===0?e.jsxs("div",{className:"text-center py-12 border border-dashed border-border rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No templates yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Save your current session as a template to create reusable configurations."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Use the "Save Template" button in the header when you have a session ready.'})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:t.map(s=>e.jsx(N,{template:s,onDelete:()=>i(s._id),onEdit:()=>c(s),onPublish:()=>o(s),onUnpublish:()=>h(s)},s._id))}),u&&e.jsx(y,{template:u,isOpen:!0,onClose:()=>c(null)}),n&&e.jsx(j,{isOpen:!0,onClose:()=>o(null),type:"template",sourceId:n._id,sourceName:n.name,sourceDescription:n.description,publishedMarketplaceId:n.publishedMarketplaceId})]})}export{S as component};
